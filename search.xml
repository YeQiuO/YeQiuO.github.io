<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>æ·±åº¦å­¦ä¹ åŸºç¡€</title>
    <url>/DL-basic/</url>
    <content><![CDATA[<h1 id="åå·®æ–¹å·®">åå·®æ–¹å·®</h1>
<p><a
href="https://www.cnblogs.com/makefile/p/bias-var.html#fn2">å‚è€ƒæ–‡ç« </a></p>
<h2 id="æ³›åŒ–è¯¯å·®">æ³›åŒ–è¯¯å·®</h2>
<p>æ¨¡å‹çš„å¹³æ–¹é¢„æµ‹è¯¯å·®çš„æœŸæœ›</p>
<p><span
class="math display">\[Err(\mathbf{x})=E\left[\left(y-f(\mathbf{x};D)\right)^2\right]=\mathbb{E}_D\left[\left(f(\boldsymbol{x};D)-\bar{f}\left(\boldsymbol{x}\right)\right)^2\right]+\left(\bar{f}(\boldsymbol{x})-y\right)^2+\mathbb{E}_D\left[(y_D-y)^2\right]\]</span></p>
<h2 id="æ–¹å·®">æ–¹å·®</h2>
<blockquote>
<p>æ–¹å·®æ˜¯æŒ‡æ¨¡å‹å¯¹äºä¸åŒè®­ç»ƒé›†çš„é¢„æµ‹ç»“æœçš„æ³¢åŠ¨ç¨‹åº¦ï¼ˆå³æ³›åŒ–èƒ½åŠ›ï¼‰ï¼Œ<strong>åˆ»ç”»äº†æ•°æ®æ‰°åŠ¨æ‰€é€ æˆçš„å½±å“</strong>ã€‚é«˜æ–¹å·®æ„å‘³ç€æ¨¡å‹è¿‡äºå¤æ‚ï¼Œå¯¹è®­ç»ƒæ•°æ®ä¸­çš„å™ªå£°å’Œç»†èŠ‚è¿‡äºæ•æ„Ÿï¼Œè¡¨ç¤ºæ¨¡å‹<strong>è¿‡æ‹Ÿåˆ</strong></p>
</blockquote>
<p>ä½¿ç”¨æ ·æœ¬æ•°ç›¸åŒçš„ä¸åŒè®­ç»ƒé›†äº§ç”Ÿçš„æ–¹å·®</p>
<p><span
class="math display">\[\mathrm{var}(\mathbf{x})=\mathrm{E}_\mathrm{D}\left[\left(\mathrm{f}(\mathbf{x};\mathrm{D})-\overline{\mathrm{f}}(\mathbf{x})\right)^2\right]\]</span></p>
<p>å…¶ä¸­ï¼Œç®—æ³• ğ‘“ å¯¹æµ‹è¯•æ ·æœ¬ ğ‘¥ çš„æœŸæœ›é¢„æµ‹ï¼ˆä¸åŒè®­ç»ƒé›† ğ· ä¸Šæ¨¡å‹ ğ‘“
å¯¹æµ‹è¯•æ ·æœ¬ ğ‘¥ çš„é¢„æµ‹è¾“å‡ºçš„æœŸæœ›ï¼‰<span
class="math inline">\(\overline{f}(\mathbf{x})=E_D[f\left(\mathbf{x};D\right)]\)</span></p>
<h2 id="åå·®">åå·®</h2>
<blockquote>
<p>åå·®æ˜¯æŒ‡æ¨¡å‹çš„é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚ï¼Œ<strong>æ¨¡å‹æœ¬èº«çš„æ‹Ÿåˆèƒ½åŠ›</strong>ã€‚é«˜åå·®æ„å‘³ç€æ¨¡å‹è¿‡äºç®€å•ï¼Œæ— æ³•æ•æ‰åˆ°æ•°æ®çš„å¤æ‚æ¨¡å¼ï¼Œè¡¨ç¤ºæ¨¡å‹<strong>æ¬ æ‹Ÿåˆ</strong></p>
</blockquote>
<p>æœŸæœ›é¢„æµ‹ä¸çœŸå®æ ‡è®°çš„è¯¯å·®</p>
<p><span
class="math display">\[\mathrm{bias}^2(\mathbf{x})=\left(\overline{\mathrm{f}}(\mathbf{x})-\mathrm{y}\right)^2\]</span></p>
<h2 id="å™ªå£°">å™ªå£°</h2>
<blockquote>
<p>è¡¨è¾¾äº†å½“å‰ä»»åŠ¡ä¸Šä»»ä½•æ¨¡å‹æ‰€èƒ½è¾¾åˆ°çš„æœŸæœ›æ³›åŒ–è¯¯å·®çš„ä¸‹ç•Œï¼Œ<strong>åˆ»ç”»äº†å­¦ä¹ é—®é¢˜æœ¬èº«çš„éš¾åº¦</strong>ã€‚</p>
</blockquote>
<p>çœŸå®æ ‡è®°ä¸æ•°æ®é›†ä¸­çš„å®é™…æ ‡è®°é—´çš„åå·®</p>
<p><span
class="math display">\[\varepsilon^2=E_D\left[(y_D-y)^2\right]\]</span></p>
<h2 id="åå·®-æ–¹å·®çª˜å¢ƒ">åå·®-æ–¹å·®çª˜å¢ƒ</h2>
<img data-src="/DL-basic/606386-20180722194316424-288674381.png" class="" title="bias-variance-tradeoff">
<ul>
<li>åå‘å·¦ä¾§æ—¶ï¼Œè®­ç»ƒæ•°æ®çš„æ‰°åŠ¨ä¸è¶³ä»¥ä½¿å­¦ä¹ å™¨äº§ç”Ÿæ˜¾è‘—å˜åŒ–ï¼Œæ­¤æ—¶åå·®ä¸»å¯¼æ³›åŒ–è¯¯å·®ï¼Œç§°ä¸º<strong>æ¬ æ‹Ÿåˆç°è±¡</strong>
<ul>
<li>å¢åŠ æ¨¡å‹çš„è¿­ä»£æ¬¡æ•°ï¼›æ›´æ¢æè¿°èƒ½åŠ›æ›´å¼ºçš„æ¨¡å‹ï¼›ç”Ÿæˆæ›´å¤šç‰¹å¾ä¾›è®­ç»ƒä½¿ç”¨ï¼›é™ä½æ­£åˆ™åŒ–æ°´å¹³</li>
</ul></li>
<li>åå‘å³ä¾§æ—¶ï¼Œæ¨¡å‹çš„æ‹Ÿåˆèƒ½åŠ›éå¸¸å¼ºï¼Œæ•°æ®è½»å¾®å˜åŒ–éƒ½èƒ½å¯¼è‡´æ¨¡å‹å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœè¿‡åˆ†å­¦ä¹ è®­ç»ƒæ•°æ®çš„ç‰¹ç‚¹ï¼Œåˆ™ä¼šå‘ç”Ÿ<strong>è¿‡æ‹Ÿåˆç°è±¡</strong>
<ul>
<li>æ‰©å¢è®­ç»ƒé›†ï¼›å‡å°‘è®­ç»ƒä½¿ç”¨çš„ç‰¹å¾çš„æ•°é‡ï¼›é™ä½æ¨¡å‹å¤æ‚åº¦ï¼›æé«˜æ­£åˆ™åŒ–æ°´å¹³</li>
</ul></li>
</ul>
<p>ä¸ºäº†è§£å†³â€œåå·®å’Œæ–¹å·®åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯æœ‰å†²çªçš„â€çš„é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨KæŠ˜äº¤å‰éªŒè¯æˆ–æ­£åˆ™åŒ–ï¼Œå®ƒä»¬åˆ†åˆ«ä»æ•°æ®åˆ’åˆ†å’Œæ¨¡å‹å¤æ‚åº¦ä¸¤ä¸ªè§’åº¦å…¥æ‰‹ï¼Œæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œç¨³å¥æ€§ï¼š</p>
<ul>
<li>KæŠ˜äº¤å‰éªŒè¯é€šè¿‡å¤šæ¬¡åˆ’åˆ†å’ŒéªŒè¯ï¼Œå‡å°‘å› æ•°æ®åˆ’åˆ†ä¸å½“è€Œå¯¼è‡´çš„æ€§èƒ½ä¼°è®¡åå·®</li>
<li>æ­£åˆ™åŒ–åœ¨æŸå¤±å‡½æ•°ä¸­åŠ å…¥ä¸€ä¸ªä¸æ¨¡å‹å¤æ‚åº¦ç›¸å…³çš„æƒ©ç½šé¡¹ï¼Œä»¥é™åˆ¶æ¨¡å‹çš„å¤æ‚åº¦å¹¶é˜²æ­¢è¿‡æ‹Ÿåˆ
<a href="https://www.cnblogs.com/zingp/p/10375691.html">å‚è€ƒæ–‡ç« </a>
<ul>
<li>L1æ­£åˆ™åŒ–æ˜¯æŒ‡æƒå€¼å‘é‡wä¸­å„ä¸ªå…ƒç´ çš„ç»å¯¹å€¼ä¹‹å’Œï¼Œå¯ä»¥ä½¿å¾—å‚æ•°ç¨€ç–åŒ–ï¼Œå³å¾—åˆ°çš„å‚æ•°æ˜¯ä¸€ä¸ªç¨€ç–çŸ©é˜µï¼Œè¿›è€Œå¯ä»¥ç”¨äºç‰¹å¾é€‰æ‹©ã€‚äºŒç»´å¹³é¢å›¾åƒï¼š<img data-src="/DL-basic/o_L1.png" class="" title="image"></li>
<li>L2æ­£åˆ™åŒ–æ˜¯æŒ‡æƒå€¼å‘é‡wä¸­å„ä¸ªå…ƒç´ çš„å¹³æ–¹å’Œç„¶åå†æ±‚å¹³æ–¹æ ¹ï¼Œè®©æƒå€¼å°½å¯èƒ½å°ï¼Œå¦‚æœå‚æ•°è¶³å¤Ÿå°ï¼Œæ•°æ®åç§»å¾—å¤šä¸€ç‚¹ä¹Ÿä¸ä¼šå¯¹ç»“æœé€ æˆä»€ä¹ˆå½±å“ï¼Œä¸“ä¸šä¸€ç‚¹çš„è¯´æ³•æ˜¯<strong>æŠ—æ‰°åŠ¨èƒ½åŠ›å¼º</strong>ã€‚äºŒç»´å¹³é¢å›¾åƒï¼š<img data-src="/DL-basic/o_L2.png" class="" title="image"></li>
</ul></li>
</ul>
<h1 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h1>
<h2 id="ä¼˜åŒ–å™¨">ä¼˜åŒ–å™¨</h2>
<p>Adamï¼šè‡ªé€‚åº”å­¦ä¹ ç‡ï¼Œé€šè¿‡è®¡ç®—æ¢¯åº¦çš„ä¸€é˜¶çŸ©ï¼ˆå‡å€¼ï¼‰å’ŒäºŒé˜¶çŸ©ï¼ˆæœªä¸­å¿ƒåŒ–çš„æ–¹å·®ï¼‰æ¥è°ƒæ•´å­¦ä¹ ç‡</p>
<p>AdamWï¼šå¸¦æœ‰æƒé‡è¡°å‡å’Œå­¦ä¹ ç‡é¢„çƒ­çš„Adamä¼˜åŒ–å™¨ã€‚æ”¹è¿›äº†Adamï¼Œå°†æƒé‡è¡°é€€å’Œæ¢¯åº¦æ›´æ–°è§£è€¦ï¼ŒæŠŠL2æ­£åˆ™åŒ–ç§»åˆ°æƒé‡æ›´æ–°æ—¶è€Œä¸æ˜¯æ¢¯åº¦è®¡ç®—æ—¶</p>
<h1 id="è®­ç»ƒæ–¹æ³•">è®­ç»ƒæ–¹æ³•</h1>
<h2 id="ç›‘ç£å­¦ä¹ ">ç›‘ç£å­¦ä¹ </h2>
<p>è®­ç»ƒæ•°æ®æ—¢æœ‰ç‰¹å¾(feature)åˆæœ‰æ ‡ç­¾(label)ï¼Œé€šè¿‡è®­ç»ƒï¼Œè®©æœºå™¨å¯ä»¥è‡ªå·±æ‰¾åˆ°ç‰¹å¾å’Œæ ‡ç­¾ä¹‹é—´çš„è”ç³»ï¼Œåœ¨é¢å¯¹åªæœ‰ç‰¹å¾æ²¡æœ‰æ ‡ç­¾çš„æ•°æ®æ—¶ï¼Œå¯ä»¥åˆ¤æ–­å‡ºæ ‡ç­¾ã€‚</p>
<h2 id="æ— ç›‘ç£å­¦ä¹ ">æ— ç›‘ç£å­¦ä¹ </h2>
<p>æ•°æ®åªæœ‰ç‰¹å¾(feature)æ— æ ‡ç­¾(label)ï¼Œæ˜¯ä¸€ç§æœºå™¨å­¦ä¹ çš„è®­ç»ƒæ–¹å¼ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç»Ÿè®¡æ‰‹æ®µï¼Œåœ¨æ²¡æœ‰æ ‡ç­¾çš„æ•°æ®é‡Œå¯ä»¥å‘ç°æ½œåœ¨çš„ä¸€äº›ç»“æ„çš„ä¸€ç§è®­ç»ƒæ–¹å¼ã€‚</p>
<h2 id="åŠç›‘ç£å­¦ä¹ ">åŠç›‘ç£å­¦ä¹ </h2>
<p>åˆ©ç”¨åŒæ—¶åŒ…å«æœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æ•°æ®æ¥æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿåœ¨æµ‹è¯•é˜¶æ®µæ›´å¥½åœ°æ³›åŒ–åˆ°æ–°çš„ã€æœªè§è¿‡çš„æ•°æ®ã€‚</p>
<h2 id="å¼ºåŒ–å­¦ä¹ ">å¼ºåŒ–å­¦ä¹ </h2>
<p>è®©ä¸€ä¸ªæ™ºèƒ½ä½“ï¼ˆagentï¼‰åœ¨ç¯å¢ƒï¼ˆEnviromentï¼‰ä¸­é€šè¿‡å°è¯•å’Œé”™è¯¯æ¥å­¦ä¹ è¡Œä¸ºï¼ˆActionï¼‰ç­–ç•¥ã€‚æ™ºèƒ½ä½“é€šè¿‡ä¸ç¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œæ ¹æ®å¥–åŠ±ä¿¡å·æ¥è°ƒæ•´å…¶è¡Œä¸ºç­–ç•¥ï¼Œä»¥è¾¾åˆ°æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±çš„ç›®æ ‡ã€‚</p>
<p>é’ˆå¯¹ PPO ç®—æ³•çš„ä¼˜åŒ–ï¼š</p>
<ul>
<li>å½’ä¸€åŒ–å¥–åŠ±åˆ†æ•°ã€å°†å¥–åŠ±åˆ†æ•°åšç™½åŒ–å¤„ç†</li>
</ul>
<img data-src="/DL-basic/overview_chatgpt.png" class="" title="overview_chatgpt">
<h3 id="rlhf">RLHF</h3>
<blockquote>
<p>Reinforcement Learning from Human
Feedbackï¼Œä»¥<strong>å¼ºåŒ–å­¦ä¹ æ–¹å¼ä¾æ®äººç±»åé¦ˆä¼˜åŒ–è¯­è¨€æ¨¡å‹</strong>ï¼Œæ˜¯
OpenAI æå‡ºçš„ç”Ÿæˆé¢†åŸŸï¼ˆDecoder_onlyï¼‰çš„æ–°è®­ç»ƒèŒƒå¼</p>
</blockquote>
<p>Policy Gradient</p>
<style>.jdtwsmwbmjqm{zoom:50%;}</style>
<img data-src="/DL-basic/image-20240716101748533.png" class="jdtwsmwbmjqm" alt="image-20240716101748533">
<p>RM+PPO</p>
<p>æ­¥éª¤ä¸€ã€é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹</p>
<style>.ivxckgeksbiy{zoom: 50%;}</style>
<img data-src="/DL-basic/image-20240715191912939.png" class="ivxckgeksbiy" alt="image-20240715191912939">
<p>æ­¥éª¤äºŒã€è®­ç»ƒå¥–åŠ±æ¨¡å‹ RM</p>
<style>.reoadrswcmkf{zoom: 50%;}</style>
<img data-src="/DL-basic/image-20240715191936226.png" class="reoadrswcmkf" alt="image-20240715191936226">
<p>æ­¥éª¤ä¸‰ã€ç”¨å¼ºåŒ–å­¦ä¹  PPO å¾®è°ƒ</p>
<style>.viuvnclymhsv{zoom:50%;}</style>
<img data-src="/DL-basic/image-20240715192056550.png" class="viuvnclymhsv" alt="image-20240715192056550">
<p>DPO</p>
<p>KTO</p>
<p>ORPO</p>
<h1 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°</h1>
<p>MSELoss å›å½’ä»»åŠ¡</p>
<p>CrossEntropyLoss å•æ ‡ç­¾åˆ†ç±»</p>
<p>BCEWithLogitsLoss å¤šæ ‡ç­¾åˆ†ç±»</p>
<h1 id="torch">Torch</h1>
<p><code>torch.nn.Parameter()</code>å°†ä¸€ä¸ªä¸å¯è®­ç»ƒçš„ tensor
è½¬æ¢æˆå¯ä»¥è®­ç»ƒçš„ç±»å‹ parameterï¼Œå¹¶å°†è¿™ä¸ª parameter ç»‘å®šåˆ°è¿™ä¸ª module
é‡Œé¢</p>
]]></content>
      <categories>
        <category>DL</category>
      </categories>
      <tags>
        <tag>æ·±åº¦å­¦ä¹ åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title>LLM åº”ç”¨å¼€å‘</title>
    <url>/LLM-Application/</url>
    <content><![CDATA[<p>å®éªŒå®¤é¡¹ç›®å¯¹è¯æ¨¡å—çš„ä¸»è¦å·¥ä½œå’Œåˆ›æ–°ç‚¹ï¼Œå…ˆå¤§è‡´è®°å½•ä¸€ä¸‹æ€è·¯ï¼Œåç»­æ…¢æ…¢å®Œå–„</p>
<h1 id="ä½•ä¸ºllmåº”ç”¨å¼€å‘">ä½•ä¸ºLLMåº”ç”¨å¼€å‘</h1>
<p>ç½‘ä¸Šä¸å°‘äººè®¤ä¸ºï¼Œä¸å…¶å»åš Prompt åº”ç”¨ä¸å¦‚å»æå‡ LLM çš„æ™ºèƒ½ï¼ŒPrompt
åº”ç”¨å¯¹äºå¤§è¯­è¨€æ¨¡å‹èƒ½åŠ›æå‡çš„ä½œç”¨æœ‰é™ã€‚ä½†æˆ‘ä¸ä»¥ä¸ºç„¶ï¼Œè·å¾— Prompt
çš„åŠ æŒä¹‹åï¼ŒLLM
å¯ä»¥<strong>åº”ç”¨ç°å®ç”Ÿæ´»çš„æ‰€æœ‰å·¥å…·</strong>ï¼›å¯ä»¥<strong>æŒ‰æ­¥éª¤æ­£ç¡®å¤„ç†ä¸€ä¸ªå¤æ‚é—®é¢˜</strong>ï¼ˆå› ä¸º
LLM
ä¸åŒäºäººç±»å¯¹è¯ï¼Œåªæœ‰æ„é€ å‡ºéå¸¸è¯¦ç»†ä¸”å‘¨å¯†çš„è¿‡ç¨‹çº¦æŸï¼Œæ‰èƒ½å¾—åˆ°æœ€æ­£ç¡®çš„ç­”æ¡ˆï¼Œä¸ç„¶ä¼šå‡ºç°â€œå¹»è§‰â€ç°è±¡ï¼‰ï¼›å¯ä»¥å¼•å¯¼
<strong>LLM è‡ªæˆ‘è§„åˆ’</strong>ï¼ˆä¸‹æ–‡çš„é•¿æ–‡æœ¬å¯¹è¯ï¼‰ï¼Œç›®å‰ Prompt
æœ€å¸¸åº”ç”¨åœ¨ <code>Dynamic Few-Shot Examples</code> é¢†åŸŸä¸­ï¼Œå¯ä»¥å¿«é€Ÿå®šä½ä¸
Query æœ€ç›¸å…³çš„å°æ ·æœ¬ï¼Œä¸ä½¿ä¸ç›¸å…³çš„å†…å®¹åˆ†æ•£ LLM
çš„æ³¨æ„åŠ›ï¼Œè€Œä¸åªå±€é™äºâ€œèŠå¤©æœºå™¨äººâ€å’Œâ€œæœç´¢å¼•æ“â€è¿™ç±»çœ‹ä¼¼æ²¡å•¥ä¹ˆå¤ªå¤§ç”¨å¤„çš„åå¤´ã€‚</p>
<p>ä¸€è¨€ä»¥è”½ä¹‹ï¼Œåº”ç”¨å¼€å‘å°±æ˜¯å°† LLM
èªæ˜çš„å¤§è„‘è£…ä¸Šå¯éšæ—¶æ›¿æ¢çš„æ‰‹è„šã€äº”å®˜å’Œå‰é¢å¶ã€æµ·é©¬ä½“ï¼Œå®ƒå¯ä»¥å˜æˆä»»ä½•äººï¼Œä½¿ç”¨ä»»ä½•å·¥å…·ã€‚</p>
<h1 id="é•¿æ–‡æœ¬å¯¹è¯">é•¿æ–‡æœ¬å¯¹è¯</h1>
<h2 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</h2>
<p>è™½ç„¶æ¨¡å‹éƒ½æ”¯æŒ32kçš„ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯æ— æ³•è¦æ±‚æ¨¡å‹ä¸€æ¬¡æ€§è¾“å‡ºè¶…é•¿æ–‡æœ¬ã€‚è‹¥ç»™æ¨¡å‹è¾“å…¥ï¼šâ€œç»™æˆ‘è®²è®²ä¸­å›½äº”åƒå¹´å†å²ï¼Œå­—æ•°ä¸å¾—å°‘äºäº”åƒâ€ï¼Œæ˜¯æ— æ³•å¾—åˆ°æƒ³è¦çš„å›ç­”ï¼Œæ¨¡å‹æœ€å¤šç”Ÿæˆä¸€ä¸¤åƒçš„å­—ï¼Œè€Œä¸”ç”±äºæ‰€æœ‰è¾“å‡ºéƒ½æ˜¯ä¸€æ¬¡è¿”å›çš„ï¼Œä¸Šä¸‹æ–‡é€»è¾‘å’Œå†…å®¹éƒ½ä¸å°½äººæ„ã€‚</p>
<h2 id="è§£å†³æ€è·¯">è§£å†³æ€è·¯</h2>
<p>å…ˆè°ƒç”¨æ¨¡å‹ç”Ÿæˆä¸€æ¬¡å¤§çº²ï¼Œå†æ‹†åˆ†å¤§çº²åˆ†æ‰¹æ¬¡è¾“å…¥æ¨¡å‹ï¼Œæ¯æ¬¡æ¨¡å‹çš„è¾“å‡ºåªéœ€è¦å…³æ³¨ä¸€å°å—å†…å®¹ï¼Œå› æ­¤å¯ä»¥è·å¾—æ›´ä¼˜ç»“æœã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">OutlinePrompt = ChatPromptTemplate.from_template(<span class="string">f&#x27;è¯·æ ¹æ®<span class="subst">&#123;query&#125;</span>ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ ¼å¼å¯¹é—®é¢˜æç‚¼ç›®å½•ã€‚å›ç­”å†…å®¹å°½é‡ç®€çŸ­\n \</span></span><br><span class="line"><span class="string">            å¼€å§‹ç”Ÿæˆå¤§çº²:\n \</span></span><br><span class="line"><span class="string">            1. XXX\n    1.1xxx 1.2xxx 1.3xxx ...\n  \</span></span><br><span class="line"><span class="string">            2. XXX\n    2.1xxx 2.2xxx 2.3xxx ...\n  \</span></span><br><span class="line"><span class="string">            .......\n&#x27;</span>)</span><br><span class="line">chain = LLMChain(prompt=OutlinePrompt, llm=model1, memory=<span class="literal">None</span>, verbose=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>ç”±äºéœ€è¦<strong>ç»“æ„åŒ–è§£æ</strong>è¾“å‡ºç»“æœå¹¶<strong>é“¾å¼è°ƒç”¨</strong>æ¨¡å‹æ‰©å†™å­è®ºç‚¹ï¼Œé‡‡ç”¨ç»“æ„åŒ–è¾“å‡ºè§£æå™¨
<code>from langchain.output_parsers import StructuredOutputParser, ResponseSchema</code>
å’Œæ¨¡å‹è°ƒç”¨é“¾
<code>from langchain.chains import SimpleSequentialChain, SequentialChain</code>
ï¼Œè¯¥æ–¹æ³•ç›¸è¾ƒäºç›´æ¥ for
å¾ªç¯è°ƒç”¨æ¨¡å‹æ›´åŠ éº»çƒ¦ï¼Œä½†æ˜¯ä¾¿äºæ•´ä½“é¡¹ç›®çš„å¼€å‘ã€è°ƒç”¨å’Œç»´æŠ¤ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">chat_prompt = PromptTemplate.from_template(<span class="string">f&#x27;è¯·ä»¥<span class="subst">&#123;title&#125;</span>çš„<span class="subst">&#123;contexts&#125;</span>ä¸ºä¸»è¦å†…å®¹ï¼Œå¸®æˆ‘æ‰©å†™åˆ°<span class="subst">&#123;num&#125;</span>å­—&#x27;</span>)</span><br><span class="line">combined_prompt = PromptTemplate.from_template(<span class="string">f&#x27;å†™ä¸€æ®µè¿‡æ¸¡æ®µï¼Œä»<span class="subst">&#123;title&#125;</span>è‡ªç„¶è¿‡æ¸¡åˆ°<span class="subst">&#123;next_title&#125;</span>ï¼Œå†…å®¹ç®€çŸ­&#x27;</span>)</span><br><span class="line">chat_chain = LLMChain(llm=llm, prompt=chat_prompt, output_key=<span class="string">&quot;chat&quot;</span>)</span><br><span class="line">combined_chain = LLMChain(llm=llm, prompt=combined_prompt, output_key=<span class="string">&quot;combined&quot;</span>)</span><br><span class="line">single_chain = SequentialChain(</span><br><span class="line">    chains=[chat_chain, combined_chain], </span><br><span class="line">    input_variables=[<span class="string">&quot;title&quot;</span>, <span class="string">&quot;contexts&quot;</span>, <span class="string">&quot;num&quot;</span>, <span class="string">&quot;next_title&quot;</span>],</span><br><span class="line">    output_variables=[<span class="string">&quot;chat&quot;</span>, <span class="string">&quot;combined&quot;</span>],</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç›®å‰è¿˜æ˜¯é€šè¿‡ for å¾ªç¯éå†å¤§çº²ï¼Œåç»­è€ƒè™‘é‡‡ç”¨è·¯ç”±é“¾
<code>LLMRouterChain</code>ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">router_prompt = PromptTemplate(</span><br><span class="line">    template=router_template,</span><br><span class="line">    input_variables=[<span class="string">&quot;input&quot;</span>],</span><br><span class="line">    output_parser=RouterOutputParser(),</span><br><span class="line">)</span><br><span class="line">chain = MultiPromptChain(</span><br><span class="line">    router_chain=router_chain,    <span class="comment"># è·¯ç”±é“¾è·¯</span></span><br><span class="line">    destination_chains=destination_chains,   <span class="comment"># ç›®æ ‡é“¾è·¯ï¼ˆLLmChain æ•°ç»„ï¼‰</span></span><br><span class="line">    default_chain=default_chain,      <span class="comment"># é»˜è®¤é“¾è·¯</span></span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="ç§æœ‰æ•°æ®çŸ¥è¯†åº“">ç§æœ‰æ•°æ®çŸ¥è¯†åº“</h1>
<h2 id="é—®é¢˜èƒŒæ™¯-1">é—®é¢˜èƒŒæ™¯</h2>
<p>ç¦»çº¿ç§æœ‰æ•°æ®ä¸èƒ½ç›´æ¥ä½œä¸ºè¯­æ–™åº“è®­ç»ƒæ¨¡å‹ï¼ŒLLM
éœ€è¦å…·æœ‰åŸºäºç§æœ‰æ•°æ®è¿”å›çš„èƒ½åŠ›ã€‚</p>
<h2 id="è§£å†³æ€è·¯-1">è§£å†³æ€è·¯</h2>
<p>çŸ¥è¯†åº“ç³»ç»Ÿè¦åŒ…æ‹¬æ–‡æ¡£åŠ è½½ã€åˆ‡åˆ†ã€å­˜å‚¨ã€æ£€ç´¢å’Œå­˜å‚¨èŠå¤©è®°å½•æ¨¡å—ï¼Œå…·ä½“é€šè¿‡å‘é‡è¡¨å¾
<code>Embeddings</code> å’Œå‘é‡å­˜å‚¨ <code>Vector Store</code> å®ç°</p>
<ul>
<li>æ–‡æœ¬è¡¨å¾æ˜¯å¯¹æ–‡æœ¬è¯­ä¹‰çš„å‘é‡è¡¨å¾ï¼Œç›¸ä¼¼å†…å®¹çš„æ–‡æœ¬å…·æœ‰ç›¸ä¼¼çš„è¡¨å¾å‘é‡ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥åœ¨å‘é‡ç©ºé—´ä¸­æ¯”è¾ƒæ–‡æœ¬çš„ç›¸ä¼¼æ€§ã€‚</li>
<li>å‘é‡æ•°æ®åº“<code>Vector Database</code>ç”¨æ¥å­˜å‚¨æ–‡æ¡£çš„æ–‡æœ¬å—ã€‚å¯¹äºç»™å®šçš„æ–‡æ¡£ï¼Œæˆ‘ä»¬é¦–å…ˆå°†å…¶åˆ†æˆè¾ƒå°çš„æ–‡æœ¬å—<code>chunks</code>ï¼Œç„¶åè·å–æ¯ä¸ªå°æ–‡æœ¬å—çš„æ–‡æœ¬è¡¨å¾ï¼Œå¹¶å°†è¿™äº›è¡¨å¾å‚¨å­˜åœ¨å‘é‡æ•°æ®åº“ä¸­ã€‚è¿™ä¸ªæµç¨‹æ­£æ˜¯åˆ›å»ºç´¢å¼•<code>index</code>çš„è¿‡ç¨‹ã€‚å°†æ–‡æ¡£åˆ†æˆå°æ–‡æœ¬å—çš„åŸå› åœ¨äºæˆ‘ä»¬å¯èƒ½æ— æ³•å°†æ•´ä¸ªæ–‡æ¡£ä¼ å…¥è¯­è¨€æ¨¡å‹è¿›è¡Œå¤„ç†ã€‚</li>
</ul>
<img data-src="/LLM-Application/image-20240424102449161.png" class="" title="image-20240424102449161">
<p>Langchain ä¸­æ–‡æœ¬åˆ†å‰²å™¨ <code>langchain.text_splitter</code> éƒ½æ ¹æ®
chunk_size(å—å¤§å°) å’Œ chunk_overlap(å—ä¸å—ä¹‹é—´çš„é‡å å¤§å°) è¿›è¡Œåˆ†å‰²</p>
<ul>
<li>chunk_size æŒ‡æ¯ä¸ªå—åŒ…å«çš„å­—ç¬¦æˆ– Tokenï¼ˆå¦‚å•è¯ã€å¥å­ç­‰ï¼‰çš„æ•°é‡</li>
<li>chunk_overlap
æŒ‡ä¸¤ä¸ªå—ä¹‹é—´å…±äº«çš„å­—ç¬¦æ•°é‡ï¼Œç”¨äºä¿æŒä¸Šä¸‹æ–‡çš„è¿è´¯æ€§ï¼Œé¿å…åˆ†å‰²ä¸¢å¤±ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
</ul>
<style>.titkojkaescf{zoom:50%;}</style>
<img data-src="/LLM-Application/image-20240424102824838.png" class="titkojkaescf" alt="langchain.text_splitter">
<p><strong>Q1</strong>ï¼šå¦‚ä½•åŠ å¼ºæœç´¢ç»“æœçš„å¤šæ ·æ€§ï¼Ÿ</p>
<p><strong>A1</strong>ï¼šæœ€å¤§è¾¹é™…ç›¸å…³æ€§
<code>Maximum marginal relevance</code>
ï¼Œè¿‡æ»¤æœç´¢ç»“æœä¸­ç›¸ä¼¼åº¦å¾ˆé«˜çš„æ–‡æ¡£ï¼Œå¯ä»¥åŒæ—¶æ»¡è¶³æŸ¥è¯¢çš„ç›¸å…³æ€§å’Œç»“æœçš„å¤šæ ·æ€§</p>
<p><strong>Q2</strong>ï¼šå¦‚ä½•å°†æŸ¥è¯¢é™å®šåœ¨æŸäº›æ–‡æ¡£ä¸­ï¼Ÿå¦‚ LLM
åœ¨æŸ¥è¯¢æ—¶å¯èƒ½åŒæ—¶æŸ¥æ‰¾
æµ™æ±Ÿçœè´¢æ”¿æŠ¥å‘Šã€æ±Ÿè‹çœè´¢æ”¿æŠ¥å‘Šï¼Œä½†é—®é¢˜åªä¸æµ™æ±Ÿçœç›¸å…³</p>
<p><strong>A2</strong>ï¼šé€šè¿‡ <code>SelfQueryRetriever</code> å‚æ•°
<code>document_content_description</code>
æŒ‡å®šå…ƒç´ çš„ä¸åŒå­—æ®µï¼ˆsourceï¼‰ä»¥åŠå®ƒä»¬å¯¹åº”çš„ä½ç½®ï¼ˆpageï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">metadata_field_info_chinese = [</span><br><span class="line">    AttributeInfo(</span><br><span class="line">        name=<span class="string">&quot;source&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;æ–‡ç« æ¥æºäº `index-æµ™æ±Ÿçœè´¢æ”¿æŠ¥å‘Š`, `index-æ±Ÿè‹çœè´¢æ”¿æŠ¥å‘Š` çš„å…¶ä¸­ä¹‹ä¸€&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">    AttributeInfo(</span><br><span class="line">        name=<span class="string">&quot;page&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;æ–‡ç« ä¸­çš„å“ªä¸€é¡µ&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="string">&quot;integer&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>Q3</strong>ï¼šå¦‚ä½•é€šè¿‡è¿‡è·å–åˆ°çš„æ–‡æ¡£å¾—åˆ° LLM å“åº”</p>
<p><strong>A3</strong>ï¼šé‡‡ç”¨ æ£€ç´¢å¼é—®ç­”é“¾ <code>RetrievalQA</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">template = <span class="string">&quot;&quot;&quot;ä½¿ç”¨ä»¥ä¸‹ä¸Šä¸‹æ–‡ç‰‡æ®µæ¥å›ç­”æœ€åçš„é—®é¢˜ã€‚å¦‚æœä½ ä¸çŸ¥é“ç­”æ¡ˆï¼Œåªéœ€è¯´ä¸çŸ¥é“ï¼Œä¸è¦è¯•å›¾ç¼–é€ ç­”æ¡ˆã€‚ç­”æ¡ˆæœ€å¤šä½¿ç”¨ä¸‰ä¸ªå¥å­ã€‚å°½é‡ç®€æ˜æ‰¼è¦åœ°å›ç­”ã€‚åœ¨å›ç­”çš„æœ€åä¸€å®šè¦è¯´&quot;æ„Ÿè°¢æ‚¨çš„æé—®ï¼&quot;</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string">é—®é¢˜ï¼š&#123;question&#125;</span></span><br><span class="line"><span class="string">æœ‰ç”¨çš„å›ç­”ï¼š&quot;&quot;&quot;</span></span><br><span class="line">QA_CHAIN_PROMPT = PromptTemplate.from_template(template)</span><br><span class="line"><span class="comment"># RetrievalQA å†…éƒ¨ä½¿ç”¨äº† QA_CHAIN_PROMPT</span></span><br><span class="line">qa_chain = RetrievalQA.from_chain_type( </span><br><span class="line">    llm,</span><br><span class="line">    retriever=vectordb.as_retriever()</span><br><span class="line">)</span><br><span class="line">result = qa_chain(&#123;<span class="string">&quot;query&quot;</span>: question&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Q4</strong>ï¼šå¦‚æœæ–‡æ¡£å¤ªå¤šï¼Œæ— æ³•å°†å®ƒä»¬å…¨éƒ¨é€‚é…åˆ°ä¸Šä¸‹æ–‡çª—å£ä¸­æ€ä¹ˆåŠï¼Ÿ</p>
<p><strong>A4</strong>ï¼šé‡‡ç”¨
<code>MapReduce</code>ï¼Œé¦–å…ˆå°†æ¯ä¸ªç‹¬ç«‹çš„æ–‡æ¡£å•ç‹¬å‘é€åˆ°è¯­è¨€æ¨¡å‹ä»¥è·å–åŸå§‹ç­”æ¡ˆã€‚ç„¶åï¼Œå°†ç­”æ¡ˆé€šè¿‡æœ€ç»ˆå¯¹è¯­è¨€æ¨¡å‹çš„ä¸€æ¬¡è°ƒç”¨ç»„åˆæˆæœ€ç»ˆçš„ç­”æ¡ˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">qa_chain_mr = RetrievalQA.from_chain_type(</span><br><span class="line">    llm,</span><br><span class="line">    retriever=vectordb.as_retriever(),</span><br><span class="line">    chain_type=<span class="string">&quot;map_reduce&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¿¡æ¯åˆ†å¸ƒåœ¨ä¸¤ä¸ªæ–‡æ¡£ä¹‹é—´ï¼Œæ— æ³•åœ¨åŒä¸€ä¸Šä¸‹æ–‡ä¸­è·å–åˆ°æ‰€æœ‰çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ²¡æ³•ç»™å‡ºæ­£ç¡®ç­”æ¡ˆã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨
<code>Refine æ£€ç´¢å¼é—®ç­”é“¾</code> ï¼ŒRefine æ–‡æ¡£é“¾ç±»ä¼¼äº MapReduce
é“¾ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ–‡æ¡£ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡ LLMï¼Œä½†æœ‰æ‰€æ”¹è¿›çš„æ˜¯ï¼Œæˆ‘ä»¬æ¯æ¬¡å‘é€ç»™ LLM
çš„æœ€ç»ˆæç¤ºæ˜¯ä¸€ä¸ªåºåˆ—ï¼Œè¿™ä¸ªåºåˆ—ä¼šå°†å…ˆå‰çš„å“åº”ä¸æ–°æ•°æ®ç»“åˆåœ¨ä¸€èµ·ï¼Œå¹¶è¯·æ±‚å¾—åˆ°æ”¹è¿›åçš„å“åº”ã€‚è¿™ç§æ–¹æ³•ç±»ä¼¼äº
RNNï¼Œæˆ‘ä»¬å¢å¼ºäº†ä¸Šä¸‹æ–‡ï¼Œä»è€Œè§£å†³ä¿¡æ¯åˆ†å¸ƒåœ¨ä¸åŒæ–‡æ¡£çš„é—®é¢˜ã€‚</p>
<p><a href="https://github.com/chatchat-space/Langchain-Chatchat">Github
å‚è€ƒé¡¹ç›®é“¾æ¥</a></p>
<h1 id="å¤šåœºæ™¯çŸ¥è¯†å›¾è°±">å¤šåœºæ™¯çŸ¥è¯†å›¾è°±</h1>
<h2 id="é—®é¢˜èƒŒæ™¯-2">é—®é¢˜èƒŒæ™¯</h2>
<p>å‚è€ƒ Langchain å¤–éƒ¨çŸ¥è¯†åº“å¼€æºé¡¹ç›®çš„ <a
href="https://github.com/chatchat-space/Langchain-Chatchat/issues/1583">Issue</a>ï¼Œå¯ä»¥å‘ç°ï¼Œç”±äºå•ä¸€çš„æ–‡æ¡£åˆ‡åˆ†æ–¹æ³•å’Œå·²è®­ç»ƒå¥½çš„åˆ†è¯å™¨åˆ‡åˆ†æ–¹æ³•ï¼ˆé¡¹ç›®ä¸­ç”¨çš„æ˜¯
bge-large-zh-v1.5
æ¨¡å‹ï¼‰å¹¶ä¸èƒ½ç†è§£åœºæ™¯ç›¸å…³çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ— æ³•æ„å»ºæœ‰é’ˆå¯¹æ€§çš„å¯¹è¯çŸ¥è¯†åº“ï¼Œå› æ­¤ç®€å•çš„å¯¼å…¥å¤–éƒ¨æ•°æ®æ— æ³•å®ç°å¤šåœºæ™¯éœ€æ±‚ã€‚</p>
<h2 id="è§£å†³æ€è·¯-2">è§£å†³æ€è·¯</h2>
<p>é’ˆå¯¹ç§æœ‰æ•°æ®çš„å¤šåœºæ™¯å¯¹è¯éœ€æ±‚ï¼Œå¯ä»¥æ„å»ºå¹¶åº”ç”¨ä¸åŒåœºæ™¯çš„çŸ¥è¯†å›¾è°±ã€‚</p>
<img data-src="/LLM-Application/image-20240424140419971.png" class="" title="image-20240424140419971">
<p>åŸºäº ç”¨æˆ·è¾“å…¥Query å’Œ å›¾æ•°æ®åº“ Schema æ„å»º Promptï¼Œé€šè¿‡ LLM
è·å–ç®€çŸ­ã€ç²¾è¦çš„å®ä½“å’Œå…³ç³»ä¿¡æ¯ï¼Œåç»­å†åŸºäºæ­¤ç”Ÿæˆå¯¹è¯å“åº”ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> GraphCypherQAChain</span><br><span class="line"><span class="keyword">from</span> langchain.graphs <span class="keyword">import</span> Neo4jGraph</span><br><span class="line"></span><br><span class="line">graph = Neo4jGraph(</span><br><span class="line">    url=<span class="string">&quot;bolt://localhost:7687&quot;</span>, </span><br><span class="line">    username=<span class="string">&quot;neo4j&quot;</span>, </span><br><span class="line">    password=<span class="string">&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line">chain = GraphCypherQAChain.from_llm(</span><br><span class="line">    model, graph=graph, verbose=<span class="literal">True</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Langchain åº•å±‚é’ˆå¯¹å›¾æ•°æ®åº“å¯¹è¯çš„ Prompt</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CYPHER_GENERATION_TEMPLATE = <span class="string">&quot;&quot;&quot;Task:Generate Cypher statement to query a graph database.</span></span><br><span class="line"><span class="string">Instructions:</span></span><br><span class="line"><span class="string">Use only the provided relationship types and properties in the schema.</span></span><br><span class="line"><span class="string">Do not use any other relationship types or properties that are not provided.</span></span><br><span class="line"><span class="string">Schema:</span></span><br><span class="line"><span class="string">&#123;schema&#125;</span></span><br><span class="line"><span class="string">Note: Do not include any explanations or apologies in your responses.</span></span><br><span class="line"><span class="string">Do not respond to any questions that might ask anything else than for you to construct a Cypher statement.</span></span><br><span class="line"><span class="string">Do not include any text except the generated Cypher statement.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The question is:</span></span><br><span class="line"><span class="string">&#123;question&#125;&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>Langchain åº•å±‚é’ˆå¯¹ä¸Šä¸‹æ–‡é—®ç­”çš„ Prompt</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CYPHER_QA_TEMPLATE = <span class="string">&quot;&quot;&quot;You are an assistant that helps to form nice and human understandable answers.</span></span><br><span class="line"><span class="string">The information part contains the provided information that you must use to construct an answer.</span></span><br><span class="line"><span class="string">The provided information is authoritative, you must never doubt it or try to use your internal knowledge to correct it.</span></span><br><span class="line"><span class="string">Make the answer sound as a response to the question. Do not mention that you based the result on the given information.</span></span><br><span class="line"><span class="string">If the provided information is empty, say that you don&#x27;t know the answer.</span></span><br><span class="line"><span class="string">Information:</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question: &#123;question&#125;</span></span><br><span class="line"><span class="string">Helpful Answer:&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="å¤šè½®å¯¹è¯">å¤šè½®å¯¹è¯</h1>
<p>é‡‡ç”¨ qdrant å‘é‡åº“ä¿å­˜å¯¹è¯å†å²</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomQdrantMemory</span>(<span class="title class_ inherited__">BaseChatMemory</span>):</span><br><span class="line">    <span class="comment"># è®¿é—®æ•°æ®åº“æŠ½å–æœ€ç›¸å…³è”çš„ message_limit æ¡æ•°æ®</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buffer</span>(<span class="params">self, inputs: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="type">List</span>[BaseMessage]:</span><br><span class="line">        chat_messages: <span class="type">List</span>[BaseMessage] = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inputs:</span><br><span class="line">            <span class="keyword">return</span> chat_messages</span><br><span class="line">        hits = self.qdrant.search(</span><br><span class="line">            collection_name=self.conversation_id,</span><br><span class="line">            query_vector=self.encoder.encode(inputs[<span class="string">&#x27;input&#x27;</span>]).tolist(),</span><br><span class="line">            limit=self.message_limit,</span><br><span class="line">        )</span><br><span class="line">        hits = <span class="built_in">sorted</span>(hits, key=<span class="keyword">lambda</span> x:x.<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">for</span> hit <span class="keyword">in</span> hits:</span><br><span class="line">            chat_messages.append(HumanMessage(content=hit.payload[<span class="string">&#x27;human&#x27;</span>]))</span><br><span class="line">            chat_messages.append(AIMessage(content=hit.payload[<span class="string">&#x27;assistant&#x27;</span>]))</span><br><span class="line">        curr_buffer_length = self.llm.get_num_tokens(get_buffer_string(chat_messages))</span><br><span class="line">        <span class="comment"># å¦‚æœè¶…å‡ºæ¨¡å‹æœ€é•¿ä¸Šä¸‹æ–‡ï¼Œåˆ™å¼¹å‡ºæœ€æ—©çš„å¯¹è¯å†å²</span></span><br><span class="line">        <span class="keyword">if</span> curr_buffer_length &gt; self.max_token_limit:</span><br><span class="line">            pruned_memory = []</span><br><span class="line">            <span class="keyword">while</span> curr_buffer_length &gt; self.max_token_limit <span class="keyword">and</span> chat_messages:</span><br><span class="line">                pruned_memory.append(chat_messages.pop())</span><br><span class="line">                curr_buffer_length = self.llm.get_num_tokens(get_buffer_string(chat_messages))</span><br><span class="line">        <span class="keyword">return</span> chat_messages        </span><br></pre></td></tr></table></figure>
<h1 id="è™šæ‹Ÿäººè®¾">è™šæ‹Ÿäººè®¾</h1>
<p><a href="https://github.com/LC1332/Chat-Haruhi-Suzumiya">Github
å‚è€ƒé¡¹ç›®é“¾æ¥</a></p>
<p>æµç¨‹</p>
<ul>
<li>éŸ³è§†é¢‘ä¸Šä¼ 
<ul>
<li>è¯­éŸ³è½¬æ–‡å­— FFmpeg</li>
<li>ã€åˆå§‹åŒ–æ—¶ã€‘å£°çº¹æ„å»º</li>
<li>è¯­éŸ³è½¬æ–‡å­— Whisper</li>
<li>ç‰¹å¾è¯­æ–™åº“æ„å»º</li>
</ul></li>
<li>è¯­æ–™ + Chroma å‘é‡åº“ç›¸ä¼¼åº¦ + KNN è·ç¦»åŒ¹é…</li>
<li>ç»„æˆè¾“å…¥ï¼ŒLLM å“åº”ç»“æœ</li>
</ul>
]]></content>
      <categories>
        <category>LLMåº”ç”¨å¼€å‘</category>
      </categories>
      <tags>
        <tag>Langchain</tag>
        <tag>å‘é‡æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å·¥ä½œ</title>
    <url>/How-to-Work/</url>
    <content><![CDATA[<ol type="1">
<li>ä¸å‘ä¸äº¢ï¼Œè°¦è™šæœ‰ç¤¼</li>
<li>å¯ä»¥ç«äº‰ä½†è¦é¿å…å†…æ–—</li>
<li>åŠæ—¶å’Œé¢†å¯¼åŒæ­¥è¿›åº¦</li>
<li>å¹³å’Œè°¦é€Šï¼Œæ€ç»´æ•æ·ï¼Œå¤„ç†é—®é¢˜ç®€æ˜æ‰¼è¦</li>
</ol>
<p>ã€å…ˆæŠ„æŠ„äººå®¶çš„æ„Ÿæ‚Ÿï¼Œè¿™è¾¹æ–‡ç« ç•™ç»™æœªæ¥å·¥ä½œäº†æ…¢æ…¢å……å®ã€‘</p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
        <category>æ€è€ƒ</category>
      </categories>
      <tags>
        <tag>å·¥ä½œ</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„å’Œç®—æ³•</title>
    <url>/Java-Algorithm/</url>
    <content><![CDATA[<h1 id="ç®—æ³•">ç®—æ³•</h1>
<h2 id="é“¾è¡¨">é“¾è¡¨</h2>
<h3 id="å¿«æ…¢æŒ‡é’ˆ">å¿«æ…¢æŒ‡é’ˆ</h3>
<p>é“¾è¡¨å€’æ•°ç¬¬nä¸ªæ•°</p>
<h3 id="åˆ†æ²»æ³•">åˆ†æ²»æ³•</h3>
<p>æ’åº</p>
<h2 id="äºŒåˆ†æŸ¥æ‰¾">äºŒåˆ†æŸ¥æ‰¾</h2>
<p>ã€1ã€‘ç›®æ ‡ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œæ‰¾ç¬¬ä¸€ä¸ªå¤§äºå®ƒçš„ä¸‹æ ‡</p>
<p>ã€2ã€‘æœ‰å¤šä¸ªç›®æ ‡å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œæ‰¾ç¬¬ä¸€ä¸ªç­‰äºå®ƒçš„ä¸‹æ ‡</p>
<p>ã€æ€è·¯ã€‘åŸºäºäºŒåˆ†æŸ¥æ‰¾ï¼Œä¼˜åŒ–å¯»æ‰¾ mid æŒ‡é’ˆå’Œæ”¶æ•› left right
æŒ‡é’ˆçš„æ­¥éª¤ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æ</p>
<ul>
<li>mid=(left+right)&gt;&gt;2ï¼›if
(nums[left]<strong>&lt;</strong>nums[mid]) left=mid<strong>+1</strong>;
else right=mid;ã€æ‰¾å·¦è¾¹ã€‘</li>
<li>mid=(left+right<strong>+1</strong>)&gt;&gt;2ï¼›if
(nums[left]<strong>&lt;=</strong>nums[mid]) left=mid; else
right=mid<strong>-1</strong>;ã€æ‰¾å³è¾¹ã€‘</li>
</ul>
<h2 id="å †æ’åº">å †æ’åº</h2>
<p>æ•°ç»„å®ç°å¤§æ ¹å †çš„ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼ˆæ³¨æ„åŠ¨æ€æ‰©å®¹ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Heap</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] data;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downHeapify</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸‹æ ‡ä»0å¼€å§‹ï¼Œå­èŠ‚ç‚¹ä¸‹æ ‡ä¸º2i+1å’Œ2i+2</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i*<span class="number">2</span> + <span class="number">1</span>, r = i*<span class="number">2</span> + <span class="number">2</span>, largest = i;</span><br><span class="line">        <span class="keyword">if</span> (l &lt; heapSize &amp;&amp; data[l] &gt; data[largest]) &#123;</span><br><span class="line">            largest = l;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (r &lt; heapSize &amp;&amp; data[r] &gt; data[largest]) &#123;</span><br><span class="line">            largest = r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (largest != i) &#123;</span><br><span class="line">            swap(i, largest);</span><br><span class="line">            maxHeapify(largest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upHeapify</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="comment">// çˆ¶èŠ‚ç‚¹ä¸‹æ ‡ä¸º(i-1)/2</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">parent</span> <span class="operator">=</span> (i-<span class="number">1</span>)/<span class="number">2</span>, min = i;</span><br><span class="line">        <span class="keyword">if</span> (parent&gt;=<span class="number">0</span> &amp;&amp; data[parent] &lt; data[i]) &#123;</span><br><span class="line">            min = parent;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (min != i) &#123;</span><br><span class="line">            swap(min, i);</span><br><span class="line">            upHeapify(min);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</h2>
<p>æ€è·¯ï¼šåŠ¨è§„çš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯æŠŠä¸€ä¸ªå¤æ‚é—®é¢˜æ‹†åˆ†æˆå¤šä¸ªç®€å•ã€å¯ä»¥é€æ­¥å †å å¾—åˆ°ç­”æ¡ˆçš„å­é—®é¢˜ã€‚</p>
<p>åšé¢˜æ­¥éª¤</p>
<ol type="1">
<li>ç¡®å®šdpæ•°ç»„ï¼ˆdp tableï¼‰ä»¥åŠä¸‹æ ‡çš„å«ä¹‰</li>
<li>ç¡®å®šé€’æ¨å…¬å¼</li>
<li>dpæ•°ç»„å¦‚ä½•åˆå§‹åŒ–</li>
<li>ç¡®å®šéå†é¡ºåº</li>
<li>ä¸¾ä¾‹æ¨å¯¼dpæ•°ç»„</li>
</ol>
<h3 id="èƒŒåŒ…">0-1èƒŒåŒ…</h3>
<blockquote>
<p>æ¯ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡</p>
</blockquote>
<p>ä¸‹æ ‡å«ä¹‰ï¼šdp[ç‰©å“ i ][å®¹é‡ j ] ã€‚å¦‚æœ
ç‰©å“ä»·å€¼==ç‰©å“ç§ç±»ï¼Œdpæ•°ç»„å¯ä»¥ç›´æ¥ç”¨ boolean[][]ï¼Œä¸ç›¸ç­‰ç”¨ int[][]</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š<code>dp[i][j] = dp[i - 1][j] || dp[i - 1][j - nums[i]]</code></p>
<p>åˆå§‹åŒ–ï¼šç‰©å“ 0 å’Œå®¹é‡ 0 çš„æƒ…å†µ</p>
<p>éå†é¡ºåºï¼šäºŒç»´æ•°ç»„å…ˆéå†ç‰©å“å’Œå®¹é‡éƒ½å¯ä»¥ï¼Œä¸€ç»´æ•°ç»„åªèƒ½å…ˆéå†å®¹é‡</p>
<h3 id="æ ‘å½¢-dp">æ ‘å½¢ dp</h3>
<p>é¢˜å‹ï¼š<strong>æ ‘çš„ç›´å¾„</strong></p>
<p>æ€è·¯ï¼šå¯ä»¥çœ‹ä½œæ˜¯å†æ±‚æ ‘çš„æ·±åº¦ï¼Œåœ¨æ±‚æ·±åº¦çš„åŒæ—¶â€œæ›´æ–°æ ‘çš„æœ€é•¿ç›´å¾„â€ã€‚</p>
<p>ä»£ç æ¨¡æ¿</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LongestPath</span> &#123;</span><br><span class="line">    List&lt;Integer&gt;[] g;</span><br><span class="line">    <span class="type">int</span> <span class="variable">longestPath</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸¤ç§æ€è·¯ï¼š1.è®°å½•æœ€å¤§å’Œæ¬¡å¤§é•¿çš„è·¯å¾„ï¼›2.è®°å½•æœ€å¤§é•¿ maxï¼Œmax+å½“å‰ç»“æœ å’Œ result æ¯”å¤§å°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> child:g[x]) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> dfs(child) + <span class="number">1</span>;</span><br><span class="line">            longestPath = Math.max(longestPath, max + cur);</span><br><span class="line">            max = Math.max(max, cur);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] relate = &#123;-<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;  <span class="comment">// è¾¹çš„å…³ç³»(é¢˜ç›®ç»™å‡º)</span></span><br><span class="line">        <span class="comment">// æ„å»ºå…³ç³»ï¼ŒList å­˜å„¿å­èŠ‚ç‚¹ï¼Œå¯ä»¥æ‹“å±•åˆ°ä¸€èˆ¬æ ‘çš„æƒ…å†µ</span></span><br><span class="line">        g = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[relate.length];</span><br><span class="line">        Arrays.setAll(g, e -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i&lt;relate.length; i++) &#123;</span><br><span class="line">            g[relate[i]].add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(<span class="number">0</span>);</span><br><span class="line">        System.out.println(longestPath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‹“å±•ï¼š</p>
<ul>
<li>ã€124ã€‘æ±‚äºŒå‰æ ‘ä¸­æœ€å¤§çš„è·¯å¾„å’Œã€‚æ”¹å·¦å³å­æ ‘çš„æ·±åº¦ä¸ºèŠ‚ç‚¹å€¼çš„å’Œï¼Œè‹¥å’Œä¸ºè´Ÿæ•°åˆ™è¿”å›
0</li>
<li>ã€2245ã€‘ä¸€èˆ¬æ ‘çš„æœ€é•¿è·¯å¾„ã€‚éå†æ‰€æœ‰é‚»å±…ï¼ˆè¿‡æ»¤æ‰çˆ¶èŠ‚ç‚¹ï¼‰ï¼Œå–æœ€é•¿ã€æ¬¡é•¿ä¸¤æ¡è·¯å¾„ç›¸åŠ ï¼Œç»“æœä¸ºæœ€é•¿è·¯å¾„ã€‚æ­¤å¤–ï¼Œæ ¹æ®é¢˜æ„è¿˜è¦å»é™¤çˆ¶å­ç»“ç‚¹ç›¸åŒçš„æƒ…å†µã€‚</li>
</ul>
<p>é¢˜å‹ï¼š<strong>æ ‘ä¸Šæœ€å¤§ç‹¬ç«‹é›†</strong>ï¼ˆä»å›¾ä¸­é€‰æ‹©å°½é‡å¤šçš„ç‚¹ï¼Œä½¿å¾—è¿™äº›ç‚¹äº’ä¸ç›¸é‚»ï¼‰</p>
<p>é¢˜å‹ï¼š<strong>æ ‘ä¸Šæœ€å°æ”¯é…é›†</strong>ï¼ˆä»å›¾ä¸­é€‰æ‹©å°½é‡å°‘çš„ç‚¹ï¼Œä½¿å¾—è¿™äº›ç‚¹å’Œå…¶çˆ¶å­ç»“ç‚¹åŒ…æ‹¬äº†æ•´æ£µæ ‘ï¼‰</p>
<h3 id="äºŒç»´-dp">äºŒç»´ dp</h3>
<p>é¢˜å‹ï¼šæœ€é•¿å…¬å…±å­åºåˆ—</p>
<p>æ€è·¯ï¼šå®šä¹‰ <code>dp[i][j]</code> è¡¨ç¤º <code>text1[0:i-1]</code> å’Œ
<code>text2[0:j-1]</code> çš„æœ€é•¿å…¬å…±å­åºåˆ—</p>
<h2 id="å‰ç¼€å’Œ">å‰ç¼€å’Œ</h2>
<blockquote>
<p>åº”ç”¨é¢˜å‹ï¼šè¿ç»­å­æ•°ç»„</p>
</blockquote>
<h2 id="å¹¶æŸ¥é›†">å¹¶æŸ¥é›†</h2>
<blockquote>
<p>åº”ç”¨é¢˜å‹ï¼šæ£€æŸ¥æ ‘æ˜¯å¦è¿é€šï¼›æ„é€ æœ€å°ç”Ÿæˆæ ‘</p>
<p>æ‰©å±•ï¼šå¸¦æƒå¹¶æŸ¥é›†</p>
</blockquote>
<p>æ•°æ®ç»“æ„æ¨¡æ¿</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] tab;</span><br><span class="line">    Node (<span class="type">int</span> size) &#123;</span><br><span class="line">        <span class="built_in">this</span>.tab = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i==tab[i] ? i : (tab[i] = find(tab[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        tab[find(x)] = find(y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="java-æŠ€å·§">Java æŠ€å·§</h1>
<p>å¼ºåˆ¶ç±»å‹è½¬æ¢</p>
<ul>
<li>å‘é›¶æˆªæ–­ï¼Œç›´æ¥ä¿ç•™æ•´æ•°ä½ <code>1/2 == -1/2 == 0</code></li>
</ul>
<p>åŸºæœ¬æ•°æ®ç±»å‹çš„é»˜è®¤å€¼</p>
<ul>
<li>int Â doubleï¼š0</li>
<li>booleanï¼šfalse</li>
</ul>
<p>å¸¸é‡æ± </p>
<ul>
<li>åŒ…è£…ç±»å‹å¸¸é‡æ± ï¼šByte, Short, Integer [-128,127], Long, Character,
Boolean</li>
<li>å­—ç¬¦ä¸²å¸¸é‡æ± </li>
</ul>
<p>åˆå§‹åŒ–</p>
<ul>
<li>æˆå‘˜å˜é‡ï¼ˆå®šä¹‰åœ¨ç±»é‡Œæ–¹æ³•å¤–çš„å˜é‡ï¼‰ä¸€å®šè¦è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œå¦‚æœä¸æ˜¾å¼çš„è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šè¿›è¡Œé»˜è®¤çš„åˆå§‹åŒ–
<ul>
<li>åŸºæœ¬æ•°æ®ç±»å‹ä¸€èˆ¬æ˜¯ç»™äºˆé»˜è®¤å€¼</li>
<li>å¼•ç”¨ç±»å‹åˆå§‹å€¼ä¸º null</li>
</ul></li>
<li>å±€éƒ¨å˜é‡ä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨å£°æ˜å±€éƒ¨å˜é‡æ—¶è¦æ³¨æ„ï¼Œå¯ä»¥ä¸åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼Œä½†åœ¨ä½¿ç”¨ä¹‹å‰ä¸€å®šè¦è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦åˆ™ä¼šæŠ¥ç¼–è¯‘é”™è¯¯</li>
</ul>
<h2 id="æ•°ç»„åˆ—è¡¨å¿«é€Ÿåˆå§‹åŒ–">æ•°ç»„ã€åˆ—è¡¨å¿«é€Ÿåˆå§‹åŒ–</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] array = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">int</span>[][] array = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;<span class="number">2</span>,<span class="number">3</span>&#125;&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;&gt; list = Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);  <span class="comment">// è¿”å›çš„æ˜¯Arraysçš„å†…éƒ¨ç±»ã€æ— æ³•å¢åˆ ã€‘</span></span><br><span class="line">List&lt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()&#123;&#123;</span><br><span class="line">    add(<span class="number">1</span>);</span><br><span class="line">    add(<span class="number">2</span>);</span><br><span class="line">    add(<span class="number">3</span>);</span><br><span class="line">&#125;&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="åˆå§‹åŒ–å°æ ¹å †">åˆå§‹åŒ–å°æ ¹å †</h2>
<p>ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ— <code>PriorityQueue</code> å®ç°å°æ ¹å †</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">PriorityQueue&lt;<span class="type">int</span>[]&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((pair1,pair2) -&gt; pair1[<span class="number">1</span>]-pair2[<span class="number">1</span>]);  <span class="comment">// æ•°ç»„</span></span><br><span class="line">PriorityQueue&lt;ListNode&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((o1, o2) -&gt; o1.val-o2.val);  <span class="comment">// èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">queue.offer(data)  <span class="comment">// èŠ‚ç‚¹å…¥å †</span></span><br><span class="line">data = queue.poll()  <span class="comment">// å¤´èŠ‚ç‚¹å‡ºå †</span></span><br></pre></td></tr></table></figure>
<h2 id="list-è½¬æ•°ç»„">List è½¬æ•°ç»„</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹éœ€è¦æ‰‹åŠ¨æ‹†ç®±</span></span><br><span class="line"><span class="type">int</span>[] array = list.stream().mapToInt(Integer::valueOf).toArray();</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµå¼</span></span><br><span class="line">String[] array = list.stream().toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line"><span class="comment">// ä¸²è¡Œã€è§„å®šå¥½æ•°ç»„å¤§å°ï¼Œzhuan&#x27;huaé€Ÿåº¦æ›´å¿«ã€‘</span></span><br><span class="line">String[] array = list.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[list.size()]);</span><br><span class="line">String[] array = list.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="æ•°ç»„è½¬-list">æ•°ç»„è½¬ List</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹éœ€è¦æ‰‹åŠ¨è£…ç®±</span></span><br><span class="line"><span class="type">int</span>[] arr = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">List&lt;Integer&gt; list = Arrays.stream(arr).boxed().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer[] integers = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">3</span>,<span class="number">8</span>,<span class="number">20</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">25</span>&#125;;</span><br><span class="line">List&lt;Integer&gt; list = Arrays.asList(integers); </span><br><span class="line"><span class="comment">// ArrayList&lt;Object&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">// Collections.addAll(list, a);</span></span><br></pre></td></tr></table></figure>
<h2 id="ä½è¿ç®—å€¼äº¤æ¢">ä½è¿ç®—å€¼äº¤æ¢</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ch[a] ^= ch[b];</span><br><span class="line">ch[b] ^= ch[a];</span><br><span class="line">ch[a] ^= ch[b];</span><br></pre></td></tr></table></figure>
<h2 id="æ³›å‹å ä½ç¬¦">æ³›å‹&amp;å ä½ç¬¦</h2>
<p>æ³›å‹ï¼šT E K V &gt;
æ³›å‹çš„åˆè¡·å°±æ˜¯ä¸ºäº†èƒ½åœ¨ç¼–è¯‘å™¨æ£€æŸ¥å‡ºç±»å‹å®‰å…¨é—®é¢˜ï¼Œå¹¶é€šè¿‡ç¼–è¯‘é”™è¯¯æç¤ºç¨‹åºå‘˜</p>
<ul>
<li>æ³›å‹å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹</li>
<li>æ³›å‹é€šè¿‡ç±»å‹æ“¦é™¤å®ç°</li>
</ul>
<p>å ä½ç¬¦ï¼š?</p>
<p>TODO lambda stream æµå¼è®¡ç®— è¯¦è§£</p>
<h2 id="ä½è¿ç®—åˆ¤æ–­å¥‡å¶">ä½è¿ç®—åˆ¤æ–­å¥‡å¶</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">num &amp; <span class="number">1</span> == <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="åè¿›åˆ¶æ•°è½¬-char">åè¿›åˆ¶æ•°è½¬ char</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> <span class="variable">t</span> <span class="operator">=</span> Character.forDigit(i, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h2 id="collection-è½¬-list">Collection è½¬ List</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Collection&lt;T&gt; collection = map.values();</span><br><span class="line">List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;T&gt;(collection);</span><br></pre></td></tr></table></figure>
<h2 id="map-éå†æ–¹æ³•">Map éå†æ–¹æ³•</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Map.Entry&lt;Key.class, Value.class&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;key= &quot;</span> + entry.getKey() + <span class="string">&quot; and value= &quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åœ¨æ¡ä»¶è¯­å¥ä¸­èµ‹å€¼">åœ¨æ¡ä»¶è¯­å¥ä¸­èµ‹å€¼</h2>
<p>ä¸èƒ½ç›´æ¥åœ¨ <code>if</code> è¯­å¥çš„æ¡ä»¶éƒ¨åˆ†è¿›è¡Œå£°æ˜å’Œèµ‹å€¼ï¼Œéœ€è¦åœ¨
<code>if</code> è¯­å¥ä¹‹å‰å£°æ˜å˜é‡ï¼Œå¹¶åœ¨æ¡ä»¶è¯­å¥ä¸­åªè¿›è¡Œèµ‹å€¼æˆ–æ¯”è¾ƒæ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> dis;  </span><br><span class="line"><span class="keyword">if</span> ((dis = i - dp[i - <span class="number">1</span>]) &gt; <span class="number">1</span> &amp;&amp; s.charAt(dis - <span class="number">2</span>) == <span class="string">&#x27;(&#x27;</span>) &#123;  </span><br><span class="line">    <span class="comment">// ... ä½¿ç”¨ dis è¿›è¡Œæ“ä½œ ...  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="stringbuilderstringbuffer-å¸¸ç”¨æ–¹æ³•">StringBuilder/StringBuffer
å¸¸ç”¨æ–¹æ³•</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">s.append(char c) // å°† char è¿½åŠ åˆ°æ­¤åºåˆ—</span><br><span class="line">s.charAt(int index) // è¿”å›æŒ‡å®šç´¢å¼•å¤„çš„æ­¤åºåˆ—ä¸­çš„ char å€¼</span><br><span class="line">s.deleteCharAt(int index) // æŒ‰æ­¤é¡ºåºåˆ é™¤æŒ‡å®šä½ç½®çš„ char</span><br><span class="line">s.setCharAt(int index, char ch) // æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦è®¾ç½®ä¸º ch</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Javaç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <url>/Design-Pattern/</url>
    <content><![CDATA[<h1 id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼</h1>
<p>åŒé‡æ ¡éªŒé”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (uniqueInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">//ç±»å¯¹è±¡åŠ é”</span></span><br><span class="line">    <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">        <span class="keyword">if</span> (uniqueInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">            uniqueInstance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h1>
<blockquote>
<p>æŠ½è±¡å‡ºæ­¥éª¤çš„æ‰§è¡Œé¡ºåºä½œä¸ºæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°æ–¹æ³•äº¤ç»™å­ç±»å®ç°</p>
</blockquote>
<p>å®ç° AQS æŠ½è±¡ç±»çš„é”ï¼Œéœ€è¦é‡å†™ CLH é”çš„
<code>tryAcquire-tryRelease</code>ã€<code>tryAcquireShared-tryReleaseShared</code>ã€<code>isHeldExclusively</code>
æ–¹æ³•ã€‚</p>
<p>é‡å†™é’©å­æ–¹æ³•ï¼Œå¯ä»¥è‡ªå®šä¹‰ <code>state</code>
çš„å«ä¹‰ï¼šå€¼ä¸ºå¤šå°‘æ—¶ä»£è¡¨åŠ é”æˆåŠŸ/å¤±è´¥ or
è§£é”æˆåŠŸ/å¤±è´¥ï¼Œä¹Ÿå¯ä»¥å®ç°å…±äº«é”æˆ–ç‹¬å é”ã€‚</p>
<h1 id="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</h1>
<p>å…·ä½“æŸ¥çœ‹ JUC_Lock åšå®¢çš„ <code>CompletableFuture</code>
çš„åº•å±‚å®ç°</p>
<h1 id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</h1>
<p>å…·ä½“æŸ¥çœ‹ SpringMVC åšå®¢çš„ <code>HandlerAdapter</code> çš„åº•å±‚å®ç°</p>
<p>å¼€é—­åŸåˆ™ï¼šæ–°å¢ä»£æ›¿ä¿®æ”¹</p>
]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>LLM-Basic</title>
    <url>/LLM-Basic/</url>
    <content><![CDATA[<blockquote>
<p>å¤§æ¨¡å‹æ ¸å¿ƒæŠ€æœ¯ç‚¹åœ¨äºè®­ç»ƒèµ„æºã€æ•°æ®æ¸…æ´—å’Œæ•°æ®é…æ¯”ç­‰ï¼Œå…¶éš¾ç‚¹æˆ–è®¸ä¸åœ¨äºæ¨¡å‹è®­ç»ƒå’Œæ¨¡å‹ç»“æ„æ­å»º</p>
</blockquote>
<p><strong>ã€å˜å½¢é‡‘åˆšä¹‹ç¥ï¼ä¿ä½‘æˆ‘æ‰¾åˆ°å·¥ä½œï¼ã€‘</strong></p>
<style>.sjwvpviettdw{zoom:70%;}</style>
<img data-src="/LLM-Basic/image-20240714162218754.png" class="sjwvpviettdw" alt="image-20240714162218754">
<ul>
<li>ç›¸è¾ƒäº RNNï¼ŒTransformer
ç›´æ¥å°†å¥å­ä¸­<strong>ä»»æ„ä¸¤ä¸ªå•è¯çš„è”ç³»é€šè¿‡ä¸€ä¸ªè®¡ç®—æ­¥éª¤ç›´æ¥è”ç³»èµ·æ¥</strong>ï¼Œè¿œè·ç¦»ä¾èµ–ç‰¹å¾ä¹‹é—´çš„è·ç¦»è¢«æå¤§ç¼©çŸ­ï¼Œæœ‰åˆ©äºæœ‰æ•ˆåœ°åˆ©ç”¨è¿™äº›ç‰¹å¾ï¼›</li>
<li>Self Attention
å¤§å¤§æå‡äº†<strong>è®¡ç®—çš„å¹¶è¡Œ</strong>ï¼Œé€šè¿‡ä¸Šä¸‰è§’maskå¯ä»¥åŒæ—¶è®­ç»ƒä¸€å¥è¯ä¸­çš„æ‰€æœ‰tokenï¼›</li>
</ul>
<p>NLP
ä»»åŠ¡ï¼šæƒ…æ„Ÿåˆ†æã€æ–‡æœ¬ç”Ÿæˆã€å‘½åä½“è¯†åˆ«ã€é˜…è¯»ç†è§£ã€æ©ç å¡«å……ã€æ–‡æœ¬æ‘˜è¦ã€æœºå™¨ç¿»è¯‘ã€ç‰¹å¾æå–ã€å¯¹è¯æœºå™¨äººã€‚</p>
<p>NLP
æ•°æ®é›†å¤§å¤šæ˜¯æœªæ ‡æ³¨çš„æ–‡æ¡£ï¼Œå› æ­¤é‡‡ç”¨è‡ªç›‘ç£å­¦ä¹ çš„æ–¹å¼è®­ç»ƒæ¨¡å‹ï¼Œå¦‚é¢„æµ‹ä¸‹ä¸€ä¸ªè¯
LMã€å®Œå½¢å¡«ç©º MLMã€‚æ—©äº›å¹´ï¼Œæµè¡Œçš„æ˜¯è¯åµŒå…¥ Word
Embeddingï¼Œç›®æ ‡æ˜¯é‡‡ç”¨å‘é‡çš„å½¢å¼è¡¨ç¤ºè¯å…ƒï¼Œé‡‡ç”¨ä¸€ç»„å‘é‡è¡¨ç¤ºä¸€æ®µè¯ï¼Œå¯ä»¥ç”¨äºè®¡ç®—è¯/å¥å­ç›¸ä¼¼åº¦ã€‚</p>
<p>ç°é˜¶æ®µï¼ŒTransformer çš„å‡ºç°ä¿ƒä½¿ä¸‰ç§ç±»å‹çš„æ¨¡å‹çš„å‡ºç°ï¼šå‰ç¼€è¯­è¨€æ¨¡å‹
Encoder-Decoderï¼ˆprefix-lmï¼‰ï¼›æ©ç è¯­è¨€æ¨¡å‹/è‡ªç¼–ç æ¨¡å‹
Encoder-Onlyï¼›å› æœè¯­è¨€æ¨¡å‹/è‡ªå›å½’æ¨¡å‹ Decoder-Onlyã€‚Encoder-only
é€‚ç”¨äºæœºå™¨ç¿»è¯‘ã€å¥å­åˆ†ç±»ã€å‘½åä½“è¯†åˆ«å’Œé—®ç­”ï¼ˆå¤§æ¦‚ï¼‰ï¼›Decoder-only
é€‚ç”¨äºæ–‡æœ¬é¢„æµ‹ï¼›Encoder-Decoder é€‚ç”¨äºæ–‡æœ¬å‹ç¼©ã€‚</p>
<h1 id="llm-åŸºç¡€çŸ¥è¯†">LLM åŸºç¡€çŸ¥è¯†</h1>
<h2 id="é¢„è®­ç»ƒæ˜¾å­˜å ç”¨">é¢„è®­ç»ƒæ˜¾å­˜å ç”¨</h2>
<p>æ ·ä¾‹ï¼šå¤§å°ä¸º n Bçš„æ¨¡å‹ï¼ŒAdam ä¼˜åŒ–å™¨ï¼Œæ··åˆç²¾åº¦ fp16ï¼Œ
b(batch_size)ï¼Œs(sequence len)ï¼Œh(hidden size)</p>
<ol type="1">
<li>è¾“å…¥è¾“å‡ºï¼šsbh*2 byte</li>
<li>æ¨¡å‹å¤§å°ï¼šn*2 GB</li>
<li>æ¢¯åº¦å¤§å°ï¼šn*2 GB</li>
<li>ä¼˜åŒ–å™¨å¤§å°ï¼š(4+4+4) *n
GBã€‚æ¨¡å‹æ›´æ–°æ—¶ï¼Œæ¢¯åº¦å¾ˆå°ï¼Œå­¦ä¹ ç‡ä¹Ÿå¾ˆå°ï¼Œç²¾åº¦ä¸¢å¤±ä¼šå½±å“æ¨¡å‹æ”¶æ•›æ•ˆæœï¼Œæ‰€ä»¥ä¼˜åŒ–å™¨ä¸­çš„æ•°æ®å…¨éƒ½æ˜¯
fp32 ç²¾åº¦ã€‚</li>
<li>æ¿€æ´»å€¼å¤§å°ï¼šsbh(34+5*a*s/h)*L byte <a
href="https://zhuanlan.zhihu.com/p/673916177">åˆ†æ</a></li>
</ol>
<h2 id="ä¼˜åŒ–å™¨">ä¼˜åŒ–å™¨</h2>
<p>åœ¨çŸ³å™¨æ—¶ä»£ï¼Œäººä»¬ç›´æ¥ä½¿ç”¨ <code>loss.backward()</code>
è®¡ç®—æ¢¯åº¦ï¼Œä¹˜ä»¥å›ºå®šçš„å­¦ä¹ ç‡ï¼Œå¾—åˆ°æ‰€æœ‰å‚æ•°æ›´æ–°çš„å¹…åº¦ã€‚ç„¶è€Œï¼Œä½¿ç”¨å›ºå®šçš„å­¦ä¹ ç‡ï¼Œåœ¨æ¢¯åº¦å˜åŒ–å‰§çƒˆçš„åœ°æ–¹ï¼Œä¼šå¯¼è‡´æ›´æ–°ä¸ç¨³å®šæˆ–æ”¶æ•›æ…¢ã€‚</p>
<p>ä¸ºæé«˜æ”¶æ•›æ•ˆæœï¼Œå‡ºç°äº†å¾ˆå¤šä¼˜åŒ–å™¨ï¼Œå®ƒä»¬è¢«æ”¶è—åœ¨
<code>torch.optim</code> é‡Œé¢ï¼Œæœ€å‡ºåçš„åº”è¯¥æ˜¯
<code>Adam</code>ã€<code>AdamW</code>ã€<code>SGD</code>ä¸‰å¤§å¤©ç‹ï¼Œå¾…æˆ‘å¨“å¨“é“æ¥ã€‚</p>
<h3 id="adam">Adam</h3>
<p>è‡ªé€‚åº”å­¦ä¹ ç‡ï¼š Adam
é€šè¿‡è®¡ç®—ä¸€é˜¶å’ŒäºŒé˜¶çŸ©ä¼°è®¡æ¥ä¸ºæ¯ä¸ªå‚æ•°è‡ªé€‚åº”åœ°è°ƒæ•´å­¦ä¹ ç‡ï¼›</p>
<p>åå·®æ ¡æ­£ï¼š
åˆå§‹é˜¶æ®µæ¢¯åº¦ä¼°è®¡å¯èƒ½åä½ï¼Œé€šè¿‡åå·®æ ¡æ­£å¯ä»¥åŠ é€ŸåˆæœŸçš„å­¦ä¹ é€Ÿç‡ï¼›</p>
<p>é€‚åº”æ€§å¼ºï¼š Adam åœ¨å¾ˆå¤šä¸åŒçš„æ¨¡å‹å’Œæ•°æ®é›†ä¸Šéƒ½è¡¨ç°å‡ºäº†è‰¯å¥½çš„æ€§èƒ½ï¼›</p>
<h2 id="å‡å°‘æ˜¾å­˜å ç”¨">å‡å°‘æ˜¾å­˜å ç”¨</h2>
<p>æ··åˆç²¾åº¦è®­ç»ƒï¼šFP16
é€Ÿåº¦å¿«ï¼Œå ç”¨å°ï¼Œé€‚åˆå‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­ã€çŸ©é˜µè®¡ç®—ï¼›FP32
ç²¾åº¦é«˜ï¼Œé€‚åˆæ¢¯åº¦ç´¯ç§¯ã€æƒé‡æ›´æ–°ã€å½’ä¸€åŒ–ã€softmaxï¼ˆå¯ä»¥é€šè¿‡åŠ¨æ€æŸå¤±ç¼©æ”¾å‡å°‘ç²¾åº¦æŸå¤±ï¼‰</p>
<p>æ¢¯åº¦ç´¯ç§¯ï¼š
<code>loss = loss / self.args.gradient_accumulation_steps</code>ï¼Œæ›´ç¨³å®šçš„æ¢¯åº¦ä¼°è®¡</p>
<p>æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼š<code>gradient_checkpointing=True</code>
åªä¿å­˜è®¡ç®—ä»£ä»·å¤§ä¸”æ˜¾å­˜å ç”¨å°‘çš„ä¸­é—´æ¿€æ´»å€¼ï¼Œåœ¨åå‘ä¼ æ’­æ—¶é‡æ–°è®¡ç®—æœªä¿å­˜çš„æ¿€æ´»å€¼</p>
<h2 id="é‡‡æ ·">é‡‡æ ·</h2>
<p>top_k
(int)ï¼šæ¯æ¬¡ä¿ç•™æ¦‚ç‡æœ€å¤§çš„å‡ ä¸ªåºåˆ—ï¼Œå†æŒ‰ç…§æ¦‚ç‡é€‰æ‹©ä¿ç•™çš„åºåˆ—ï¼ˆä¸é€‚ç”¨äºæ¦‚ç‡åˆ†å¸ƒå¹³æ»‘çš„æƒ…å†µï¼‰</p>
<p>top_p (float: 0~1)ï¼šä¿ç•™å‰nä¸ªæ¦‚ç‡å’Œå¤§äº p
çš„åºåˆ—ï¼Œå†æŒ‰ç…§æ¦‚ç‡é€‰æ‹©ä¿ç•™çš„åºåˆ—ï¼ˆé€‚ç”¨äºæ¦‚ç‡åˆ†å¸ƒå¹³æ»‘çš„æƒ…å†µï¼ŒæŒ‰ç…§æ¦‚ç‡é‡‡æ ·ï¼Œæé«˜å“åº”å¤šæ ·æ€§ï¼‰</p>
<p>temperatureï¼šä¼˜åŒ–äº† Softmax å‡½æ•°æ”¹ä¸º <span
class="math inline">\(p(x_i)=\frac{e^{\frac{x_i}t}}{\sum_{j=1}^ne^{\frac{x_j}t}}\)</span>ï¼Œæ¸©åº¦è¶Šå°
softmax çš„æ¦‚ç‡åˆ†é…è¶Šå°–é”ï¼ˆç¡®å®šæ€§ï¼‰ï¼Œåä¹‹è¶Šå¹³æ»‘ï¼ˆéšæœºæ€§ï¼‰</p>
<p>num_beamsï¼šæ¯æ¬¡ä¿ç•™æ¦‚ç‡æœ€å¤§çš„å‡ ä¸ªåºåˆ—ï¼Œæœ€åè¾“å‡ºæ¦‚ç‡æœ€å¤§çš„å€¼ï¼ˆä¸Šé¢ä¸‰ä¸ªæ–¹æ³•å·²è¶³å¤Ÿï¼ŒæŸæœç´¢æœªåŒ…å«åœ¨
OpenAI API ä¸­ï¼‰</p>
<h2 id="embedding-æ¨¡å‹çš„ç»“æ„">Embedding æ¨¡å‹çš„ç»“æ„</h2>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">BertModel(</span><br><span class="line">  (embeddings): BertEmbeddings(</span><br><span class="line">    (word<span class="built_in">_</span>embeddings): Embedding(21152, 1024, padding<span class="built_in">_</span>idx=0)</span><br><span class="line">    (position<span class="built_in">_</span>embeddings): Embedding(512, 1024)</span><br><span class="line">    (token<span class="built_in">_</span>type<span class="built_in">_</span>embeddings): Embedding(2, 1024)</span><br><span class="line">    (LayerNorm): </span><br><span class="line">    (dropout): Dropout(p=0.1, inplace=False)</span><br><span class="line">  )</span><br><span class="line">  (encoder): BertEncoder(</span><br><span class="line">    (layer): ModuleList(</span><br><span class="line">      (0-23): 24 x BertLayer(</span><br><span class="line">        (attention): BertAttention(</span><br><span class="line">          (self): BertSdpaSelfAttention(</span><br><span class="line">            (query): Linear(in<span class="built_in">_</span>features=1024, out<span class="built_in">_</span>features=1024, bias=True)</span><br><span class="line">            (key): Linear(in<span class="built_in">_</span>features=1024, out<span class="built_in">_</span>features=1024, bias=True)</span><br><span class="line">            (value): Linear(in<span class="built_in">_</span>features=1024, out<span class="built_in">_</span>features=1024, bias=True)</span><br><span class="line">            (dropout): Dropout(p=0.1, inplace=False)</span><br><span class="line">          )</span><br><span class="line">          (output): BertSelfOutput(</span><br><span class="line">            (dense): Linear(in<span class="built_in">_</span>features=1024, out<span class="built_in">_</span>features=1024, bias=True)</span><br><span class="line">            (LayerNorm): </span><br><span class="line">            (dropout): Dropout(p=0.1, inplace=False)</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">        (intermediate): BertIntermediate(</span><br><span class="line">          (dense): Linear(in<span class="built_in">_</span>features=1024, out<span class="built_in">_</span>features=4096, bias=True)</span><br><span class="line">          (intermediate<span class="built_in">_</span>act<span class="built_in">_</span>fn): GELUActivation()</span><br><span class="line">        )</span><br><span class="line">        (output): BertOutput(</span><br><span class="line">          (dense): Linear(in<span class="built_in">_</span>features=4096, out<span class="built_in">_</span>features=1024, bias=True)</span><br><span class="line">          (LayerNorm): </span><br><span class="line">          (dropout): Dropout(p=0.1, inplace=False)</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">  (pooler): BertPooler(</span><br><span class="line">    (dense): Linear(in<span class="built_in">_</span>features=1024, out<span class="built_in">_</span>features=1024, bias=True)</span><br><span class="line">    (activation): Tanh()</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="coding">Coding</h1>
<h2 id="transformersåŠç›¸å…³åº“">TransformersåŠç›¸å…³åº“</h2>
<blockquote>
<p>ä¼˜ç§€çš„åŸºç¡€çŸ¥è¯†åˆ†äº« <a
href="https://www.bilibili.com/video/BV1CB4y1R78v/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&amp;vd_source=3cc51ca1725a727b98e3f7d482a21ed1">B
ç«™è¯¾ç¨‹</a>ï¼Œ<a
href="https://github.com/datawhalechina/tiny-universe/tree/main">å¼€æºé¡¹ç›®</a></p>
</blockquote>
<p>Transformersï¼šæ ¸å¿ƒåº“ï¼Œæ¨¡å‹åŠ è½½ã€æ¨¡å‹è®­ç»ƒã€æµæ°´çº¿å¹¶è¡Œç­‰</p>
<p>Tokenizerï¼šåˆ†è¯å™¨ï¼Œå¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œæ–‡æœ¬åˆ°tokenåºåˆ—çš„äº’ç›¸è½¬æ¢ã€‚å…·ä½“å·¥ä½œåŒ…æ‹¬ï¼šåˆ†è¯ã€ç´¢å¼•ã€å¡«å……æˆªæ–­ã€attention_maskã€token_type</p>
<p>Datasetsï¼šæ•°æ®é›†åº“ï¼Œæä¾›äº†æ•°æ®é›†çš„åŠ è½½ã€å¤„ç†ç­‰æ–¹æ³•</p>
<p>Evaluateï¼šè¯„ä¼°å‡½æ•°ï¼Œæä¾›å„ç§è¯„ä»·æŒ‡æ ‡çš„è®¡ç®—å‡½æ•°</p>
<p>Trainerï¼šå°†æ¨¡å‹è®­ç»ƒæµç¨‹æ‰“åŒ…ï¼ŒåŒ…æ‹¬ï¼šåˆ›å»ºä¼˜åŒ–å™¨ã€åˆ›å»ºDataLoaderã€tensorè½¬ç§»åˆ°CUDAä¸Š</p>
<p>PEFTï¼šé«˜æ•ˆå¾®è°ƒæ¨¡å‹çš„åº“ï¼Œæä¾›äº†å‡ ç§é«˜æ•ˆå¾®è°ƒçš„æ–¹æ³•ï¼Œå°å‚æ•°é‡åŠ¨å¤§æ¨¡å‹</p>
<p>Accelerateï¼šåˆ†å¸ƒå¼è®­ç»ƒï¼Œæä¾›äº†åˆ†å¸ƒå¼è®­ç»ƒè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¤§æ¨¡å‹çš„åŠ è½½ä¸æ¨ç†è§£å†³æ–¹æ¡ˆ</p>
<p>Optimumï¼šä¼˜åŒ–åŠ é€Ÿåº“ï¼Œæ”¯æŒå¤šç§åç«¯ï¼Œå¦‚Onnxruntimeã€OpenVinoç­‰</p>
<p>Gradioï¼šå¯è§†åŒ–éƒ¨ç½²åº“ï¼Œå‡ è¡Œä»£ç å¿«é€Ÿå®ç°åŸºäºWebäº¤äº’çš„ç®—æ³•æ¼”ç¤ºç³»ç»Ÿ</p>
<h2 id="åˆ†å¸ƒå¼è®­ç»ƒ">åˆ†å¸ƒå¼è®­ç»ƒ</h2>
<p>Accelerate åŒ…ï¼Œèåˆäº† Deepspeedã€DDPã€FSDPï¼›</p>
<h2 id="llama-factory-æºç ">LLaMA-Factory æºç </h2>
<p>trainargs.main_process_first() åªæœ‰åœ¨ä¸»è¿›ç¨‹é‡Œé¢è¿›è¡Œæ•°æ®å¤„ç†</p>
<p>é«˜æ•ˆæ‰“åŒ…ç­–ç•¥ï¼Œæ›¿æ¢ transformers åŒ…çš„
<code>_get_unpad_data</code>ï¼Œä»¥åŒºåˆ†æ¯ä¸ª batch ä¸­çš„ä¸åŒåºåˆ—</p>
]]></content>
      <categories>
        <category>LLM</category>
      </categories>
      <tags>
        <tag>å¤§æ¨¡å‹åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux-Tool</title>
    <url>/Linux-Tool/</url>
    <content><![CDATA[<h1 id="vim">Vim</h1>
<h2 id="åŸºæœ¬æ¨¡å¼åˆ‡æ¢">åŸºæœ¬æ¨¡å¼åˆ‡æ¢</h2>
<ul>
<li><strong><code>i</code></strong>ï¼šè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œä»å…‰æ ‡å‰æ’å…¥æ–‡æœ¬ã€‚</li>
<li><strong><code>a</code></strong>ï¼šè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œä»å…‰æ ‡åæ’å…¥æ–‡æœ¬ã€‚</li>
<li><strong><code>Esc</code></strong>ï¼šé€€å‡ºæ’å…¥æ¨¡å¼ï¼Œå›åˆ°æ­£å¸¸æ¨¡å¼ã€‚</li>
<li><strong><code>v</code></strong>ï¼šè¿›å…¥å¯è§†æ¨¡å¼ï¼Œç”¨äºé€‰æ‹©æ–‡æœ¬å—ã€‚</li>
<li><strong><code>V</code></strong> æˆ–
<strong><code>vv</code></strong>ï¼šè¿›å…¥å¯è§†è¡Œæ¨¡å¼ï¼Œé€‰æ‹©æ•´è¡Œæ–‡æœ¬ã€‚</li>
<li><strong><code>Ctrl + v</code></strong>ï¼šè¿›å…¥å¯è§†å—æ¨¡å¼ï¼Œé€‰æ‹©çŸ©å½¢åŒºåŸŸã€‚</li>
</ul>
<h2 id="å…‰æ ‡ç§»åŠ¨">å…‰æ ‡ç§»åŠ¨</h2>
<ul>
<li><strong><code>w</code></strong>ï¼šå…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„å¼€å¤´ã€‚</li>
<li><strong><code>b</code></strong>ï¼šå…‰æ ‡ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªå•è¯çš„å¼€å¤´ã€‚</li>
<li><strong><code>0</code></strong>ï¼šç§»åŠ¨åˆ°è¡Œé¦–ã€‚</li>
<li><strong><code>$</code></strong>ï¼šç§»åŠ¨åˆ°è¡Œå°¾ã€‚</li>
<li><strong><code>gg</code></strong>ï¼šç§»åŠ¨åˆ°æ–‡ä»¶çš„ç¬¬ä¸€è¡Œã€‚</li>
<li><strong><code>G</code></strong>ï¼šç§»åŠ¨åˆ°æ–‡ä»¶çš„æœ€åä¸€è¡Œã€‚</li>
<li><strong><code>H</code></strong>ï¼šç§»åŠ¨åˆ°å±å¹•çš„é¡¶éƒ¨ã€‚</li>
<li><strong><code>M</code></strong>ï¼šç§»åŠ¨åˆ°å±å¹•çš„ä¸­éƒ¨ã€‚</li>
<li><strong><code>L</code></strong>ï¼šç§»åŠ¨åˆ°å±å¹•çš„åº•éƒ¨ã€‚</li>
</ul>
<h2 id="ç¼–è¾‘æ–‡æœ¬">ç¼–è¾‘æ–‡æœ¬</h2>
<ul>
<li><strong><code>x</code></strong>ï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨çš„å­—ç¬¦ã€‚</li>
<li><strong><code>dw</code></strong>ï¼šåˆ é™¤ä»å…‰æ ‡åˆ°å•è¯æœ«å°¾çš„å†…å®¹ã€‚</li>
<li><strong><code>dd</code></strong>ï¼šåˆ é™¤å½“å‰è¡Œã€‚</li>
<li><strong><code>d$</code></strong>ï¼šåˆ é™¤ä»å…‰æ ‡åˆ°è¡Œæœ«çš„å†…å®¹ã€‚</li>
<li><strong><code>yy</code></strong>ï¼šå¤åˆ¶å½“å‰è¡Œã€‚</li>
<li><strong><code>p</code></strong>ï¼šç²˜è´´åˆ°å…‰æ ‡ä¹‹åã€‚</li>
<li><strong><code>u</code></strong>ï¼šæ’¤é”€ä¸Šä¸€æ­¥æ“ä½œã€‚</li>
<li><strong><code>Ctrl + r</code></strong>ï¼šé‡åšæ’¤é”€çš„æ“ä½œã€‚</li>
<li><strong><code>r</code></strong>ï¼šæ›¿æ¢å…‰æ ‡ä¸‹çš„å­—ç¬¦ã€‚</li>
<li><strong><code>ciw</code></strong>ï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨çš„å•è¯å¹¶è¿›å…¥æ’å…¥æ¨¡å¼ã€‚</li>
<li><strong><code>c$</code></strong>ï¼šåˆ é™¤ä»å…‰æ ‡åˆ°è¡Œå°¾çš„å†…å®¹å¹¶è¿›å…¥æ’å…¥æ¨¡å¼ã€‚</li>
</ul>
<h2 id="æœç´¢å’Œæ›¿æ¢">æœç´¢å’Œæ›¿æ¢</h2>
<ul>
<li><strong><code>/pattern</code></strong>ï¼šå‘ä¸‹æœç´¢
<code>pattern</code>ã€‚</li>
<li><strong><code>?pattern</code></strong>ï¼šå‘ä¸Šæœç´¢
<code>pattern</code>ã€‚</li>
<li><strong><code>n</code></strong>ï¼šè·³åˆ°ä¸‹ä¸€ä¸ªæœç´¢ç»“æœã€‚</li>
<li><strong><code>N</code></strong>ï¼šè·³åˆ°ä¸Šä¸€ä¸ªæœç´¢ç»“æœã€‚</li>
<li><strong><code>:s/old/new/g</code></strong>ï¼šå°†å½“å‰è¡Œçš„æ‰€æœ‰
<code>old</code> æ›¿æ¢ä¸º <code>new</code>ã€‚</li>
<li><strong><code>:%s/old/new/g</code></strong>ï¼šå°†æ•´ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰
<code>old</code> æ›¿æ¢ä¸º <code>new</code>ã€‚</li>
</ul>
<h2 id="æ–‡ä»¶æ“ä½œ">æ–‡ä»¶æ“ä½œ</h2>
<ul>
<li><strong><code>:w</code></strong>ï¼šä¿å­˜æ–‡ä»¶ã€‚</li>
<li><strong><code>:q</code></strong>ï¼šé€€å‡º Vimã€‚</li>
<li><strong><code>:wq</code></strong>ï¼šä¿å­˜å¹¶é€€å‡ºã€‚</li>
<li><strong><code>:q!</code></strong>ï¼šä¸ä¿å­˜å¼ºåˆ¶é€€å‡ºã€‚</li>
<li><strong><code>:e filename</code></strong>ï¼šæ‰“å¼€æ–‡ä»¶
<code>filename</code>ã€‚</li>
<li><strong><code>:r filename</code></strong>ï¼šåœ¨å½“å‰æ–‡ä»¶ä¸­æ’å…¥
<code>filename</code> çš„å†…å®¹ã€‚</li>
</ul>
<h1 id="screen">Screen</h1>
<h2 id="åŸºæœ¬å‘½ä»¤">åŸºæœ¬å‘½ä»¤</h2>
<ul>
<li><strong><code>screen</code></strong>ï¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„
<code>screen</code> ä¼šè¯ã€‚</li>
<li><strong><code>screen -S session_name</code></strong>ï¼šå¯åŠ¨ä¸€ä¸ªå‘½åä¸º
<code>session_name</code> çš„ <code>screen</code> ä¼šè¯ã€‚</li>
<li><strong><code>screen -ls</code></strong>ï¼šåˆ—å‡ºå½“å‰æ‰€æœ‰çš„
<code>screen</code> ä¼šè¯ã€‚</li>
<li><strong><code>screen -r</code></strong>ï¼šé‡æ–°è¿æ¥åˆ°ä¸€ä¸ª
<code>screen</code> ä¼šè¯ï¼ˆå¦‚æœåªæœ‰ä¸€ä¸ªä¼šè¯ï¼‰ã€‚</li>
<li><strong><code>screen -r session_name</code></strong>ï¼šé‡æ–°è¿æ¥åˆ°ä¸€ä¸ªåä¸º
<code>session_name</code> çš„ <code>screen</code> ä¼šè¯ã€‚</li>
<li><strong><code>screen -d session_name</code></strong>ï¼šåœ¨å…¶ä»–åœ°æ–¹çš„ç»ˆç«¯æ–­å¼€æŸä¸ªä¼šè¯çš„è¿æ¥ã€‚</li>
<li><strong><code>screen -d -r session_name</code></strong>ï¼šå¼ºåˆ¶ä»å…¶ä»–åœ°æ–¹çš„ç»ˆç«¯æ–­å¼€å¹¶é‡æ–°è¿æ¥åˆ°
<code>session_name</code> ä¼šè¯ã€‚</li>
<li><strong><code>screen -X quit</code></strong>ï¼šå…³é—­æ‰€æœ‰
<code>screen</code> ä¼šè¯</li>
</ul>
<h2 id="åœ¨-screen-ä¼šè¯ä¸­æ“ä½œ">åœ¨ <code>screen</code> ä¼šè¯ä¸­æ“ä½œ</h2>
<p>åœ¨ <code>screen</code> ä¼šè¯ä¸­ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä»¥ <code>Ctrl + a</code>
å¼€å¤´ï¼ˆè¡¨ç¤ºâ€œå‰ç¼€é”®â€ï¼‰ï¼Œç„¶åè·Ÿéšå…¶ä»–æŒ‰é”®æ¥æ‰§è¡Œæ“ä½œã€‚</p>
<ul>
<li><strong><code>Ctrl + a, X</code></strong>ï¼šå…³é—­å½“å‰çš„åˆ†å‰²çª—å£ã€‚</li>
<li><strong><code>Ctrl + a, c</code></strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çª—å£ã€‚</li>
<li><strong><code>Ctrl + a, n</code></strong>ï¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£ã€‚</li>
<li><strong><code>Ctrl + a, p</code></strong>ï¼šåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªçª—å£ã€‚</li>
<li><strong><code>Ctrl + a, "</code></strong>ï¼šåˆ—å‡ºå½“å‰æ‰€æœ‰çª—å£ï¼Œå…è®¸é€‰æ‹©åˆ‡æ¢ã€‚</li>
<li><strong><code>Ctrl + a, 0-9</code></strong>ï¼šåˆ‡æ¢åˆ°æŒ‡å®šç¼–å·çš„çª—å£ï¼ˆä¾‹å¦‚
<code>Ctrl + a, 1</code> åˆ‡æ¢åˆ°çª—å£ 1ï¼‰ã€‚</li>
<li><strong><code>Ctrl + a, d</code></strong>ï¼šå°†å½“å‰
<code>screen</code> ä¼šè¯æ–­å¼€ï¼ˆdetachï¼‰ï¼Œä¼šè¯ç»§ç»­åœ¨åå°è¿è¡Œã€‚</li>
<li><strong><code>Ctrl + a, A</code></strong>ï¼šé‡å‘½åå½“å‰çª—å£ã€‚</li>
<li><strong><code>Ctrl + a, K</code></strong>ï¼šå…³é—­å½“å‰çª—å£ã€‚</li>
<li><strong><code>Ctrl + a, S</code></strong>ï¼šæ°´å¹³åˆ†å‰²å½“å‰çª—å£ã€‚</li>
<li><strong><code>Ctrl + a, |</code></strong>ï¼šå‚ç›´åˆ†å‰²å½“å‰çª—å£ã€‚</li>
<li><strong><code>Ctrl + a, tab</code></strong>ï¼šåœ¨åˆ†å‰²çš„çª—å£é—´åˆ‡æ¢ç„¦ç‚¹ã€‚</li>
<li><strong><code>Ctrl + a, Q</code></strong>ï¼šå…³é—­é™¤äº†å½“å‰çª—å£å¤–çš„æ‰€æœ‰åˆ†å‰²çª—å£ã€‚</li>
<li><strong><code>Ctrl + a, X</code></strong>ï¼šå…³é—­å½“å‰çš„åˆ†å‰²çª—å£ã€‚</li>
</ul>
<h2 id="ä¼šè¯ç®¡ç†">ä¼šè¯ç®¡ç†</h2>
<ul>
<li><strong><code>Ctrl + a, :quit</code></strong> æˆ–
<strong><code>Ctrl + a, d</code></strong>ï¼šç»“æŸå½“å‰ <code>screen</code>
ä¼šè¯ã€‚</li>
<li><strong><code>Ctrl + a, :kill</code></strong>ï¼šå¼ºåˆ¶å…³é—­å½“å‰çª—å£ã€‚</li>
<li><strong><code>exit</code></strong>ï¼šé€€å‡ºå½“å‰ <code>screen</code>
ä¼šè¯ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>Linuxå·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>LLM-Model</title>
    <url>/LLM-Model/</url>
    <content><![CDATA[<h1 id="llm-æ”¹è¿›æŠ€æœ¯">LLM æ”¹è¿›æŠ€æœ¯</h1>
<h2 id="æ»‘åŠ¨çª—å£æ³¨æ„åŠ›æœºåˆ¶">æ»‘åŠ¨çª—å£æ³¨æ„åŠ›æœºåˆ¶</h2>
<p>sliding window attention: Longformer</p>
<img data-src="/LLM-Model/swa.png" class="" title="img">
<p><a
href="https://amaarora.github.io/posts/2024-07-04%20SWA.html#sliding-window-attention-in-pytorch">æŠ€æœ¯åšå®¢</a></p>
<h2 id="ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶">ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶</h2>
<p>Generating Long Sequences with Sparse
Transformersï¼Œæ ¸å¿ƒæ˜¯åªè®©è®¾ç½®å¥½çš„åƒç´ ç‚¹å‚ä¸è‡ªæ³¨æ„åŠ›çš„è®¡ç®—ï¼ˆæ³¨æ„è¿™é‡Œä¸æ˜¯åªé€‰å–è®¾ç½®å¥½ä½ç½®ä¸Šçš„åƒç´ ç‚¹ï¼Œå…¶ä»–maskæ‰ï¼Œå› ä¸ºè¿™æ ·å¹¶ä¸èƒ½é™ä½æ¨¡å‹çš„å¤æ‚åº¦ï¼‰ï¼Œå¼•å…¥ä¸€ä¸ªåä¸ºè¿æ¥æ¨¡å¼(Connectivity
Pattern)çš„å˜é‡ï¼Œè¿æ¥æ¨¡å¼åªä½œç”¨åœ¨<span
class="math inline">\(K\)</span>å’Œ<span
class="math inline">\(V\)</span>çš„è®¡ç®—ä¸Šï¼Œ(bs, head_num, seq_len,
head_dim) ä¸­çš„ seq_len åªé€‰å–è¿æ¥æ¨¡å¼ä¸­é€‰æ‹©çš„ã€‚</p>
<p>è¿æ¥æ¨¡å¼ï¼ˆæ³¨æ„åŠ›æ ¸ï¼‰çš„é€‰æ‹©ï¼šå±€éƒ¨ç¨€ç–æ¨¡å¼ã€åˆ†å—ç¨€ç–æ¨¡å¼ã€å¯¹è§’å—ç¨€ç–æ¨¡å¼</p>
<img data-src="/LLM-Model/2.png" class="" title="img">
<p><a
href="https://fengyan-wby.fun/2023/08/22/%E3%80%90%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB%E3%80%91Generating-Long-Sequences-with-Sparse-Transformers/">æŠ€æœ¯åšå®¢</a></p>
<h1 id="qwen2-æºç è§£è¯»">Qwen2 æºç è§£è¯»</h1>
<p><a
href="httpsï¼š//github.com/datawhalechina/tiny-universe/tree/main/content/Qwen-blog">Link</a></p>
<img data-src="/LLM-Model/dccdd5360d984d2c84a9f7338c55e665.jpeg" class="" title="img">
<p><code>modeling_qwen2.py</code> æ¶æ„</p>
<ul>
<li><p>Qwen2RMSNormï¼š RMSå½’ä¸€åŒ–å±‚</p></li>
<li><p>Qwen2RotaryEmbeddingï¼š æ—‹è½¬ä½ç½®ç¼–ç </p></li>
<li><p>Attention</p>
<ul>
<li><p>Qwen2Attentionï¼š æ³¨æ„åŠ›å±‚</p></li>
<li><p>Qwen2FlashAttention2ï¼š ä½¿ç”¨Flash Attention
2.0ç‰ˆæœ¬åŠ é€Ÿçš„æ³¨æ„åŠ›å±‚</p></li>
<li><p>Qwen2SdpaAttentionï¼š ä½¿ç”¨Sdpaï¼ˆpytorchè‡ªå¸¦çš„åŠ é€Ÿï¼Œ Scaled
Dot-Product Attentionï¼‰åŠ é€Ÿçš„æ³¨æ„åŠ›å±‚</p></li>
</ul></li>
<li><p>Qwen2DecoderLayerï¼š ç¼–ç å±‚ï¼Œæ ¸å¿ƒç»“æ„ï¼Œä¹‹åå°±æ˜¯å †å </p></li>
<li><p>Qwen2PreTrainedModelï¼š é¢„è®­ç»ƒç±»</p></li>
<li><p>Qwen2Modelï¼š ä¸å¸¦headçš„Qwen2æ¨¡å‹</p></li>
<li><p>Qwen2ForCausalLMï¼š å¸¦Causal LM headçš„Qwen2æ¨¡å‹</p></li>
<li><p>Qwen2ForSequenceClassificationï¼š å¸¦åºåˆ—åˆ†ç±»å¤´çš„Qwen2æ¨¡å‹</p></li>
</ul>
<p>åŠŸèƒ½å‡½æ•°</p>
<ul>
<li><p>_get_unpad_dataï¼š åœ¨flash attentionçš„æ•°æ®é¢„å¤„ç†ä¸­ä¼šç”¨åˆ°ã€‚ä¸»è¦æ˜¯å¯¹
attention mask è¿›è¡Œä¸€äº›æ“ä½œï¼›</p></li>
<li><p>rotate_halfï¼š åœ¨æ—‹è½¬ä½ç½®ç¼–ç ä¸­ç”¨åˆ°ï¼›</p></li>
<li><p>apply_rotary_pos_embï¼š å¯¹æ•°æ®ä¸»è¦æ˜¯æ³¨æ„åŠ›è¿ç®—ä¸­çš„ qï¼Œk
åšæ—‹è½¬ä½ç½®ç¼–ç ï¼›</p></li>
<li><p>repeat_kvï¼š ä¸»è¦æ˜¯åœ¨ MQAï¼ˆMulti-Query Attentionï¼‰å’Œ
GQAï¼ˆGroup-Query Attentionï¼‰ä¸­ç”¨åˆ°ï¼Œå› ä¸º q head æ•°é‡æ˜¯ kï¼Œv head
çš„æ•°é‡çš„æ•´æ•°å€</p></li>
</ul>
<p>ä¼˜åŒ–æ³¨æ„åŠ›æœºåˆ¶ï¼Œé™ä½å¤„ç†é•¿åºåˆ—æ—¶çš„è®¡ç®—å¤æ‚åº¦ã€‚</p>
<h2 id="åˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ›æœºåˆ¶-gqa">åˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ›æœºåˆ¶ GQA</h2>
<p>MQA å°†æ‰€æœ‰æ³¨æ„åŠ›å¤´çš„é”®å’Œå€¼å…±äº«</p>
<p>GQA çš„æ–¹å¼æ˜¯å°†å¤šä¸ªæ³¨æ„åŠ›å¤´åˆ†æˆç»„ï¼Œæ¯ç»„å¤´å…±äº«åŒä¸€ç»„çš„é”®å’Œå€¼ã€‚</p>
<img data-src="/LLM-Model/v2-8a907719f9e3ced8347a051d9a66c732_720w.webp" class="" title="img">
<p>å®ç°æ–¹å¼ï¼š<code>transformers.models.llama.modeling_llama.repeat_kv</code>
å¤åˆ¶å¤šæ¬¡ KVï¼Œä½¿ç”¨ <code>expand</code> è€Œä¸æ˜¯ <code>repeat</code> æ˜¯å› ä¸º
KV çš„å‚æ•°æ˜¯ç»„å†…å…±äº«çš„</p>
<h2 id="æ—‹è½¬ä½ç½®ç¼–ç -pore">æ—‹è½¬ä½ç½®ç¼–ç  PoRE</h2>
<blockquote>
<p>é€šè¿‡æ—‹è½¬ç¼–ç ï¼Œä½¿å¾—æ¯ä¸ª token
æ—¢æœ‰ç›¸å¯¹ä½ç½®ä¿¡æ¯ï¼Œåˆæœ‰ç»å¯¹ä½ç½®ä¿¡æ¯ï¼ŒQwen2 çš„ä½ç½®ä¿¡æ¯ç¼–ç æ˜¯åœ¨ attention
ä¸­è®¡ç®—åˆ° KV ä¸­çš„</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªç»´åº¦ä¸º 512 çš„å‘é‡<span
class="math inline">\(v=(v_0,v_1,v_2,v_3ï¼Œ...ï¼Œv_{511})\)</span>ï¼ŒRoPE
å¯èƒ½å°†å…¶çœ‹ä½œï¼š</p>
<ul>
<li>ç¬¬ 1 å¯¹ï¼š<span class="math inline">\((v_0,v_1)\)</span></li>
<li>ç¬¬ 2 å¯¹ï¼š<span class="math inline">\((v_2,v_3)\)</span></li>
<li>...</li>
<li>ç¬¬ 256 å¯¹ï¼š<span
class="math inline">\((v_{510},v_{511})\)</span></li>
</ul>
<p>ç„¶åï¼Œé€šè¿‡æ—‹è½¬çŸ©é˜µåˆ†åˆ«å¯¹æ¯ä¸€å¯¹è¿›è¡Œæ—‹è½¬ï¼Œä½¿å¾—æ¯ä¸€å¯¹çš„æ—‹è½¬è§’åº¦ä¸ç›¸å¯¹ä½ç½®ç›¸å¯¹åº”ã€‚</p>
<style>.rllrjroulwyh{zoomï¼š 67%;}</style>
<img data-src="/LLM-Model/ROPE3.png" class="rllrjroulwyh" alt="img">
<p>ä»£ç å±‚é¢ï¼ŒQwen2 æ„é€  <code>Qwen2RotaryEmbedding</code> ç±»å’Œ
<code>apply_rotary_pos_emb</code> æ–¹æ³•ï¼Œ
<code>Qwen2RotaryEmbedding</code> ç±»åŸºäº seq_len è¿”å›ç¼“å­˜çš„ cos å’Œ sin
æ•°æ®ï¼Œ <code>apply_rotary_pos_emb</code> æ–¹æ³•å°†ä½ç½®ä¿¡æ¯ä½œç”¨åˆ°<span
class="math inline">\(K\)</span>å’Œ<span
class="math inline">\(V\)</span>ä¸Šã€‚</p>
<h2 id="å‡æ–¹æ ¹å½’ä¸€åŒ–-rmsnorm">å‡æ–¹æ ¹å½’ä¸€åŒ– RMSNorm</h2>
<p>çŸ©é˜µè®¡ç®—è¦è¿›è¡Œå½’ä¸€åŒ–é˜²æ­¢ä¸åŒç‰¹å¾çš„å–å€¼è¿‡å¤§ï¼Œå¸¸ç”¨çš„æ˜¯ layer
normï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€é¡¹å‡å»æ ·æœ¬çš„å‡å€¼ï¼Œå†é™¤ä»¥æ ·æœ¬çš„æ–¹å·®ï¼›è€Œ RMS
åˆ™æ˜¯å»é™¤äº†å‡å»å‡å€¼çš„æ“ä½œï¼Œä»¥ä¾¿æå‡æ•ˆç‡ã€‚</p>
<ul>
<li>LayerNorm
é€šè¿‡å‡å€¼å’Œæ ‡å‡†å·®å¯¹è¾“å…¥è¿›è¡Œæ ‡å‡†åŒ–ï¼Œç¡®ä¿è¾“å…¥å…·æœ‰<strong>é›¶å‡å€¼å’Œå•ä½æ–¹å·®</strong>ï¼Œè¿™å¯¹ç¨³å®šè®­ç»ƒæœ‰å¸®åŠ©ã€‚</li>
<li>RMSNorm
åˆ™é€šè¿‡å‡æ–¹æ ¹è¿›è¡Œå½’ä¸€åŒ–ï¼Œ<strong>ä¸å…³æ³¨å‡å€¼ï¼Œä»…å¯¹å¹…å€¼è¿›è¡Œè§„èŒƒåŒ–ï¼Œé¿å…äº†å¯¹æ•°æ®çš„ä¸­å¿ƒåŒ–å¤„ç†</strong>ï¼Œå‡å°‘äº†è®¡ç®—å¤æ‚åº¦ï¼Œå¹¶ä¸”åœ¨æŸäº›æ¨¡å‹ä¸­è¡¨ç°ä¼˜è¶Šã€‚</li>
</ul>
<p><span class="math inline">\(\text{LN}(x) = \frac{x - \mu}{\sigma}
\cdot \gamma + \beta\)</span></p>
<ul>
<li>x æ˜¯è¾“å…¥å‘é‡ï¼ˆé€šå¸¸æ˜¯æ¨¡å‹ä¸­æ¯ä¸€å±‚çš„è¾“å‡ºï¼‰ã€‚</li>
<li><span class="math inline">\(\mu\)</span> æ˜¯è¾“å…¥å‘é‡çš„å‡å€¼ã€‚</li>
<li><span class="math inline">\(\sigma\)</span>
æ˜¯è¾“å…¥å‘é‡çš„æ ‡å‡†å·®ã€‚</li>
<li><span class="math inline">\(\gamma\)</span> å’Œ <span
class="math inline">\(\beta\)</span> æ˜¯å¯å­¦ä¹ çš„ç¼©æ”¾å’Œåç§»å‚æ•°ã€‚</li>
</ul>
<p>LN ä¼šè®¡ç®—æ•´ä¸ªè¾“å…¥çš„å‡å€¼ <span class="math inline">\(\mu\)</span>
å’Œæ ‡å‡†å·® $ $ï¼Œå¹¶ç”¨å®ƒä»¬å¯¹è¾“å…¥è¿›è¡Œæ ‡å‡†åŒ–ã€‚</p>
<p><span class="math inline">\(\text{RMSNorm}(x) =
\frac{x}{\text{RMS}(x)} \cdot \gamma\)</span></p>
<ul>
<li><span class="math inline">\(\text{RMS}(x) = \sqrt{\frac{1}{n}
\sum_{i=1}^n x_i^2}\)</span>æ˜¯è¾“å…¥å‘é‡çš„å‡æ–¹æ ¹ï¼›</li>
<li>$$ æ˜¯å¯å­¦ä¹ çš„ç¼©æ”¾å‚æ•°ï¼›</li>
<li>ä¸ä½¿ç”¨å‡å€¼å’Œåç§»å‚æ•° <span class="math inline">\(\beta\)</span>
ï¼›</li>
</ul>
<p>RMSNorm åªå…³æ³¨è¾“å…¥çš„
<strong>èŒƒæ•°ï¼ˆå¹…å€¼ï¼‰</strong>ï¼Œè€Œä¸è€ƒè™‘å‡å€¼ï¼Œé¿å…äº†å¯¹æ•°æ®çš„ä¸­å¿ƒåŒ–å¤„ç†ã€‚</p>
<p>å®ƒæ˜¯ä¸€ç§æ›´è½»é‡çº§çš„æ ‡å‡†åŒ–æ–¹æ³•ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æé«˜è®­ç»ƒæ•ˆç‡å’Œæ”¶æ•›é€Ÿåº¦ã€‚</p>
<h2 id="æ¿€æ´»å‡½æ•°-swiglu">æ¿€æ´»å‡½æ•° SwiGLU</h2>
<p>SwiGLU å°† GLU çš„é—¨æ§æ”¹ä¸º <code>Swish</code> ï¼ŒåéªŒè¯å®å…¶åœ¨ GLU
çš„ä¼—å¤šå˜ä½“é‡Œæ•ˆæœæœ€å¥½ï¼Œä¼˜äº Transformer ä¸€å¼€å§‹ä½¿ç”¨çš„
<code>ReLU</code>ã€‚</p>
<p><span class="math inline">\(F.silu(self.w1(x)) *
self.w2(x)\)</span>ï¼Œå…¶ä¸­ silu å…¬å¼ä¸º <span
class="math inline">\(\mathrm{Swish}_\beta(x)=x\otimes\sigma(\beta
x)\)</span></p>
]]></content>
      <categories>
        <category>LLM</category>
      </categories>
      <tags>
        <tag>å¤§æ¨¡å‹ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>RAG æ¶æ„å’Œ Langchain æ¡†æ¶</title>
    <url>/LLM-RAG-Langchain/</url>
    <content><![CDATA[<p>å½“ä¸‹ï¼Œå¾®è°ƒï¼ˆFine-Tuningï¼‰å’Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented
Generationï¼Œç®€ç§°RAGï¼‰æ˜¯å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸ä¸“æœ‰æ•°æ®ä¹‹é—´èåˆè´¯é€šçš„æœ€ä¸»æµçš„ä¸¤ç§æ–¹æ³•ã€‚å¾®è°ƒå¯¹æ•°æ®é›†å’Œç¡¬ä»¶è¦æ±‚é«˜ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿå¤§çš„å¹³å°å¾ˆéš¾æ·±å…¥ç ”ç©¶ï¼Œå› æ­¤æœ¬æ–‡ä¸»è¦æ¶‰åŠæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGæ¶æ„ï¼‰é¢†åŸŸçŸ¥è¯†ã€‚</p>
<h1 id="æ¦‚å¿µ">æ¦‚å¿µ</h1>
<p>RAG æ˜¯ä¸€ç§ä½¿ç”¨é¢å¤–æ•°æ®å¢å¼º LLM çŸ¥è¯†çš„æŠ€æœ¯ï¼Œæ˜¯ 2020 å¹´å‘è¡¨çš„è®ºæ–‡ <a
href="https://arxiv.org/abs/2005.11401">é¢å‘çŸ¥è¯†å¯†é›†å‹ NLP
ä»»åŠ¡çš„æ£€ç´¢å¢å¼ºç”Ÿæˆ</a>ä¸­æå‡ºçš„æ–°æ€æƒ³ã€‚LLM
é€šè¿‡å¤–éƒ¨çŸ¥è¯†æºè·å–é¢å¤–ä¿¡æ¯ï¼Œä»è€Œç”Ÿæˆæ›´å‡†ç¡®ã€æ›´ç¬¦åˆä¸Šä¸‹æ–‡çš„ç­”æ¡ˆï¼Œå¹¶å‡å°‘é”™è¯¯ä¿¡æ¯ï¼ˆæˆ–ç§°ä¸ºâ€œå¹»è§‰â€ï¼Œå³æ¨¡å‹å¯¹ç”¨æˆ·æ„å›¾çš„è¯¯è§£æˆ–åœ¨å¤„ç†ç‰¹å®šæŒ‡ç¤ºæ—¶äº§ç”Ÿäº†ä¸å‡†ç¡®çš„æ¨æ–­ï¼‰ã€‚å…¸å‹çš„
RAG åº”ç”¨ç¨‹åºæœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼š</p>
<ul>
<li>ç´¢å¼•ï¼šç”¨äºå¼•å…¥æºæ•°æ®å¹¶å¯¹å…¶è¿›è¡Œ<strong>ç´¢å¼•</strong>çš„ç®¡é“ï¼Œé€šå¸¸ç¦»çº¿è¿è¡Œã€‚
<ul>
<li>åŠ è½½ï¼šå°†æ•°æ®åº“ä¸­çš„å¤§æ®µæ–‡æœ¬è¯»å…¥ç³»ç»Ÿ</li>
<li>æ‹†åˆ†ï¼šå¤§å—æ•°æ®ä¸ä¾¿äºæœç´¢ï¼Œä¸”æ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£æœ‰é™ï¼Œå› æ­¤éœ€è¦æ‹†åˆ†æ•°æ®</li>
<li>å­˜å‚¨ï¼šé‡‡ç”¨å‘é‡æ•°æ®åº“å’Œç´¢å¼•å­˜å‚¨æ•°æ®</li>
</ul></li>
<li>æ£€ç´¢å’Œç”Ÿæˆï¼šå®é™…çš„ RAG
é“¾ï¼Œå®ƒåœ¨è¿è¡Œæ—¶æ¥å—ç”¨æˆ·æŸ¥è¯¢å¹¶ä»ç´¢å¼•ä¸­æ£€ç´¢ç›¸å…³æ•°æ®ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™æ¨¡å‹ã€‚
<ul>
<li>æ£€ç´¢ï¼šå°†ç”¨æˆ·çš„æŸ¥è¯¢é€šè¿‡åµŒå…¥æ¨¡å‹è½¬åŒ–ä¸ºå‘é‡ï¼Œä»¥ä¾¿ä¸å‘é‡æ•°æ®åº“ä¸­çš„å…¶ä»–ä¸Šä¸‹æ–‡ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ã€‚é€šè¿‡è¿™ç§ç›¸ä¼¼æ€§æœç´¢ï¼Œå¯ä»¥æ‰¾åˆ°å‘é‡æ•°æ®åº“ä¸­æœ€åŒ¹é…çš„å‰
k ä¸ªæ•°æ®</li>
<li>ç”Ÿæˆï¼šå°†ç”¨æˆ·çš„æŸ¥è¯¢å’Œæ£€ç´¢åˆ°çš„é¢å¤–ä¿¡æ¯ä¸€èµ·åµŒå…¥åˆ°ä¸€ä¸ªé¢„è®¾çš„æç¤ºæ¨¡æ¿ä¸­ï¼Œè¿™ä¸ªç»è¿‡æ£€ç´¢å¢å¼ºçš„æç¤ºå†…å®¹ä¼šè¢«è¾“å…¥åˆ°å¤§è¯­è¨€æ¨¡å‹
(LLM) ä¸­ï¼Œä»¥ç”Ÿæˆæ‰€éœ€çš„è¾“å‡º</li>
</ul></li>
</ul>
<p>ä»åŸå§‹æ•°æ®åˆ°å“åº”ç”Ÿæˆæœ€å¸¸è§çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<img data-src="/LLM-RAG-Langchain/x7ta8v77.png" class="" title="x7ta8v77">
<p>æµç¨‹å›¾2ï¼š</p>
<img data-src="/LLM-RAG-Langchain/c9b5e6b82c3243f3b51817fe9c5bcc72.png" class="" title="img">
<p>RAG æµ‹è¯„æŒ‡æ ‡ï¼š</p>
<style>.wlnrptmmyyhm{zoom:40%;}</style>
<img data-src="/LLM-RAG-Langchain/image-20240820085527076.png" class="wlnrptmmyyhm" alt="image-20240820085527076">
<h1 id="langchain">Langchain</h1>
<p>LangChain
é‡‡ç”¨ç»„ä»¶åŒ–è®¾è®¡çš„æ€æƒ³ï¼Œå°†è¯­è¨€æ¨¡å‹å¼€å‘åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼š<strong>å¯¹è¯å†å²
Memoryã€æç¤ºå·¥ç¨‹ Promptã€è¾“å‡ºè§£æ Paraseã€LLMé“¾ Chainã€ç´¢å¼•
Indexesã€ä»£ç† Agents</strong>ã€‚Langchain
æ¨¡å—åŒ–è®¾è®¡çš„ä¸­å¿ƒæ€æƒ³æ˜¯æå‡ä»£ç ç»´æŠ¤ã€æ‰©å±•å’Œé‡ç”¨çš„èƒ½åŠ›ï¼Œå¯ä»¥å¿«é€Ÿå¼€å‘å¤šè½®æç¤ºä»¥åŠè§£æè¾“å‡ºçš„åº”ç”¨ã€‚</p>
<p>æ­¤å¤–ï¼ŒLangchain
è¿˜æä¾›äº†å¯¹è¯è¿‡ç¨‹ä¸­éœ€è¦çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¦‚ï¼š<strong>æ–‡æ¡£åŠ è½½å™¨
UnstructuredBaseLoaderã€æ–‡æ¡£åˆ†å‰²å™¨ TextSplitterã€å‘é‡æ•°æ®åº“å­˜å‚¨å’Œæœç´¢
BaseChatMemoryã€å¤šç§å·¥å…·ç±»é“¾è°ƒç”¨ MapReduceDocumentsChain</strong></p>
<p>è¿˜æœ‰é¢å¤–çš„åŠŸèƒ½å¦‚ï¼šç”¨é‡è®°å½•ã€æ•°æ®æµè¿”å› acallã€ç¼“å­˜
SQLiteã€æ”¯æŒå¤šç§æ¨¡å‹æ¥å£ OpenAIã€å‘é‡æ•°æ®åº“ langchain.vectorstores</p>
<h2 id="æ¨¡å‹é“¾-chain">æ¨¡å‹é“¾ Chain</h2>
<p>é“¾ï¼ˆChainsï¼‰é€šå¸¸å°†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸å…¶ä»–ç»„ä»¶ç»„åˆåœ¨ä¸€èµ·æ¥æ„å»ºæ›´å¤æ‚çš„é“¾ã€‚æ¯”å¦‚ï¼ŒLLMChain
å…è®¸æˆ‘ä»¬å¯¹åˆ›å»ºçš„ Prompt ä½¿ç”¨å¤§æ¨¡å‹ï¼›</p>
<p>Chain åŸºç±»æ˜¯æ‰€æœ‰ Chain
å¯¹è±¡çš„èµ·ç‚¹ï¼Œå¤„ç†è¾“å…¥ã€è¾“å‡ºã€å†å²å’Œå›è°ƒç­‰åŠŸèƒ½ï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨ï¼Œå†…éƒ¨ç»„ä»¶ä¹Ÿå¯ä»¥é€šè¿‡å›è°ƒè¿›è¡Œäº¤äº’ï¼›</p>
<p>è‡ªå®šä¹‰ Chain éœ€è¦ç»§æ‰¿ Chain åŸºç±»ï¼Œå®ç° _call/_acall
æ–¹æ³•å®šä¹‰è°ƒç”¨é€»è¾‘ï¼›</p>
<h2 id="å¯¹è¯å†å²-memory">å¯¹è¯å†å² Memory</h2>
<p>æ ¹æ®éœ€æ±‚å¯ä»¥å°†å†å²å­˜å‚¨åœ¨
SQLiteã€qdrantç­‰æ•°æ®åº“ä¸­ï¼Œä¸‹é¢ä»£ç å°†å†å²å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferMemory</span><br><span class="line">memory = ConversationBufferMemory(</span><br><span class="line">    memory_key=<span class="string">&quot;history&quot;</span>, <span class="comment"># ä¸ prompt çš„è¾“å…¥å˜é‡ä¿æŒä¸€è‡´ã€‚</span></span><br><span class="line">    return_messages=<span class="literal">True</span> <span class="comment"># å°†ä»¥æ¶ˆæ¯åˆ—è¡¨çš„å½¢å¼è¿”å›èŠå¤©è®°å½•ï¼Œè€Œä¸æ˜¯å•ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="æç¤ºå·¥ç¨‹-prompt">æç¤ºå·¥ç¨‹ Prompt</h2>
<p>Prompt å¾ˆå°‘æ˜¯å†™æ˜ä¸å˜çš„ï¼Œé€šå¸¸ä»å¤šä¸ªç»„ä»¶æ„å»ºè€Œæˆçš„ã€‚ PromptTemplate
è´Ÿè´£æ„å»ºè¿™ä¸ªè¾“å…¥ã€‚</p>
<p><strong>è¾“å‡ºè§£æ Parase</strong> æ˜¯æç¤ºå·¥ç¨‹çš„ä¸€ç§ï¼š</p>
<ul>
<li><code>get_format_instructions() -&gt; str</code>ï¼šæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«æœ‰å…³å¦‚ä½•æ ¼å¼åŒ–è¯­è¨€æ¨¡å‹è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼Œå³æç¤º
Promptã€‚</li>
<li><code>parse(str) -&gt; Any</code>ï¼šæ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå‡å®šä¸ºè¯­è¨€æ¨¡å‹çš„å“åº”ï¼‰å¹¶å°†å…¶è§£æä¸ºæŸä¸ªç»“æ„ã€‚</li>
<li><code>parse_with_prompt(str) -&gt; Any</code>ï¼šä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå‡è®¾æ˜¯è¯­è¨€æ¨¡å‹çš„å“åº”ï¼‰å’Œä¸€ä¸ªæç¤ºï¼ˆå‡è®¾æ˜¯ç”Ÿæˆè¿™æ ·çš„å“åº”çš„æç¤ºï¼‰ï¼Œå¹¶å°†å…¶è§£æä¸ºæŸç§ç»“æ„ã€‚æç¤ºåœ¨æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸ºäº†æä¾›ä¿¡æ¯ä»¥ä¾¿
OutputParser é‡æ–°å°è¯•æˆ–ä»¥æŸç§æ–¹å¼ä¿®å¤è¾“å‡ºã€‚</li>
</ul>
<h2 id="ç´¢å¼•-indexes">ç´¢å¼• Indexes</h2>
<p>ç»“æ„åŒ–æ–‡æ¡£ï¼Œä»¥ä¾¿ LLM å¯ä»¥ä¸å¤–éƒ¨æ–‡æ¡£äº¤äº’ã€‚
LangChainæœ‰è®¸å¤šæ¨¡å—å¯å¸®åŠ©æ‚¨åŠ è½½ã€ç»“æ„åŒ–ã€å­˜å‚¨å’Œæ£€ç´¢æ–‡æ¡£ã€‚<a
href="https://yeqiuo.github.io/LLM%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/#%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE%E7%9F%A5%E8%AF%86%E5%BA%93">è¯¦è§</a></p>
<h2 id="ä»£ç†-agents">ä»£ç† Agents</h2>
<p>ä»£ç†æ¶‰åŠ LLM
åšå‡ºè¡ŒåŠ¨å†³ç­–ï¼ˆObservationï¼‰ã€æ‰§è¡Œè¯¥è¡ŒåŠ¨ï¼ˆActionï¼‰ã€æŸ¥çœ‹ä¸€ä¸ªè§‚å¯Ÿç»“æœï¼ˆObservationï¼‰ï¼Œå¹¶é‡å¤è¯¥è¿‡ç¨‹ç›´åˆ°å®Œæˆã€‚LangChain
æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„ä»£ç†æ¥å£ï¼Œä¸€ç³»åˆ—å¯ä¾›é€‰æ‹©çš„ä»£ç†ï¼Œä»¥åŠç«¯åˆ°ç«¯ä»£ç†çš„ç¤ºä¾‹ã€‚</p>
<ul>
<li>ä½¿ç”¨å·¥å…·å¹¶è§‚å¯Ÿå…¶è¾“å‡º</li>
<li>ç”Ÿæˆç›¸åº”è¿”å›ç»™ç”¨æˆ·</li>
</ul>
<h1 id="æ–‡æœ¬åŒ¹é…ä»»åŠ¡">æ–‡æœ¬åŒ¹é…ä»»åŠ¡</h1>
<blockquote>
<p>RAG
å°†åŒ¹é…åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œå¯åˆ†ä¸ºï¼šç²—å¬å›ã€ç»†å¬å›ã€ç²—æ’åºã€ç²¾æ’åºã€å†æ’åºã€‚è¯¥ä»»åŠ¡åŒ…æ‹¬å¤šä¸ªå­ä»»åŠ¡ï¼Œå¦‚æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—ã€é—®ç­”åŒ¹é…ã€å¯¹è¯åŒ¹é…ï¼Œç±»ä¼¼äºRAGçš„æ–‡æœ¬æŠ½å–å¼é˜…è¯»ç†è§£å’Œå¤šé¡¹é€‰æ‹©</p>
</blockquote>
<p>RAG é‡‡å–å¬å›ï¼ˆIF-IDFã€BM25ï¼‰ã€ç²—æ’ï¼ˆåŒå¡” Bert
æ¨¡å‹ã€Sentence-Bertã€text2vecã€uniemï¼‰ã€ç²¾æ’ï¼ˆå•å¡” Bert
æ¨¡å‹ï¼‰ï¼Œå¾—åˆ°ç›¸å…³çš„æ–‡æ¡£è¾“å…¥ LLM ä¸­ã€‚</p>
<h2 id="åŸºäºè¯åŒ¹é…">åŸºäºè¯åŒ¹é…</h2>
<blockquote>
<p>ä¼ ç»Ÿæ–¹æ³•å°†è¯åŒ¹é…ã€è¯è·ç­‰åˆ†æ•°ä½œä¸ºç‰¹å¾ï¼Œç”¨çº¿æ€§æ¨¡å‹æˆ–æ ‘æ¨¡å‹é¢„æµ‹ç›¸å…³æ€§ï¼Œæ•ˆæœè¿œä¸å¦‚æ·±åº¦å­¦ä¹ ã€‚</p>
</blockquote>
<p>å°†æŸ¥è¯¢æ–‡æœ¬åˆ†è¯ï¼Œè¯åœ¨æ–‡æ¡£ d ä¸­å‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼Œåˆ™æŸ¥è¯¢æ–‡æœ¬å’Œæ–‡æ¡£ d
è¶Šç›¸å…³</p>
<h3 id="if-idf">IF-IDF</h3>
<p><strong>æ¦‚å¿µ</strong></p>
<p>è¯è¢‹æ¨¡å‹ï¼šï¼ˆbag of wordsï¼‰åªè€ƒè™‘è¯é¢‘ï¼Œä¸è€ƒè™‘è¯çš„é¡ºåºå’Œä¸Šä¸‹æ–‡</p>
<p>è¯é¢‘ TFï¼šæ¯ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°çš„é›†åˆï¼›<span
class="math inline">\(\sum_{t\in\mathcal{Q}}\operatorname{tf}_{t,d}\)</span></p>
<ul>
<li>ç¼ºé™·ï¼šæ–‡æ¡£è¶Šé•¿ï¼ŒTF è¶Šå¤§ï¼›è§£å†³ï¼šé™¤ä»¥æ–‡æ¡£é•¿åº¦ï¼Œå½’ä¸€åŒ–ï¼›<span
class="math inline">\(\sum_{t\in
Q}\frac{\mathrm{tf}_{t,d}}{l_d}\)</span></li>
<li>ç¼ºé™·ï¼šæ¯ä¸ªè¯é‡è¦æ€§ä¸åŒï¼›è§£å†³ï¼šè¯­ä¹‰é‡è¦æ€§ï¼ˆterm
weightï¼‰ï¼Œåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„è¶Šå¤šï¼Œæƒé‡è¶Šä½ï¼›</li>
</ul>
<p>æ–‡æ¡£é¢‘ç‡ DFï¼šè¯ t åœ¨å¤šå°‘æ–‡æ¡£ä¸­å‡ºç°è¿‡ï¼Œå®šä¹‰â€œè¯â€åŒºåˆ«æ–‡æ¡£çš„èƒ½åŠ›ï¼›</p>
<p>é€†æ–‡æ¡£æ’åº IDFï¼šè¡¡é‡ä¸€ä¸ªè¯åœ¨ N ä¸ªæ–‡æ¡£ä¸­çš„é‡è¦æ€§ï¼›<span
class="math inline">\(\mathrm{idf}_t=\mathrm{log}\frac
N{\mathrm{df}_t}\)</span></p>
<p><span class="math inline">\(\mathrm{TFIDF}(\mathcal{Q},d) =
\sum_{t\in\mathcal{Q}} \frac{\mathrm{tf}_{t,d}}{l_{d}} \cdot
\mathrm{idf}_{t}.\)</span></p>
<p>å…¶ä¸­ï¼ŒæŸ¥è¯¢è¯qçš„åˆ†è¯åå¾—åˆ° Q é›†åˆï¼Œå®ƒä¸æ–‡æ¡£ d çš„ç›¸å…³æ€§ç”¨ TF-IDF
è¡¡é‡ï¼›ç»“æœè¿˜å–å†³äºæ‰€é‡‡å–çš„åˆ†è¯ç®—æ³•ï¼›</p>
<h3 id="bm25">BM25</h3>
<p>IF-IDF çš„å˜ç§ï¼Œk å’Œ b æ˜¯å‚æ•°ï¼ˆé€šå¸¸è®¾ç½®ä¸º kâˆˆ[1.2, 2]ï¼Œb=0.75ï¼‰</p>
<p><span class="math inline">\(\sum_{t\in
Q}\frac{\mathrm{tf}_{t,d}\cdot(k+1)}{\mathrm{tf}_{t,d}+k\cdot\left(1-b+b\cdot\frac{l_d}{\mathrm{mean}(l_d)}\right)}\cdot\ln\left(1+\frac{N-\mathrm{df}_t+0.5}{\mathrm{df}_t+0.5}\right)\)</span></p>
<h3 id="åŸºäºè¯è·">åŸºäºè¯è·</h3>
<p>ä¸¤ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°ä½ç½®ä¹‹é—´ï¼Œé—´éš”çš„è¯è¶Šå°‘è¶Šå¯èƒ½ç›¸å…³ï¼›</p>
<p>ç®€è€Œè¨€ä¹‹ï¼ŒæŸ¥è¯¢è¯åˆ‡åˆ†åçš„ term
åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°è¶Šå¤šè¶Šå¥½ï¼Œä»»æ„ä¸¤ä¸ªè¯ä¹‹é—´çš„è·ç¦»è¶Šè¿‘è¶Šå¥½ï¼›</p>
<p>egï¼š<strong>OkaTP</strong></p>
<h2 id="åŸºäºæ·±åº¦å­¦ä¹ ">åŸºäºæ·±åº¦å­¦ä¹ </h2>
<p><strong>åŸºäºäº¤äº’ç­–ç•¥çš„å•å¡”æ¨¡å‹</strong> å‡†ç¡®åº¦æ›´é«˜</p>
<p>Bert è¾“å‡º similarityï¼ŒäºŒåˆ†ç±»ä»»åŠ¡ï¼ˆç›¸ä¼¼/ä¸ç›¸ä¼¼ï¼‰</p>
<p><strong>åŸºäºå‘é‡åŒ¹é…çš„åŒå¡”æ¨¡å‹ </strong>é€Ÿåº¦æ›´å¿«</p>
<p>Bert è¾“å‡º Sentence_Embeddingï¼Œæ‹Ÿåˆ cos_Similarityï¼ˆå›å½’ä»»åŠ¡ï¼‰</p>
<h1 id="è¯„ä»·æŒ‡æ ‡">è¯„ä»·æŒ‡æ ‡</h1>
<p>äºŒåˆ†ç±»è¯„ä»·æŒ‡æ ‡ AUC</p>
<style>.dqcajpbocdum{zoom: 33%;}</style>
<img data-src="/LLM-RAG-Langchain/image-20240815155230728.png" class="dqcajpbocdum" alt="image-20240815155230728">
<h1 id="å¯ä¿¡åº¦-rag">å¯ä¿¡åº¦ RAG</h1>
<p>å½“æ£€ç´¢è¿”å›çš„ç»“æœæœ‰é”™è¯¯æˆ–ä¿¡æ¯ä¸¢å¤±æ—¶ï¼Œä¼šå¯¼è‡´LLMå›å¤å‡ºç°å¹»è§‰ã€‚</p>
<p>ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼šå¯ä¿¡åº¦ï¼ˆFaithfulnessï¼‰ã€ç­”æ¡ˆç›¸å…³æ€§ï¼ˆAnswer
Relevanceï¼‰ã€ä¸Šä¸‹æ–‡ç›¸å…³æ€§ï¼ˆContext Relevanceï¼‰</p>
<h1 id="query-é¢„å¤„ç†">Query é¢„å¤„ç†</h1>
<p>åŒä¹‰Queryï¼Œ</p>
<p>æ„å›¾è¯†åˆ«</p>
<h1 id="å¬å›">å¬å›</h1>
<p>ç´¢å¼•æŠ€æœ¯ï¼šå€’æ’ç´¢å¼•ã€å‹ç¼©å€’æ’ç´¢</p>
<p>æ£€ç´¢æ¨¡å‹ï¼šBM25ã€BERT</p>
<p>å¼•å…¥ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ›´å¥½åœ°ç†è§£ç”¨æˆ·æ„å›¾</p>
]]></content>
      <categories>
        <category>LLMåº”ç”¨å¼€å‘</category>
      </categories>
      <tags>
        <tag>RAGæ¶æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§æ¨¡å‹å¾®è°ƒæ–¹æ³•</title>
    <url>/LLM-PEFT/</url>
    <content><![CDATA[<blockquote>
<p>å› æ­¤ï¼Œè¿‘å¹´æ¥ç ”ç©¶è€…ä»¬æå‡ºäº†å„ç§å„æ ·çš„å‚æ•°é«˜æ•ˆè¿ç§»å­¦ä¹ æ–¹æ³•ï¼Œå³<strong>å›ºå®šä½é¢„è®­ç»ƒæ¨¡å‹çš„å¤§éƒ¨åˆ†å‚æ•°ï¼Œä»…è°ƒæ•´æ¨¡å‹çš„ä¸€å°éƒ¨åˆ†å‚æ•°æ¥è¾¾åˆ°ä¸å…¨éƒ¨å‚æ•°çš„å¾®è°ƒæ¥è¿‘çš„æ•ˆæœ</strong>ã€‚è°ƒæ•´çš„å¯ä»¥æ˜¯æ¨¡å‹è‡ªæœ‰çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯é¢å¤–åŠ å…¥çš„ä¸€äº›å‚æ•°ã€‚ç›®å‰çš„å¾®è°ƒæ–¹æ³•åˆ†ä¸ºåŠ æ€§æ–¹æ³•ã€é€‰æ‹©æ€§æ–¹æ³•ã€é‡å‚æ•°åŒ–æ–¹æ³•å’Œæ··åˆæ–¹æ³•ã€‚</p>
</blockquote>
<h1 id="qa">Q&amp;A</h1>
<p>[Q] ä»€ä¹ˆæƒ…å†µä¸‹æ¨¡å‹æ˜¾å­˜å ç”¨å¤§ï¼Ÿ</p>
<ul>
<li>batch size å¤§ï¼Œå¹¶è¡Œè®¡ç®—ï¼›</li>
<li>æ¨¡å‹å‚æ•°é‡å¤§ï¼Œæ¯ä¸ªå‚æ•°éƒ½éœ€è¦å­˜å‚¨ç©ºé—´ï¼ˆç²¾åº¦ä¸åŒå ç”¨ç©ºé—´ä¸åŒ fp32 fp16
bf16 int8 int4ï¼‰ï¼›</li>
<li>è®¡ç®—è¿‡ç¨‹äº§ç”Ÿå¤§é‡çš„ä¸­é—´å˜é‡ï¼ˆå¦‚æ¿€æ´»å€¼ã€æ¢¯åº¦ç­‰ï¼‰ï¼Œè¿™äº›ä¸­é—´å˜é‡ä¹Ÿéœ€è¦å­˜å‚¨åœ¨æ˜¾å­˜ä¸­ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„è®¡ç®—ï¼›</li>
<li>ä¼˜åŒ–å™¨æ‰€éœ€çš„é¢å¤–ä¿¡æ¯å¤šï¼ˆå¦‚åŠ¨é‡ã€å­¦ä¹ ç‡ç­‰ï¼‰ï¼›</li>
<li>æ¨¡å‹å¤æ‚ï¼Œåå‘ä¼ æ’­çš„è®¡ç®—å›¾å ç”¨æ›´å¤šæ˜¾å­˜ï¼›</li>
</ul>
<p>[Q] ä¸ºä»€ä¹ˆå‡å°‘äº†å¯è®­ç»ƒå‚æ•°å°±ä¼šå‡å°‘æ˜¾å­˜å ç”¨ï¼Ÿ</p>
<ul>
<li>ä¸éœ€è¦å­˜å‚¨å®ƒä»¬çš„æ¢¯åº¦ï¼›</li>
<li>ä¸éœ€è¦ä¸ºä¸å¯è®­ç»ƒå‚æ•°åˆ†é…é¢å¤–çš„å†…å­˜æ¥å­˜å‚¨ä¼˜åŒ–çŠ¶æ€ï¼ˆå¦‚åŠ¨é‡ã€å­¦ä¹ ç‡ç­‰ï¼‰ï¼›</li>
<li>ä¸éœ€è¦å­˜å‚¨ä¸­é—´æ¿€æ´»å€¼ï¼ˆæ¿€æ´»å€¼ç”¨äºåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—æ¢¯åº¦ï¼Œè¿›è€Œæ›´æ–°æ¨¡å‹çš„å‚æ•°ï¼‰ï¼›</li>
</ul>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">ä»¥ LP32 ç²¾åº¦å…¨é‡å¾®è°ƒä¸€ä¸ª 1.3B çš„æ¨¡å‹éœ€è¦å ç”¨å¤šå°‘æ˜¾å­˜ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ¨¡å‹æƒé‡ï¼š1.2G * 4B = 4.8GB</span><br><span class="line">æ¢¯åº¦ï¼š1.2G * 4B = 4.8GB</span><br><span class="line">ä¼˜åŒ–å™¨çŠ¶æ€ï¼š1.2G * 4B * 2 = 9.6GB</span><br><span class="line">å‰å‘æ¿€æ´»å€¼ï¼šå–å†³äºåºåˆ—é•¿åº¦ã€éšå±‚ç»´åº¦ã€batch size</span><br><span class="line"></span><br><span class="line">å®é™…åŠ è½½åï¼Œå ç”¨å¤§çº¦ 20GB çš„æ˜¾å­˜</span><br></pre></td></tr></table></figure>
<p>[Q] æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆæœ‰æ•ˆçš„å‡å°‘æ˜¾å­˜å ç”¨çš„æ–¹æ³•ï¼Ÿ</p>
<ul>
<li>æ¢¯åº¦ç´¯è®¡æŠ€æœ¯ï¼šå°†å¤šä¸ªå°æ‰¹é‡è®­ç»ƒæ•°æ®çš„æ¢¯åº¦è¿›è¡Œç´¯ç§¯ï¼Œåœ¨è¾¾åˆ°æŒ‡å®šç´¯ç§¯æ¬¡æ•°åï¼Œä½¿ç”¨ç´¯ç§¯æ¢¯åº¦ç»Ÿä¸€æ›´æ–°ä¸€æ¬¡æ¨¡å‹å‚æ•°ï¼Œä»è€Œè¾¾åˆ°ä¸å¤§æ‰¹é‡æ•°æ®è®­ç»ƒç›¸è¿‘çš„æ•ˆæœï¼›
<ul>
<li>ç›¸å½“äºé™ä½äº† batch sizeï¼Œå› è€Œå‡å°‘äº†æ˜¾å­˜å ç”¨ï¼›</li>
<li>å¤šä¸ªå°æ‰¹é‡çš„å¯è®­ç»ƒå‚æ•°çš„æ¢¯åº¦æ˜¯å­˜åœ¨ä¸€èµ·çš„ï¼Œä¸é¢å¤–å ç”¨æ˜¾å­˜ï¼›</li>
</ul></li>
<li>æ¢¯åº¦æ£€æŸ¥ç‚¹
gradient_checkpointï¼šåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­é‡æ–°è®¡ç®—å‰å‘ä¼ æ’­ä¸­çš„æŸäº›ä¸­é—´æ¿€æ´»å€¼ï¼Œä»è€Œå‡å°‘æ˜¾å­˜å ç”¨ï¼›</li>
</ul>
<p>[Q] ä¸ºä»€ä¹ˆéœ€è¦ PEFTï¼Ÿ</p>
<ul>
<li><p><strong>å…¨é‡å¾®è°ƒå¤§æ¨¡å‹</strong>è™½ç„¶æ•ˆæœè¿˜ä¸é”™ï¼Œä½†éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºå’Œè®­ç»ƒæ•°æ®ï¼ˆè®­ç»ƒæ•°æ®ä¸­é€šç”¨æ•°æ®å’Œé¢†åŸŸæ•°æ®éƒ½è¦æœ‰ï¼‰ï¼›</p></li>
<li><p>ä¸ºäº†é™ä½è®¡ç®—èµ„æºï¼Œåª<strong>å¾®è°ƒæ¨¡å‹çš„æŸå‡ å±‚å‚æ•°</strong>æ—¶ï¼Œæ— æ³•å¾—åˆ°è¾ƒå¥½çš„å¾®è°ƒç»“æœï¼Œä¼šå‡ºç°æ¬ æ‹Ÿåˆæˆ–æ³›åŒ–èƒ½åŠ›é™ä½çš„æƒ…å†µï¼Œæ¨¡å‹æ— æ³•æœ‰æ•ˆå­¦ä¹ é¢†åŸŸæ•°æ®çš„çŸ¥è¯†ï¼Œä¸”å¯èƒ½ä¼šç ´åäº†é¢„è®­ç»ƒæ¨¡å‹çš„é€šç”¨è¯­è¨€è¯­ä¹‰èƒ½åŠ›ï¼›</p></li>
<li><p>å½“ä¿®æ”¹äº†è¾“å…¥ Embedding
æˆ–å¤§æ¨¡å‹æ¯ä¸€å±‚çš„æŸäº›éƒ¨åˆ†æ—¶ï¼Œå¯ä»¥åœ¨æœ‰é™çš„è®¡ç®—èµ„æºä¸Šï¼Œå¾—åˆ°ä¸å…¨é‡å¾®è°ƒè¿‘ä¼¼çš„å¾®è°ƒæ•ˆæœï¼Œè¿™ä¾¿æ˜¯
PEFT å­˜åœ¨çš„ç†ç”±ï¼›</p></li>
<li><p>ä¸åŒé¢†åŸŸçš„å…¨é‡å¾®è°ƒæ¨¡å‹éœ€è¦åˆ†å¼€éƒ¨ç½²ï¼Œèµ„æºå ç”¨é‡å¤§ï¼›ç”±äºåªä¿®æ”¹äº†éƒ¨åˆ†å‚æ•°ï¼ŒPEFT
ä¸­çš„æ–¹æ³•ï¼Œéƒ½å…·æœ‰â€œ<strong>ä¸€æ¬¡éƒ¨ç½²ï¼Œå¤šé¢†åŸŸå…±ç”¨</strong>â€çš„èƒ½åŠ›ï¼Œåªéœ€è¦ä¸€æ¬¡å°±èƒ½åŠ è½½æ‰€æœ‰å‚æ•°ï¼Œé’ˆå¯¹ä¸åŒé¢†åŸŸçš„è°ƒç”¨åˆ‡æ¢ä¸åŒçš„
PEFT å‚æ•°ï¼Œå³é‡‡ç”¨è¯¥é¢†åŸŸå¾®è°ƒæ‰€å¢åŠ çš„å°éƒ¨åˆ†å‚æ•°ï¼›</p></li>
</ul>
<p>[Q] æœ‰å“ªäº›æ˜¾å­˜ä¼˜åŒ–ç­–ç•¥ï¼Ÿ</p>
<ul>
<li>é«˜æ•ˆå¾®è°ƒ PEFTï¼›
<ul>
<li>Lora</li>
<li>Prefix-Tuning</li>
</ul></li>
<li>å‰å‘æ¿€æ´»å€¼ï¼›
<ul>
<li>Gradient Accumulation</li>
<li>Gradient Checkpoints</li>
<li>Data Length</li>
</ul></li>
<li>ä¼˜åŒ–å™¨çŠ¶æ€ï¼›
<ul>
<li>Adafactor Optiomizer</li>
</ul></li>
<li>å‰å‘æ¿€æ´»å€¼ + æ¢¯åº¦ï¼›
<ul>
<li>Freeze Model</li>
</ul></li>
<li>å‚æ•°é‡åŒ–ï¼›
<ul>
<li>QLora</li>
</ul></li>
</ul>
<h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>2018å¹´Berté—®ä¸–åï¼ŒNLP
ç ”ç©¶çš„è¶‹åŠ¿è½¬å˜ä¸ºâ€œé¢„è®­ç»ƒæ¨¡å‹+å¾®è°ƒâ€ã€‚è™½ç„¶æ›´å¤§çš„æ¨¡å‹å¸¦æ¥äº†æ›´å¥½çš„æ€§èƒ½ï¼Œä½†ä»¥ä¼ ç»Ÿçš„æ–¹å¼å¯¹æ¨¡å‹è¿›è¡Œå…¨é‡å¾®è°ƒä¼šæ¶ˆè€—å·¨å¤§çš„è®¡ç®—å’Œå­˜å‚¨èµ„æºï¼Œè¿‡é«˜çš„ç¡¬ä»¶é—¨æ§›ä¸åˆ©äºè¯¥é¢†åŸŸçš„ç ”ç©¶å’Œå‘å±•ã€‚</p>
<p>åœ¨æ­¤èƒŒæ™¯ä¸‹ï¼Œå‚æ•°é«˜æ•ˆå¾®è°ƒå’Œé‡åŒ–æŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œå‚æ•°é«˜æ•ˆå¾®è°ƒæ–¹æ³•ä»…å¯¹æ¨¡å‹çš„ä¸€å°éƒ¨åˆ†å‚æ•°ï¼ˆè¿™ä¸€å°éƒ¨åˆ†å¯èƒ½æ˜¯æ¨¡å‹è‡ªèº«çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤–éƒ¨å¼•å…¥çš„ï¼‰è¿›è¡Œè®­ç»ƒï¼Œä¾¿å¯ä»¥ä¸ºæ¨¡å‹å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½å˜åŒ–ï¼Œä¸€äº›åœºæ™¯ä¸‹ç”šè‡³ä¸è¾“äºå…¨é‡å¾®è°ƒï¼Œé¢‡æœ‰ä¸€ç§<strong>å››ä¸¤æ‹¨åƒæ–¤</strong>çš„æ„Ÿè§‰ã€‚</p>
<p>ç”±äºè®­ç»ƒä¸€å°éƒ¨åˆ†å‚æ•°ï¼Œæå¤§ç¨‹åº¦é™ä½äº†è®­ç»ƒå¤§æ¨¡å‹çš„ç®—åŠ›éœ€æ±‚ï¼Œä¸éœ€è¦å¤šæœºå¤šå¡ï¼Œå•å¡å³å¯å®Œæˆå¯¹ä¸€äº›å¤§æ¨¡å‹çš„è®­ç»ƒã€‚ä¸ä»…å¦‚æ­¤ï¼Œå°‘é‡çš„è®­ç»ƒå‚æ•°å¯¹å­˜å‚¨çš„è¦æ±‚åŒæ ·é™ä½äº†å¾ˆå¤šï¼Œå¤§å¤šæ•°çš„å‚æ•°é«˜æ•ˆå¾®è°ƒæ–¹æ³•åªéœ€è¦ä¿å­˜è®­ç»ƒéƒ¨åˆ†çš„å‚æ•°ï¼Œä¸åŠ¨è¾„å‡ å
GB çš„é¢„è®­ç»ƒå¤§æ¨¡å‹ç›¸æ¯”ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ã€‚</p>
<p>å½“ä¸‹æµè¡Œ PEFT ç»“æ„ä¸€è§ˆï¼š</p>
<img data-src="/LLM-PEFT/peft%E6%96%B9%E6%B3%95.jpg" class="" title="peftæ–¹æ³•">
<p>å¸¸ç”¨çš„å‚æ•°é«˜æ•ˆå¾®è°ƒæ–¹æ³•ï¼š</p>
<style>.hfrsjfeixazk{zoom: 50%;}</style>
<img data-src="/LLM-PEFT/image-20240718093213465.png" class="hfrsjfeixazk" alt="image-20240718093213465">
<ul>
<li>Selectiveï¼šé€‰æ‹©æ¨¡å‹ä¸­çš„ä¸€éƒ¨åˆ†å‚æ•°è¿›è¡Œå¾®è°ƒï¼›</li>
<li>Additiveï¼šå†»ç»“æ¨¡å‹åŸæœ‰å‚æ•°ï¼Œå¾®è°ƒæ–°å¢çš„å‚æ•°å’Œæ¨¡å—ï¼›
<ul>
<li>Adaptersï¼š</li>
<li>Soft Promptï¼š</li>
</ul></li>
<li>Reparameterzationï¼š</li>
</ul>
<h1 id="å®ç°æ–¹æ³•">å®ç°æ–¹æ³•</h1>
<h2 id="å¼€æºå·¥å…·">å¼€æºå·¥å…·</h2>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>å¼€æºé¡¹ç›®</th>
<th>å¾®è°ƒæ–¹æ³•</th>
<th>å®ç°æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://github.com/hiyouga/LLaMA-Factory">Llama
Factory</a></td>
<td>GaLoreã€BAdamã€DoRAã€LongLoRAã€LLaMA
Proã€Mixture-of-Depthsã€LoRA+ã€LoftQã€PiSSA</td>
<td>peft åŒ…ã€ç¼–å†™ LongLoRAã€LlamaPro
æµç¨‹ã€é‡ç‚¹æ˜¯å¯¹å¾®è°ƒæµç¨‹çš„æ•´ä½“æ¶æ„ï¼ŒåŒ…æ‹¬é‡åŒ–ã€æ•°æ®é¢„å¤„ç†ã€åŠ é€Ÿè®­ç»ƒã€è¯„ä¼°å’Œæ¨¡å‹å­˜å‚¨ç­‰ï¼Œç”¨æˆ·å¯ä»¥å¼€ç®±å³ç”¨ã€‘</td>
</tr>
<tr class="even">
<td><a href="https://github.com/modelscope/swift">Swift</a></td>
<td>LoRAã€LoRA+ã€LLaMA
Proã€GaLoreã€LISAã€UnSlothã€SCEditã€NEFTuneã€LongLoRAã€Adapterã€IA3ã€AdaLoRA</td>
<td>peft åŒ…ã€ç¼–å†™ LongLoRAã€LoRAã€LlamaProã€Adapter æµç¨‹</td>
</tr>
<tr class="odd">
<td><a
href="https://github.com/meta-llama/llama-recipes">llama-recipes</a></td>
<td>LoRAã€QLoRAã€IA3ã€AdaLoRA</td>
<td>peft åŒ…</td>
</tr>
<tr class="even">
<td><a href="https://github.com/yangjianxin1/Firefly">Firefly</a></td>
<td>LoRAã€QLoRA</td>
<td>ç›´æ¥æ“ä½œæ¨¡å‹ç»“æ„ï¼Œä¸ºæ‰€æœ‰å…¨è¿æ¥æ·»åŠ  Adapter</td>
</tr>
<tr class="odd">
<td><a
href="https://github.com/axolotl-ai-cloud/axolotl">Axolotl</a></td>
<td>LoRAã€QLoRAã€ReLoRA</td>
<td>peft åŒ…ã€ç¼–å†™ ReLoRA æµç¨‹</td>
</tr>
</tbody>
</table>
<h2 id="å¼€å‘åŒ…">å¼€å‘åŒ…</h2>
<p>Bitsandbytesï¼šè®­ç»ƒè¿‡ç¨‹ä¸­çš„å‚æ•°é‡åŒ–ã€å‹ç¼©å’ŒåŠ é€Ÿ</p>
<p>Peftï¼ˆæ²¡æœ‰Adapteræ–¹æ³•çš„å®ç°ï¼‰ï¼šå‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯ï¼Œæ—¨åœ¨é€šè¿‡æœ€å°åŒ–å¾®è°ƒå‚æ•°çš„æ•°é‡å’Œè®¡ç®—å¤æ‚åº¦æ¥æé«˜é¢„è®­ç»ƒæ¨¡å‹åœ¨æ–°ä»»åŠ¡ä¸Šçš„æ€§èƒ½ï¼ˆå¯ä»¥å®ç°ï¼‰</p>
<p>Adaptersï¼šHuggingFace Transformers
çš„é™„åŠ åº“ï¼Œå°†å„ç§é€‚é…å™¨æ–¹æ³•é›†æˆåˆ°æœ€å…ˆè¿›çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸­ï¼Œä»¥æœ€å°çš„è®­ç»ƒå’Œæ¨ç†ç¼–ç å¼€é”€ã€‚</p>
<p>DeepSpeedï¼šæä¾›äº†ä»è®­ç»ƒåˆ°æ¨ç†çš„å…¨é¢ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å‚æ•°åˆå§‹åŒ–ã€è®­ç»ƒåŠ é€Ÿã€å†…å­˜ä¼˜åŒ–ç­‰å¤šä¸ªæ–¹é¢</p>
<h2 id="å¼€æºæ•°æ®é›†">å¼€æºæ•°æ®é›†</h2>
<p><a
href="https://fengyan-wby.fun/2024/04/11/LLM%E8%AE%AD%E7%BB%83%E8%B5%84%E6%BA%90/">Link</a></p>
<h2 id="æµ‹è¯„æ–¹æ³•">æµ‹è¯„æ–¹æ³•</h2>
<p>Accã€F1ã€PPLã€Distinct-nã€BLUE-nã€Rouge-nã€Rouge-L</p>
<h1 id="å¾®è°ƒç®—æ³•">å¾®è°ƒç®—æ³•</h1>
<blockquote>
<p>ä¸åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>å¾®è°ƒå›¾åƒå¤§æ¨¡å‹ Stable Diffusionï¼šlokr lohaï¼›</p></li>
<li><p>å°†æ–‡æœ¬åˆ°å›¾åƒçš„æ‰©æ•£æ¨¡å‹é€‚åº”ä¸‹æ¸¸ä»»åŠ¡ï¼šæ­£äº¤çŸ©é˜µOFTã€è´è¶å¾®è°ƒ Boft
ï¼›</p></li>
</ul>
</blockquote>
<p>åŸºäºåŠ æ³•
PEFTï¼šå¢åŠ é¢å¤–å¯è®­ç»ƒæ¨¡å‹ç»“æ„æˆ–å‚æ•°ï¼ˆEmbeddingã€MLPã€LSTMï¼‰ï¼Œå¦‚ï¼šPrompt
Tuningã€Prefix Tuningã€Adapterï¼›</p>
<p>åŸºäºé€‰æ‹© PEFTï¼šç›´æ¥å¾®è°ƒå¤§æ¨¡å‹ä¸­çš„ä¸€éƒ¨åˆ†å‚æ•°ï¼Œå¦‚ï¼šBitFitã€LN
Tuningï¼›</p>
<p>åŸºäºé‡å‚æ•°åŒ–
PEFTï¼šåœ¨å·²ç»è®­ç»ƒå¥½çš„å‚æ•°çŸ©é˜µçš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¯è®­ç»ƒã€å¯åˆå¹¶çš„å‚æ•°ï¼Œå¦‚ï¼šLoRAã€AdaLoRAã€PISSAã€GaLoreï¼›</p>
<p>èåˆä¸Šè¿°ä¸‰ç§æ–¹æ³•çš„ PEFTï¼šæ··åˆä¸Šè¿°ä¸‰ç§æ–¹æ³•ï¼Œå¦‚ï¼šMAM
Adapterã€UniPELTï¼›</p>
<p>é«˜æ•ˆé‡åŒ–ï¼šä¸é™ä½è®­ç»ƒæ•ˆæœçš„å‰æä¸‹ï¼Œé™ä½è®¡ç®—èµ„æºçš„éœ€æ±‚ï¼Œå¦‚ï¼šQLoRAï¼›</p>
<p>å¹¶è¡Œè®­ç»ƒï¼šæå‡è®­ç»ƒé€Ÿåº¦ï¼ŒSLoRAï¼›</p>
<p>å·¥ç¨‹ç³»ç»Ÿè§’åº¦çš„ä¼˜åŒ–ï¼šæ¢¯åº¦æ£€æŸ¥ç‚¹ã€å†…å­˜å¸è½½ï¼›</p>
<p>å¯è®­ç»ƒå‚æ•°é‡æ¯”è¾ƒï¼šIA3 &lt; BitFit &lt; Prompt-Tuning &lt; Lora =
Prefix-Tuning</p>
<h2 id="bitfit">BitFit</h2>
<p><strong>åªè®­ç»ƒæ¨¡å‹ä¸­çš„ bias éƒ¨åˆ†</strong>ï¼Œå†»ç»“å…¶ä»–å‚æ•°ã€‚</p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ç®€å•é«˜æ•ˆï¼Œèµ„æºå ç”¨é‡å°ï¼›</li>
<li>æ³›åŒ–æ€§å¼ºï¼Œé€‚ç”¨å„ç§åœºæ™¯ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>å¯è§£é‡Šæ€§å·®ï¼›</li>
<li>å¼ºä¾èµ–äºå¤§æ¨¡å‹è‡ªèº«çš„è´¨é‡ï¼›</li>
</ul>
<h2 id="ln-tuning">LN-Tuning</h2>
<p>å•ç‹¬è°ƒæ•´ LayerNorm æ¨¡å—çš„ weight å’Œ bias
å‚æ•°ï¼Œè®­ç»ƒå‚æ•°é‡å°‘ï¼Œä¾¿äºå’Œå…¶ä»–çš„å¾®è°ƒæ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚</p>
<style>.ksizjskrmlqc{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723134459641.png" class="ksizjskrmlqc" alt="image-20240723134459641">
<p>å®éªŒè¡¨æ˜ï¼ŒPrefix-Tuning + LN çš„å¾®è°ƒæ•ˆæœæœ€ä½³ã€‚</p>
<p>ä¼˜åŠ¿</p>
<ul>
<li>å‚æ•°é‡ä½ï¼Œæ•ˆæœä¸é”™ï¼›</li>
</ul>
<h2 id="prompt-tuning">Prompt-Tuning</h2>
<p>å†»ç»“é¢„è®­ç»ƒå¤§æ¨¡å‹çš„å…¨éƒ¨å‚æ•°ï¼Œåœ¨è®­ç»ƒçš„è¾“å…¥æ•°æ®å‰åŠ å…¥ä¸€å°æ®µ
Promptï¼Œ<strong>åªè®­ç»ƒ Prompt çš„è¡¨ç¤ºå±‚ï¼Œå³ä¸€ä¸ª Embedding
æ¨¡å—</strong>ã€‚</p>
<p>å…¶ä¸­ï¼ŒPrompt å­˜åœ¨ä¸¤ç§å½¢å¼ï¼Œåˆ†åˆ«æ˜¯ hard prompt å’Œ soft promptã€‚hard
prompt é€šè¿‡äººå·¥è¾“å…¥çš„æç¤ºè¯åˆå§‹åŒ– promptï¼Œsoft prompt éšæœºåˆå§‹åŒ–
promptã€‚äºŒè€…ç›¸æ¯”ï¼Œhard prompt å¯æ§æ€§æ›´å¼ºï¼Œè®­ç»ƒé€Ÿåº¦æ›´å¿«ã€‚ä¸ºäº†ä¼˜åŒ–Soft
prompt çš„æ•ˆæœï¼Œåç»­ç ”ç©¶æå‡ºäº† P-Tuningã€‚</p>
<blockquote>
<p>å¯è®­ç»ƒæ¨¡å—ï¼šEmbedding(virtual_token, hidden_size)</p>
</blockquote>
<style>.jdjhuxcxcucv{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240712160012402.png" class="jdjhuxcxcucv" alt="image-20240712160012402">
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ç®€åŒ–äº†ä¸åŒä»»åŠ¡ä¹‹é—´çš„è½¬æ¢å’Œè¿ç§»ï¼Œä½¿å¾—æ¨¡å‹å¯ä»¥æ›´åŠ çµæ´»åœ°åº”ç”¨äºå„ç§åœºæ™¯ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>é¢„è®­ç»ƒæ¨¡å‹è¾ƒå°æˆ–åœ¨Few-shotåœºæ™¯ä¸‹ï¼Œå¾®è°ƒç»“æœä¸ä½³ï¼›</li>
</ul>
<h2 id="p-tuning">P-Tuning</h2>
<p>åœ¨ Prompt-Tuning çš„ Soft Prompt åŸºç¡€ä¸Šï¼Œå¯¹ Prompt
éƒ¨åˆ†è¿›è¡Œè¿›ä¸€æ­¥çš„ç¼–ç è®¡ç®—ï¼ŒåŠ é€Ÿæ”¶æ•›ã€‚å…·ä½“æ¥è¯´ï¼ŒPEFT
åŒ…ä¸­æ”¯æŒä¸¤ç§ç¼–ç æ–¹å¼ï¼Œä¸€ç§æ˜¯ LSTMï¼Œä¸€ç§æ˜¯ MLPã€‚</p>
<blockquote>
<p>å¯è®­ç»ƒæ¨¡å—ï¼šEmbedding(virtual_token, hidden_size) + MLP/LSTM</p>
</blockquote>
<img data-src="/LLM-PEFT/PT.png" class="" title="PT.png">
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é€šè¿‡ Encoder å°†ç¦»æ•£çš„ Prompt Embedding è½¬å˜ä¸ºè¿ç»­çš„ï¼Œå‡å°‘äº† Prompt
Embedding åˆå§‹åŒ–å¯¹å¾®è°ƒæ€§èƒ½çš„å½±å“ï¼Œæé«˜äº†è®­ç»ƒçš„ç¨³å®šæ€§ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>å¢åŠ çš„ Prompt Encoder éœ€è¦é¢å¤–çš„è®¡ç®—èµ„æºï¼›</li>
</ul>
<h2 id="prefix-tuning">Prefix Tuning</h2>
<p>å°†å¯å­¦ä¹ çš„å‰ç¼€ä»¥ past_key_values çš„å½¢å¼æ”¾åˆ°æ¨¡å‹çš„ attention çš„ KV
å¤´éƒ¨ï¼Œæ¯ä¸ª MHA ä¸­çš„æ³¨æ„åŠ›å±‚å…±äº«åŒä¸€ç»„å‰ç¼€ã€‚</p>
<blockquote>
<p>past _key_valuesï¼šTransformer æ¨¡å‹ä¸­å†å²è®¡ç®—è¿‡çš„ key å’Œ value
çš„ç»“æœï¼Œæœ€æ—©æ˜¯ç”¨äºç”Ÿæˆç±»æ¨¡å‹è§£ç åŠ é€Ÿï¼Œè§£ç é€»è¾‘æ˜¯æ ¹æ®å†å²è¾“å…¥ï¼Œæ¯æ¬¡é¢„æµ‹ä¸€ä¸ªæ–°çš„
Tokenï¼Œç„¶åå°†æ–°çš„ Token åŠ å…¥è¾“å…¥ï¼Œå†é¢„æµ‹ä¸‹ä¸€ä¸ª
Tokenã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨å¤§é‡çš„é‡å¤è®¡ç®—ï¼Œå› æ­¤å¯ä»¥å°† key å’Œ value
çš„è®¡ç®—ç»“æœç¼“å­˜ï¼Œä½œä¸º past_key_values
è¾“å…¥åˆ°ä¸‹ä¸€æ¬¡çš„è®¡ç®—ä¸­ï¼Œè¿™ä¸€æŠ€æœ¯åˆè¢«ç§°ä¹‹ä¸º kv cacheã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯è®­ç»ƒæ¨¡å—ï¼šEmbedding + MLPï¼Œä¸ P-Tuning çš„åŒºåˆ«æ˜¯ prefix æ˜ å°„åˆ°äº†æ¨¡å‹çš„éšè—å±‚ä¸Š</span></span><br><span class="line">self.embedding = torch.nn.Embedding(num_virtual_tokens, token_dim)</span><br><span class="line">self.transform = torch.nn.Sequential(</span><br><span class="line">    torch.nn.Linear(token_dim, encoder_hidden_size),</span><br><span class="line">    torch.nn.Tanh(),</span><br><span class="line">    torch.nn.Linear(encoder_hidden_size, num_layers * <span class="number">2</span> * token_dim),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># transformers.models.bloom.BloomAttention æºç å®ç°</span></span><br><span class="line"><span class="keyword">if</span> layer_past <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    past_key, past_value = layer_past</span><br><span class="line">    key_layer = torch.cat((past_key, key_layer), dim=<span class="number">2</span>)</span><br><span class="line">    value_layer = torch.cat((past_value, value_layer), dim=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<style>.keyjobncnuku{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240712161951488.png" class="keyjobncnuku" alt="image-20240712161951488">
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ‹Ÿåˆé€Ÿåº¦å¿«ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>ç›´æ¥ä¿®æ”¹æ¨¡å‹ç»“æ„ï¼Œä¾èµ–é¢„è®­ç»ƒæ¨¡å‹æœ¬èº«çš„ç»“æ„ï¼›</li>
<li>å®ç°å¤æ‚ï¼Œç›¸æ¯”äºç›´æ¥ä¿®æ”¹è¾“å…¥ Prompt Embedding æ²¡æœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼›</li>
<li>ç›¸æ¯”äºå…¶ä»–çš„ Soft Prompt æ–¹æ³•ï¼ŒPrefix Tuning
å¯è®­ç»ƒå‚æ•°é‡å¤§ï¼Œæ¯ä¸€å±‚çš„ K V éƒ½éœ€è¦å¯è®­ç»ƒå‰ç¼€ï¼›</li>
</ul>
<h2 id="p-tuning-v2">P-Tuning V2</h2>
<p>ä¸ Prefix Tuning
æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šç§»é™¤é‡å‚æ•°åŒ–çš„ç¼–ç å™¨ï¼Œå³æ²¡æœ‰MLPã€‚</p>
<p>é€šè¿‡å…±äº«è¿ç»­æç¤ºåŒæ—¶ä¼˜åŒ–å¤šä¸ªä»»åŠ¡ï¼Œå¤šä»»åŠ¡å­¦ä¹ æ˜¯ P-Tuning v2
çš„å¯é€‰åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å¤šä»»åŠ¡å…±äº«å‰ç¼€è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</p>
<style>.hhnkxjxutspn{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240712162302772.png" class="hhnkxjxutspn" alt="image-20240712162302772">
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ç§»é™¤é‡å‚æ•°åŒ–çš„ç¼–ç å™¨ï¼Œå¯¹äºè¾ƒå°çš„æ¨¡å‹ï¼Œä¼šå½±å“æ¨¡å‹çš„è¡¨ç°ï¼Œä¸”å¯¹äºå¤§æ¨¡å‹æå‡ä¸å¤§ï¼›</li>
<li>å¼•å…¥å¤šä»»åŠ¡å­¦ä¹ æ¦‚å¿µï¼Œå…ˆåœ¨å¤šä»»åŠ¡çš„Promptä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œç„¶åå†é€‚é…ä¸‹æ¸¸ä»»åŠ¡ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>prefixé•¿åº¦åœ¨ 100~200
æ—¶ï¼Œå¾®è°ƒç»“æœæœ€ä¼˜ï¼Œä½†ç”±äºæ¨¡å‹å¯æ¥å—çš„æœ€å¤§è¾“å…¥é•¿åº¦æœ‰é™ï¼Œéšç€è½¯æç¤ºçš„å‚æ•°é‡å¢å¤šï¼Œå®é™…è¾“å…¥åºåˆ—çš„æœ€å¤§é•¿åº¦ä¹Ÿä¼šç›¸åº”å‡å°ï¼›</li>
<li>ç›´æ¥ä¼˜åŒ– prompt å’Œ prefix æ˜¯éå•è°ƒçš„ï¼Œæ¯”è¾ƒéš¾ä»¥æ”¶æ•›ï¼›</li>
</ul>
<h2 id="diff-pruning">Diff pruning</h2>
<p>ä¸æ˜¯ä¿®æ”¹æ¨¡å‹çš„ç»“æ„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªç‰¹å®šä»»åŠ¡çš„ diff
å‘é‡æ‰©å±•åŸºç¡€æ¨¡å‹ã€‚å­¦ä¹ ç‰¹å®šäºä»»åŠ¡çš„å·®å¼‚å‘é‡ï¼Œè¯¥å‘é‡æ‰©å±•äº†åŸå§‹é¢„è®­ç»ƒå‚æ•°ã€‚diff
å‘é‡ <span class="math display">\[\delta_{task}\]</span>
åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªé€‚åº”ä¿®å‰ªï¼Œå¹¶åŠ å…¥ ğ¿0 èŒƒæ•°æƒ©ç½šçš„å¯å¾®è¿‘ä¼¼æ¥é¼“åŠ±ç¨€ç–æ€§ã€‚</p>
<p><span
class="math display">\[\theta_{task}=\theta_{pretrained}+\delta_{task}\]</span></p>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>éœ€è¦åº•å±‚å®ç°æ¥åŠ é€Ÿéç»“æ„åŒ–ç¨€ç–çŸ©é˜µçš„è®¡ç®—ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ç°æœ‰çš„æ¡†æ¶ï¼›</li>
<li>è®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦å­˜å‚¨å®Œæ•´çš„âˆ†çŸ©é˜µï¼Œç›¸æ¯”äºFull
finetuneå¹¶æ²¡æœ‰é™ä½è®¡ç®—æˆæœ¬ï¼›</li>
</ul>
<h2 id="lora">LoRA</h2>
<p>æ·±åº¦ç½‘ç»œç”±å¤§é‡ Dense
å±‚æ„æˆï¼Œè¿™äº›å‚æ•°çŸ©é˜µé€šå¸¸æ˜¯ä½ç§©çš„ã€‚ç›¸å…³å·¥ä½œè¡¨æ˜ï¼Œåœ¨é€‚åº”ç‰¹å®šä»»åŠ¡æ—¶ï¼Œé¢„è®­ç»ƒæ¨¡å‹æ˜¯è¿‡åº¦å‚æ•°åŒ–çš„ï¼Œhidden_size
å®é™…ä¸Šå­˜åœ¨äºä¸€ä¸ªè¾ƒä½çš„å†…åœ¨ç»´åº¦ä¸Šï¼Œå³é«˜ç»´æ•°æ®å®é™…æ˜¯åœ¨ä½ç»´å­ç©ºé—´ä¸­ã€‚</p>
<p>å› æ­¤ï¼Œå°† <span class="math inline">\(\Delta\mathbf{W}\)</span>
ç”¨ä¸¤ä¸ªæ›´å‚æ•°é‡æ›´å°çš„çŸ©é˜µ <span
class="math inline">\(\mathbf{A}\in\mathbb{R}^{d\times r}\)</span> å’Œ
<span class="math inline">\(\mathbf{B}\in\mathbb{R}^{r\times d}\)</span>
ä½ç§©è¿‘ä¼¼ï¼ˆr&lt;dï¼‰ã€‚å…¶ä¸­ï¼ŒçŸ©é˜µ B é€šè¿‡é«˜æ–¯å‡½æ•°åˆå§‹åŒ–ï¼ŒçŸ©é˜µ A
ä¸ºå…¨é›¶åˆå§‹åŒ–ï¼Œä½¿å¾—è®­ç»ƒå¼€å§‹ä¹‹å‰æ—è·¯å¯¹åŸæ¨¡å‹ä¸é€ æˆå½±å“ã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼Œå†»ç»“é¢„è®­ç»ƒçš„æ¨¡å‹æƒé‡ï¼Œå¹¶å°†å¯è®­ç»ƒçš„ç§©åˆ†è§£çŸ©é˜µæ³¨å…¥åˆ°å¤§æ¨¡å‹çš„æ¯ä¸ª
Attention
å±‚çš„çº¿æ€§å˜æ¢ä¸­ã€‚è¾“å…¥åˆ†åˆ«ä¸åŸå§‹æƒé‡å’Œä¸¤ä¸ªä½ç§©çŸ©é˜µè¿›è¡Œè®¡ç®—ï¼Œå…±åŒå¾—åˆ°æœ€ç»ˆç»“æœã€‚</p>
<style>.antclmivydob{zoom:40%;}</style>
<img data-src="/LLM-PEFT/image-20240712170241205.png" class="antclmivydob" alt="image-20240712170241205">
<p>è®­ç»ƒå®Œæˆåï¼Œå¯ä»¥å°†ä¸¤ä¸ªä½ç§©çŸ©é˜µä¸åŸå§‹æ¨¡å‹ä¸­çš„æƒé‡è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶åçš„æ¨¡å‹ä¸åŸå§‹æ¨¡å‹æ— å¼‚ï¼Œé¿å…äº†æ¨ç†æœŸé—´
Prompt ç³»åˆ—æ–¹æ³•å¸¦æ¥çš„é¢å¤–è®¡ç®—é‡ã€‚</p>
<p><span
class="math display">\[\mathbf{h}=(\mathbf{W}_0+\Delta\mathbf{W})\mathbf{x}=\mathbf{W}_0\mathbf{x}+\mathbf{B}\mathbf{A}\mathbf{x}\]</span></p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å¯ä»¥å°†åŸæƒé‡ä¸è®­ç»ƒåæƒé‡åˆå¹¶ï¼Œåœ¨æ¨ç†æ—¶ä¸å­˜åœ¨é¢å¤–çš„è®¡ç®—å¼€é”€ï¼›</li>
<li>ä¸å¢åŠ è¾“å…¥å‚æ•°ï¼Œä¸æ”¹å˜æ¨¡å‹ç»“æ„ï¼Œç®€å•æ˜“ç”¨ï¼Œæ³›åŒ–æ€§å¼ºï¼›</li>
<li>æå‡ºä½ç§©åˆ†è§£çŸ©é˜µçš„æ€è·¯ï¼Œåœ¨å‡å°‘è®¡ç®—èµ„æºéœ€æ±‚çš„åŒæ—¶ï¼Œä¸ä¼šä¸¢å¤±é¢„è®­ç»ƒåŸæœ‰çš„é€šç”¨èƒ½åŠ›ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>é¢„å…ˆæŒ‡å®šæ¯ä¸ªå¢é‡çŸ©é˜µçš„å†…åœ¨ç§© r
ç›¸åŒï¼Œå¿½ç•¥äº†åœ¨å¾®è°ƒé¢„è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæƒé‡çŸ©é˜µçš„é‡è¦æ€§åœ¨ä¸åŒæ¨¡å—å’Œå±‚ä¹‹é—´å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œåœ¨å®éªŒä¸­å¯ä»¥å‘ç°
Wq
çš„ç§©æ›´å¤§ï¼Œå³å­˜å‚¨çš„ä¿¡æ¯æ›´å¤šï¼›å› æ­¤æ— æ³•å®Œå…¨æ•æ‰é¢„è®­ç»ƒæ¨¡å‹çš„ç‰¹å¾ï¼Œæˆ–æ— æ³•æœ‰æ•ˆåœ°å°†åŸå§‹æ¨¡å‹çš„çŸ¥è¯†è¿ç§»åˆ°ç›®æ ‡ä»»åŠ¡ä¸Šï¼›</li>
<li>åªè®­ç»ƒäº†self-attentionï¼Œæ²¡æœ‰è®­ç»ƒ feed-forward networksï¼Œäº‹å®ä¸Š FFN
æ›´é‡è¦ï¼›</li>
</ul>
<h2 id="ia3">IA3</h2>
<blockquote>
<p>ç”±äºä¸åŒå¤§æ¨¡å‹ç»“æ„ä¸åŒï¼Œæºç å®ç°æœ‰å·®åˆ«ã€‚bloom é¢„è®­ç»ƒæ¨¡å‹çš„ QKV å…±ç”¨
Linear å±‚ (hidden_size, hidden_size*3)ï¼ŒIA3
çš„å¯è®­ç»ƒå‚æ•°åŒæ—¶ä½œç”¨äºä¸‰è€…ä¹‹ä¸Š</p>
</blockquote>
<p>æŠ‘åˆ¶å’Œæ”¾å¤§å†…éƒ¨æ¿€æ´»ï¼Œé€šè¿‡å¯å­¦ä¹ çš„å‘é‡å¯¹æ¿€æ´»å€¼è¿›è¡ŒæŠ‘åˆ¶æˆ–æ”¾å¤§ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡ä¸€ç»„å¯è®­ç»ƒå‚æ•°ç›´æ¥äº
Kã€Vã€FFN ç›¸ä¹˜ï¼Œé’ˆå¯¹ä¸åŒ batch
çš„åŒä¸€ä½ç½®è¿›è¡Œç›¸åŒçš„è°ƒæ•´ï¼ˆå³ä¹˜ä¸Šç›¸åŒå¯å­¦ä¹ å‚æ•°ï¼‰ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­å†»ç»“åŸå§‹æ¨¡å‹çš„æƒé‡ï¼Œåªæ›´æ–°æ–°å¢çš„å‚æ•°ã€‚è®­ç»ƒå®Œæˆåï¼Œä¸
Lora ç±»ä¼¼ï¼Œå¯ä»¥å°†å­¦ä¹ éƒ¨åˆ†çš„å‚æ•°ä¸åŸå§‹æƒé‡åˆå¹¶ï¼Œæ²¡æœ‰é¢å¤–æ¨ç†å¼€é”€ã€‚</p>
<style>.woywmpuirsjy{zoom:67%;}</style>
<img data-src="/LLM-PEFT/image-20240718191324572.png" class="woywmpuirsjy" alt="image-20240718191324572">
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è°ƒèŠ‚çš„å‚æ•°å°‘äº Loraï¼Œå¾®è°ƒæ•ˆæœä¹Ÿä¸é”™ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>å­¦ä¹ ç‡å¯¹å¾®è°ƒæ•ˆç‡å½±å“è¾ƒå¤§ï¼Œè®ºæ–‡ä¸­çš„å»ºè®®æ˜¯ 3e-3ï¼›</li>
</ul>
<h2 id="adalora">AdaLora</h2>
<p>AdaLora
åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨â€œå…ˆæ¢ç´¢å‚æ•°ç©ºé—´ï¼Œå†å…³æ³¨æœ€é‡è¦çš„æƒé‡â€çš„æ–¹æ³•ï¼Œä¸é¢„å…ˆæŒ‡å®šçŸ©é˜µçš„ç§©ï¼Œè€Œæ˜¯åŠ¨æ€æ›´æ–°å¢é‡çŸ©é˜µçš„ç§©ï¼Œå› ä¸ºç ”ç©¶å‘ç°æƒé‡çŸ©é˜µçš„é‡è¦æ€§åœ¨ä¸åŒæ¨¡å—å’Œå±‚ä¹‹é—´å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚åœ¨è¯¥å¾®è°ƒæ–¹æ³•ä¸­ï¼Œéœ€è¦å…ˆæ‰¾åˆ°æ›´åŠ é‡è¦çš„çŸ©é˜µï¼Œç»™å…¶åˆ†é…æ›´å¤šçš„å‚æ•°ï¼ˆæ›´å¤§çš„ç§©ï¼‰ï¼Œå¹¶è£å‰ªä¸é‡è¦çš„çŸ©é˜µã€‚ç›¸æ¯”äºLoraï¼Œè¯¥æ–¹æ³•åœ¨æå‡æ¨¡å‹æ•ˆæœçš„åŒæ—¶ï¼Œé™ä½äº†å‚æ•°è®¡ç®—é‡ã€‚</p>
<p>åŒºåˆ«äº Lora çš„ä½ç§©çŸ©é˜µåˆ†è§£ï¼ŒAdaLora
é‡‡ç”¨å‚æ•°åŒ–çŸ©é˜µæ¥æ¨¡æ‹Ÿå¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰ï¼Œå¹¶èˆå¼ƒä¸é‡è¦çš„å¥‡å¼‚å€¼ï¼Œä¿ç•™å¥‡å¼‚å‘é‡ã€‚ç”±äºå¯¹ä¸€ä¸ªå¤§çŸ©é˜µè¿›è¡Œç²¾ç¡®
SVD
åˆ†è§£çš„è®¡ç®—æ¶ˆè€—éå¸¸å¤§ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥åŠ é€Ÿè®¡ç®—ï¼ŒåŒæ—¶ä¿ç•™æœªæ¥æ¢å¤çš„å¯èƒ½æ€§å¹¶ç¨³å®šè®­ç»ƒã€‚</p>
<p><span class="math display">\[W=W^{(0)}+\Delta=W^{(0)}+P \Lambda
Q\]</span></p>
<p>è®¡ç®—ä¸‰å…ƒç»„ QKV
çš„é‡è¦æ€§åˆ†æ•°ï¼Œä¿®å‰ªä¸å¤ªé‡è¦çš„å¥‡å¼‚å€¼ï¼Œå°†æ›´å¤šé¢„ç®—ç•™ç»™ä¼˜å…ˆçº§è¾ƒé«˜çš„å¢é‡çŸ©é˜µã€‚</p>
<p><span
class="math display">\[S_{k,i}=s\left(\lambda_{k,i}\right)+\frac{1}{d_1}\sum_{j=1}^{d_1}s\left(P_{k,ji}\right)+\frac{1}{d_2}\sum_{j=1}^{d_2}s\left(Q_{k,ij}\right)\]</span></p>
<p>é€šè¿‡çµæ•åº¦å¹³æ»‘å’Œä¸ç¡®å®šæ€§é‡åŒ–ï¼ŒåŠ å…¥ç´¯è®¡çµæ•åº¦çš„å½±å“æ¥è§£å†³éšæœºé‡‡æ ·å’Œå¤æ‚çš„è®­ç»ƒåŠ¨æ€å¯¼è‡´çµæ•åº¦ä¼°è®¡çš„å˜å¼‚æ€§å¤§ã€ä¸ç¡®å®šæ€§å¤§çš„é—®é¢˜</p>
<p><span
class="math display">\[\begin{aligned}&amp;\bar{I}^{(t)}\left(w_{ij}\right)=\beta_1\bar{I}^{(t-1)}\left(w_{ij}\right)+\left(1-\beta_1\right)I^{(t)}\left(w_{ij}\right)\\&amp;\bar{U}^{(t)}\left(w_{ij}\right)=\beta_2\bar{U}^{(t-1)}\left(w_{ij}\right)+\left(1-\beta_2\right)\left|I^{(t)}\left(w_{ij}\right)-\bar{I}^{(t)}\left(w_{ij}\right)\right|\end{aligned}\]</span></p>
<p><span
class="math display">\[s^{(t)}\left(w_{ij}\right)=\bar{I}^{(t)}\left(w_{ij}\right)\cdot\bar{U}^{(t)}\left(w_{ij}\right)\]</span></p>
<p>å¯ä»¥é€šè¿‡æ¢¯åº¦ä¸‹é™çš„æ–¹å¼å¯¹<span class="math inline">\(P, \Lambda,
Q\)</span>è¿›è¡Œæ›´æ–°ï¼Œå°†ä¸éœ€è¦çš„å¥‡å¼‚å€¼ Î» å‰ªè£ Maskï¼Œåç»­ä»å¯ä»¥åŠ å…¥è®­ç»ƒ</p>
<p><span
class="math display">\[\Lambda_k^{(t+1)}=\mathcal{T}\left(\tilde{\Lambda}_k^{(t)},S_k^{(t)}\right),\text{
with
}\mathcal{T}\left(\tilde{\Lambda}_k^{(t)},S_k^{(t)}\right)_{ii}=\begin{cases}\tilde{\Lambda}_{k,ii}^{(t)}&amp;S_{k,i}^{(t)}\text{
is in the top- }b^{(t)}\text{ of }S^{(t)}\\0&amp;\text{
otherwise}&amp;\end{cases}\]</span></p>
<p>è®­ç»ƒæŸå¤±ä¸­æ·»åŠ äº†é¢å¤–çš„æƒ©ç½šé¡¹ï¼Œä»¥è§„èŒƒå¥‡å¼‚çŸ©é˜µPå’ŒQçš„æ­£äº¤æ€§ï¼Œä»è€Œé¿å…SVDçš„å¤§é‡è®¡ç®—å¹¶ç¨³å®šè®­ç»ƒã€‚</p>
<p><span class="math display">\[R(P,Q)=\left\|P^\top
P-I\right\|_\mathrm{F}^2+\left\|QQ^\top-I\right\|_\mathrm{F}^2\]</span></p>
<p>æœ€ç»ˆï¼Œå¾®è°ƒçš„æŸå¤±å‡½æ•°ä¸º</p>
<p><strong>é‡è¦ç»“è®º</strong></p>
<style>.xlgfgzyplsnz{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723112058468.png" class="xlgfgzyplsnz" alt="image-20240723112058468">
<p>AdaLoRA æ€»æ˜¯å€¾å‘äºå°†æ›´å¤šé¢„ç®—åˆ†é…ç»™ FFN å’Œé¡¶å±‚ï¼Œå³ FFN
æ¨¡å—å’Œé¡¶å±‚çš„æƒé‡çŸ©é˜µå¯¹äºæ¨¡å‹æ€§èƒ½æ›´ä¸ºé‡è¦ã€‚</p>
<h2 id="adapter-tuning">Adapter Tuning</h2>
<p>åœ¨ Transformer Layer çš„ Self-Attetion å’Œ FFN
ä¹‹åæ’å…¥ä¸€ä¸ªå…ˆé™ç»´å†å‡ç»´çš„ MLPï¼ˆä»¥åŠä¸€å±‚æ®‹å·®å’ŒLayer
Normalizationï¼‰æ¥å­¦ä¹ æ¨¡å‹å¾®è°ƒçš„çŸ¥è¯†ã€‚</p>
<style>.wgkkirvahosg{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723101505442.png" class="wgkkirvahosg" alt="image-20240723101505442">
<p>å›¾ä¸­ï¼ŒAdapter å³æ’å…¥çš„ FF Down + éçº¿æ€§æ¿€æ´»å±‚ + FF
upã€‚åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œå›ºå®šåŸå§‹æ¨¡å‹çš„å‚æ•°ï¼Œåªå¾®è°ƒé€‚é…å±‚ã€‚</p>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>éœ€è¦ä¿®æ”¹åŸæœ‰æ¨¡å‹ç»“æ„ï¼Œä¼šå¢åŠ æ¨¡å‹å‚æ•°é‡ï¼›</li>
</ul>
<p>å˜ä½“ï¼š</p>
<ul>
<li><a
href="https://aclanthology.org/2020.findings-emnlp.41.pdf">Paper</a>ï¼šä»…åœ¨
MLP æ¨¡å—ä¹‹åå’Œ LayerNorm ä¹‹åä½¿ç”¨é€‚é…å™¨å±‚</li>
</ul>
<h2 id="adapterfusion">AdapterFusion</h2>
<p>æ•´åˆæ¥è‡ªå¤šä¸ªä»»åŠ¡çš„çŸ¥è¯†çš„æ–¹æ³•æ—¶ï¼Œå¸¸é‡åˆ°ç¾éš¾æ€§é—å¿˜å’Œå¤šä»»åŠ¡æ•°æ®é›†å¹³è¡¡æ–¹é¢çš„å›°éš¾ã€‚AdapterFusion
åˆ†ç¦»çŸ¥è¯†æå–å’ŒçŸ¥è¯†ç»„åˆè¿™ä¸¤ä¸ªé˜¶æ®µï¼Œå¯ä»¥ä»¥éç ´åæ€§çš„æ–¹å¼æœ‰æ•ˆåœ°åˆ©ç”¨ä»å¤šä¸ªä»»åŠ¡ä¸­å­¦åˆ°çš„è¡¨ç¤ºã€‚çŸ¥è¯†æå–é˜¶æ®µå­¦ä¹ Adapter
ä»»åŠ¡ç‰¹å®šå‚æ•°ï¼Œå…¶å°è£…äº†ç‰¹å®šäºä»»åŠ¡çš„ä¿¡æ¯ï¼›çŸ¥è¯†ç»„åˆé˜¶æ®µå°†ä¸åŒä»»åŠ¡çš„ Adapter
ç»„åˆåˆ°ä¸€èµ·ã€‚</p>
<style>.hkekyumgqnzn{zoom:60%;}</style>
<img data-src="/LLM-PEFT/image-20240723102934378.png" class="hkekyumgqnzn" alt="image-20240723102934378">
<style>.cqmuvdrnvgic{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723103303792.png" class="cqmuvdrnvgic" alt="image-20240723103303792">
<p>AdapterFusion
ç»„ä»¶å°†åœ¨ä¸åŒä»»åŠ¡ä¸Šè®­ç»ƒçš„å¤šä¸ªé€‚é…å™¨çš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œå¹¶å­¦ä¹ ç¼–ç ä¿¡æ¯çš„å‚æ•°åŒ–æ··åˆå™¨ï¼Œåº”ç”¨äºå•ä¸ªä»»åŠ¡å¤š
Adapter çš„åœºæ™¯å’Œå¤šä»»åŠ¡æ··åˆçš„åœºæ™¯ã€‚å•ä»»åŠ¡åœºæ™¯ä¸­ï¼Œå¯ä»¥å¤šä¸ª Adapter
å¯ç”¨äºæå–åŒä¸€ä¸‹æ¸¸ä»»åŠ¡ä¸åŒç»´åº¦çš„ä¿¡æ¯ï¼Œå†å°†ä»–ä»¬èåˆèµ·æ¥ã€‚</p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä¼˜äºåœ¨å•ä»»åŠ¡å’Œå¤šä»»åŠ¡ä¸­è®­ç»ƒçš„ Adapter
æ¨¡å‹ï¼Œå¯ä»¥è§†ä¸ºå¤šAdapteræå–ä¸åŒç»´åº¦çš„ä¿¡æ¯ï¼ŒAdapterFusion
å°†ä»–ä»¬èåˆèµ·æ¥ã€‚</li>
</ul>
<h2 id="adapterdrop">AdapterDrop</h2>
<p>è¯¥æ–¹æ³•åœ¨ä¸å½±å“ä»»åŠ¡æ€§èƒ½çš„å‰æä¸‹ï¼ŒåŠ¨æ€é«˜æ•ˆçš„ç§»é™¤å†—ä½™çš„
Adapterï¼Œå¯ä»¥å°½å¯èƒ½åœ°å‡å°‘æ¨¡å‹çš„å‚æ•°é‡ï¼Œæé«˜æ¨¡å‹åœ¨åå‘ä¼ æ’­ï¼ˆè®­ç»ƒï¼‰å’Œæ­£å‘ä¼ æ’­ï¼ˆæ¨ç†ï¼‰æ—¶çš„æ•ˆç‡ã€‚</p>
<style>.vbmvebrdrlem{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723103450147.png" class="vbmvebrdrlem" alt="image-20240723103450147">
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é€šè¿‡ä»è¾ƒä½çš„ Transformer å±‚åˆ é™¤å¯å˜æ•°é‡çš„Adaperæ¥æå‡æ¨ç†é€Ÿåº¦ã€‚
å½“å¯¹å¤šä¸ªä»»åŠ¡æ‰§è¡Œæ¨ç†æ—¶ï¼ŒåŠ¨æ€åœ°å‡å°‘äº†è¿è¡Œæ—¶çš„è®¡ç®—å¼€é”€ï¼Œå¹¶åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¿æŒäº†ä»»åŠ¡æ€§èƒ½ï¼›</li>
</ul>
<h2 id="mam-adapter">MAM Adapter</h2>
<p>åˆ†è§£äº†æœ€å…ˆè¿›çš„å‚æ•°é«˜æ•ˆè¿ç§»å­¦ä¹ æ–¹æ³•çš„è®¾è®¡ï¼Œå¹¶æå‡ºäº†ä¸€ä¸ªåœ¨å®ƒä»¬ä¹‹é—´å»ºç«‹è”ç³»çš„ç»Ÿä¸€æ¡†æ¶ã€‚</p>
<style>.qpodqwximlbt{zoom: 50%;}</style>
<img data-src="/LLM-PEFT/image-20240723104300363.png" class="qpodqwximlbt" alt="image-20240723104300363">
<h2 id="unipeft">UniPEFT</h2>
<p>ä¸åŒçš„ PEFT
æ–¹æ³•åœ¨åŒä¸€ä»»åŠ¡ä¸Šçš„è¡¨ç°ä¸åŒï¼Œå› æ­¤ä¸ºç‰¹å®šä»»åŠ¡é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ³•å¹¶éæ˜“äº‹ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°æ–°
PEFT æ–¹æ³•å’Œä»»åŠ¡æ•°é‡çš„å¿«é€Ÿå¢é•¿ã€‚é‰´äºæ¨¡å‹çš„å¤šæ ·æ€§å’Œæ¨¡å‹é€‰æ‹©çš„éš¾åº¦ï¼ŒUniPEFT
æå‡ºäº†ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶ UniPEFTï¼Œå®ƒå°†ä¸åŒçš„PEFT
æ–¹æ³•ä½œä¸ºå­æ¨¡å—ï¼Œå¹¶é€šè¿‡é—¨æ§æœºåˆ¶å­¦ä¹ æ¿€æ´»æœ€é€‚åˆå½“å‰æ•°æ®æˆ–ä»»åŠ¡è®¾ç½®çš„æ–¹æ³•ã€‚</p>
<style>.slxwufueyoyc{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723104910206.png" class="slxwufueyoyc" alt="image-20240723104910206">
<h2 id="pissa">PISSA</h2>
<blockquote>
<p>peft åŒ…ä¸­æœ‰ PISSA åˆå§‹åŒ–æ–¹æ³•
<code>self.pissa_init(adapter_name, init_lora_weights)</code></p>
</blockquote>
<p>PISSA å’Œ LoRA ä¸»è¦çš„åŒºåˆ«æ˜¯åˆå§‹åŒ–æ–¹å¼ä¸åŒã€‚åŒæ ·åŸºäºä½ç§©ç‰¹æ€§çš„å‡è®¾ï¼Œä½†
PISSA ä¸æ˜¯å»è¿‘ä¼¼ï¼Œè€Œæ˜¯ç›´æ¥åŸºäºåŸçŸ©é˜µæ“ä½œã€‚</p>
<p>PiSSA å¯¹é¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°çŸ©é˜µ<span class="math display">\[W\in
R^{m\times n}\]</span> è¿›è¡Œå¥‡å¼‚å€¼åˆ†è§£ï¼Œå…¶ä¸­å‰ r
ä¸ªå¥‡å¼‚å€¼å’Œå¥‡å¼‚å‘é‡ç”¨æ¥åˆå§‹åŒ–é€‚é…å™¨ (adapter) çš„ä¸¤ä¸ªçŸ©é˜µ<span
class="math display">\[A\in R^{m\times r}\]</span> å’Œ<span
class="math display">\[B\in R^{r\times n}\]</span> ï¼Œï¼› <span
class="math display">\[r\ll\min(m,n)\]</span>
å‰©ä½™çš„å¥‡å¼‚å€¼å’Œå¥‡å¼‚å‘é‡ç”¨æ¥æ„é€ æ®‹å·®çŸ©é˜µ<span
class="math display">\[W^{res}\in R^{m\times n}\]</span> ï¼Œä½¿å¾—<span
class="math display">\[W=AB+W^{res}\]</span>
ã€‚å› æ­¤ï¼Œé€‚é…å™¨ä¸­çš„å‚æ•°åŒ…å«äº†æ¨¡å‹çš„æ ¸å¿ƒå‚æ•°ï¼Œè€Œæ®‹å·®çŸ©é˜µä¸­çš„å‚æ•°æ˜¯ä¿®æ­£å‚æ•°ã€‚é€šè¿‡å¾®è°ƒå‚æ•°é‡è¾ƒå°çš„æ ¸å¿ƒé€‚é…å™¨
Aã€Bï¼Œå†»ç»“å‚æ•°é‡è¾ƒå¤§çš„æ®‹å·®çŸ©é˜µ <span
class="math display">\[\text{Wres}\]</span>
ï¼Œå°±è¾¾æˆäº†ç”¨å¾ˆå°‘çš„å‚æ•°è¿‘ä¼¼å…¨å‚æ•°å¾®è°ƒçš„æ•ˆæœã€‚</p>
<style>.loufpgjlzqsw{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723093258953.png" class="loufpgjlzqsw" alt="image-20240723093258953">
<p>ä¼˜åŠ¿</p>
<ul>
<li>ç›¸æ¯”äº LoRAï¼Œæ”¶æ•›é€Ÿåº¦æ›´å¿«ï¼Œæ€§èƒ½æ›´å¥½</li>
</ul>
<h2 id="vera">VeRA</h2>
<p>åŒºåˆ«äºLoraï¼ŒVera å°† A å’Œ B
çŸ©é˜µæŒ‰ç…§é«˜æ–¯åˆ†å¸ƒéšæœºåˆå§‹åŒ–å¹¶å†»ç»“ï¼Œåªè®­ç»ƒä¸¤ç»„ç›´æ¥å’ŒAã€Bç›¸ä¹˜çš„ä¸€ç»´å‚æ•°ã€‚è™½ç„¶ç›´è§‚çœ‹èµ·æ¥Aå’ŒBåƒä¸¤ä¸ªæ— ç”¨çš„å¼ é‡ï¼Œä½†å®é™…ä¸Šå®ƒä»¬ä»ç„¶æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå®éªŒè¯æ˜å³ä½¿æ˜¯éšæœºå¼ é‡ä¹Ÿå¯ä»¥ç”¨äºå¾®è°ƒã€‚</p>
<style>.gsxghiyykogj{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723100503853.png" class="gsxghiyykogj" alt="image-20240723100503853">
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>VeRAæ˜¾è‘—å‡å°‘äº†å¯è®­ç»ƒå‚æ•°çš„æ•°é‡ï¼ˆLoRAç›¸æ¯”å‚æ•°å‡å°‘äº†10å€ï¼‰ï¼Œè€Œç²¾åº¦æ²¡æœ‰æŸå¤±ï¼›</li>
<li>ç¼©æ”¾å‘é‡å°ºå¯¸å°ï¼Œå¯ä»¥å°†è®¸å¤šç‰ˆæœ¬é©»ç•™åœ¨å•ä¸ªGPUçš„æœ‰é™å†…å­˜ä¸­ï¼Œä»è€Œå¤§å¤§æé«˜äº†æœåŠ¡æ•ˆç‡ï¼Œé€‚åˆäºéœ€è¦é¢‘ç¹äº¤æ¢å¤§é‡å¾®è°ƒæ¨¡å‹çš„åœºæ™¯ï¼Œæ¯”å¦‚é’ˆå¯¹ä¸ªäººç”¨æˆ·ä¸ªæ€§åŒ–çš„åŸºäºäº‘çš„äººå·¥æ™ºèƒ½æœåŠ¡ï¼›</li>
</ul>
<h2 id="dora">DoRA</h2>
<p>å°†æ¯ä¸ªé«˜é˜¶çŸ©é˜µéƒ½åˆ†è§£ä¸º 1*k å¤§å°çŸ©é˜µå’Œ d*k æ–¹å‘çŸ©é˜µçš„ä¹˜ç§¯ï¼ŒLoRA
å€¾å‘äºåŒæ—¶æ”¹å˜å¹…åº¦å’Œæ–¹å‘ï¼ŒDoRAå¯ä»¥æ›´å®¹æ˜“åœ°å°†äºŒè€…åˆ†å¼€è°ƒæ•´ï¼Œæˆ–è€…ç”¨å¦ä¸€ä¸ªçš„è´Ÿå˜åŒ–æ¥è¡¥å¿ä¸€ä¸ªçš„å˜åŒ–ã€‚</p>
<style>.goruzvpferlf{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240723110508921.png" class="goruzvpferlf" alt="image-20240723110508921">
<h2 id="slora">SLORA</h2>
<p>ä¸€ä¸ª GPU ä¸Šå¹¶è¡Œæ‰§è¡Œå¤šä¸ª lora adapters çš„å¾®è°ƒ</p>
<p>S-LoRA èƒ½å¤Ÿåœ¨å•ä¸ª GPU ä¸Šæˆ–è·¨å¤šä¸ª GPU ä»¥è¾ƒå°çš„å¼€é”€ä¸ºæ•°åƒä¸ª LoRA
é€‚é…å™¨æä¾›æœåŠ¡ã€‚è¯¥æ–¹æ³•å°†æ‰€æœ‰ LoRA
æ¨¡å—å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œå¹¶å°†å½“å‰è¿è¡Œçš„æŸ¥è¯¢ä½¿ç”¨çš„é€‚é…å™¨è·å–åˆ° GPU
å†…å­˜ï¼Œæå‡ºé‡‡ç”¨ç»Ÿä¸€åˆ†é¡µæŠ€æœ¯ï¼Œä½¿ç”¨ç»Ÿä¸€çš„å†…å­˜æ± æ¥ç®¡ç†å…·æœ‰ä¸åŒç­‰çº§çš„åŠ¨æ€é€‚é…å™¨æƒé‡å’Œå…·æœ‰ä¸åŒåºåˆ—é•¿åº¦çš„
KV ç¼“å­˜å¼ é‡ã€‚æ­¤å¤–ï¼Œè¯¥æ–¹æ³•é‡‡ç”¨æ–°é¢–çš„å¼ é‡å¹¶è¡Œç­–ç•¥å’Œé«˜åº¦ä¼˜åŒ–çš„å®šåˆ¶ CUDA
å†…æ ¸ï¼Œå¯è§†ä¸ºå®šåˆ¶åŒ–çš„ LoRAå¾®è°ƒé«˜æ•ˆè®¡ç®—æµç¨‹ã€‚</p>
<h2 id="galore">GaLore</h2>
<p>æ¢¯åº¦ä½ç§©æŠ•å½±ï¼ˆGaLoreï¼‰æ˜¯ä¸€ç§å…¨é‡å‚æ•°å­¦ä¹ çš„è®­ç»ƒç­–ç•¥ï¼Œä½†æ¯”å¸¸è§çš„ä½ç§©è‡ªé€‚åº”æ–¹æ³•ï¼ˆLoRAï¼‰æ›´èŠ‚çœå†…å­˜ã€‚å…¶å…³é”®æ€æƒ³æ˜¯åˆ©ç”¨æƒé‡çŸ©é˜µ
W çš„æ¢¯åº¦ <span class="math display">\[G\in \mathbb{R}^{m\times
n}\]</span> ç¼“æ…¢å˜åŒ–çš„ä½ç§©ç»“æ„ï¼Œè€Œä¸æ˜¯è¯•å›¾å°†æƒé‡çŸ©é˜µæœ¬èº«è¿‘ä¼¼ä¸ºä½ç§©ã€‚</p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>èŠ‚çœå†…å­˜ï¼ˆä¸‰å€ï¼‰ï¼›</li>
<li>æ€§èƒ½ä¸é”™ï¼›</li>
</ul>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>è®­ç»ƒé€Ÿåº¦æ…¢ï¼ˆä¸‰å€ï¼‰ï¼›</li>
</ul>
<h2 id="lora-1">LoRA+</h2>
<p>LoRA ä¸­çš„é€‚é…å™¨çŸ©é˜µ A å’Œ B ä»¥ç›¸åŒçš„å­¦ä¹ ç‡ï¤æ–°ï¼Œå®éªŒè¡¨æ˜å¯¹ A å’Œ B
ä½¿ç”¨ç›¸åŒçš„å­¦ä¹ ç‡å¹¶ï¥§èƒ½å®ç°æœ‰æ•ˆçš„ç‰¹å¾å­¦ä¹ ï¼ŒLoRA+ é€šè¿‡ç²¾å¿ƒé€‰æ‹©çš„å›ºå®šæ¯”ç‡ä¸º
LoRA é€‚é…å™¨çŸ©é˜µ A å’Œ B è®¾ç½®ï¥§åŒçš„å­¦ä¹ ç‡ï¼Œçº æ­£ LoRA çš„è¿™ç§æ¬¡ä¼˜æ€§ã€‚</p>
<style>.iicejhkmmbrj{zoom: 67%;}</style>
<img data-src="/LLM-PEFT/image-20240725102452954.png" class="iicejhkmmbrj" alt="image-20240725102452954">
<h2 id="longlora">LongLoRA</h2>
<p>LongLoRA
æ‰©å±•äº†æ¨¡å‹çš„ä¸Šä¸‹æ–‡ï¼ŒåŒæ—¶ä¿ç•™äº†å…¶åŸå§‹æ¶æ„ï¼Œå¹¶ä¸”ä¸å¤§å¤šæ•°ç°æœ‰æŠ€æœ¯å…¼å®¹ã€‚ä¸€æ–¹é¢ï¼Œè™½ç„¶æ¨ç†è¿‡ç¨‹ä¸­éœ€è¦å¯†é›†çš„å…¨å±€æ³¨æ„åŠ›ï¼Œä½†å¾®è°ƒè¿‡ç¨‹æ›´éœ€è¦ç¨€ç–çš„å±€éƒ¨æ³¨æ„åŠ›å®ç°æœ‰æ•ˆä¸”é«˜æ•ˆåå‘ä¼ æ’­ã€‚ç”±æ­¤ï¼Œè¯¥æ–¹æ³•æå‡ºè½¬ç§»ç¨€ç–æ³¨æ„åŠ›</p>
<p><span class="math display">\[S^2-Attn\]</span></p>
<p>æœ‰æ•ˆåœ°å®ç°äº†ä¸Šä¸‹æ–‡æ‰©å±•ã€‚å¦ä¸€æ–¹é¢ï¼Œé™¤äº†åœ¨çº¿æ€§å±‚ä¸­è®­ç»ƒ LoRA
æƒé‡ä¹‹å¤–ï¼ŒLongLoRA
è¿˜è¿›ä¸€æ­¥ä½¿åµŒå…¥å±‚å’Œå½’ä¸€åŒ–å±‚å˜å¾—å¯è®­ç»ƒï¼Œç”±æ­¤å¯ä»¥è¡¨ç°å‡ºè¾ƒå¥½çš„æ€§èƒ½ã€‚ä»å®ç°ä¸Šæ¥çœ‹ï¼Œè¯¥æ–¹æ³•åœ¨è®­ç»ƒä¸­åªéœ€ä¸¤è¡Œä»£ç å³å¯å®ç°ï¼Œä¸”åœ¨æ¨ç†ä¸­æ˜¯å¯é€‰çš„ï¼Œä¸ä¼šå ç”¨é¢å¤–è®¡ç®—èµ„æºã€‚</p>
<img data-src="/LLM-PEFT/image-20240725143254778.png" class="" title="image-20240725143254778">
<h2 id="rslora">RsLoRA</h2>
<p>LoRAé€šè¿‡åœ¨é€‰å®šå±‚æ·»åŠ å¯è®­ç»ƒçš„ä½ç§©Adapteræ¥å®ç°å‚æ•°æœ‰æ•ˆçš„å¾®è°ƒã€‚æ¯ä¸ªLoRAç”±ä¸¤ä¸ªä½ç§©çŸ©é˜µä¹˜ç§¯ç»„æˆï¼Œå¹¶ä¹˜ä»¥ä¸€ä¸ªä¸ç§©ç›¸å…³çš„å› å­ï¼Œä¼ ç»Ÿçš„LoRAé‡‡ç”¨â€œç›´æ¥é™¤ä»¥ç§©çš„å› å­â€çš„æ–¹æ³•è¿‡äºæ¿€è¿›ï¼Œå¯¼è‡´é«˜ç§©Adapterçš„å­¦ä¹ é€Ÿåº¦å‡ç¼“ï¼Œæ€§èƒ½å—é™ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒLoRAé€šå¸¸ä»…é™äºä½¿ç”¨éå¸¸ä½çš„ç§©ã€‚</p>
<p>rsLoRAæ·±å…¥ç ”ç©¶äº† LoRA çš„ç¼©æ”¾å› å­å¯¹å­¦ä¹ è¿‡ç¨‹çš„å½±å“ï¼Œå¹¶è¯æ˜äº† LoRA
åº”è¯¥é™¤ä»¥ç§©çš„å¹³æ–¹æ ¹è€Œä¸æ˜¯ç§©ï¼Œé€šè¿‡ä½¿ç”¨è¾ƒå¤§çš„ç§©åœ¨è®­ç»ƒæœŸé—´å¢åŠ è®¡ç®—èµ„æºä»¥è·å¾—æ›´å¥½çš„å¾®è°ƒæ€§èƒ½ï¼ŒåŒæ—¶ä¸æ”¹å˜æ¨ç†è®¡ç®—æˆæœ¬ã€‚</p>
<style>.dieuvgncfvfc{zoom:67%;}</style>
<img data-src="/LLM-PEFT/image-20240903102620304.png" class="dieuvgncfvfc" alt="image-20240903102620304">
<h2 id="llama-pro">LLaMA Pro</h2>
<p>è¯¥æ–¹æ³•æå‡ºçš„Block
Expansionæ–¹æ³•ï¼Œå³å—æ‰©å±•ï¼Œåœ¨ä¿æŒé¢„è®­ç»ƒæ¨¡å‹å‚æ•°ä¸å˜çš„åŸºç¡€ä¸Šï¼Œå¢åŠ æ–°çš„blockæ¥é€‚åº”æ–°çš„è®­ç»ƒä»»åŠ¡ã€‚è¿™äº›æ–°åŠ å…¥çš„blockä¸åŸæœ‰blockååŒå·¥ä½œï¼Œæ—¢ä¿ç•™äº†æ¨¡å‹åŸæœ‰çš„çŸ¥è¯†ï¼Œåˆèƒ½å¤Ÿé€‚åº”æ–°çš„è®­ç»ƒæ•°æ®å’Œä»»åŠ¡éœ€æ±‚ã€‚</p>
<style>.vgkgxpodvaur{zoom:50%;}</style>
<img data-src="/LLM-PEFT/image-20240729142017433.png" class="vgkgxpodvaur" alt="image-20240729142017433">
<h2 id="æ–¹æ³•æ€§èƒ½å¯¹æ¯”">æ–¹æ³•æ€§èƒ½å¯¹æ¯”</h2>
<p>ä»æ–¹æ³•ç±»å‹ã€æ˜¯å¦å­˜å‚¨é«˜æ•ˆã€æ˜¯å¦å†…å­˜é«˜æ•ˆã€åå‘ä¼ æ’­æˆæœ¬ã€æ¨ç†å¼€é”€äº”ä¸ªç»´åº¦æ¯”è¾ƒ
PEFT æ–¹æ³•ï¼š</p>
<img data-src="/LLM-PEFT/image-20240714150443014.png" class="" title="image-20240714150443014">
<p>å„ç§å‚æ•°é«˜æ•ˆæ–¹æ³•çš„å‚ä¸è®­ç»ƒçš„å‚æ•°é‡ã€æœ€ç»ˆæ¨¡å‹ä¸åŸå§‹æ¨¡å‹çš„æ”¹å˜å‚æ•°ï¼ˆdeltaå€¼ï¼‰ä»¥åŠè®ºæ–‡ä¸­å‚ä¸è¯„ä¼°çš„æ¨¡å‹çš„èŒƒå›´ï¼š</p>
<img data-src="/LLM-PEFT/image-20240714150638355.png" class="" title="image-20240714150638355">
<p>PEFT
æ–¹æ³•åœ¨ä½•ç§æ¨¡å‹å¤§å°ä¸Šè¿›è¡Œè¿‡è¯„ä¼°ï¼Œä»¥åŠåœ¨è®ºæ–‡ä¸­é€šå¸¸ä½¿ç”¨çš„å¯è®­ç»ƒå‚æ•°æ•°é‡ã€‚æˆ‘ä»¬æ‰€è¯´çš„å¯è®­ç»ƒå‚æ•°æ•°é‡æ˜¯æŒ‡ç”±æ¢¯åº¦ä¼˜åŒ–ç®—æ³•æ›´æ–°çš„å‚æ•°æ•°é‡ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ç”¨â€œæ›´æ”¹å‚æ•°â€è¡¨ç¤ºçš„åŸå§‹æ¨¡å‹ä¸æœ€ç»ˆæ¨¡å‹ä¹‹é—´çš„å·®å¼‚ã€‚å¯¹äºé‡å‚æ•°åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬æŠ¥å‘Šäº†é‡å‚æ•°åŒ–å‰åçš„å‚æ•°æ•°é‡ã€‚ç”±äºS4æ¨¡å‹åœ¨ä¸åŒå±‚ä½¿ç”¨äº†ä¸åŒçš„æ–¹æ³•ï¼Œå› æ­¤ä¼°ç®—å…¶æ›´æ–°åçš„å‚æ•°æ•°é‡æ¯”è¾ƒå¤æ‚ã€‚æˆ‘ä»¬æŠ¥å‘Šäº†åœ¨å·²å‘è¡¨çš„æ–‡çŒ®ä¸­å¯¹è¿™äº›æ–¹æ³•è¿›è¡Œè¯„ä¼°çš„èŒƒå›´ã€‚</p>
<p>è¿‘å¹´æ¥ï¼ŒåŸºäºTransformeræ¶æ„çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œåœ¨ä¼—å¤šè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡è¾¾åˆ°äº†æœ€ä½³æ€§èƒ½è¡¨ç°ã€‚ç›®å‰ï¼Œæ„å»ºé¢†åŸŸä¸“ç”¨LLMçš„ä¸»æµç­–ç•¥æ˜¯ï¼šåœ¨æµ·é‡é€šç”¨æ•°æ®é›†ä¸Šé¢„è®­ç»ƒçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆPLMï¼‰ï¼Œå¹¶é€šè¿‡é’ˆå¯¹ç‰¹å®šä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒï¼ˆFine-tuningï¼‰ã€‚ç›¸è¾ƒäºç›´æ¥é‡‡ç”¨PLMï¼Œé’ˆå¯¹ä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒèƒ½æ˜¾è‘—æå‡æ¨¡å‹æ€§èƒ½ã€‚ç„¶è€Œï¼Œéšç€LLMå‚æ•°è§„æ¨¡æ€¥å‰§å¢é•¿ï¼Œåœ¨æ¶ˆè´¹çº§ç¡¬ä»¶ä¸Šè¿›è¡Œå¾®è°ƒå˜å¾—ä¸åˆ‡å®é™…ã€‚</p>
<p>ä¸ºåº”å¯¹æ­¤æŒ‘æˆ˜ï¼Œç ”ç©¶è€…ä»¬è¿‘å¹´æ¥æå‡ºäº†å‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯ï¼ˆParameter-Efficient
Fine-Tuning,
PEFTï¼‰ï¼Œå…¶æ ¸å¿ƒæ€æƒ³åœ¨äºå›ºå®šPLMçš„å¤§éƒ¨åˆ†å‚æ•°ï¼Œä»…è°ƒæ•´ä¸€å°éƒ¨åˆ†å…³é”®å‚æ•°æˆ–å¼•å…¥é¢å¤–å‚æ•°ï¼Œä»¥æ¥è¿‘ç›´æ¥å¾®è°ƒPLMçš„æ•ˆæœã€‚è¿™ç§æ–¹æ³•ä¸ä»…ä¿ç•™äº†PLMçš„å¹¿æ³›çŸ¥è¯†åº“ï¼Œè¿˜æ˜¾è‘—é™ä½äº†è®¡ç®—ä¸å­˜å‚¨éœ€æ±‚ï¼Œä¸ºåœ¨èµ„æºå—é™ç¯å¢ƒä¸‹é«˜æ•ˆå¾®è°ƒLLMå¼€è¾Ÿäº†æ–°è·¯å¾„ã€‚</p>
<h1 id="é«˜æ•ˆé‡åŒ–">é«˜æ•ˆé‡åŒ–</h1>
<h2 id="qlora">QLoRA</h2>
<p>åˆ›æ–°ç‚¹ï¼š</p>
<ul>
<li>4ä½NormalFloatï¼ˆNF4ï¼‰ï¼šè¿™æ˜¯ä¸€ç§é’ˆå¯¹æ­£æ€åˆ†å¸ƒæƒé‡è®¾è®¡çš„ä¿¡æ¯ç†è®ºä¸Šæœ€ä¼˜çš„é‡åŒ–æ•°æ®ç±»å‹ã€‚ç›¸è¾ƒäºä¼ ç»Ÿçš„4ä½æ•´æ•°å’Œ4ä½æµ®ç‚¹æ•°ï¼ŒNF4ä¸ºæ­£æ€åˆ†å¸ƒæ•°æ®æä¾›äº†æ›´ä¼˜å¼‚çš„å®è¯æ€§èƒ½ã€‚</li>
<li>åŒé‡é‡åŒ–ï¼šQLoraå¼•å…¥äº†å¯¹é‡åŒ–å¸¸æ•°çš„äºŒæ¬¡é‡åŒ–ï¼Œè¿›ä¸€æ­¥å‡å°äº†ç¼“å­˜å ç”¨ã€‚è¿™ç§åŒé‡é‡åŒ–æœºåˆ¶åŒ…å«å¯¹æ™®é€šå‚æ•°çš„ä¸€æ¬¡é‡åŒ–å’Œå¯¹é‡åŒ–å¸¸æ•°çš„å†é‡åŒ–ï¼Œä»è€Œåœ¨ä¸ç‰ºç‰²ç²¾åº¦çš„å‰æä¸‹è¿›ä¸€æ­¥å‹ç¼©æ¨¡å‹ã€‚</li>
<li>åˆ†é¡µä¼˜åŒ–å™¨ï¼šè¿™æ˜¯ä¸€ç§æ™ºèƒ½çš„å†…å­˜ç®¡ç†æŠ€æœ¯ï¼Œå½“GPUå†…å­˜ä¸è¶³æ—¶ï¼Œå®ƒå¯ä»¥å°†éƒ¨åˆ†æ•°æ®ç§»åˆ°ç³»ç»Ÿå†…å­˜ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è°ƒå›GPUå†…å­˜ã€‚è¿™æœ‰åŠ©äºå¤„ç†é•¿åºåˆ—æˆ–å¤§æ‰¹é‡æ•°æ®æ—¶çš„å†…å­˜å³°å€¼é—®é¢˜ã€‚</li>
</ul>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æå‡ºäº†é«˜æ•ˆä¸”æœ‰æ•ˆçš„é‡åŒ–æŠ€æœ¯ï¼Œä½¿åœ¨å•ä¸ªGPUä¸Šå¾®è°ƒè¶…å¤§å‹å‚æ•°æ¨¡å‹æˆä¸ºå¯èƒ½ï¼›</li>
</ul>
<h2 id="loftq">LoftQ</h2>
<p>è¯¥æ–¹æ³•ä¸€ç§æ–°çš„é‡åŒ–æ¡†æ¶ï¼Œåœ¨å¯¹ LLM è¿›è¡Œé‡åŒ–çš„åŒæ—¶ï¼Œä¸º LoRA
å¾®è°ƒæ‰¾åˆ°åˆé€‚çš„ä½ç§©åˆå§‹åŒ–ã€‚è¿™ç§åˆå§‹åŒ–å‡è½»äº†é‡åŒ–æ¨¡å‹å’Œå…¨ç²¾åº¦æ¨¡å‹ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶æ˜¾ç€æé«˜äº†ä¸‹æ¸¸ä»»åŠ¡çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<h2 id="gptq">GPTQ</h2>
<h2 id="awq">AWQ</h2>
<p>GGUF</p>
<h1 id="å¾®è°ƒæ–¹æ³•é€‚é…">å¾®è°ƒæ–¹æ³•é€‚é…</h1>
<blockquote>
<p>å¦‚ä½•å°†å¾®è°ƒæ¨¡å‹åº”ç”¨åœ¨ è‡ªå®šä¹‰/æœªè¢«å®˜æ–¹é€‚é… çš„å¤§æ¨¡å‹ä¸Š</p>
</blockquote>
<p>é€šè¿‡ <code>target_modules</code> å’Œ <code>modules_to_save</code>
å®ç°è‡ªå®šä¹‰å¯è®­ç»ƒå‚æ•°å’Œæ¨¡å—</p>
<p>Merge Peft Modelï¼šå°†é¢„è®­ç»ƒå¥½çš„ Lora æˆ– IA3
çš„æ¨¡å‹å‚æ•°èå…¥é¢„è®­ç»ƒæ¨¡å‹ä¸­ï¼Œå®ç°ä¸ä¿®æ”¹åŸæ¨¡å‹çš„ç»“æ„å’Œå‚æ•°é‡</p>
]]></content>
      <categories>
        <category>LLM</category>
      </categories>
      <tags>
        <tag>LLMå¾®è°ƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œ</title>
    <url>/Network/</url>
    <content><![CDATA[<h1 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h1>
<p>OSI
ä¸ƒå±‚æ¨¡å‹ï¼šåº”ç”¨å±‚ã€è¡¨ç¤ºå±‚ã€ä¼šè¯å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç½—å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç‰©ç†å±‚</p>
<p>TCP/IP å››å±‚æ¨¡å‹ï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€ç½‘ç»œæ¥å£å±‚</p>
<ul>
<li><p>åº”ç”¨å±‚ï¼Œç›´æ¥æœåŠ¡äºç”¨æˆ·ã€‚å”¯ä¸€è¿è¡Œåœ¨ç”¨æˆ·æ€çš„å±‚ï¼šHTTPã€FTPã€Telnetã€DNSã€SMTPã€DHCP</p></li>
<li><p>ä¼ è¾“å±‚ï¼Œåº”ç”¨å±‚çš„æŠ€æœ¯æ”¯æŒã€‚åº”ç”¨å±‚æ•°æ®è¶…è¿‡ MSS ä¼šå°†å…¶åˆ‡åˆ†æˆ TCP
æ®µï¼Œä¼ è¾“å±‚æŠ¥æ–‡ä¸­åŒ…æ‹¬äº†ç«¯å£å·ï¼Œç”¨äºåŒºåˆ†æŠ¥æ–‡å±äºå“ªä¸ªåº”ç”¨ï¼šTCPã€UDP</p></li>
<li><p>ç½‘ç»œå±‚ï¼Œè´Ÿè´£æ•°æ®åœ¨ç½‘ç»œä¸­çš„ä¼ è¾“ï¼Œå³å¯»å€å’Œè·¯ç”±ã€‚è¶…è¿‡ MTU
ä¼šåˆ‡åˆ†ï¼ŒIPåœ°å€ä»£è¡¨ç½‘ç»œå·å’Œä¸»æœºå·ï¼šIPã€ARPã€ICMP</p></li>
<li><p>ä¼ è¾“å±‚ï¼Œå…³æ³¨é“¾è·¯çº§åˆ«çš„ä¼ è¾“</p></li>
</ul>
<p>åº”ç”¨æ•°æ®è½¬æ¢åˆ°ä¼ è¾“å—çš„è¿‡ç¨‹ï¼š</p>
<style>.kcypobmahgov{zoom: 50%;}</style>
<img data-src="/Network/12.jpg" class="kcypobmahgov" alt="img">
<h2 id="è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹">è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹</h2>
<style>.jzdhchjfbfgd{zoom: 67%;}</style>
<img data-src="/Network/image-20240730153032143.png" class="jzdhchjfbfgd" alt="image-20240730153032143">
<ol type="1">
<li>è§£æ URL</li>
<li>DNS æŸ¥è¯¢æœåŠ¡å™¨ IP
åœ°å€ï¼ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨-&gt;æ ¹åŸŸåæœåŠ¡å™¨-&gt;é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼‰</li>
<li>æ“ä½œç³»ç»Ÿåè®®æ ˆï¼ŒåŒ…æ‹¬ä¼ è¾“å±‚å’Œç½‘ç»œå±‚åè®®å®ç°</li>
<li>TCP å»ºç«‹è¿æ¥ï¼ˆSYN_SENDã€SYN_RECEã€ESTABLISHEDï¼‰</li>
<li>åŸºäºç«¯å£çš„ TCP å¯é ä¼ è¾“</li>
<li>åŸºäºåœ°å€çš„ IP å®šä½ä¼ è¾“</li>
<li>å¤´éƒ¨åŠ ä¸Šå‘é€å’Œæ¥æ”¶æ–¹çš„ MAC å¤´éƒ¨ï¼ŒARP æŸ¥æ‰¾æ¥æ”¶ç«¯çš„ MAC</li>
<li>ç½‘å¡ï¼Œå¸§æ ¡éªŒç¬¦</li>
<li>äº¤æ¢æœºï¼Œä»¥å¤ªç½‘è®¾å¤‡ï¼ŒåŸºäº MAC åœ°å€è¡¨è½¬å‘ï¼Œæ²¡æœ‰ç¼“å­˜å°±å¹¿æ’­</li>
<li>è·¯ç”±å™¨ï¼Œå’Œç½‘å¡ç±»ä¼¼ï¼Œå„ä¸ªç«¯å£éƒ½å…·æœ‰ MAC å’Œ
IPã€‚é€šè¿‡è·¯ç”±è¡¨ç¡®å®šè¦åˆ°ç›®çš„åœ° IP éœ€è¦èµ°å“ªä¸ªç«¯å£ï¼Œå¹¶æ›¿æ¢å¸§çš„æºã€ç›®æ ‡
MAC</li>
</ol>
<p>åœ¨ç½‘ç»œåŒ…ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œæº IP å’Œç›®æ ‡ IP å§‹ç»ˆæ˜¯ä¸ä¼šå˜çš„ï¼ˆå‰æï¼šæ²¡æœ‰ä½¿ç”¨
NAT ç½‘ç»œçš„ï¼‰ï¼Œä¸€ç›´å˜åŒ–çš„æ˜¯ MAC åœ°å€ï¼Œå› ä¸ºéœ€è¦ MAC
åœ°å€åœ¨ä»¥å¤ªç½‘å†…è¿›è¡Œä¸¤ä¸ªè®¾å¤‡ä¹‹é—´çš„åŒ…ä¼ è¾“</p>
<p>æ ¡éªŒè¿‡ç¨‹ï¼šMAC åœ°å€ã€IP åœ°å€ã€åºåˆ—å·ã€ç«¯å£</p>
<ol start="11" type="1">
<li>TCP å››æ¬¡æŒ¥æ‰‹ï¼ˆFIN_WAIT_1ã€FIN_RECEã€FIN_WAIR_2ã€LAST_ACKï¼‰</li>
</ol>
<h2 id="linux-å®ç°æ•°æ®åŒ…æ”¶å‘">Linux å®ç°æ•°æ®åŒ…æ”¶å‘</h2>
<p><strong>å‘é€</strong></p>
<p>NAPI
æœºåˆ¶ï¼šä¸é‡‡ç”¨ä¸­æ–­çš„æ–¹å¼è¯»å–æ•°æ®ï¼Œè€Œæ˜¯é¦–å…ˆé‡‡ç”¨ä¸­æ–­å”¤é†’æ•°æ®æ¥æ”¶çš„æœåŠ¡ç¨‹åºï¼Œç„¶å
poll çš„æ–¹æ³•æ¥è½®è¯¢æ•°æ®</p>
<p>DMA æŠ€æœ¯ï¼šå°†ç½‘ç»œåŒ…å†™å…¥åˆ°æŒ‡å®šçš„å†…å­˜åœ°å€ï¼Œæ¥ç€ç½‘å¡å‘ CPU
å‘èµ·ç¡¬ä»¶ä¸­æ–­ï¼Œå½“ CPU
æ”¶åˆ°ç¡¬ä»¶ä¸­æ–­è¯·æ±‚åï¼Œæ ¹æ®ä¸­æ–­è¡¨ï¼Œè°ƒç”¨å·²ç»æ³¨å†Œçš„ä¸­æ–­å¤„ç†å‡½æ•°</p>
<p>ç¡¬ä¸­æ–­å…ˆæŠŠæ”¶åˆ°çš„æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œæš‚æ—¶å±è”½ CPU
ä¸­æ–­ï¼Œåç»­è½¯ä¸­æ–­ç»Ÿä¸€å¤„ç†å…ˆå‰çš„æ•°æ®</p>
<p><strong>æ¥æ”¶</strong></p>
<ol type="1">
<li>å°†ç”¨æˆ·å¾…å‘é€çš„æ•°æ®ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ sk_buff
å†…å­˜ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°å‘é€ç¼“å†²åŒºï¼›</li>
<li>å…‹éš†ä¸€ä»½ sk_buff çš„å‰¯æœ¬ï¼Œç”¨äºç½‘ç»œå±‚ä¼ è¾“ï¼Œä¼ è¾“å±‚ä¿ç•™åŸå§‹ sk_buff
ç›´åˆ°æ¥æ”¶åˆ° ACKï¼Œä»¥ä¿è¯å¯é ä¼ è¾“ï¼›</li>
<li>å½“ IP å±‚å‘ç°æ•°æ®åŒ…å¤§äº MTU æ—¶ï¼Œä¼šç”³è¯·é¢å¤–çš„
sk_buffï¼Œå¹¶å°†åŸæ¥çš„æ•°æ®åŒ…æ‹†åˆ†æˆå¤šä¸ªå°çš„ sk_buffï¼›</li>
</ol>
<h1 id="åº”ç”¨å±‚-http">åº”ç”¨å±‚ HTTP</h1>
<blockquote>
<p>HTTP
æ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸–ç•Œé‡Œä¸“é—¨åœ¨ã€Œä¸¤ç‚¹ã€ä¹‹é—´ã€Œä¼ è¾“ã€æ–‡å­—ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ã€Œè¶…æ–‡æœ¬ã€æ•°æ®çš„ã€Œçº¦å®šå’Œè§„èŒƒã€</p>
</blockquote>
<p>å¸¸ç”¨å­—æ®µ</p>
<p><strong>Content-Length</strong>ï¼šHTTP åè®®é€šè¿‡è®¾ç½®å›è½¦ç¬¦ã€æ¢è¡Œç¬¦ä½œä¸º
HTTP header çš„è¾¹ç•Œï¼Œé€šè¿‡ Content-Length å­—æ®µä½œä¸º HTTP body
çš„è¾¹ç•Œï¼Œè¿™ä¸¤ä¸ªæ–¹å¼éƒ½æ˜¯ä¸ºäº†è§£å†³â€œç²˜åŒ…â€çš„é—®é¢˜ã€‚</p>
<p>HTTP/1.1 ä¼˜åŒ–</p>
<ul>
<li>é•¿è¿æ¥ï¼Œå¤ç”¨ TCP è¿æ¥</li>
<li>ç¼“å­˜ï¼šå¼ºåˆ¶ç¼“å­˜å’Œåå•†ç¼“å­˜</li>
<li>å‹ç¼©</li>
<li>ç®¡é“ä¼ è¾“</li>
<li>çµæ´»ã€æ˜“äºæ‰©å±•</li>
</ul>
<p>HTTP/2 ä¼˜åŒ–</p>
<ul>
<li>å¤´éƒ¨å‹ç¼©</li>
<li>å¹¶å‘ä¼ è¾“</li>
<li>æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€</li>
<li>äºŒè¿›åˆ¶å¸§æ ¼å¼ä¼ è¾“</li>
</ul>
<p>HTTP/3 ä¼˜åŒ–</p>
<ul>
<li>æå‡ºäº† QUIC ä¼ è¾“å±‚åè®®ä»£æ›¿
tcpã€‚quicæ˜¯åŸºäºudpå®ç°çš„ï¼Œåœ¨æ— è¿æ¥çš„åŸºç¡€ä¸Šå®ç°äº†å¯é å’Œå®‰å…¨
<ul>
<li>æ›´å¿«çš„è¯·æ±‚å¤šè·¯å¤ç”¨</li>
<li>é¿å…é˜Ÿå¤´é˜»å¡</li>
<li>æ›´å¿«çš„å»ºç«‹è¿æ¥</li>
</ul></li>
</ul>
<p>HTTPS</p>
<ul>
<li>åŠ å¯†ä¼ è¾“ï¼šåœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´åŠ äº† SSL/TLS å®‰å…¨åè®®ï¼›å»ºç«‹è¿æ¥æ—¶éœ€è¦
SSL/TLS çš„æ¡æ‰‹è¿‡ç¨‹ï¼›ä½¿ç”¨æ—¶éœ€è¦å‘ CA ç”³è¯·æ•°å­—è¯ä¹¦</li>
<li>æ‘˜è¦ç®—æ³• + æ•°å­—ç­¾å
<ul>
<li>æ··åˆåŠ å¯†ï¼šå»ºç«‹è¿æ¥ç”¨éå¯¹ç§°åŠ å¯†ï¼šå…¬é’¥å’Œç§é’¥ï¼›ä¼ è¾“æ•°æ®ç”¨å¯¹ç§°åŠ å¯†ï¼šä¸€ä¸ªå¯†é’¥</li>
<li>æ‘˜è¦ç®—æ³•ï¼šç”¨æ‘˜è¦ç®—æ³•ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰æ¥è®¡ç®—å‡ºå†…å®¹çš„å“ˆå¸Œå€¼ï¼Œå“ˆå¸Œå€¼æ˜¯å”¯ä¸€çš„ï¼Œä¸”æ— æ³•é€šè¿‡å“ˆå¸Œå€¼æ¨å¯¼å‡ºå†…å®¹</li>
<li>æ•°å­—ç­¾åï¼šé€šè¿‡ã€Œç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ã€çš„æ–¹å¼ï¼Œæ¥ç¡®è®¤æ¶ˆæ¯çš„èº«ä»½</li>
<li>æ•°å­—è¯ä¹¦ï¼šé€šè¿‡ç¬¬ä¸‰æ–¹ CA ä¿è¯æœåŠ¡å™¨çš„å…¬é’¥ç§é’¥æ²¡æœ‰è¢«åˆ«äººæ›¿æ¢è¿‡</li>
</ul></li>
<li>å»ºç«‹è¿æ¥ï¼šRSAç®—æ³•
<ul>
<li>ClientHelloï¼šå®¢æˆ·ç«¯ç”Ÿäº§éšæœºæ•° Client Random</li>
<li>SeverHelloï¼šæœåŠ¡ç«¯ç”Ÿäº§éšæœºæ•° Server Randomã€æ•°å­—è¯ä¹¦</li>
<li>å®¢æˆ·ç«¯å›åº”ï¼šè·å–è¯ä¹¦ä¸­çš„æœåŠ¡å™¨å…¬é’¥ã€åŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ã€å…¬é’¥åŠ å¯†éšæœºæ•°
pre-master key</li>
<li>ä¸‰ä¸ªéšæœºæ•°ç®—å‡º<strong>ä¼šè¯å¯†é’¥</strong>ï¼ŒåŒæ–¹éƒ½é€šçŸ¥å¯¹æ–¹åç»­è¯·æ±‚éƒ½ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†é€šä¿¡</li>
</ul></li>
</ul>
<h1 id="ä¼ è¾“å±‚-tcp">ä¼ è¾“å±‚ TCP</h1>
<blockquote>
<p>è´Ÿè´£ä¸ºåº”ç”¨å±‚æä¾›ç½‘ç»œæ”¯æŒï¼Œå®ç°åº”ç”¨åˆ°åº”ç”¨çš„æ•°æ®ä¼ è¾“</p>
</blockquote>
<p>TCP ï¼šé¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„</p>
<p>ä¸‰æ¬¡æ¡æ‰‹</p>
<style>.tygbrwnekklx{zoom:50%;}</style>
<img data-src="/Network/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.drawio.png" class="tygbrwnekklx" alt="TCP ä¸‰æ¬¡æ¡æ‰‹">
<p>å››æ¬¡æŒ¥æ‰‹ã€closed_waitï¼›last_ackã€‘</p>
<style>.zhsxwlfdlejs{zoom: 67%;}</style>
<img data-src="/Network/format,png-20230309230614791.png" class="zhsxwlfdlejs" alt="å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­è¿æ¥ â€”â€” TCP å››æ¬¡æŒ¥æ‰‹">
<ul>
<li>é¦–å…ˆç¡®è®¤å®¢æˆ·ç«¯ä¸ä¼šå†å‘é€è¯·æ±‚ç»™æœåŠ¡ç«¯</li>
<li>ç„¶åæœåŠ¡ç«¯åœ¨å‘é€å®Œæ•°æ®åï¼Œå†å‘å®¢æˆ·ç«¯å‘é€æ–­å¼€è¿æ¥</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Ÿå› ä¸ºTCPæ˜¯åŒå‘é€šä¿¡çš„å¯é çš„åè®®ï¼Œéœ€è¦ç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æœ‰æ”¶å‘æ•°æ®åŒ…çš„èƒ½åŠ›ï¼›ä¸ºåç»­ä¼ è¾“åšå‡†å¤‡ï¼šåºåˆ—å·</p>
<p>æµé‡æ§åˆ¶ã€è¶…æ—¶é‡ä¼ ã€æ‹¥å¡æ§åˆ¶</p>
<p><a
href="https://blog.csdn.net/dl962454/article/details/115796513">æ‹¥å¡æ§åˆ¶</a>ï¼šæ…¢å¼€å§‹ï¼ˆæ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼Œæ‹¥å¡çª—å£
cwnd å°±åŠ å€ï¼‰ã€æ‹¥å¡é¿å…ï¼ˆæ…¢å¼€å§‹é—¨é™
ssthreshï¼‰ã€å¿«é‡ä¼ ï¼ˆè¿ç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤å°±ç«‹å³é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µï¼Œä¸ç­‰å¾…é‡ä¼ è®¡æ—¶å™¨åˆ°æœŸï¼‰ã€å¿«æ¢å¤</p>
<h1 id="ç½‘ç»œå±‚-ip">ç½‘ç»œå±‚ IP</h1>
<blockquote>
<p>è´Ÿè´£è·¯å¾„ä¼ è¾“è¿‡ç¨‹ä¸­è·¯å¾„å’ŒèŠ‚ç‚¹çš„é€‰æ‹©ï¼Œå®ç°è®¾å¤‡åˆ°è®¾å¤‡çš„æ•°æ®ä¼ è¾“</p>
</blockquote>
<p>å¯»å€èƒ½åŠ›ï¼šç½‘ç»œå·+ä¸»æœºå·ï¼ˆå­ç½‘æ©ç ï¼‰</p>
<p>è·¯ç”±ï¼šæ•°æ®åŒ…æ¯åˆ°è¾¾ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡è·¯ç”±ç®—æ³•å†³å®šä¸‹ä¸€æ­¥èµ°å“ªæ¡è·¯å¾„</p>
<p>åˆ†ç‰‡é‡ç»„ï¼šä»¥å¤ªç½‘çš„ MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰æ˜¯ 1500
å­—èŠ‚ã€‚åœ¨åˆ†ç‰‡ä¼ è¾“ä¸­ï¼Œä¸€æ—¦æŸä¸ªåˆ†ç‰‡ä¸¢å¤±ï¼Œåˆ™ä¼šé€ æˆ<strong>æ•´ä¸ª IP
æ•°æ®æŠ¥ä½œåºŸ</strong>ï¼Œæ‰€ä»¥ TCP å¼•å…¥äº† MSS ä¹Ÿå°±æ˜¯åœ¨ TCP å±‚è¿›è¡Œåˆ†ç‰‡ä¸ç”± IP
å±‚åˆ†ç‰‡ï¼Œé‚£ä¹ˆå¯¹äº UDP æˆ‘ä»¬å°½é‡ä¸è¦å‘é€ä¸€ä¸ªå¤§äº MTU çš„æ•°æ®æŠ¥æ–‡</p>
<p>ICMPï¼šè¯Šæ–­å’Œé€šçŸ¥å‡ºé”™</p>
<p>NATï¼šç½‘ç»œåœ°å€è½¬æ¢</p>
<p>DHCPï¼šåŠ¨æ€è·å– IP åœ°å€</p>
<p>ARPï¼šä¸‹ä¸€è·³çš„ MAC åœ°å€</p>
<p>DNSï¼šåŸŸåè§£æ</p>
<p>IGMPï¼šç»„æ’­</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿ</title>
    <url>/OS/</url>
    <content><![CDATA[<p>é‡ç‚¹ï¼šçº¿ç¨‹è¿›ç¨‹ã€æ­»é”</p>
<h1 id="å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç†</h1>
<h2 id="è™šæ‹Ÿå†…å­˜">è™šæ‹Ÿå†…å­˜</h2>
<p>CPU
åªä¼šè®¿é—®è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œåœ¨æ“ä½œæ€»çº¿å‰ï¼Œé€šè¿‡ä¸€ä¸ªåœ°å€è½¬æ¢ç¡¬ä»¶å°†è™šæ‹Ÿå†…å­˜åœ°å€è½¬æ¢ä¸ºç‰©ç†å†…å­˜åœ°å€</p>
<p>è¿›ç¨‹éš”ç¦»ï¼šå°†è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œè¿›ç¨‹ä¹‹é—´çš„åœ°å€ç©ºé—´ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°</p>
<p>è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼š</p>
<style>.qvbpiwiwqfvm{zoom:50%;}</style>
<img data-src="/OS/image-20240518105657086.png" class="qvbpiwiwqfvm" alt="image-20240518105657086">
<p>ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜¯ç›¸äº’éš”ç¦»ç›¸äº’ç‹¬ç«‹çš„ï¼›å†…æ ¸è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜¯å„ä¸ªè¿›ç¨‹å…±äº«çš„ï¼›</p>
<h1 id="è¿›ç¨‹ç®¡ç†">è¿›ç¨‹ç®¡ç†</h1>
<p>æ•°æ®ç»“æ„ PCB</p>
<p><strong>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</strong></p>
<p>çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½ã€‚</p>
<ul>
<li>è¿›ç¨‹æ˜¯èµ„æºï¼ˆåŒ…æ‹¬å†…å­˜ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰ï¼‰åˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯ CPU
è°ƒåº¦çš„æœ€å°å•ä½ï¼›</li>
<li>è¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„èµ„æºå¹³å°ï¼Œè€Œçº¿ç¨‹åªç‹¬äº«å¿…ä¸å¯å°‘çš„èµ„æºï¼Œå¦‚å¯„å­˜å™¨å’Œæ ˆï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«åœ°å€ç©ºé—´å’Œæ–‡ä»¶ç­‰èµ„æºï¼›</li>
<li>çº¿ç¨‹åŒæ ·å…·æœ‰å°±ç»ªã€é˜»å¡ã€æ‰§è¡Œä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼ŒåŒæ ·å…·æœ‰çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å…³ç³»ï¼›</li>
<li>çº¿ç¨‹èƒ½å‡å°‘å¹¶å‘æ‰§è¡Œçš„æ—¶é—´å’Œç©ºé—´å¼€é”€ï¼›</li>
</ul>
<h2 id="è¿›ç¨‹é—´é€šä¿¡æ–¹å¼">è¿›ç¨‹é—´é€šä¿¡æ–¹å¼</h2>
<p>åŒ¿åç®¡é“ / å‘½åç®¡é“</p>
<p>æ¶ˆæ¯é˜Ÿåˆ—</p>
<p>å…±äº«å†…å­˜+ä¿¡å·é‡</p>
<p>Socket</p>
<h2 id="ä¹è§‚é”æ‚²è§‚é”">ä¹è§‚é”æ‚²è§‚é”</h2>
<p>CAS æ˜¯ä¹è§‚é”æ²¡é”™ï¼Œä½†æ˜¯ CAS å’Œè‡ªæ—‹é”ä¸åŒä¹‹å¤„ï¼Œè‡ªæ—‹é”åŸºäº CAS åŠ äº†while
æˆ–è€…ç¡çœ  CPU
çš„æ“ä½œè€Œäº§ç”Ÿè‡ªæ—‹çš„æ•ˆæœï¼ŒåŠ é”å¤±è´¥ä¼šå¿™ç­‰å¾…ç›´åˆ°æ‹¿åˆ°é”ï¼Œè‡ªæ—‹é”æ˜¯è¦éœ€è¦äº‹å…ˆæ‹¿åˆ°é”æ‰èƒ½ä¿®æ”¹æ•°æ®çš„ï¼Œæ‰€ä»¥ç®—æ‚²è§‚é”ã€‚</p>
<h2 id="çº¿ç¨‹å´©æºƒ">çº¿ç¨‹å´©æºƒ</h2>
<p>1ã€å¦‚æœçº¿ç¨‹æ˜¯<strong>éæ³•è®¿é—®å†…å­˜</strong>å¼•èµ·çš„å´©æºƒï¼Œå…¶å¯¹åº”è¿›ç¨‹ä¸€å®šä¼šå´©æºƒã€‚</p>
<p>2ã€è¿›ç¨‹å´©æºƒçš„æœ¬è´¨æ˜¯ï¼šæ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹å‘å‡ºäº†ä¿¡å·ï¼Œä¾‹å¦‚éæ³•è®¿é—®å†…å­˜çš„ä¿¡å·æ˜¯
SIGSEGVï¼ˆåºå· 11ï¼‰</p>
<p>3ã€æƒ³è¦é˜²æ­¢è¿›ç¨‹å¥”æºƒï¼Œéœ€è¦è‡ªå®šä¹‰ä¿¡å·å¤„ç†å‡½æ•°å»æ‹¦æˆª SIGSEGV ä¿¡å·ã€‚å‚è€ƒ
JVM ä¸­çº¿ç¨‹å´©æºƒä½† JVM è¿›ç¨‹ä¸ä¼šå´©æºƒ</p>
<h1 id="ç½‘ç»œç³»ç»Ÿ">ç½‘ç»œç³»ç»Ÿ</h1>
<h2 id="io-å¤šè·¯å¤ç”¨">I/O å¤šè·¯å¤ç”¨</h2>
<p><strong>å•ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦</strong>ï¼Œå¦‚ç½‘ç»œè¿æ¥æˆ–æ–‡ä»¶å¥æŸ„ã€‚å½“è¿™äº›æè¿°ç¬¦ä¸­çš„ä»»ä½•ä¸€ä¸ªå°±ç»ªæ—¶ï¼Œæ¯”å¦‚æœ‰æ•°æ®å¯è¯»æˆ–å¯å†™ï¼Œå¤šè·¯å¤ç”¨æœºåˆ¶å°±èƒ½å¤Ÿé€šçŸ¥åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚å¸¸è§çš„IOå¤šè·¯å¤ç”¨æŠ€æœ¯åŒ…æ‹¬
selectã€poll å’Œ epoll ç­‰ã€‚</p>
<p>select</p>
<p>å°†å·²è¿æ¥çš„ Socket éƒ½æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œç„¶åè°ƒç”¨ select
å‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸é‡Œï¼Œè®©å†…æ ¸æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿï¼Œæ£€æŸ¥çš„æ–¹å¼å¾ˆç²—æš´ï¼Œå°±æ˜¯é€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆçš„æ–¹å¼ï¼Œå½“æ£€æŸ¥åˆ°æœ‰äº‹ä»¶äº§ç”Ÿåï¼Œå°†æ­¤
Socket æ ‡è®°ä¸ºå¯è¯»æˆ–å¯å†™ï¼Œ
æ¥ç€å†æŠŠæ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´å›ç”¨æˆ·æ€é‡Œï¼Œç„¶åç”¨æˆ·æ€è¿˜éœ€è¦å†é€šè¿‡éå†çš„æ–¹æ³•æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„
Socketï¼Œç„¶åå†å¯¹å…¶å¤„ç†ã€‚<strong>2
æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ï¼Œ<strong>2
æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ã€‚</p>
<p>poll</p>
<p>å®ƒä½¿ç”¨ä¸€ä¸ª pollfd
ç»“æ„æ¥è¡¨ç¤ºè¢«ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åŠå…¶äº‹ä»¶ï¼Œä¸selectç›¸æ¯”ï¼Œpollæ²¡æœ‰æ–‡ä»¶æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå› ä¸ºå®ƒåŸºäºé“¾è¡¨æ¥å­˜å‚¨ã€‚<strong>éƒ½æ˜¯ä½¿ç”¨ã€Œçº¿æ€§ç»“æ„ã€å­˜å‚¨è¿›ç¨‹å…³æ³¨çš„
Socket é›†åˆï¼Œå› æ­¤éƒ½éœ€è¦éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ¥æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„
Socketï¼Œæ—¶é—´å¤æ‚åº¦ä¸º
O(n)ï¼Œè€Œä¸”ä¹Ÿéœ€è¦åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ‹·è´æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong></p>
<p>epoll</p>
<img data-src="/OS/640.webp" class="" title="å›¾ç‰‡">
<ul>
<li>epoll
åªåœ¨åˆå§‹æ—¶å®Œæˆä¸€æ¬¡æ–‡ä»¶æè¿°ç¬¦çš„æ³¨å†Œï¼Œé¿å…äº†æ¯æ¬¡è°ƒç”¨æ—¶çš„æ‹·è´å¼€é”€ï¼›</li>
<li>å½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œä¼šè°ƒç”¨å›è°ƒå‡½æ•°å°† Socket
é›†åˆä¸€æ¬¡æ€§ä¼ é€’åˆ°å°±ç»ªäº‹ä»¶åˆ—è¡¨ä¸­ï¼Œå¹¶é€šçŸ¥ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä½¿å¾— epoll
åœ¨å¤„ç†å¤§é‡æ–‡ä»¶æè¿°ç¬¦æ—¶ä»ç„¶èƒ½ä¿æŒé«˜æ•ˆï¼›</li>
<li>å½“ç”¨æˆ·è°ƒç”¨ epoll_wait()
è¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œæ˜ç¡®æŒ‡å‡ºäº†å“ªäº›æ–‡ä»¶æè¿°ç¬¦æ˜¯å°±ç»ªçš„ï¼Œæ— éœ€åƒ
select å’Œ poll éå†æ‰€æœ‰ socket é›†åˆï¼›</li>
</ul>
<p><strong>è§¦å‘æ—¶æœº</strong></p>
<ul>
<li>è¾¹ç¼˜è§¦å‘ã€epollã€‘ï¼šåªæœ‰å½“æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ä»ä¸å°±ç»ªå˜ä¸ºå°±ç»ªæ—¶ï¼Œepoll
æ‰ä¼šå‘å‡ºé€šçŸ¥ï¼›ä¸€æ—¦é€šçŸ¥è¿‡åï¼Œé™¤éçŠ¶æ€å†æ¬¡å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™ä¸ä¼šå†æ¬¡é€šçŸ¥ï¼›</li>
<li>æ°´å¹³è§¦å‘ã€select/pollã€‘ï¼šåªè¦æ–‡ä»¶æè¿°ç¬¦å¤„äºå°±ç»ªçŠ¶æ€ï¼Œepollå°±ä¼šæŒç»­å‘å‡ºé€šçŸ¥ï¼Œç›´åˆ°æ•°æ®å¤„ç†å®Œæ¯•ï¼›</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>è®ºæ–‡é˜…è¯» RAFT</title>
    <url>/paper-PAFT/</url>
    <content><![CDATA[<p><a
href="https://gorilla.cs.berkeley.edu/blogs/9_raft.html">Paper</a></p>
<h1 id="åˆ›æ–°ç‚¹">åˆ›æ–°ç‚¹</h1>
<p>æå‡ºäº†æ–°é¢–çš„ç‰¹å®š RAG åœºæ™¯ä¸‹çš„å¤§æ¨¡å‹å¾®è°ƒæ–¹æ³•ï¼ˆæœ‰æ˜ç¡®æ–‡æ¡£åŸŸçš„
RAGï¼‰ï¼›</p>
<p>åŸºäº COTï¼Œè¿›ä¸€æ­¥å®Œå–„äº†æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ï¼›</p>
<h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>å½“å‰çš„å¼€æ”¾åŸŸå¯¹è¯æ¨¡å‹åšçš„æ˜¯â€é—­å·è€ƒè¯•â€œï¼›</p>
<p>RAG åšçš„æ˜¯â€å¼€å·è€ƒè¯•â€œï¼Œå…¶ç»“æœä¾èµ–äºæ£€ç´¢å™¨çš„æ•ˆæœï¼›</p>
<p>PAFT
åº”ç”¨äºâ€ç‰¹å®šé¢†åŸŸçš„å¼€å·è€ƒè¯•â€œï¼Œæ¨¡å‹å…ˆåœ¨ç‰¹å®šåŸŸæ–‡æ¡£å†…å­¦ä¹ å¦‚ä½•åšâ€å¼€å·è€ƒè¯•â€œï¼Œå¯ä»¥æé«˜æ¨¡å‹
RAG çš„èƒ½åŠ›ï¼Œè¿˜èƒ½å‡å°‘å¹»è§‰çš„äº§ç”Ÿï¼›</p>
<h1 id="å®éªŒ">å®éªŒ</h1>
<h2 id="æ–¹æ³•">æ–¹æ³•</h2>
<p>å‰ç½®æ¡ä»¶ï¼š<span class="math inline">\(\mathrm{Q}\)</span>é—®é¢˜ï¼› <span
class="math inline">\(\mathrm{A}^{*}\)</span> ç­”æ¡ˆï¼› <span
class="math inline">\(\mathrm{D}^{*}\)</span> ç­”æ¡ˆæ¥æºæ–‡æ¡£ï¼› <span
class="math inline">\(D_n\)</span> æ— å…³æ–‡æ¡£ã€‚</p>
<p>æ­£ä¾‹æ ·æœ¬ï¼š<span class="math inline">\(Q+ \mathrm{D^*}
+D_1+D_2+\dots+D_k=&gt;\mathrm{A}^{*}\)</span></p>
<p>è´Ÿä¾‹æ ·æœ¬ï¼š <span
class="math inline">\(\mathrm{Q}+\mathbf{D}_{1}+\mathbf{D}_{2}+\dots+\mathbf{D}_{\mathbf{k}}=&gt;\mathbf{A}^{\star}\)</span></p>
<p>è®ºæ–‡ä¸­åŸºäºæ•°æ®é›†åšå…¨é‡ SFT è®­ç»ƒ</p>
<h2 id="æ•°æ®é›†">æ•°æ®é›†</h2>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">Question: The Oberoi family is part of a hotel company that has a head office in what city?</span><br><span class="line"></span><br><span class="line">context: [The Oberoi family is an Indian family that is famous for its involvement in hotels, namely through The Oberoi Group]...[It is located in city center of Jakarta, near Mega Kuningan, adjacent to the sister JW Marriott Hotel. It is operated by The Ritz-Carlton Hotel Company. The complex has two towers that comprises a hotel and the Airlangga Apartment respectively]...[The Oberoi Group is a hotel company with its head office in Delhi.]</span><br><span class="line"></span><br><span class="line">Instruction: Given the question, context and answer above, provide a logical reasoning for that answer. Please use the format of: <span class="params">##</span>Reason: &#123;reason&#125; <span class="params">##</span>Answer: &#123;answer&#125;.</span><br><span class="line"></span><br><span class="line">CoT Answer: <span class="params">##</span>Reason: The document <span class="params">##</span>begin<span class="built_in">_</span>quote<span class="params">##</span> The Oberoi family is an Indian family that is famous for its involvement in hotels, namely through The Oberoi Group. <span class="params">##</span>end<span class="built_in">_</span>quote<span class="params">##</span> establishes that the Oberoi family is involved in the Oberoi group, and the document <span class="params">##</span>begin<span class="built_in">_</span>quote<span class="params">##</span> The Oberoi Group is a hotel company with its head office in Delhi. <span class="params">##</span>end<span class="built_in">_</span>quote<span class="params">##</span> establishes the head office of The Oberoi Group. Therefore, the Oberoi family is part of a hotel company whose head office is in Delhi. <span class="params">##</span>Answer: Delhi</span><br></pre></td></tr></table></figure>
<p>ä»æ•°æ®é›† <code>Answer</code>
ä¸­å¯ä»¥çœ‹å‡ºï¼Œæé—®è€…å¼•å¯¼æ¨¡å‹ä»¥æ€ç»´é“¾çš„æ–¹å¼å»å›ç­”é—®é¢˜ï¼Œå…ˆè¯´åŸå› 
<code>Reason</code> å†è¯´ç­”æ¡ˆ <code>Answer</code></p>
<p>æ–‡ä¸­é‡‡ç”¨ ##begin_quote## å’Œ ##end_quote##
è¡¨ç¤ºç›´æ¥ä»ä¸Šä¸‹æ–‡å¤åˆ¶ç²˜è´´çš„å¼•ç”¨ï¼Œç ”ç©¶äººå‘˜å‘ç°è¿™æ˜¯é˜²æ­¢æ¨¡å‹äº§ç”Ÿå¹»è§‰å¹¶åšæŒæä¾›çš„ä¸Šä¸‹æ–‡çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p>
<h2 id="å®éªŒç»“æœ">å®éªŒç»“æœ</h2>
<p>DFSï¼ˆDomain-Specific Finetuningï¼‰ï¼šç‰¹å®šé¢†åŸŸå†…å¾®è°ƒ</p>
<p>PAFTï¼šç‰¹å®šé¢†åŸŸå¾®è°ƒ+ç‰¹å®šé¢†åŸŸ RAG</p>
<img data-src="/paper-PAFT/image-20240815185100137.png" class="" title="image-20240815185100137">
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>å°†æ¨¡å‹åœ¨ç‰¹å®šé¢†åŸŸçš„æ–‡æ¡£ä¸Šåšæ€ç»´é“¾å¾®è°ƒ</p>
<ul>
<li>é€šè¿‡ç‰¹å®šé¢†åŸŸå¾®è°ƒï¼Œæ¨¡å‹å¯ä»¥å­¦ä¼šå¦‚ä½•åšâ€œå¼€å·è€ƒè¯•â€œï¼›</li>
<li>å½“é¢†åŸŸå†…æ•°æ®å‘ç”Ÿä¸€äº›å˜åŒ–æ—¶ï¼Œæ¨¡å‹ä¾ç„¶èƒ½æ‰¾åˆ°ç­”æ¡ˆï¼Œå³ä½¿æ²¡æœ‰æ­£ç¡®ç­”æ¡ˆä¹Ÿä¸ä¼šå‡ºç°å¹»è§‰ï¼›</li>
<li>å¯ä»¥è®¤ä¸ºï¼Œæ¨¡å‹éœ€è¦ä¸“ä¸šçš„å¾®è°ƒæ¥è®­ç»ƒå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„
RAGï¼ˆå¼€å·è€ƒè¯•ï¼‰èƒ½åŠ›ï¼›</li>
</ul>
]]></content>
      <categories>
        <category>paper</category>
      </categories>
      <tags>
        <tag>å¤§æ¨¡å‹å¾®è°ƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker</title>
    <url>/#2024/Docker/</url>
    <content><![CDATA[<img data-src="/" class="" title="img">
<ul>
<li><a href="https://www.runoob.com/docker/docker-compose.html">Docker
Compose</a>ï¼šç”¨äºå®šä¹‰å’Œè¿è¡Œ<strong>å¤šå®¹å™¨ Docker
åº”ç”¨ç¨‹åº</strong>çš„å·¥å…·ï¼Œä½¿å¤šä¸ªå®¹å™¨å¯ä»¥åœ¨éš”ç¦»ç¯å¢ƒä¸­ä¸€èµ·è¿è¡Œï¼›</li>
<li><a
href="https://www.runoob.com/docker/docker-dockerfile.html">Dockerfile</a>ï¼šç”¨æ¥æ„å»ºé•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€æ¡æ¡<strong>æ„å»ºé•œåƒ</strong>æ‰€éœ€çš„æŒ‡ä»¤å’Œè¯´æ˜ï¼›</li>
<li><a href="https://www.runoob.com/docker/docker-machine.html">Docker
Machine</a>ï¼šæ˜¯ä¸€ä¸ªç®€åŒ– Docker
å®‰è£…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå³å¯åœ¨ç›¸åº”çš„å¹³å°ä¸Šå®‰è£…Dockerï¼›å¯ä»¥é›†ä¸­<strong>ç®¡ç†</strong>æ‰€æœ‰çš„
docker ä¸»æœºï¼Œæ¯”å¦‚å¿«é€Ÿçš„ç»™ 100 å°æœåŠ¡å™¨å®‰è£…ä¸Š dockerï¼›</li>
</ul>
<h1 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h1>
<p>docker run &lt;IMAGE&gt; [COMMAND]
[ARG...]ã€åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‘</p>
<ul>
<li>[-d] åå°è¿è¡Œå®¹å™¨</li>
<li>[-p] æŒ‡å®šç«¯å£æ˜ å°„</li>
<li>[-v] æ˜ å°„ä¸»æœºæ–‡ä»¶å·</li>
<li>[--name &lt;NAME&gt;] å‘½åå®¹å™¨</li>
<li>[-e] è®¾ç½®ç¯å¢ƒå˜é‡</li>
</ul>
<p>docker ps [OPTIONS]ã€åˆ—å‡ºå®¹å™¨ã€‘</p>
<ul>
<li>[-a] æ˜¾ç¤ºæ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œçš„</li>
</ul>
<p>docker rm [OPTIONS] &lt;CONTAINER &gt;
ã€åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»åœæ­¢çš„å®¹å™¨ã€‘</p>
<ul>
<li>[-f] å¼ºåˆ¶åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨</li>
<li>[-v] åˆ é™¤å®¹å™¨æŒ‚è½½çš„å·</li>
</ul>
<p>docker build [OPTIONS] &lt;PATH&gt; ã€åˆ›å»ºé•œåƒã€‘</p>
<ul>
<li>[-f] æŒ‡å®šè¦ä½¿ç”¨çš„ Dockerfile è·¯å¾„</li>
<li>[--rm] è®¾ç½®é•œåƒæˆåŠŸååˆ é™¤ä¸­é—´å®¹å™¨</li>
</ul>
<p>docker save [OPTIONS] &lt;IMAGE&gt; ã€å°†æŒ‡å®šé•œåƒä¿å­˜æˆ tar
å½’æ¡£æ–‡ä»¶ã€‘</p>
<ul>
<li>[-o &lt;xxx.tar&gt;]</li>
</ul>
<p>docker load [OPTIONS] ã€å¯¼å…¥é•œåƒã€‘</p>
<ul>
<li>[-i &lt;xxx.tar&gt;] æŒ‡å®šå¯¼å…¥çš„æ–‡ä»¶</li>
</ul>
<p>docker top [OPTIONS] &lt;CONTAINER&gt;
ã€æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ï¼Œæ”¯æŒ ps å‘½ä»¤å‚æ•°ã€‘</p>
<h1 id="å®è·µ">å®è·µ</h1>
<h2 id="å¦‚ä½•å®¹å™¨åŒ–-java-åº”ç”¨">å¦‚ä½•å®¹å™¨åŒ– Java åº”ç”¨</h2>
<p>Docker Composeï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span>  </span><br><span class="line"><span class="attr">services:</span>  </span><br><span class="line">  <span class="attr">db:</span>  </span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span>  </span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span>  </span><br><span class="line">    <span class="attr">environment:</span>  </span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">example</span>  </span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">mydb</span>  </span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">myuser</span>  </span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">mypassword</span>  </span><br><span class="line">    <span class="attr">ports:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3608:3306&quot;</span>  <span class="comment"># å°†å®¿ä¸»æœºçš„ 3608 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 3306 ç«¯å£  </span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">java-app:</span>  </span><br><span class="line">    <span class="attr">build:</span>  </span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span>  <span class="comment"># å‡è®¾ Dockerfile åœ¨å½“å‰ç›®å½•ä¸‹  </span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span>  </span><br><span class="line">    <span class="attr">depends_on:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span>  </span><br><span class="line">    <span class="attr">environment:</span>  </span><br><span class="line">      <span class="attr">DB_HOST:</span> <span class="string">db</span>  <span class="comment"># Java ç¨‹åºå°†è¿æ¥åˆ°åä¸º &quot;db&quot; çš„æœåŠ¡ï¼ˆå³ MySQL å®¹å™¨ï¼‰  </span></span><br><span class="line">      <span class="attr">DB_PORT:</span> <span class="number">3306</span>  <span class="comment"># åœ¨å®¹å™¨å†…éƒ¨ï¼ŒMySQL ä»ç„¶ç›‘å¬ 3306 ç«¯å£  </span></span><br><span class="line">      <span class="attr">DB_USER:</span> <span class="string">myuser</span>  </span><br><span class="line">      <span class="attr">DB_PASSWORD:</span> <span class="string">mypassword</span>  </span><br><span class="line">      <span class="attr">DB_NAME:</span> <span class="string">mydb</span>  </span><br><span class="line">    <span class="attr">ports:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span>  <span class="comment"># å‡è®¾ Java ç¨‹åºç›‘å¬ 8080 ç«¯å£</span></span><br></pre></td></tr></table></figure>
<p>Dockerfileï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€é•œåƒJava 8</span></span><br><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å·¥ä½œç›®å½•</span></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æ–‡ä»¶åˆ°å·¥ä½œç›®å½•</span></span><br><span class="line">COPY . /app</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®Javaç¯å¢ƒå˜é‡</span></span><br><span class="line">ENV PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line">ENV JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line">ENV CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´éœ²ç«¯å£</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œ</span></span><br><span class="line">ENTRYPOINT [<span class="string">&#x27;/usr/lib/jvm/java-9-openjdk-amd64/bin/javac&#x27;</span>,<span class="string">&#x27;-jar&#x27;</span>,<span class="string">&#x27;app.jar&#x27;</span>]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>å®¹å™¨è™šæ‹ŸåŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ä¹ ç¬”è¯•é¢˜æ±‡æ€»</title>
    <url>/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AF%95%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<ol start="2024" type="1">
<li></li>
</ol>
<h1 id="ç¾å›¢ç¬”è¯•">2024.4.27 ç¾å›¢ç¬”è¯•</h1>
<p>å’Œæºç¨‹å·®ä¸å¤šï¼Œç­¾åˆ°é¢˜é€Ÿé€šï¼Œåç»­ç–¯ç‹‚æŠ˜ç£¨äººï¼Œè¿‡ä¸äº†ä¸€ç‚¹ã€‚æ„Ÿè§‰é¢˜ç›®éš¾åº¦å·®çš„å¥½å¤§ï¼Œè¦ä¹ˆæˆ‘ç§’æ€å®ƒï¼Œè¦ä¹ˆå®ƒç§’æ€æˆ‘</p>
<p><strong>ç¬¬ä¸‰é¢˜</strong></p>
<blockquote>
<p>å›æº¯å†™äº†åŠå¤©ï¼Œç»“æœåªèƒ½è¿‡20%ã€‚çœ‹åˆ«äººæ˜¯ç”¨å‰ç¼€å’Œ+dpï¼Œé‚£å°±æ˜¯å’Œè…¾è®¯ç¬¬å››é¢˜ç±»ä¼¼äº†ï¼Œå½“æ—¶å­¦ä¼šäº†ç°åœ¨åˆå¿˜äº†ï¼ŒçœŸéš¾å´©ã€‚</p>
</blockquote>
<p>å°ç¾æ‹¿åˆ°äº†ä¸€ä¸ªæ•°ç»„ï¼Œå¥¹æ¯æ¬¡æ“ä½œå¯ä»¥å°†ä¸¤ä¸ªç›¸é‚»å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªå…ƒç´ ï¼Œåˆå¹¶åçš„å…ƒç´ ä¸ºåŸæ¥ä¸¤ä¸ªå…ƒç´ ä¹‹å’Œã€‚å°ç¾å¸Œæœ›æœ€ç»ˆæ•°ç»„çš„æœ€å°å€¼ä¸å°äº
kã€‚å¥¹æƒ³çŸ¥é“æœ‰å¤šå°‘ç§ä¸åŒçš„åˆå¹¶ç»“æœ?</p>
<p>è¾“å…¥æè¿°ï¼šç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°n,kï¼Œä»£è¡¨æ•°ç»„å¤§å°å’Œæ•°ç»„çš„æœ€å¤§å€¼ã€‚ç¬¬äºŒè¡Œè¾“å…¥å‡ ä¸ªæ­£æ•´æ•°q:ï¼Œä»£è¡¨å°ç¾æ‹¿åˆ°çš„æ•°ç»„ã€‚1
â‰¤ n,k,ai &lt; 200</p>
<p>è¾“å‡ºæè¿°ï¼šè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨å°ç¾å¯ä»¥å¾—åˆ°å¤šå°‘ç§ä¸åŒçš„ç»“æœã€‚ç”±äºç»“æœå¯èƒ½å¾ˆå¤§ï¼Œè¾“å‡ºå¯¹10^9+7å–æ¨¡çš„ç»“æœã€‚</p>
<p>egï¼š</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">4 4</span><br><span class="line">2 3 4 5</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º 4</p>
<p><strong>å›æº¯</strong>è§£æ³•ï¼Œåªè¿‡20%ï¼ˆåŠ äº†dpä¿å­˜è¿‡ç¨‹å€¼ä¹Ÿæ²¡ç”¨ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution_3</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] dp;</span><br><span class="line">    <span class="type">int</span>[] a;</span><br><span class="line">    <span class="type">int</span> k;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dp = <span class="keyword">new</span> <span class="title class_">int</span>[a.length];</span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">        <span class="built_in">this</span>.k = k;</span><br><span class="line">        Arrays.fill(dp, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(backtrack(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span> sum, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index==a.length) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (sum==<span class="number">0</span> &amp;&amp; dp[index]!=-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> dp[index];</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isBegin</span> <span class="operator">=</span> sum==<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=index; i&lt;a.length; i++) &#123;</span><br><span class="line">            sum += a[i];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (sum&gt;=k) &#123;</span><br><span class="line">                cnt += backtrack(<span class="number">0</span>, i+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isBegin) dp[index] = cnt;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt(), k = in.nextInt();</span><br><span class="line">        <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</span><br><span class="line">            a[i] = in.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Solution_3</span>().solve(a, k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªå·±è¯•è¯•å†™<strong>å‰ç¼€å’Œ+dp</strong>ï¼ˆæ€è·¯é‡è¦çœŸçš„å¾ˆé‡è¦ï¼ŒäºŒååˆ†é’Ÿå°±å†™å‡ºæ¥äº†ï¼‰</p>
<blockquote>
<p>dp[i] è¡¨ç¤º<del>æ•°å­— 0-i çš„æ–¹æ¡ˆæ•°</del>[0, i)
çš„å­—ä¸²å¯ä»¥æ‹†åˆ†çš„ç§ç±»ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸º<span class="math inline">\(dp[i] =
\sum dp[j]\)</span>ï¼ˆj-i å¤§äºç­‰äº k çš„æ•°é‡æ€»å’Œï¼Œç”¨å‰ç¼€å’Œæ±‚å‡ºï¼‰</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt(), k = in.nextInt();</span><br><span class="line">        <span class="type">int</span>[] sum = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        sum[<span class="number">1</span>] = in.nextInt();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>; i&lt;=n; i++) &#123;</span><br><span class="line">            sum[i] += sum[i-<span class="number">1</span>] + in.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (sum[i] - sum[j] &gt;= k) &#123;</span><br><span class="line">                    dp[i] += dp[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(dp[n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Q1</strong>ï¼šå‰ç¼€å’Œç®—æ³•åˆå§‹åŒ–æ—¶ä¸ºä»€ä¹ˆéƒ½è¦è®¾ç½®
<code>[0, 0] = 1</code> å‘¢ï¼Ÿ å¦‚: <code>dp[0] = 1</code> or
<code>map.put(0,1)</code></p>
<p><strong>A1</strong>ï¼šæƒ³ä¸æ˜ç™½å‘¢ï¼Œéœ€è¦å¯¹çŠ¶æ€è½¬ç§»æ•°ç»„ dp[]
çš„ç†è§£éå¸¸æ­£ç¡®æ‰è¡Œ</p>
<p><strong>ç¬¬å››é¢˜</strong></p>
<p>å°ç¾æ‹¿åˆ°äº†ä¸€æ£µæ ‘ï¼Œå…¶ä¸­æœ‰ä¸€äº›èŠ‚ç‚¹è¢«æŸ“æˆçº¢è‰²ã€‚</p>
<blockquote>
<p>å¤§ä½¬çš„æ€è·¯ï¼šé¢„æ‰“è¡¨å°è´¨æ•°ï¼Œç„¶ådfséå†è¿é€šå—ï¼Œç»Ÿè®¡å—å†…æ¯ä¸ªçº¢ç‚¹çš„è´¨å› å­ï¼Œå¾—åˆ°ç»“ç‚¹ç¼–å·çš„ä¹˜ç§¯çš„è´¨å› å­åˆ†è§£å½¢å¼ï¼Œæ ¹æ®è´¨å› å­æ•°é‡è®¡ç®—å› å­ä¸ªæ•°ã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œéœ€è¦èƒŒä¸€ä¸‹å¹¶æŸ¥é›†çš„æ¨¡æ¿ã€‚</p>
</blockquote>
<p>å°ç¾å®šä¹‰ä¸€ä¸ªçº¢è‰²è¿é€šå—çš„æƒå€¼ä¸º:æ‰€æœ‰èŠ‚ç‚¹ç¼–å·ä¹˜ç§¯çš„å› å­æ•°é‡ã€‚å°ç¾æƒ³çŸ¥é“ï¼Œæ‰€æœ‰çº¢è‰²è¿é€šå—çš„æƒå€¼ä¹‹å’Œæ˜¯å¤šå°‘?ç”±äºç­”æ¡ˆè¿‡å¤§ï¼Œè¯·å¯¹10^9+
7å–æ¨¡ã€‚</p>
<p><strong>è¾“å…¥æè¿°</strong>ï¼š</p>
<p>ç¬¬ä¸€è¡Œè¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°nï¼Œä»£è¡¨èŠ‚ç‚¹æ•°é‡ã€‚
ç¬¬äºŒè¡Œè¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸ºå‡ çš„ã€ä»…ç”±'R"å’Œ"Wç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç¬¬iä¸ªå­—ç¬¦ä¸º'R'ä»£è¡¨;å·èŠ‚ç‚¹è¢«æŸ“æˆçº¢è‰²ï¼Œ"Wä»£è¡¨æœªè¢«æŸ“è‰²ã€‚ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹è¢«æŸ“æˆçº¢è‰²ã€‚</p>
<p>æ¥ä¸‹æ¥çš„n -
1è¡Œï¼Œæ¯è¡Œè¾“å…¥2ä¸ªæ­£æ•´æ•°4,Uï¼Œä»£è¡¨uå·èŠ‚ç‚¹å’Œuå·èŠ‚ç‚¹æœ‰ä¸€æ¡è¾¹è¿æ¥ã€‚1 â‰¤n â‰¤
10^5, 1 â‰¤u,vâ‰¤n</p>
<p><strong>è¾“å‡ºæè¿°</strong>ï¼š</p>
<p>ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨æ‰€æœ‰çº¢è‰²è¿é€šå—çš„æƒå€¼ä¹‹å’Œã€‚</p>
<h1 id="åä¸ºæµ‹è¯„">2024.4.25 åä¸ºæµ‹è¯„</h1>
<p>åå­å…ç¬”è¯•ï¼Œåªæœ‰æµ‹è¯„äº†ã€‚çœ‹ç½‘ä¸Šå¥½å¤šäººæµ‹è¯„æŒ‚äº†æˆ‘éƒ½æƒŠå‘†äº†ï¼Œè¿˜å¥½æ²¡å’Œå…¶ä»–çš„å‚ä¸€æ ·ç›´æ¥åšæµ‹è¯„è€Œæ˜¯ä¸Šæˆ‘æœäº†ä¸‹ï¼Œå…¶ä»–çš„å‚å¯ä»¥ä¸å»ä½†åå­æˆ‘å¿…ç„¶æ‹¿ä¸‹ï¼ˆå°å¿ƒè°¨æ…å“ˆå“ˆå“ˆï¼‰</p>
<p>åå­è¦ä»€ä¹ˆæ ·æ€§æ ¼çš„äººï¼Ÿï¼ˆå‰åå›ç­”è¦ä¸€è‡´ï¼‰</p>
<ul>
<li>ä¸éœ€è¦å‡¸æ˜¾è‡ªå·±çš„èƒ½åŠ›ã€è¡¨è¾¾è‡ªå·±çš„ä¸ªæ€§ï¼Œæ›´å¤šçš„æ˜¯å›¢é˜Ÿåˆä½œ</li>
<li>é‡åˆ°æŒ«æŠ˜è¦åšæŒï¼Œé‡åˆ°é—®é¢˜ä¼šå’¨è¯¢</li>
<li>çƒ­çˆ±å·¥ä½œï¼Œåƒè‹¦è€åŠ³ï¼Œç§¯æå‘ä¸Š</li>
</ul>
<p>ï¼ˆå‡†å¤‡äº†åˆå¥½åƒæ²¡å‡†å¤‡ï¼Œå°±è¿™æ ·å§ï¼Œå¸Œæœ›èƒ½è¿‡ï¼é˜¿å¼¥é™€ä½›è´¢ç¥çˆ·ä¿ä½‘ï¼ï¼‰</p>
<p><strong>å¤ç›˜</strong>ï¼šæœ‰äº›è¿‡äºæ²¡æœ‰å‹åŠ›äº†ï¼Œå‰é¢æ¯ä¸€é¢˜éƒ½è®¤çœŸæ€è€ƒç»“æœ
40min è¿‡å®Œæ‰åšäº†ä¸€åŠï¼Œäººå®¶éƒ½æ˜¯ 40min
å°±åšå®Œäº†ï¼Œå®åœ¨æ˜¯æœ‰äº›æ‹–æ‹‰ï¼ˆä½†è¿™ä¸ªè¦è®¤çœŸé€‰çœŸçš„å¾ˆéš¾å•Šï¼Œå¾—å›å¿†è‡ªå·±å¹³å¸¸çš„æ‰€æ€æ‰€æƒ³æ‰€åšæ‰ç„¶åé€‰ä¸ªç­”æ¡ˆï¼Œåç»­æ—¶é—´ç´§å¼ ç›´æ¥ä¸»è§‚è‡†æ–­é€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«çš„ï¼‰ã€‚<strong>åªè¦æ—¶é—´ä¸ç´§å¼ å°±æ…¢æ…¢åšï¼Œä¸€æ—¦æ—¶é—´ç´§å¼ äº†æ‰å¼€å§‹å…¨ç¥è´¯æ³¨åšï¼Œè¿™å¯çœŸçš„æ˜¯ä¸€ä¸ªåæ¯›ç—…ï¼Œå¾—æ”¹ã€‚</strong></p>
<p>åç»­å­¦ä¹ å·¥ä½œä¸­éƒ½åº”è¯¥æœ‰è¿™ä¸ªæ„è¯†ï¼Œä¸»åŠ¨å…»æˆä¸“æ³¨çš„ä¹ æƒ¯ï¼Œè¦åšå°±è®¤çœŸä»”ç»†ä¸“æ³¨çš„åšäº‹æƒ…ï¼</p>
<h1 id="æºç¨‹ç¬”è¯•">2024.4.16 æºç¨‹ç¬”è¯•</h1>
<p>å‰ä¸¤é“ç­¾åˆ°é¢˜ï¼Œåé¢ä¸€ä¸ªåŠå°æ—¶çº¯æŠ˜ç£¨</p>
<p>ç¬¬ä¸‰é¢˜</p>
<p>æ¸¸æ¸¸æ‹¿åˆ°äº†ä¸€ä¸ªæ•°ç»„ï¼Œå¥¹æ¯æ¬¡æ“ä½œå¯ä»¥å°†ç›¸é‚»çš„ä¸¤ä¸ªç´ æ•°å…ƒç´ è¿›å±±314è¡Œåˆå¹¶ï¼Œåˆå¹¶åçš„æ–°æ•°ä¸ºåŸæ¥çš„ä¸¤ä¸ªæ•°ä¹‹å’Œï¼Œå¹¶åˆ é™¤åŸæ¥ä¸¤ä¸ªæ•°ã€‚æ¸¸æ¸¸å¸Œæœ›æœ€ç»ˆæ•°ç»„çš„å…ƒç´ æ•°é‡å°½å¯èƒ½å°‘ï¼Œä½ èƒ½å¸®å¸®å¥¹å—?</p>
<blockquote>
<p>ç¬¬ä¸€è¡Œè¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°nï¼Œä»£è¡¨æ•°ç»„çš„å¤§å°ã€‚
ç¬¬äºŒè¡Œè¾“å…¥å‡ ä¸ªæ­£æ•´æ•°a_iï¼Œä»£è¡¨æ•°ç»„çš„å…ƒç´  1 â‰¤ n &lt; 10^5 1 â‰¤ a_i &lt;
10^6</p>
</blockquote>
<p>è¿”å›åˆå¹¶ç»“æŸåçš„å…ƒç´ çš„æ•°é‡</p>
<p><strong>é¢˜ç›®åˆ†æ</strong>ï¼šç´ æ•°æ˜¯åªèƒ½è¢«1å’Œè‡ªèº«æ•´é™¤çš„æ•°ã€‚é’ˆå¯¹è¿™é“é¢˜å¯ä»¥ç”¨åˆ°ï¼Œå®ƒçš„ä¸€å¤§ç‰¹æ€§ï¼šé™¤äº†
2 ä¹‹å¤–ä¸¤ä¸ªç´ æ•°ä¹‹å’Œä¸€å®šæ˜¯å¶æ•°ï¼ˆå³ï¼Œä¸€å®šä¸æ˜¯ç´ æ•°ï¼‰</p>
<p>å› æ­¤åªè¦å…ˆæŠŠæ‰€æœ‰ 2
å’Œç´ æ•°åˆå¹¶ï¼Œåç»­åªéœ€è¦åˆ¤æ–­è¿˜æœ‰å¤šå°‘ç›¸é‚»çš„ç´ æ•°å³å¯ã€‚</p>
<p>åšé¢˜çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ° <code>7 2 2 3</code> è¿™ç§æƒ…å†µï¼Œå³ç´ æ•°å’Œ 2
åˆå¹¶å®Œçš„ç»“æœå¦‚æœæ˜¯ç´ æ•°ï¼Œè¿˜éœ€è¦å’Œåˆ¤æ–­ä»–çš„å·¦è¾¹è¿˜æœ‰æ²¡æœ‰
2ï¼Œæœ‰çš„è¯è¿˜è¦åˆå¹¶ï¼Œå³ä»£ç ä¸­çš„ <code>i--</code> éƒ¨åˆ†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrimeMerge</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        List&lt;Integer&gt; numbers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»å–æ•°ç»„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            numbers.add(scanner.nextInt());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå¹¶ç´ æ•°ï¼Œä¼˜å…ˆå¤„ç†2</span></span><br><span class="line">        mergePrimesWithPriorityToTwo(numbers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºæœ€ç»ˆæ•°ç»„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : numbers) &#123;</span><br><span class="line">            System.out.print(num + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ä¸€ä¸ªæ•°æ˜¯å¦æ˜¯ç´ æ•°çš„è¾…åŠ©å‡½æ•°</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPrime</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (num &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i * i &lt;= num; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (num % i == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergePrimesWithPriorityToTwo</span><span class="params">(List&lt;Integer&gt; numbers)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå¹¶2ä¸å…¶ç›¸é‚»çš„ç´ æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ç´ æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numbers.size(); ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (numbers.get(i) == <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">// æ£€æŸ¥å·¦è¾¹æ˜¯å¦æœ‰ç´ æ•°å¯ä»¥åˆå¹¶</span></span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; isPrime(numbers.get(i - <span class="number">1</span>)) &amp;&amp; isPrime(numbers.get(i - <span class="number">1</span>) + <span class="number">2</span>)) &#123;</span><br><span class="line">                    numbers.set(i - <span class="number">1</span>, numbers.get(i - <span class="number">1</span>) + <span class="number">2</span>);</span><br><span class="line">                    numbers.remove(i);</span><br><span class="line">                    i--;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; numbers.size() - <span class="number">1</span> &amp;&amp; isPrime(numbers.get(i + <span class="number">1</span>)) &amp;&amp; isPrime(numbers.get(i + <span class="number">1</span>) + <span class="number">2</span>)) &#123;</span><br><span class="line">                    <span class="comment">// æ£€æŸ¥å³è¾¹æ˜¯å¦æœ‰ç´ æ•°å¯ä»¥åˆå¹¶</span></span><br><span class="line">                    numbers.set(i, numbers.get(i) + numbers.get(i + <span class="number">1</span>));</span><br><span class="line">                    numbers.remove(i + <span class="number">1</span>);</span><br><span class="line">                    i--;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// æ²¡æœ‰å¯ä»¥åˆå¹¶çš„ç´ æ•°ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªæ•°</span></span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå¹¶å‰©ä½™çš„ç´ æ•°å¯¹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numbers.size() - <span class="number">1</span>; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isPrime(numbers.get(i)) &amp;&amp; isPrime(numbers.get(i + <span class="number">1</span>))) &#123;</span><br><span class="line">                numbers.set(i, numbers.get(i) + numbers.get(i + <span class="number">1</span>));</span><br><span class="line">                numbers.remove(i + <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬å››é¢˜</p>
<p>å®šä¹‰ä¸€æ£µæ ‘çš„ç›´å¾„ä¸ºï¼šä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹çš„è·ç¦»çš„æœ€å¤§å€¼ã€‚ç°åœ¨å®šä¹‰f(i)ï¼šå¯¹iå·èŠ‚ç‚¹ä¸Šå†è¿æ¥ä¸€ä¸ªæ–°çš„å­å¶èŠ‚ç‚¹åï¼Œæ ‘çš„ç›´å¾„é•¿åº¦ã€‚ç°åœ¨è¦æ±‚f(1)åˆ°f(n)çš„å€¼ã€‚</p>
<p>è¾“å…¥æè¿°ï¼šç¬¬ä¸€è¡Œè¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°nï¼Œä»£è¡¨æ ‘çš„èŠ‚ç‚¹æ•°é‡ã€‚</p>
<p>æ¥ä¸‹æ¥çš„n-1è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°uå’Œvï¼Œä»£è¡¨uå·èŠ‚ç‚¹å’Œvå·èŠ‚ç‚¹ä¹‹é—´æœ‰ä¸€æ¡é•¿åº¦ä¸º1çš„è¾¹è¿æ¥ã€‚</p>
<p>å˜é‡çš„èŒƒå›´ï¼š1â‰¤nâ‰¤10çš„äº”æ¬¡æ–¹ï¼Œ1â‰¤uï¼Œvâ‰¤nã€‚</p>
<p><strong>é¢˜ç›®åˆ†æï¼š</strong> æ ‘çš„ç›´å¾„å¼•å‡ºæ ‘å½¢ dp ç®—æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    List&lt;TreeNode&gt; children;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">        children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeDiameter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] f; <span class="comment">// å­˜å‚¨æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§ç›´å¾„</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt(); <span class="comment">// æ ‘çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line"></span><br><span class="line">        f = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        TreeNode[] nodes = <span class="keyword">new</span> <span class="title class_">TreeNode</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            nodes[i] = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿æ¥èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            nodes[u].children.add(nodes[v]);</span><br><span class="line">            nodes[v].children.add(nodes[u]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„å­å¶èŠ‚ç‚¹ï¼Œè®¡ç®—f(i)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="comment">// æ·»åŠ æ–°çš„å­å¶èŠ‚ç‚¹</span></span><br><span class="line">            nodes[i].children.add(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(-<span class="number">1</span>));</span><br><span class="line">            <span class="comment">// è®¡ç®—å½“å‰æœ€å¤§ç›´å¾„</span></span><br><span class="line">            dfs(nodes[i], <span class="literal">null</span>, i);</span><br><span class="line">            <span class="comment">// åˆ é™¤æ·»åŠ çš„å­å¶èŠ‚ç‚¹</span></span><br><span class="line">            nodes[i].children.remove(nodes[i].children.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            System.out.print(f[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’è®¡ç®—ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘çš„ç›´å¾„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(TreeNode node, TreeNode parent, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxDepth1</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// æœ€å¤§æ·±åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxDepth2</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// æ¬¡å¤§æ·±åº¦</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> (TreeNode child : node.children) &#123;</span><br><span class="line">            <span class="keyword">if</span> (child == parent) <span class="keyword">continue</span>; <span class="comment">// ä¸è®¿é—®çˆ¶èŠ‚ç‚¹ï¼Œé˜²æ­¢æ­»å¾ªç¯</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">childDepth</span> <span class="operator">=</span> dfs(child, node, i) + <span class="number">1</span>; <span class="comment">// é€’å½’è®¡ç®—å­èŠ‚ç‚¹çš„æ·±åº¦</span></span><br><span class="line">            <span class="keyword">if</span> (childDepth &gt; maxDepth1) &#123;</span><br><span class="line">                maxDepth2 = maxDepth1;</span><br><span class="line">                maxDepth1 = childDepth;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDepth &gt; maxDepth2) &#123;</span><br><span class="line">                maxDepth2 = childDepth;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°å½“å‰çŠ¶æ€çš„æœ€å¤§ç›´å¾„</span></span><br><span class="line">        f[i] = Math.max(f[i], maxDepth1 + maxDepth2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maxDepth1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ’ç”Ÿç¬”è¯•">2024.4.9 æ’ç”Ÿç¬”è¯•</h1>
<ol type="1">
<li>ä¸‹åˆ—ä»£ç çš„è¿”å›å€¼</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">count</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>/<span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>*<span class="number">3</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a
href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.20.2">æ ¹æ®Javaè¯­è¨€è§„èŒƒæ–‡æ¡£è§„å®š</a>ã€‚åœ¨
try-catch-finally è¯­å¥å—ä¸­ï¼Œfinally è¯­å¥å—ä¸­çš„
return/æŠ›å‡ºå¼‚å¸¸ï¼ˆç«‹å³ç»“æŸè¯­å¥ï¼‰çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¨‹åºä¼šä¼˜å…ˆè¿”å› finally
è¯­å¥å—ä¸­çš„ç«‹å³ç»“æŸè¯­å¥çš„ç»“æœï¼Œæ­¤æ—¶ try-catch è¯­å¥å—ä¸­çš„
return/æŠ›å‡ºå¼‚å¸¸ï¼ˆç«‹å³ç»“æŸè¯­å¥ï¼‰çš„ç»“æœå°±ä¼šè¢«ä¸¢å¼ƒæ‰ã€‚</p>
<ol start="2" type="1">
<li>SQL è¯­å¥</li>
</ol>
<p>è”ç»“è¯­æ³•ã€INNER JOIN è¯­æ³•</p>
<ol start="3" type="1">
<li>åˆå§‹èµ„é‡‘ Mï¼ŒN å¤©ä»·æ ¼ä¿¡æ¯ï¼ŒK æ¬¡äº¤æ˜“åï¼Œèƒ½èµšå¤šå°‘é’±ï¼Ÿï¼ˆåŠ¨æ€è§„åˆ’ï¼‰</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ ¹æ®è¾“å…¥è®¡ç®—æœ€å¤§æ”¶ç›Š</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> M doubleæµ®ç‚¹å‹ åˆå§‹èµ„é‡‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> N intæ•´å‹ å†å²ä»·æ ¼å¤©æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> historyPrices doubleæµ®ç‚¹å‹ä¸€ç»´æ•°ç»„ Nå¤©å†å²ä»·æ ¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> K intæ•´å‹ æœ€å¤§å…è®¸äº¤æ˜“æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> doubleæµ®ç‚¹å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">get_max_profit</span> <span class="params">(<span class="type">double</span> M, <span class="type">int</span> N, <span class="type">double</span>[] historyPrices, <span class="type">int</span> K)</span> &#123;</span><br><span class="line">    <span class="type">double</span>[][] dp = <span class="keyword">new</span> <span class="title class_">double</span>[K+<span class="number">1</span>][N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>; j&lt;N; j++) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][j] = M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;=K; i++) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=K; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>; j&lt;N; j++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">max</span> <span class="operator">=</span> dp[i][j-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> t=<span class="number">0</span>; t&lt;j; t++) &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">rest</span> <span class="operator">=</span> dp[i-<span class="number">1</span>][t]%historyPrices[t], buy = (dp[i-<span class="number">1</span>][t]-rest)/historyPrices[t];</span><br><span class="line">                max = Math.max(max, buy*historyPrices[j]+rest);</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i][j] = max;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[K][N-<span class="number">1</span>]-dp[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="è…¾è®¯ç¬”è¯•">2024.3.31 è…¾è®¯ç¬”è¯•</h1>
<p>æ²¡åšå¥½è®°å½•ï¼Œåªè®°äº†æ²¡åšå‡ºæ¥çš„ç¬¬å››é¢˜ï¼Œå…¶ä»–å››é“é¢˜ AC
äº†ä¸‰é“ï¼Œè¿˜æœ‰ä¸€é“é€šè¿‡ 97% æˆ‘æ€€ç–‘æ˜¯æ ·ä¾‹æœ‰é—®é¢˜[æ‰‹åŠ¨ç‹—å¤´]</p>
<ol start="4" type="1">
<li>ç»™ä½  n ä¸ªæ•°ï¼Œè¿™ n ä¸ªæ•°è¦è¢«æ‹†æˆ k
ä»½ï¼Œå¯¹æ¯ä»½ä¸­çš„æ•°å­—æ±‚å¼‚æˆ–ï¼Œæ±‚å„ä»½å¼‚æˆ–æ€»å’Œçš„æœ€å¤§å€¼ï¼ˆå’Œæ’ç”Ÿç¬¬äºŒé¢˜çš„æ€è·¯åŸºæœ¬ä¸€æ ·ï¼‰</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">    <span class="type">long</span>[][] dp = <span class="keyword">new</span> <span class="title class_">long</span>[k + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        dp[<span class="number">1</span>][i + <span class="number">1</span>] = in.nextInt() ^ dp[<span class="number">1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span>[] prefix = dp[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// æ‹†åˆ†ä¸º i ä»½</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= k; i++) &#123;</span><br><span class="line">        <span class="comment">// ä»å¤´åˆ°å°¾éå†ï¼šå°†ç¬¬ 1~j ä¸ªå…ƒç´ æ‹†æˆ i ä»½</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// å°†ç¬¬ [1,s] ä¸ªå…ƒç´ æ‹†æˆ i-1 ä»½ï¼Œ(s,j] æ˜¯æœ€åä¸€ä»½</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> j - <span class="number">1</span>; s &gt;= i - <span class="number">1</span>; s--) &#123;</span><br><span class="line">                <span class="comment">// å¼‚æˆ–çš„ä¼˜å…ˆçº§å°äºåŠ å‡æ³•</span></span><br><span class="line">                max = Math.max(max, dp[i - <span class="number">1</span>][s] + (prefix[j] ^ prefix[s]));</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i][j] = max;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(dp[k][n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>ç¬”è¯•è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>Git æ–‡æ¡£é˜…è¯»</title>
    <url>/#2024/Git/</url>
    <content><![CDATA[<p><a href="https://git-scm.com/book/zh/v2">Git ä¸­æ–‡æ–‡æ¡£</a></p>
<blockquote>
<p>æœ‰ç©ºå¯ä»¥çœ‹çœ‹è¿™ä¸ª <a href="https://github.com/xirong/my-git">Git
ç¬”è®°æ±‡æ€»</a></p>
</blockquote>
<span id="more"></span>
<img data-src="/" class="" title="img">
<h2 id="chapter-1-èµ·æ­¥">Chapter 1 èµ·æ­¥</h2>
<h3 id="ç‰ˆæœ¬æ§åˆ¶">ç‰ˆæœ¬æ§åˆ¶</h3>
<ol type="1">
<li>é›†ä¸­åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼ˆCVCSï¼‰ç¼ºç‚¹
<ol type="1">
<li>ä¸­å¤®æœåŠ¡å™¨çš„å•ç‚¹æ•…éšœå°±æ— æ³•ååŒå·¥ä½œ</li>
<li>æœ¬åœ°åªæœ‰å¿«ç…§ï¼Œé¡¹ç›®æ•´ä½“å’Œå…¶å˜æ›´å†å²åªä¿å­˜åœ¨æœåŠ¡å™¨ä¸Š</li>
</ol></li>
<li>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ï¼ˆDVCSï¼‰ä¼˜ç‚¹
<ol type="1">
<li>ä»£ç ä»“åº“å®Œæ•´åœ°é•œåƒä¸‹æ¥ï¼ŒåŒ…æ‹¬å®Œæ•´çš„å†å²è®°å½•</li>
<li>ç”¨æˆ·åœ¨æœ¬åœ°ä¿å­˜äº†æ‰€æœ‰æ”¹åŠ¨ï¼Œæ¯ä¸€æ¬¡çš„å…‹éš†éƒ½æ˜¯å¯¹ä»“åº“çš„å®Œæ•´å¤‡ä»½</li>
<li>å¯ä»¥æŒ‡å®šå’Œè‹¥å¹²ä¸åŒçš„è¿œç«¯ä»£ç ä»“åº“è¿›è¡Œäº¤äº’</li>
</ol></li>
</ol>
<h3 id="git-ç®€å²">Git ç®€å²</h3>
<ol type="1">
<li>å¹¶è¡Œå¼€å‘</li>
<li>å®Œå…¨åˆ†å¸ƒå¼</li>
<li>é€Ÿåº¦å¿«</li>
<li>æ•°æ®é‡å¤§</li>
</ol>
<h3 id="git-ç®€ä»‹">Git ç®€ä»‹</h3>
<ol type="1">
<li>å¤§å¤šç‰ˆæœ¬æ§åˆ¶å·¥å…·éƒ½æ˜¯åŸºäºå·®å¼‚çš„ï¼Œå­˜å‚¨æ–‡ä»¶éšæ—¶é—´å˜åŒ–çš„å·®å¼‚ï¼Œè€ŒGitå‚¨å­˜é¡¹ç›®å¿«ç…§æˆ–ç´¢å¼•</li>
<li>Git å®‰å…¨æ€§ä¼˜ï¼Œåªåšå¢ä¸åšåˆ ï¼›å®Œæ•´æ€§å¥½ï¼Œä½¿ç”¨SHA-1 å“ˆå¸Œç®—æ³•</li>
<li>æ–‡ä»¶çš„å››ç§çŠ¶æ€ï¼šå·²æäº¤ï¼ˆcommittedï¼‰ã€å·²ä¿®æ”¹ï¼ˆmodifiedï¼‰ã€å·²æš‚å­˜ï¼ˆstagedï¼‰ã€æœªè·Ÿè¸ªï¼ˆuntrackedï¼‰</li>
<li>é¡¹ç›®çš„ä¸‰ä¸ªé˜¶æ®µï¼šå·¥ä½œç›®å½•ã€æš‚å­˜åŒºåŸŸä»¥åŠ Git ä»“åº“</li>
<li>å·¥ä½œæµç¨‹ï¼šä¿®æ”¹æ–‡ä»¶ã€æš‚å­˜æ–‡ä»¶ã€å°†æš‚å­˜åŒºæ–‡ä»¶å¿«ç…§æ°¸ä¹…å­˜åœ¨Gitç›®å½•</li>
</ol>
<h3 id="git-é…ç½®">Git é…ç½®</h3>
<blockquote>
<p>git config --list --show-origin</p>
</blockquote>
<ol type="1">
<li>/etc/gitconfig ç³»ç»Ÿé€šç”¨é…ç½® git config --system</li>
<li>~/.gitconfig å½“å‰ç”¨æˆ·é…ç½® git config --global</li>
<li>.git/config å½“å‰é¡¹ç›®é…ç½® git config --local</li>
</ol>
<h2 id="chapter-2-åŸºç¡€">Chapter 2 åŸºç¡€</h2>
<blockquote>
<p>Gitå‘½ä»¤åªèƒ½æ§åˆ¶å½“å‰æ–‡ä»¶å¤¹å’Œå­æ–‡ä»¶å¤¹å†…çš„ä¿®æ”¹</p>
</blockquote>
<h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h3>
<p>git init ã€åˆå§‹åŒ–ä»“åº“ã€‘</p>
<p>git clone [OPTIONS] &lt;url&gt;ã€å…‹éš†ä»“åº“ã€‘</p>
<ul>
<li>[-b master]å…‹éš†æŒ‡å®šåˆ†æ”¯</li>
</ul>
<p>git status [OPTIONS] ã€æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ ã€‘</p>
<ul>
<li>[-s] ç®€è¦æ–‡ä»¶çŠ¶æ€ä¿¡æ¯</li>
</ul>
<p>git add &lt;file&gt;
ã€è·Ÿè¸ªæ–°æ–‡ä»¶ã€å·²ä¿®æ”¹çš„æ–‡ä»¶æ”¾åˆ°æš‚å­˜åŒºã€åˆå¹¶æ—¶æŠŠæœ‰å†²çªçš„æ–‡ä»¶æ ‡è®°ä¸ºå·²è§£å†³çŠ¶æ€
ã€‘</p>
<p>git diff [OPTIONS]
&lt;file&gt;ã€å·²ä¿®æ”¹æ–‡ä»¶ä¸å·²æš‚å­˜æ–‡ä»¶çš„å†…å®¹å·®å¼‚ã€‘</p>
<ul>
<li>[--staged] æ˜¾ç¤ºæš‚å­˜åŒºå’Œä¸Šä¸€æ¬¡æäº¤çš„å·®å¼‚</li>
</ul>
<p>git rm [OPTIONS] &lt;file&gt; ã€åˆ é™¤æ–‡ä»¶ã€‘</p>
<ul>
<li>[-f] å¼ºåˆ¶ç§»é™¤å­˜åœ¨æœªæäº¤ä¿®æ”¹çš„æ–‡ä»¶</li>
<li>[ --cached] æ–‡ä»¶ä¿ç•™åœ¨å·¥ä½œåŒºä¸­ï¼Œä»Gitä»“åº“å’Œæš‚å­˜åŒºä¸­åˆ é™¤</li>
</ul>
<p>git commit [OPTIONS] ã€æäº¤æ–‡ä»¶ã€‘ - [-m &lt;message&gt;] æäº¤å¤‡æ³¨ -
[--amend] è¿½åŠ æäº¤ - [-a] ç›´æ¥å°†å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ‰€æœ‰ä¿®æ”¹ä¸€èµ·æäº¤</p>
<p>git mv &lt;oldfilename&gt; &lt;newfilename&gt; ã€ç§»åŠ¨æ–‡ä»¶/æ”¹åã€‘</p>
<p>git log [OPTIONS] ã€å›é¡¾æäº¤å†å²ã€‘ - [--stat] æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„ç®€è¦ä¿¡æ¯
- [-p] æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„è¯¦ç»†ä¿¡æ¯ - [--pretty=format:"xxx"] è‡ªå®šä¹‰ä¿¡æ¯æ ¼å¼ -
[--oneline --graph --all]
æ˜¾ç¤ºæäº¤å†å²ã€å„ä¸ªåˆ†æ”¯çš„æŒ‡å‘ä»¥åŠé¡¹ç›®çš„åˆ†æ”¯åˆ†å‰æƒ…å†µ - [--since]
é™åˆ¶æ—¶é—´</p>
<p>git reset [OPTIONS]
&lt;HEAD&gt;ã€å›é€€ç‰ˆæœ¬ï¼Œå¯ä»¥æŒ‡å®šé€€å›æŸä¸€æ¬¡æäº¤çš„ç‰ˆæœ¬ï¼Œç›´æ¥åˆ é™¤æŸäº›commitçš„å†…å®¹ã€‘</p>
<ul>
<li>[--soft] å›é€€åˆ°æŸä¸ªç‰ˆæœ¬</li>
<li>[--mixed]
é»˜è®¤ï¼Œç”¨äºé‡ç½®æš‚å­˜åŒºçš„æ–‡ä»¶ä¸ä¸Šä¸€æ¬¡çš„æäº¤ä¿æŒä¸€è‡´ï¼ˆå–æ¶ˆæš‚å­˜ï¼‰ï¼Œå·¥ä½œåŒºæ–‡ä»¶å†…å®¹ä¿æŒä¸å˜</li>
<li>[--hard]
æ’¤é”€å·¥ä½œåŒºä¸­æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹å†…å®¹ï¼Œå°†æš‚å­˜åŒºä¸å·¥ä½œåŒºéƒ½å›åˆ°ä¸Šä¸€æ¬¡ç‰ˆæœ¬ï¼Œå¹¶åˆ é™¤ä¹‹å‰çš„æ‰€æœ‰ä¿¡æ¯æäº¤</li>
</ul>
<p>git checkout
[OPTIONS]ã€åœ¨ä¸åŒçš„åˆ†æ”¯ä¹‹é—´åˆ‡æ¢ã€æ¢å¤æ–‡ä»¶ã€åˆ›å»ºæ–°åˆ†æ”¯ï¼Œgit switch å’Œ git
restore å¯ä»¥ä»£æ›¿å®ƒã€‘</p>
<ul>
<li>[.] æ”¾å¼ƒæ‰€æœ‰å·¥ä½œåŒºçš„ä¿®æ”¹</li>
<li>[-f] æ”¾å¼ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ‰€æœ‰ä¿®æ”¹</li>
<li>[&lt;branch-name&gt;] ä»å½“å‰åˆ†æ”¯åˆ‡æ¢åˆ°æŒ‡å®šçš„åˆ†æ”¯</li>
<li>[-b &lt;local_new_branch_name&gt; &lt;remote_new_branch_name&gt;]
å°†è¿œç¨‹ä»“åº“é‡ŒæŒ‡å®šçš„åˆ†æ”¯æ‹‰å–åˆ°æœ¬åœ°ï¼Œå¹¶åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ä¸æŒ‡å®šè¿œç¨‹ä»“åº“åˆ†æ”¯å…³è”èµ·æ¥,å¹¶åˆ‡æ¢åˆ°æ–°å»ºçš„æœ¬åœ°åˆ†æ”¯ä¸­</li>
</ul>
<p>git remote [OPTIONS]
ã€åˆ—å‡ºå½“å‰ä»“åº“ä¸­å·²é…ç½®çš„<strong>è¿œç¨‹ä»“åº“</strong>ã€‘</p>
<ul>
<li>[-v] åˆ—å‡ºå½“å‰ä»“åº“ä¸­å·²é…ç½®çš„è¿œç¨‹ä»“åº“ï¼Œå¹¶æ˜¾ç¤ºå®ƒä»¬çš„ URL</li>
<li>[add &lt;remote_name&gt; &lt;remote_url&gt;]
æ·»åŠ è¿œç¨‹ä»“åº“ï¼ŒæŒ‡å®šä¸€ä¸ªè¿œç¨‹ä»“åº“çš„åç§°å’Œ URLï¼Œå°†å…¶æ·»åŠ åˆ°å½“å‰ä»“åº“ä¸­</li>
<li>[remane &lt;old_name&gt; &lt;new_name&gt;]
å°†å·²é…ç½®çš„è¿œç¨‹ä»“åº“é‡å‘½å</li>
<li>[show &lt;remote_name&gt;] æ˜¾ç¤ºæŒ‡å®šè¿œç¨‹ä»“åº“çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ URL
å’Œè·Ÿè¸ªåˆ†æ”¯</li>
<li>[remove &lt;remote_name&gt;] ä»å½“å‰ä»“åº“ä¸­åˆ é™¤æŒ‡å®šçš„è¿œç¨‹ä»“åº“</li>
<li>[<remote_name> <new_url>] ä¿®æ”¹æŒ‡å®šè¿œç¨‹ä»“åº“çš„ URL</li>
</ul>
<p>git fetch &lt;remote_name&gt; &lt;local_branch_name&gt;
ã€è·å–è¿œç¨‹ä»“åº“çš„æ›´æ–°ï¼Œä½†ä¸è‡ªåŠ¨åˆå¹¶åˆ°ä½ çš„å·¥ä½œã€‘</p>
<ul>
<li>[--all] è·å–è¿œç¨‹çš„æ‰€æœ‰åˆ†æ”¯</li>
</ul>
<p>git push [OPTIONS]ã€æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ã€‘</p>
<ul>
<li><p>[&lt;remote_name&gt;
&lt;local_branch_name&gt;:&lt;remote_branch_name&gt;]</p></li>
<li><p>[&lt;remote_name&gt; --delete &lt;branch_name&gt;]
åˆ é™¤è¿œç¨‹åˆ†æ”¯</p></li>
<li><p>[-u &lt;remote_name&gt; --all]
æœ¬åœ°çš„ä»“åº“å’Œè¿œç¨‹ä»“åº“è¿›è¡Œå…³è”</p></li>
<li><p>[--set-upstream &lt;remote_repository&gt;
&lt;local_branch_name&gt;] å°†æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯å…³è”</p></li>
<li><p>[--force] å¼ºåˆ¶æäº¤ï¼Œä¼šè¦†ç›–æ‰€æœ‰ behind çš„æäº¤</p></li>
</ul>
<p>git pull &lt;remote_name&gt; &lt;branch&gt;ã€<code>git fetch</code>
å’Œ <code>git merge</code> çš„ç»„åˆï¼Œæ‹‰å–åˆ°æœ¬åœ°åˆ†æ”¯å¹¶åˆå¹¶ã€‘</p>
<p>git tag [OPTIONS]ã€åˆ—å‡ºå·²æœ‰çš„æ ‡ç­¾ã€‘</p>
<ul>
<li>[-l &lt;é€šé…ç¬¦&gt;] æŸ¥è¯¢æŸäº›å¯¹åº”æ ‡ç­¾</li>
<li>[&lt;version&gt;] è½»é‡æ ‡ç­¾ï¼ˆæäº¤æ ¡éªŒå’Œå­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼‰</li>
<li>[-a &lt;version&gt; -m &lt;comment&gt;]
åˆ›å»ºé™„æ³¨æ ‡ç­¾ï¼ˆæ•°æ®åº“ä¸­çš„ä¸€ä¸ªå®Œæ•´å¯¹è±¡ï¼Œ å¯ä»¥è¢«æ ¡éªŒï¼‰</li>
<li>[-d] åˆ é™¤æ ‡ç­¾</li>
</ul>
<p>git rebase &lt;cur_branch&gt; &lt;target_branch&gt;
ã€å°†æäº¤åˆ°æŸä¸€åˆ†æ”¯ä¸Šçš„æ‰€æœ‰ä¿®æ”¹éƒ½ç§»è‡³å¦ä¸€åˆ†æ”¯ä¸Šã€‘</p>
<p>git revert
&lt;commit_id&gt;ã€ç”Ÿæˆä¸€æ¬¡æ–°çš„commitå†²æŠµåŸæ¥çš„commitï¼Œä¸ä¼šä¿®æ”¹åŸæœ‰çš„æäº¤å†å²ï¼Œè€Œæ˜¯é€šè¿‡æ·»åŠ æ–°çš„æäº¤æ¥æ’¤é”€æ›´æ”¹ã€‘</p>
<p>git merge &lt;branch&gt; ã€åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ã€‘</p>
<p>git switch [OPTIONS] &lt;branch-name&gt; ã€åˆ‡æ¢åˆ†æ”¯ï¼Œä¸ git checkout
ç±»ä¼¼ï¼Œä½†æä¾›äº†æ›´æ¸…æ™°çš„è¯­ä¹‰å’Œé”™è¯¯æ£€æŸ¥ã€‘</p>
<ul>
<li>[-c] åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</li>
</ul>
<p>git show
ã€å¯¹äºæäº¤ï¼Œå®ƒæ˜¾ç¤ºæ—¥å¿—æ¶ˆæ¯å’Œæ–‡æœ¬å·®å¼‚ï¼›å¯¹äºæ ‡ç­¾ï¼Œå®ƒæ˜¾ç¤ºæ ‡ç­¾æ¶ˆæ¯å’Œå¼•ç”¨å¯¹è±¡ã€‘</p>
<p>git restore [OPTIONS] ã€æ¢å¤æˆ–æ’¤é”€æ–‡ä»¶çš„æ›´æ”¹ã€‘ - [.]
è¿˜åŸæ‰€æœ‰æœªæäº¤çš„æ›´æ”¹ - [&lt;filename&gt;] ä¸¢å¼ƒå·¥ä½œåŒºä¿®æ”¹ - [--staged
&lt;filename&gt;] å°†æš‚å­˜åŒºçš„ä¿®æ”¹æ”¾å›å·¥ä½œåŒº - [--source=&lt;commit&gt;
&lt;file&gt;] å°†æ–‡ä»¶æ¢å¤åˆ°ç‰¹å®šæäº¤çš„çŠ¶æ€</p>
<p>git branch [OPTIONS] ã€æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ã€‘</p>
<ul>
<li>[&lt;branch_name&gt;] åˆ›å»ºæœ¬åœ°åˆ†æ”¯</li>
<li>[-b &lt;branch_name&gt;] åˆ›å»ºæœ¬åœ°åˆ†æ”¯å¹¶åˆ‡æ¢</li>
<li>[-v] æ¯ä¸ªåˆ†æ”¯çš„æœ€åä¸€æ¬¡æäº¤</li>
<li>[-vv] è·Ÿè¸ªä¿¡æ¯</li>
<li>[-r] æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</li>
<li>[-D &lt;branch_name&gt;] åˆ é™¤åˆ†æ”¯</li>
<li>[--set-upstream-to &lt;remotename&gt;/&lt;remote_branch&gt;
&lt;local_branch&gt;]
è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯ã€‚åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªåˆ†æ”¯åï¼Œéœ€è¦åšè¿œç¨‹åˆ†æ”¯å…³è”ï¼Œç›®çš„æ˜¯åœ¨æ‰§è¡Œgit
pull, git pushæ“ä½œæ—¶å°±ä¸éœ€è¦æŒ‡å®šå¯¹åº”çš„è¿œç¨‹åˆ†æ”¯</li>
<li>[--merged --no-merged] åˆå¹¶/æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„å…¶ä»–åˆ†æ”¯</li>
<li>[-m &lt;old_branch_name&gt; &lt;new_branch_name&gt;] æ”¹å</li>
</ul>
<p>git stash [OPTIONS] ã€è´®è—å·¥ä½œã€‘</p>
<ul>
<li>[list] åˆ—å‡ºæ‰€æœ‰è´®è—</li>
<li>[apply] æ¢å¤è´®è—</li>
</ul>
<h3 id="å¿½ç•¥ä¸è·Ÿè¸ªæ–‡ä»¶">å¿½ç•¥/ä¸è·Ÿè¸ªæ–‡ä»¶</h3>
<p>.gitignore æ­£åˆ™è¡¨è¾¾å¼ï¼š<a
href="https://github.com/github/gitignore">å®˜æ–¹æ ·ä¾‹æ–‡ä»¶</a></p>
<h2 id="chapter-3-åˆ†æ”¯">Chapter 3 åˆ†æ”¯</h2>
<blockquote>
<p>ç›¸å…³å‘½ä»¤åˆå¹¶åˆ° Chapter2 ä¸­</p>
</blockquote>
<ol type="1">
<li>Git ä¸­ HEADæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰å·¥ä½œä½ç½®</li>
<li>git mergetool å›¾å½¢åŒ–å†²çªè§£å†³å·¥å…·</li>
<li>æœ‰ Git ç‰¹æ€§æ¼”åŒ–å‡ºçš„å¼€å‘å·¥ä½œæµï¼šé•¿æœŸåˆ†æ”¯ã€ä¸»é¢˜åˆ†æ”¯</li>
</ol>
<h3 id="å˜åŸº">å˜åŸº</h3>
<p>å¦‚æœæäº¤å­˜åœ¨äºä½ çš„ä»“åº“ä¹‹å¤–ï¼Œè€Œåˆ«äººå¯èƒ½åŸºäºè¿™äº›æäº¤è¿›è¡Œå¼€å‘ï¼Œé‚£ä¹ˆä¸è¦æ‰§è¡Œå˜åŸºã€‚åªå¯¹å°šæœªæ¨é€æˆ–åˆ†äº«ç»™åˆ«äººçš„æœ¬åœ°ä¿®æ”¹æ‰§è¡Œå˜åŸºæ“ä½œæ¸…ç†å†å²ï¼Œ
ä»ä¸å¯¹å·²æ¨é€è‡³åˆ«å¤„çš„æäº¤æ‰§è¡Œå˜åŸºæ“ä½œã€‚</p>
<p>å·¥ä½œåŸç†ï¼šæå–&lt;topicbranch&gt;å†…çš„ä¿®æ”¹å¹¶å­˜ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åå°†HEADæŒ‡å‘&lt;basebranch&gt;ï¼Œæœ€åä»¥æ­¤å°†ä¹‹å‰å¦å­˜ä¸ºä¸´æ—¶æ–‡ä»¶çš„ä¿®æ”¹ä¾åºåº”ç”¨</p>
<h2 id="chapter-6-github">Chapter 6 GitHub</h2>
]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>ç‰ˆæœ¬ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ä¹ é¢è¯•é¢˜æ±‡æ€»</title>
    <url>/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h1 id="æµ·åº·æŠ€æœ¯ä¸»ç®¡é¢">2024.6.24 æµ·åº·æŠ€æœ¯ä¸»ç®¡é¢</h1>
<h1 id="è°äº‘æŠ€ä¸»ç®¡é¢">2024.6.13 è°äº‘æŠ€ä¸»ç®¡é¢</h1>
<ol type="1">
<li>è®²ä¸€è®²å’Œç®—æ³•ç›¸å…³çš„ç»å†</li>
</ol>
<ul>
<li>ä¸“åˆ©ï¼šåŸºäºå¼‚æ„å›¾ç½‘ç»œçš„æƒ…ç»ªæ”¯æŒå¯¹è¯</li>
<li>é¡¹ç›®ï¼šLLMåº”ç”¨å¼€å‘</li>
</ul>
<ol start="2" type="1">
<li>è¿™ä¸ªé¡¹ç›®éƒ½åœ¨ä½¿ç”¨åˆ«äººå¼€å‘å¥½çš„æŠ€æœ¯ï¼Œé‚£ä¹ˆä½ åœ¨å…¶ä¸­æœ‰ä»€ä¹ˆè´¡çŒ®ï¼Ÿ</li>
</ol>
<ul>
<li>ç›®å‰å¾ˆå¤šå¼€æºé¡¹ç›®åªåœç•™åœ¨ç§‘ç ”æ–¹é¢ï¼Œå¦‚ä½•è½åœ°åˆ°å…·ä½“é¡¹ç›®ä¸­ï¼Œå°±æ¯”å¦‚ LLM
å‡ºç°é”™è¯¯å®•æœºçš„æ—¶å€™ï¼Œé‡å¯å®¹å™¨åŒ–è¿è¡Œçš„ LLM
å®ä¾‹å¹¶é‡‡ç”¨ä¸€è‡´æ€§è½®è¯¢æ–¹æ³•ï¼Œè®¿é—®å…¶ä»–æ­£å¸¸è¿è¡Œçš„å®¹å™¨</li>
</ul>
<ol start="3" type="1">
<li>åšè¿‡æœ€å¤§çš„é¡¹ç›®</li>
</ol>
<ul>
<li>å®ä¹ çš„æ—¶å€™åšçš„æ•°æ®ä¸­å°é¡¹ç›®</li>
</ul>
<ol start="4" type="1">
<li>å¯¹æœªæ¥çš„è®¡åˆ’</li>
</ol>
<ul>
<li>ä½œä¸ºä¸€ä¸ªåˆšè¿›å…¥å·¥ä½œçš„å­¦ç”Ÿï¼Œè¦ä¸æ–­å­¦ä¹ æ‹“å®½è‡ªå·±çš„æŠ€æœ¯é¢</li>
</ul>
<h1 id="åä¸ºä¸»ç®¡é¢">2024.5.22 åä¸ºä¸»ç®¡é¢</h1>
<h1 id="è°äº‘æŠ€æœ¯é¢">2024.5.21 è°äº‘æŠ€æœ¯é¢</h1>
<p>å¹¶å‘</p>
<h1 id="åä¸ºæŠ€æœ¯é¢">2024.5.10 åä¸ºæŠ€æœ¯é¢</h1>
<ul>
<li>è®©æˆ‘è°ƒäº†ä¸‹æ‘„åƒå¤´ï¼Œå¥½å±•ç¤ºæˆ‘çš„é¢œï¼Œç„¶åè‡ªæˆ‘ä»‹ç»</li>
<li>æ‰‹æ’•ç®—æ³•ï¼ˆç”±äºå¤ªç´§å¼ å†™ä»£ç ä¸€ç›´åœ¨çµ®çµ®å¨å¨ï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ä¸šåŠ¡å‘é€æ•°æ®åˆ°å¯¹ç«¯ï¼Œç”±äºç½‘ç»œåŸå› ä¼šå‡ºç°æ¦‚ç‡ä¸¢åŒ…ï¼›ç°å‘é€1Wæ¡æ•°æ®åˆ°å¯¹ç«¯ï¼ŒæŒ‡å®šè¾“å…¥Nä¸ºä¸¢åŒ…æ•°é‡ï¼Œéšååˆ—å‡ºä¸¢åŒ…æ•°æ®çš„å…·ä½“ä½ç½®ï¼›ä½ æœ‰æœºä¼šè¿›è¡Œè¡¥åŒ…ï¼ŒMä¸ºå¯è¡¥åŒ…çš„æ•°é‡ï¼Œè¯·è¿”å›è¡¥åŒ…åæœ€å¤§å¯è¿ç»­å‘é€æ•°æ®çš„æ•°é‡</span><br><span class="line"></span><br><span class="line">æ— éœ€å®ç°äº¤äº’å¼è¾“å…¥ï¼Œåªéœ€å®ç°å¦‚ä¸‹å‡½æ•°</span><br><span class="line"><span class="type">int</span> <span class="title function_">maxContinuousPackages</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[] lostPackages, <span class="type">int</span> m)</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ ·ä¾‹</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ç¤ºä¾‹1ï¼š</span><br><span class="line">3</span><br><span class="line">1 5 10</span><br><span class="line">1</span><br><span class="line">-----</span><br><span class="line">9995</span><br><span class="line">æœ¬ç¤ºä¾‹ä¸­ï¼Œä¸¢åŒ…æ•°é‡Nä¸º3ï¼Œä¸¢åŒ…ä½ç½®åˆ†å¸ƒä¸ºç¬¬1ã€5ã€10ä¸‰ä¸ªä½ç½®ï¼Œè¡¥åŒ…æ•°é‡Mä¸º1ï¼›åœ¨ç¬¬10ä¸ªä½ç½®è¡¥åŒ…åå¯è¿ç»­å‘åŒ…æ•°é‡æœ€å¤§ï¼Œä¸º10000 - 5 = 9995</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹2ï¼š</span><br><span class="line">4</span><br><span class="line">4 6 20 9990</span><br><span class="line">2</span><br><span class="line">-----</span><br><span class="line">9994</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹3ï¼š</span><br><span class="line">4</span><br><span class="line">1500 4100 5000 8000</span><br><span class="line">2</span><br><span class="line">---</span><br><span class="line">6499</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹4ï¼š</span><br><span class="line">4</span><br><span class="line">4 699 700 9990</span><br><span class="line">2</span><br><span class="line">---</span><br><span class="line">9985</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹5ï¼š</span><br><span class="line">6</span><br><span class="line">100 2700 5100 7498 7499 7500</span><br><span class="line">2</span><br><span class="line">---</span><br><span class="line">7397</span><br></pre></td></tr></table></figure>
<p>AC ä»£ç ï¼Œä¸­é€”å†™é”™äº†è¿˜è€ƒè™‘äº†åŠ¨æ€è§„åˆ’ï¼Œå¯¼è‡´ä¸‰ååˆ†é’Ÿç”¨æ»¡äº†ï¼Œè¯´æ˜¯æœ€å¤š 30
min å†æ»¡ä¸€ç‚¹æˆ‘å°± GG äº†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">maxContinuousPackages</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[] lostPackages, <span class="type">int</span> m)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> lostPackages.length, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] data = <span class="keyword">new</span> <span class="title class_">int</span>[len+<span class="number">1</span>];</span><br><span class="line">    data[<span class="number">0</span>] = lostPackages[<span class="number">0</span>]-<span class="number">1</span>;</span><br><span class="line">    data[data.length-<span class="number">1</span>] = <span class="number">10000</span> - lostPackages[len-<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;data.length-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        data[i] = lostPackages[i] - lostPackages[i-<span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m++;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;m; i++) &#123;</span><br><span class="line">        sum += data[i];</span><br><span class="line">    &#125;</span><br><span class="line">    ans = sum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=m; i&lt;data.length; i++) &#123;</span><br><span class="line">        sum -= data[i-m];</span><br><span class="line">        sum += data[i];</span><br><span class="line">        ans = Math.max(ans, sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans+m-<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç®—æ³•æ€è·¯è®²ä¸€éï¼Œä¸­é—´åšé”™äº†åˆ æ‰çš„ä»£ç ä¹Ÿè¦è®²ä¸ºä»€ä¹ˆåšé”™äº†ï¼Œç„¶åæŠŠä»£ç æˆªäº†ä¸ªå›¾</li>
<li>è¯´ä¸€ä¸‹è‡ªå·±çš„æŠ€æœ¯æ ˆ</li>
</ul>
<p>JavaåŸºç¡€ã€JUCã€JVMã€SpringBootã€MySQL</p>
<ul>
<li>æŒ‘ä¸€ä¸ªè‡ªå·±ç†Ÿæ‚‰çš„è®²ä¸€è®²ï¼Œé€‰äº† MySQL ç´¢å¼•</li>
</ul>
<p>B+ æ ‘ç»“æ„ï¼Œèšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•ã€å’Œ B æ ‘çš„å¯¹æ¯”</p>
<ul>
<li>å¦‚æœè®©ä½ å»ºä¸€å¼ è¡¨ï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡ç´¢å¼•</li>
</ul>
<p>è”åˆç´¢å¼•ã€è¦†ç›–ç´¢å¼•ã€å‰ç¼€ç´¢å¼•</p>
<ul>
<li>IOC å®¹å™¨çš„ç†è§£</li>
</ul>
<p>ä»£ç†æ‰€æœ‰å•ä¾‹çš„åˆ›å»ºï¼Œé˜²æ­¢é¢‘ GC</p>
<ul>
<li>é‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨å•ä¾‹æ¨¡å¼è€Œç”¨ IOC å®¹å™¨çš„ Bean</li>
</ul>
<p>è¿˜èƒ½å®ç° Bean çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå¯ä»¥å®ç° AOP</p>
<ul>
<li>ç”¨ Python èƒ½å¦å®ç° AOP</li>
</ul>
<p>æˆ‘è¯´ä¸èƒ½ï¼ŒAOP å®ç°éœ€è¦æ“ä½œå­—èŠ‚ç ï¼Œä»–è¯´è¡Œï¼Œæˆ‘é“æ­‰</p>
<ul>
<li>è®¾è®¡æ¨¡å¼è®²ä¸€ä¸‹</li>
</ul>
<p>è®²äº† SpringMVC ä¸­ HanderAdapter ç”¨åˆ°çš„é€‚é…å™¨æ¨¡å¼</p>
<ul>
<li>Rest å’Œ Rpc æœ‰ä»€ä¹ˆåŒºåˆ«</li>
</ul>
<p>é¦–å…ˆè¯´äº†å®ä¹ çš„æ—¶å€™ Rpc åº•å±‚æœ‰ç”¨åˆ° Rest
ä¼ è¾“æ•°æ®åŒ…ï¼Œè€Œè¿™æ²¡æœ‰æœ¬è´¨åŒºåˆ«</p>
<p>http å¤´éƒ¨å†—ä½™ï¼Œæ•ˆç‡ä½ï¼›ä½† http3 æ•ˆç‡æŒºå¥½ä½†æ²¡æ™®åŠ</p>
<p>Rpc æ›´é€‚åˆåå°å†…éƒ¨è°ƒç”¨ï¼Œæ•ˆç‡é«˜ï¼›Rest é€‚åˆæ‰€æœ‰åœºæ™¯ï¼Œé€‚é…åšçš„å¥½</p>
<ul>
<li>OS ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€</li>
</ul>
<p>æ²¡å¤ä¹ åˆ°çš„å…«è‚¡ï¼Œè¯´äº†ä¸‹è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€ï¼Œé¡µçš„æ˜ å°„ï¼Œé“æ­‰</p>
<ul>
<li>ä¼šä»€ä¹ˆè¯­è¨€</li>
</ul>
<p>è¿˜ä¼šç‚¹ Pythonï¼Œä¸æ‡‚ C</p>
<ul>
<li>åé—®ï¼Œè¿›å»éœ€è¦ä»€ä¹ˆæŠ€æœ¯æ ˆ</li>
</ul>
<p>Java å¾®æœåŠ¡å¼€å‘ç­‰</p>
<h1 id="å°çº¢ä¹¦ä¸€é¢">2024.4.29 å°çº¢ä¹¦ä¸€é¢</h1>
<blockquote>
<p>ä»¥åæœ‰æœºä¼šçš„è¯å¯ä»¥é—®é—® HR
è¿™ä¸ªéƒ¨é—¨æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œå†åšç›¸åº”çš„å‡†å¤‡ï¼Œä¸ç„¶ä¸´æ—¶æŠ±ä½›è„šå¯èƒ½æŠ±é”™ä½›äº†ã€‚</p>
</blockquote>
<p>ä»–æ¸©æˆ‘å“­ï¼Œé¢è¯•å®˜åˆå¸…åˆè´´å¿ƒï¼Œçœ‹åˆ°æˆ‘ç´§å¼ ä¹Ÿä¸å‚¬æˆ‘ã€‚ä½†æ˜¯ä»–ä¸€ç›´åœ¨å¹æ°”ï¼Œæå¾—æˆ‘å‹åŠ›å¥½å¤§ã€‚é¢è¯•æ€»å…±30minï¼Œåç»­æ‰‹æ’•äº†ä¸€é“ç®—æ³•é¢˜20minï¼Œ==å·²ç»å¥½å‡ æ¬¡ç®—æ³•é¢˜è¯»é¢˜ä¸å‡†ç¡®äº†ï¼Œè¿ç»­å­—ä¸²å’Œå­åºåˆ—æœ€å®¹æ˜“ç†è§£é”™==</p>
<ol type="1">
<li><p>è‡ªæˆ‘ä»‹ç»</p></li>
<li><p>æ·±å…¥è®²ä¸€ä¸‹å®ä¹ ç»å†ï¼ˆå®Œå…¨æ²¡æƒ³åˆ°ä¼šé—®è¿™ä¸ªï¼‰</p></li>
</ol>
<p>æ•°æ®ä¸­å°é¡¹ç›®</p>
<ul>
<li>äº†è§£é¡¹ç›®æ¶æ„ï¼Œå¾®æœåŠ¡å’Œå¤šæ¨¡å—å¼€å‘ï¼Œæ•°æ®æµè¿‡ç¨‹</li>
<li>å°è¯•å¼€å‘å­—å…¸ç»“æ„</li>
<li>AOP æ—¥å¿—ï¼šè¿è¡Œæ—¶é—´ã€è°ƒç”¨æ¥å£ã€é€Ÿåº¦ã€ip</li>
<li>è°ƒç”¨å¾®æœåŠ¡è·å–è¿ç»´å¤§å±æ•°æ®ï¼Œå¹¶å±•ç¤ºï¼šçº¿ç¨‹æ± ã€CompletableFuture
çº¿ç¨‹å…ˆåè°ƒç”¨å…³ç³»</li>
</ul>
<ol start="3" type="1">
<li>æ—¥å¿— AOPï¼Œèƒ½ä¸èƒ½æŸ¥æ‰¾ã€è¿‡æ»¤é€»è¾‘ï¼Œä¸ºä»€ä¹ˆä¸ç”¨
ELKã€‚å¦‚æœæœ‰ç›‘æ§å¹³å°çš„è¯ï¼Œä¸ºä»€ä¹ˆä¸å­˜åˆ°ç›‘æ§å¹³å°é‡Œï¼ˆçœ‹å¾—å‡ºæ¥é¢è¯•å®˜å¾ˆå¥‡æ€ªæ€ä¹ˆåªæœ‰
AOP è®°å½•æ—¥å¿—ï¼Œæ²¡æœ‰å…¶ä»–çš„ç›¸å…³åŠŸèƒ½ï¼‰</li>
</ol>
<p>Leader å®‰æ’çš„ï¼Œç›´æ¥å­˜åˆ° MySQL ä¸­å³å¯ï¼ˆæªå¡ä¸€ä¸‹ï¼‰</p>
<ol start="4" type="1">
<li>AOP åº•å±‚åŸç†</li>
</ol>
<p>CGLibã€Java åŸç”Ÿï¼ŒSpringBoot ä¸­åªä½¿ç”¨ CGLib ä»£ç†ï¼ˆä¸€å®šè¦è¯´ Spring
æ˜¯å¯ä»¥é…ç½®çš„ï¼‰</p>
<ol start="5" type="1">
<li>è¡Œï¼Œç»§ç»­è¯´ï¼ˆæˆ‘è¶…ï¼Œæ€ä¹ˆè¯´å•Šè¯´å•¥å•Šï¼‰</li>
</ol>
<p>æ‰¯åˆ° Rpc æœåŠ¡ç«¯æ¥å£ä»£ç†ï¼›åº•å±‚åŸç†ï¼Œç¼–è¯‘æˆå­—èŠ‚ç ï¼Œè¯»å…¥ JVM
å‰åšä¸€å±‚ä»£ç†</p>
<ol start="6" type="1">
<li>æœ‰ A ç±»ä¸­çš„ BC æ–¹æ³•ã€‚B æ–¹æ³•ä½¿ç”¨æ³¨è§£ä»£ç†ï¼Œå†ç”¨ C æ–¹æ³•é€šè¿‡ this.B()
è°ƒç”¨ï¼Œä¼šå‡ºç°ä»€ä¹ˆé€»è¾‘</li>
</ol>
<p>ä¼šç›´æ¥è°ƒç”¨ B æ–¹æ³•</p>
<ol start="7" type="1">
<li><strong>é‚£å¦‚ä½•è®© this.B() çš„ä»£ç†ç”Ÿæ•ˆå‘¢</strong></li>
</ol>
<p>è·å–åˆ°è¢«ä»£ç†çš„ Beanï¼Œå†è°ƒç”¨ B æ–¹æ³•ã€å¦‚ä½•è·å–è¢« AOP ä»£ç†çš„
Beanï¼Ÿã€‘</p>
<ol start="8" type="1">
<li>ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼Œå­˜å‚¨å±‚ã€ç¼“å­˜å±‚ä¸€èµ·ç”¨çš„è¯æ€ä¹ˆåŠ</li>
</ol>
<p>åŒåˆ ä¸€è‡´æ€§</p>
<ol start="9" type="1">
<li>å•ä¾‹æ¨¡å¼å®é™…åº”ç”¨åœºæ™¯ï¼ŒSpring åº•å±‚çš„è®¾è®¡æœ‰å“ªäº›ç”¨åˆ°äº†å•ä¾‹æ¨¡å¼</li>
</ol>
<p>Spring å•ä¾‹æ¨¡å¼çš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> sychronize Singleton <span class="title function_">getInstace</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(instance==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(Singleton.class)&#123;</span><br><span class="line">            <span class="keyword">if</span>(instance==<span class="literal">null</span>) instance=<span class="keyword">new</span> <span class="title class_">Singleton</span>(); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>==åº•å±‚é’ˆå¯¹å•ä¾‹æ¨¡å¼çš„ä½¿ç”¨ï¼šIOC
å®¹å™¨ã€BeanFactory==ã€å·¥å…·ç±»ã€çº¿ç¨‹æ± ã€ApplicationContextè‡ªèº«ã€</p>
<ol start="10" type="1">
<li>åº•å±‚åˆ›å»º Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä¸€å®šä¼šç”¨åˆ° <code>synchronized</code>
å—ï¼Ÿ</li>
<li>å¯åŠ¨æ—¶ç›´æ¥æŠŠæ‰€æœ‰ Bean éƒ½åˆ›å»ºå¥½ï¼Œå¯ä¸å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</li>
</ol>
<p>Bean
ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåˆå§‹åŒ–å’Œä¾èµ–æ³¨å…¥æ˜¯ä¸¤ä¸ªé˜¶æ®µï¼Œä¸ä¼šç›¸äº’å½±å“ï¼Œå› æ­¤æ˜¯å®‰å…¨çš„</p>
<ol start="10" type="1">
<li>MySQL çš„ç´¢å¼•æœºåˆ¶</li>
</ol>
<p>èšç°‡ç´¢å¼•ï¼›ç›¸æ¯”äºè·³è¡¨ï¼ŒB+ æ ‘å¯ä»¥æœ‰æ•ˆé™ä½æ ‘çš„é«˜åº¦ï¼›ã€InnoDB çš„ B+
æ ‘åˆ°è¾¾å››å±‚çš„æƒ…å†µä¸‹èƒ½è£…ä¸‹å¤šå°‘æ•°æ®ï¼Ÿã€‘</p>
<ol start="10" type="1">
<li>B+ å’Œ B æ ‘çš„åŒºåˆ«</li>
</ol>
<p>é¡ºåºè®¿é—®å¶å­èŠ‚ç‚¹ï¼›ä¸­é—´èŠ‚ç‚¹ä¸ä¼šå­˜åˆ°ä¸‹å±‚èŠ‚ç‚¹</p>
<ol start="11" type="1">
<li>MySQL ä¹è§‚é”å’Œæ‚²è§‚é”</li>
</ol>
<p><del>MVCC</del>
æ—¶é—´æˆ³æˆ–ç‰ˆæœ¬å·å­—æ®µï¼›é—´éš™é”è¡Œé”è¡¨é”ã€æ‚²è§‚é”åº•å±‚å¦‚ä½•å®ç°çš„ï¼Ÿã€‘</p>
<ol start="12" type="1">
<li><strong>update ç”¨çš„æ˜¯è¡Œé”è¿˜æ˜¯è¡¨é”</strong></li>
</ol>
<p>åœ¨ update è¯­å¥çš„ where
æ¡ä»¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œå°±ä¼šå…¨è¡¨æ‰«æï¼Œäºæ˜¯å°±ä¼šå¯¹æ‰€æœ‰è®°å½•åŠ ä¸Š next-key
é”ï¼ˆè®°å½•é” + é—´éš™é”ï¼‰ï¼Œç›¸å½“äºæŠŠæ•´ä¸ªè¡¨é”ä½äº†</p>
<ol start="13" type="1">
<li>äºŒçº§ç´¢å¼•ã€è”åˆç´¢å¼•ã€æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™</li>
<li>Redis æ€ä¹ˆå®ç°è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼ˆä¸æ˜¯å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰</li>
<li>ç¼“å­˜ç©¿é€</li>
</ol>
<p>å¤ªç´§å¼ äº†ï¼Œå›ç­”æˆç¼“å­˜é›ªå´©äº†</p>
<ol start="13" type="1">
<li><strong>Redis å¤§ Key é—®é¢˜çš„å®šä¹‰ï¼Œè§£å†³æ–¹æ³•</strong></li>
<li><strong>çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ± çš„ä¸ªæ•°æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ</strong></li>
</ol>
<p>çº¿ç¨‹ç­‰å¾…æ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œéœ€è¦è¶Šå¤šçº¿ç¨‹ï¼›çº¿ç¨‹è®¡ç®—æ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œéœ€è¦è¶Šå°‘çº¿ç¨‹ï¼›</p>
<ul>
<li>CPUå¯†é›†å‹ä»»åŠ¡ï¼šN+1</li>
<li>IOå¯†é›†å‹ä»»åŠ¡ï¼š2N</li>
</ul>
<p>æ‰‹æ’•ç®—æ³•ï¼šã€300. æœ€é•¿é€’å¢å­åºåˆ—ã€‘ä¸€å¼€å§‹è´ªå¿ƒæ²¡å†™å‡ºæ¥ï¼Œåé¢ç”¨ dp
å†™å‡ºæ¥çš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line"><span class="type">int</span>[] data = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</span><br><span class="line">    data[i] = in.nextInt();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</span><br><span class="line">    dp[i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>; j&lt;i; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[j]&lt;data[i]) &#123;</span><br><span class="line">            dp[i] = Math.max(dp[i], dp[j]+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = Math.max(ans, dp[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(ans);</span><br></pre></td></tr></table></figure>
<p><strong>æ€»ç»“QA</strong></p>
<p><strong>Q</strong>ï¼šJDK åŠ¨æ€ä»£ç†å’Œ cglib çš„åº•å±‚å®ç°çš„åŒºåˆ«ï¼Ÿ</p>
<p><strong>A</strong>ï¼šJDKï¼šç›®æ ‡ç±»åŠ è½½åï¼Œä½¿ç”¨ Native
æ–¹æ³•åœ¨<strong>è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»</strong>ï¼Œå°†åˆ‡é¢ç»‡å…¥åˆ°ä»£ç†ç±»ä¸­ï¼›CGLibï¼šç›®æ ‡ç±»åŠ è½½åï¼Œå­—èŠ‚ç æ„å»ºæ¡†æ¶
<strong>ASM
æ„å»ºå­—èŠ‚ç </strong>æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œå°†åˆ‡é¢é€»è¾‘åŠ å…¥åˆ°å­ç±»ä¸­ï¼›AspectJï¼š<strong>ç¼–è¯‘æœŸé—´</strong>ï¼Œå°†åˆ‡é¢ç»‡å…¥ä»£ç†ç±»ä¸­ï¼Œå¾—åˆ°ä»£ç†åçš„å­—èŠ‚ç ï¼›</p>
<p><strong>Q</strong>ï¼šç±»ä¸Šæœ‰ AOP
æ³¨è§£ï¼Œå¦‚ä½•åˆ†åˆ«è·å–è¢«ä»£ç†å‰å’Œä»£ç†åçš„è¿™ä¸ªç±»å‘¢ï¼Ÿ</p>
<p><strong>A</strong>ï¼šä»£ç†å‰ï¼šç›´æ¥ new ä¸€ä¸ªå¯¹è±¡ï¼›ä»£ç†åï¼šé€šè¿‡
<code>ApplicationContext</code> æˆ– <code>@Autowired</code>
æ³¨è§£æ¥è·å–ä»£ç† Bean
å¯¹è±¡ï¼Œå³<strong>å®¹å™¨ä¸­åªä¼šå­˜æ”¾è¢«ä»£ç†è¿‡çš„ç±»</strong>ï¼›</p>
<p><strong>Q</strong>ï¼šå•ä¾‹æ¨¡å¼ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</p>
<p><strong>A</strong>ï¼šä¸»è¦å–å†³äº Bean æ˜¯å¦æ˜¯æ— çŠ¶æ€çš„ï¼Œå³ Bean
ä¸­æ˜¯å¦åŒ…å«å¯å˜çš„çŠ¶æ€ä¿¡æ¯ï¼›</p>
<p><strong>Q</strong>ï¼šMySQL å¦‚ä½•å®ç°ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ</p>
<p><strong>A</strong>ï¼šä¹è§‚é”ï¼šç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³å­—æ®µï¼›æ‚²è§‚é”ï¼šInnoDB
æ‰€æœ‰çš„è¡Œé”ç®—æ³•éƒ½æ˜¯åŸºäºç´¢å¼•å®ç°çš„ï¼Œé”å®šçš„éƒ½æ˜¯ç´¢å¼•æˆ–ç´¢å¼•åŒºé—´ï¼›</p>
<p><strong>Q</strong>ï¼šupdate ç”¨çš„æ˜¯è¡Œé”è¿˜æ˜¯è¡¨é”ã€TODOã€‘</p>
<p><strong>A</strong>ï¼šWhere
æ¡ä»¶åˆ¤æ–­æœ‰ç´¢å¼•å°±èµ°ç´¢å¼•ï¼Œèµ°ç´¢å¼•å°±é”ç´¢å¼•ï¼Œç´¢å¼•é”äº†å°±æ˜¯è¡Œé”ï¼Œä¸ç„¶å°±æ˜¯è¡¨é”</p>
<p><strong>Q</strong>ï¼šRedis æ€ä¹ˆå®ç°è¿‡æœŸåˆ é™¤ç­–ç•¥</p>
<p><strong>A</strong>ï¼šæƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤ï¼ˆä¸é‡‡ç”¨å®šæ—¶åˆ é™¤ï¼‰<img data-src="/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E9%A2%98%E6%B1%87%E6%80%BB/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5.jpg" class="" title="img"></p>
<p><strong>Q</strong>ï¼šRedis å¤§ Key é—®é¢˜çš„å®šä¹‰ï¼Œè§£å†³æ–¹æ³•</p>
<p><strong>A</strong>ï¼šä»åº”ç”¨æœåŠ¡ã€æŒä¹…åŒ–è§’åº¦åˆ†åˆ«ä½œç­”</p>
<p><strong>å®šä¹‰</strong>ï¼šæŸä¸ª key æ‰€å¯¹åº”çš„ value è¿‡å¤§ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äº
String ç±»å‹çš„æ•°æ®ï¼Œå¦‚æœå…¶å¤§å°è¶…è¿‡ 10KBï¼Œä¸€èˆ¬è¢«è®¤ä¸ºæ˜¯å¤§ keyï¼›è€Œå¯¹äº
setã€zsetã€hash ç­‰é›†åˆç±»å‹çš„æ•°æ®ï¼Œå¦‚æœå…¶åŒ…å«çš„å…ƒç´ æ•°é‡è¶…è¿‡ 5000
æ¡ï¼Œä¹Ÿé€šå¸¸è¢«è§†ä¸ºå¤§ keyã€‚</p>
<p><strong>è§£å†³åŠæ³•</strong>ï¼š</p>
<ul>
<li>æŠŠå¤§ key æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå° keyï¼›</li>
<li>å°†å¤§ Key æ‹†åˆ†æˆå¤šä¸ªå° Key å¹¶ç”¨ Hash ç»“æ„å­˜å‚¨ï¼›</li>
<li>å®šæ—¶æ£€æŸ¥ Redis æ˜¯å¦å­˜åœ¨å¤§ key ï¼Œå¦‚æœè¯¥å¤§ key æ˜¯å¯ä»¥åˆ é™¤çš„ï¼Œä¸è¦ä½¿ç”¨
DEL å‘½ä»¤åˆ é™¤ï¼Œå› ä¸ºè¯¥å‘½ä»¤åˆ é™¤è¿‡ç¨‹ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯ç”¨ unlink å‘½ä»¤ï¼ˆRedis
4.0+ï¼‰åˆ é™¤å¤§ keyï¼Œå› ä¸ºè¯¥å‘½ä»¤çš„åˆ é™¤è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼›</li>
</ul>
<p>é€ æˆçš„ä¸è‰¯å½±å“ï¼š</p>
<ul>
<li>åº”ç”¨æœåŠ¡ï¼šRedis æ˜¯å•çº¿ç¨‹çš„ï¼Œå¤§ Key
å†™å…¥å’Œåˆ é™¤ä¼šé˜»å¡å…¶ä»–å‘½ä»¤ï¼›å†…å­˜åˆ†å¸ƒä¸å‡ï¼Œå¤±å»å†…å­˜æ—¶ç©ºå±€éƒ¨æ€§ç‰¹æ€§ï¼›ç½‘ç»œé˜»å¡ï¼ŒIO
å‹åŠ›å¤§ï¼›</li>
<li>æŒä¹…åŒ–ï¼šAlways å‚æ•°ä¸‹æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜æ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼›ç»å¸¸æ€§è§¦å‘AOF
é‡å†™æœºåˆ¶ï¼›AOF é‡å†™æœºåˆ¶å’Œ RDB å¿«ç…§ï¼ˆbgsave å‘½ä»¤ï¼‰çš„è¿‡ç¨‹ï¼Œéƒ½ä¼šåˆ†åˆ«é€šè¿‡
fork()
å‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œä¼šå¯¼è‡´é˜»å¡çˆ¶è¿›ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼›é›†ç¾¤æ¨¡å¼ä¸‹å†…å­˜åˆ†å¸ƒä¸å‡</li>
</ul>
<h1 id="æ’ç”Ÿä¸€é¢">2024.4.10 æ’ç”Ÿä¸€é¢</h1>
<p>è™½ç„¶é¢è¯•åªæœ‰
17minï¼Œä½†æ„Ÿè§‰å†é•¿ä¸€ç‚¹æˆ‘çœŸçš„è¦èšŒåŸ ä½äº†ï¼Œå“­ï¼ˆåœ¨æ­ç”µåäºŒæ•™çº¿ä¸‹é¢çš„ï¼‰</p>
<p>åæ€ï¼šè‡ªæˆ‘ä»‹ç»å‡†å¤‡ä¸è¶³ï¼Œéƒ½è¦å¼€å§‹é¢è¯•äº†è¿˜åœ¨è€ƒè™‘æ€ä¹ˆæ”¹ï¼ˆå…¶å®ä¹Ÿæ€ªä»–ä»¬é¢è¯•é€šçŸ¥å¤ªæ™šäº†ï¼Œä¸æ€ªæˆ‘å˜»å˜»ï¼‰å¹³æ—¶å­¦çš„ä¸æ‰å®ï¼Œè¯´ä¸å‡º
AQS çš„åº•å±‚å®ç°åŸç†æˆ‘å¯ä»¥æ¥å—ï¼Œä½†è¿ AQS
éƒ½æ²¡æåˆ°å®åœ¨æ˜¯å¤ªè ¢äº†ï¼Œæœç„¶è¿˜æ˜¯å‡†å¤‡çš„ä¸å¤Ÿå……åˆ†ã€‚è°¢è°¢æ’ç”Ÿä¸€å·´æŒæ‹é†’äº†æˆ‘ï¼Œè®¤æ¸…äº†è‡ªå·±è¿˜æ˜¯ä¸ªå°èœé¸¡ã€‚æ‘†æ­£å¿ƒæ€ï¼Œç»§ç»­åŠªåŠ›ï¼ï¼ï¼</p>
<ol type="1">
<li>è‡ªæˆ‘ä»‹ç»</li>
</ol>
<p>é¢è¯•å®˜çœ‹äº†ç®€å†ï¼Œè¯´â€œä¸æ„§æ˜¯è½¯ä»¶å·¥ç¨‹å†…å®¹æ¯”åˆ«äººå¤šå¤šäº†â€ï¼Œé¢è¯•å®˜çœŸçš„æ˜¯å¾ˆè®¤çœŸçš„æŠŠç®€å†ä»å¤´çœ‹åˆ°å°¾ï¼ˆæ³ªç›®ï¼‰</p>
<ol start="2" type="1">
<li>Rpc é¡¹ç›®å…·ä½“æ˜¯ä»€ä¹ˆ</li>
</ol>
<p>å› ä¸ºè‡ªæˆ‘ä»‹ç»é‡Œè¯´äº†ä¸ºä»€ä¹ˆè¦åš RPC é¡¹ç›®ï¼Œé¢è¯•å®˜é¡ºåŠ¿é—®äº†ã€‚</p>
<p>ç®€å•è¯´äº†ä¸Šæ®µå®ä¹ ä¸­ç”¨åˆ°äº†è‡ªå®šä¹‰ Cluster é›†ç¾¤ç­–ç•¥ï¼Œå› ä¸º Dubbo è‡ªå¸¦çš„
ClusterRulesï¼ˆå¹¿æ’­ã€å¤±è´¥ç«‹åˆ»è¿”å›ï¼‰æ²¡æœ‰æ¶‰åŠåˆ°è½®è¯¢æ£€æŸ¥ç¦»çº¿ä»»åŠ¡æ˜¯å¦å®Œæˆçš„åŠŸèƒ½ï¼Œæ‰€ä»¥
Leader è®©æˆ‘åˆ©ç”¨ Dubbo çš„ SPI
æœºåˆ¶åšäº†ä¸€ä¸ªæŸ¥è¯¢å¾®æœåŠ¡çš„è®¡ç®—è¿‡ç¨‹æ˜¯å¦å®Œæˆçš„æ–¹æ³•ï¼Œç„¶åæŒ‚è½½åœ¨
META-INF/dubbo ä¸‹å°± Dubbo
æ¡†æ¶å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥é›†ç¾¤æ‰§è¡Œæ–¹å¼ï¼ˆå½“æ—¶è¯´çš„å¹¶æ²¡æœ‰è¿™ä¹ˆæ¸…æ™°ï¼Œè¿˜æ˜¯å¤ªèœäº†å‘œå‘œï¼‰</p>
<ol start="3" type="1">
<li>å¦‚ä½•åˆ†æ dump æ–‡ä»¶</li>
</ol>
<p>æ„Ÿè§‰ç®€å†é‡Œå”¯ä¸€å¸å¼•é¢è¯•å®˜çš„å°±æ˜¯å¦‚ä½•å¤„ç† OOM Crash äº†ã€‚</p>
<p>æµ‹è¯•æŠ¥æœåŠ¡å¼‚å¸¸ï¼Œçº¿ç¨‹æ± ç­‰å¾…é˜Ÿåˆ—è¿‡é•¿ï¼›Leader å¸¦æˆ‘ç”¨ jstack
è·å¾—çº¿ç¨‹çš„çŠ¶æ€ï¼›å‘ç°è¯¥çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½å¤„åœ¨é˜»å¡çŠ¶æ€ï¼Œå¹¶ä¸”éƒ½é˜»å¡åœ¨çˆ¶çº¿ç¨‹ï¼›æŸ¥çœ‹çˆ¶å­çº¿ç¨‹è°ƒç”¨å…³ç³»å’Œ
Executors.<em>newFixedThreadPool</em>(25) åº•å±‚åŸç†ï¼Œå‘ç° FixedThreadPool
ä½¿ç”¨äº†æ— é™é•¿çš„é˜»å¡é˜Ÿåˆ—ï¼Œçˆ¶çº¿ç¨‹æœªæ‰§è¡Œå®Œæˆï¼Œä¸”å­çº¿ç¨‹åªèƒ½åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œé€ æˆæ­»é”æ‰€ä»¥é˜Ÿåˆ—ä¸€ç›´åœ¨å˜é•¿</p>
<ol start="4" type="1">
<li>synchronized Reentrantlock çš„å…·ä½“ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒ</li>
</ol>
<p>åªçŸ¥é“åº•å±‚å®ç°åŸç†ä¸åŒä¸”éƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¹¶ä¸çŸ¥é“å…·ä½“ä½¿ç”¨åœºæ™¯çš„åŒºåˆ«ï¼ˆå“ªæ¥çš„è¿™ä¹ˆçœŸå®ä¸šåŠ¡å¤šåœºæ™¯å•Šå–‚ï¼‰</p>
<ol start="5" type="1">
<li>MySQL è°ƒä¼˜</li>
</ol>
<p>æ„šè ¢çš„æˆ‘åªçŸ¥é“æ„å»ºç´¢å¼•ã€ä¼˜åŒ–è¡¨ç»“æ„å’Œå¢å¤§
BufferPoolï¼Œå¥½åœ¨åç»­ä¸Šç½‘ä¹Ÿæ²¡æ‰¾åˆ°ä»€ä¹ˆå¾ˆå¥½çš„æ–¹æ³•ã€‚æˆ–è®¸==é¢„ç¼–è¯‘ SQL
è¯­å¥==æ˜¯ä¸ªä¸é”™çš„æƒ³æ³•ï¼Œæ ¹æ® MySQL è¿è¡Œè¿‡ç¨‹æ¨å‡ºçš„ä¼˜åŒ–æ–¹æ³•ã€‚</p>
<h1 id="é¢è¯•-prepare">é¢è¯• Prepare</h1>
<h2 id="è‡ªæˆ‘ä»‹ç»">è‡ªæˆ‘ä»‹ç»</h2>
<blockquote>
<p>ç”±äºé”™è¯¯ä½¿ç”¨ Dubbo æ³¨è§£å¯¼è‡´çš„ JVM å¼‚å¸¸é—®é¢˜ï¼›Rpc ä¸­é—´ä»¶é‡‡ç”¨ Netty
ä¼ è¾“æ•°æ®ã€Zookeeper
æ³¨å†ŒæœåŠ¡;è°ƒåº¦å„å¾®æœåŠ¡ï¼Œèšåˆå¹¶ç¼“å­˜æ•°æ®ï¼›æˆ‘è¿˜å’ŒåŒäº‹ä¸€èµ·åˆ†æè§£å†³äº†çº¿ä¸Šå‘Šè­¦äº‹æ•…ï¼›</p>
</blockquote>
<p>é¢è¯•å®˜æ‚¨å¥½ï¼Œå¾ˆè£å¹¸èƒ½æ¥å‚åŠ åä¸ºçš„é¢è¯•ï¼Œæˆ‘å«ç‹å“²æ–‡ï¼Œç›®å‰åœ¨æ­å·ç”µå­ç§‘æŠ€å¤§å­¦è¯»ç ”ï¼Œæœ¬ç§‘å°±è¯»äºæµ™å¤§åŸå¸‚å­¦é™¢ã€‚</p>
<p>æœ¬ç§‘æœŸé—´æˆ‘åŠ å…¥äº†é»‘èƒ¡æ¡ƒå®éªŒå®¤ï¼Œå‚ä¸äº†æ™ºæ…§å®éªŒå®¤å’Œæ—¶é—´åºåˆ—é¢„æµ‹ç­‰é¡¹ç›®ï¼Œè¿˜åœ¨å®éªŒå®¤ä¸¾åŠçš„
2020
å¹´è°·æ­Œå¼€å‘è€…å¤§ä¼šä¸Šåˆ†äº«äº†è‡ªå·±çš„é¡¹ç›®ç»éªŒã€‚æˆ‘åœ¨æµ™æ±Ÿåå¤é“å¨æ•°æ®ç§‘æŠ€æœ‰é™å…¬å¸å®ä¹ æœŸé—´ï¼Œä¸»è¦è´Ÿè´£æ—¥å¿—åˆ‡é¢å’Œè¿ç»´å¤§å±çš„å¼€å‘ï¼Œåœ¨è¿™æœŸé—´æˆ‘ç§¯ç´¯äº†ä¼ä¸šçº§åˆ†å¸ƒå¼å¾®æœåŠ¡é¡¹ç›®çš„å¼€å‘ç»éªŒã€‚</p>
<p>åœ¨è¯»ç ”æœŸé—´ï¼Œæˆ‘åŠ å…¥äº†å¤§æ•°æ®ä¸åŸå¸‚è®¡ç®—å®éªŒå®¤ï¼Œä¸»è¦è´Ÿè´£ä¸‰å‹é˜´ææ¿é¡¹ç›®çš„åç«¯å¼€å‘å’ŒæŸæ¶‰å¯†é¡¹ç›®çš„å¤§è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘ã€‚åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸ä»…æ›´åŠ æ·±å…¥æŒæ¡äº†
SpringBootã€MySQLã€Redis ç­‰ä¸»æµæŠ€æœ¯ï¼Œè¿˜äº†è§£äº† Langchainã€PyTorchã€Milvus
ç­‰å‰æ²¿æŠ€æœ¯ã€‚åœ¨å·¥ä½œä¹‹ä½™ï¼Œæˆ‘è¿˜å­¦ä¹ äº† Rpc
ä¸­é—´ä»¶çš„æ¶æ„å’Œè®¾è®¡æ€æƒ³ï¼Œå¹¶å¼€å‘äº†ä¸€ä¸ªç®€æ˜“çš„è½»é‡çº§ Rpc
ä¸­é—´ä»¶ã€‚æ­¤å¤–ï¼Œæˆ‘è¿˜æ­å»ºäº†ä¸ªäººåšå®¢ç½‘ç«™ï¼Œå®šæœŸå‘å¸ƒå­¦ä¹ ç¬”è®°å’ŒæŠ€æœ¯æ€»ç»“ï¼Œä¸æ–­æ²‰æ·€è‡ªå·±çš„å¼€å‘ç»éªŒã€‚</p>
<p>æœ€åï¼Œæˆ‘éå¸¸å¸Œæœ›èƒ½æœ‰æœºä¼šåŠ å…¥åä¸ºï¼Œå°†æ‰€å­¦çŸ¥è¯†åº”ç”¨åˆ°å®é™…å·¥ä½œä¸­ï¼Œå¹¶ä¸ä¼˜ç§€çš„å›¢é˜Ÿä¸€èµ·å…±åŒæˆé•¿ã€‚è°¢è°¢ï¼</p>
<h2 id="é¡¹ç›®å›°éš¾è§£å†³æ–¹æ³•">é¡¹ç›®å›°éš¾/è§£å†³æ–¹æ³•</h2>
<p>å®ä¹ </p>
<ul>
<li>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„å¤æ‚ === è¯·æ•™å‰è¾ˆã€æ‰“æ–­ç‚¹å¼„æ˜ç™½æ•°æ®æµï¼›</li>
<li>å¤šçº¿ç¨‹å¹¶å‘ï¼Œç¼–æ’ä»»åŠ¡æ‰§è¡Œæµç¨‹ === ç¾å›¢æŠ€æœ¯åšå®¢ CompletableFuture
åŸç†å’Œå®è·µï¼›</li>
<li>æ²Ÿé€šåä½œï¼Œå’ŒåŒäº‹äº¤æµï¼Œç†è§£åˆ«äººçš„æƒ³æ³•çš„åŒæ—¶æ¸…æ¥šåœ°è¡¨è¾¾è‡ªå·±çš„æƒ³æ³•ï¼›è®©é¢†å¯¼æ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå·¥ä½œé‡å’Œé‡éš¾ç‚¹åœ¨å“ª
=== å¤šæ²Ÿé€šå¤šäº¤æµï¼Œå…ˆç†æ¸…è‡ªå·±çš„æƒ³æ³•å†å’ŒåŒäº‹ã€é¢†å¯¼æ²Ÿé€šï¼›</li>
</ul>
<p>LLM åº”ç”¨å¼€å‘</p>
<ul>
<li>LLM éƒ¨ç½²ï¼ŒæŠ€æœ¯é€‰å‹ FastChatã€FastApiã€VLLM åŠ é€Ÿ ===
å®è·µå°è¯•ï¼Œé€‰æ‹©æœ€åˆé€‚çš„æ–¹æ³•ï¼›</li>
<li>æ€è€ƒå¦‚ä½•å®ç°éœ€æ±‚ ===
å‚è€ƒåˆ«äººå‘è¡¨çš„ç»éªŒå’Œæ€è·¯ï¼Œæ¯”å¦‚çœ‹è®ºæ–‡ã€æŠ€æœ¯åšå®¢ã€çº¿ä¸Šå®£è®²ä¼šã€å¼€æºé¡¹ç›®ç­‰ï¼Œåœ¨é’ˆå¯¹éœ€æ±‚æ”¹è¿›å’Œä¼˜åŒ–ï¼›</li>
<li>Prompt æ„å»ºï¼Œæ•°æ®åˆ‡åˆ†ã€æ•°æ®é›†æ„å»ºï¼šåˆ†è¯ã€åˆ†æ®µã€Embedding è®¡ç®—</li>
</ul>
<p>RPC ä¸­é—´ä»¶</p>
<ul>
<li>Netty æ•°æ®ä¼ è¾“</li>
<li>RPCæ¶æ„==Bean ç”Ÿå‘½å‘¨æœŸï¼Œåˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒï¼šzkï¼ˆCPã€zabç®—æ³•ï¼‰</li>
</ul>
<p>ä¸‰å‹</p>
<ul>
<li>æ•°æ®åº“ç¼“å­˜ä¸€è‡´æ€§è®¾è®¡</li>
<li>æ–°éœ€æ±‚çš„å¼€å‘</li>
</ul>
<h2 id="qa">Q&amp;A</h2>
<p><a
href="https://www.bilibili.com/read/cv13183086/#:~:text=%EF%BC%88%E7%AE%80%E5%8C%96%E7%89%88%EF%BC%89,%E5%8D%8E%E4%B8%BA%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BB%B7%E5%80%BC%E8%A7%82%E6%9C%89%E5%9B%9B%E4%B8%AA%E6%96%B9%E9%9D%A2%EF%BC%9A1%E3%80%81%E4%BB%A5%E5%AE%A2%E6%88%B7%E4%B8%BA%E4%B8%AD%E5%BF%83%EF%BC%8C%E5%AE%83%E5%8F%AF%E4%BB%A5%E7%A1%AE%E5%AE%9A%E5%A5%8B%E6%96%97%E7%9A%84%E6%96%B9%E5%90%91%3B2%E3%80%81%E4%BB%A5%E5%A5%8B%E6%96%97%E8%80%85%E4%B8%BA%E6%9C%AC%EF%BC%8C%E5%AE%83%E5%8F%AF%E4%BB%A5%E6%8F%90%E4%BE%9B%E6%B4%BB%E5%8A%9B%E7%9A%84%E6%BA%90%E6%B3%89%3B3%E3%80%81%E9%95%BF%E6%9C%9F%E8%89%B0%E8%8B%A6%E5%A5%8B%E6%96%97%EF%BC%8C%E8%BF%99%E6%98%AF%E5%AF%B9%E4%BA%BA%E4%BF%AE%E8%BA%AB%E7%9A%84%E4%B8%80%E4%B8%AA%E8%BF%87%E7%A8%8B%3B4%E3%80%81%E5%9D%9A%E6%8C%81%E8%87%AA%E6%88%91%E6%89%B9%E5%88%A4%EF%BC%8C%E5%9C%A8%E6%89%B9%E5%88%A4%E4%B8%AD%E8%83%BD%E5%A4%9F%E5%BE%97%E5%88%B0%E4%BF%AE%E5%BF%83%E3%80%82">åä¸ºæ ¸å¿ƒä»·å€¼è§‚</a></p>
<ul>
<li>ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒï¼Œä»¥å¥‹æ–—è€…ä¸ºæœ¬ï¼Œé•¿æœŸè‰°è‹¦å¥‹æ–—ï¼ŒåšæŒè‡ªæˆ‘æ‰¹åˆ¤</li>
</ul>
<p>è¯´è¯´è‡ªå·±å¯¹äºè‰°è‹¦å¥‹æ–—çš„çœ‹æ³•ï¼ˆç²¾ç¥ä¸Šçš„ï¼‰</p>
<ul>
<li>æˆ‘è®¤ä¸ºè‰°è‹¦å¥‹æ–—æ˜¯ä¸€ç§ç§¯æå‘ä¸Šã€ä¸æ–­è¿›å–çš„å“è´¨ï¼Œæ˜¯ä¸ºäº†å®ç°è‡ªèº«ä»·å€¼ï¼ŒåŠªåŠ›è¿‡ä¸Šå……å®ä¸”æœ‰æ„ä¹‰çš„äººç”Ÿï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ºäº†çœ¼å‰çš„åˆ©ç›Šï¼›</li>
<li>ç»“åˆæˆ‘è‡ªå·±çš„ç»å†æ¥çœ‹ï¼Œè™½ç„¶ä¸­è€ƒå¤±åˆ©äº†ï¼Œä½†æˆ‘ä»ä¿æŒåŠªåŠ›æ‹¼æçš„ä¿¡å¿µï¼Œåœ¨åç»­çš„é«˜è€ƒã€è€ƒç ”ä¸­ä¸æ–­è¶…è¶Šè‡ªå·±ï¼Œæ‰æœ‰æœºä¼šæ¥è§¦åˆ°äº†æ›´å¤šæœ‰æŒ‘æˆ˜æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼›</li>
</ul>
<p>ç§‘ç ”&amp;é¡¹ç›®ï¼š</p>
<ul>
<li><p>æ‹…ä»»è§’è‰²ï¼›è´Ÿè´£çš„å·¥ä½œï¼›é¡¹ç›®èƒŒæ™¯ï¼›å‰æœŸè°ƒç ”ï¼›åˆ›æ–°ç‚¹</p></li>
<li><p>é¡¹ç›®æœ‰å“ªäº›éš¾ç‚¹</p></li>
<li><p>å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼›å¦‚ä½•è§£å†³</p></li>
<li><p>ç§‘ç ”è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼›å¦‚ä½•è§£å†³</p>
<ul>
<li>ä¸€å¼€å§‹å¯¹ç§‘ç ”å†…å®¹ä¸€çªä¸é€šï¼Œé€šè¿‡ä¸æ–­çš„å­¦ä¹ è¯•é”™æ€»ç»“æ…¢æ…¢ç§¯ç´¯äº†ç»éªŒ</li>
</ul></li>
</ul>
<p>æ¥ä¸‹æ¥çš„ä¸€å¹´é‡Œæœ‰ä»€ä¹ˆè®¡åˆ’</p>
<ul>
<li>ä¸“åˆ©ä¿®æ”¹ï¼Œç§‹æ‹›æ‰¾å·¥ä½œï¼Œå†™å¤§è®ºæ–‡+æ¯•ä¸šç­”è¾©</li>
<li>å­¦ä¹ å¤§æ•°æ®æŠ€æœ¯æ ˆï¼ˆHadoopã€Map-Reduceã€Hbaseï¼‰ï¼Œå‡ºå›½æ—…è¡Œ</li>
</ul>
<p>æœªæ¥èŒä¸šè§„åˆ’</p>
<ul>
<li>è¿›å…¥ä¼˜ç§€çš„å›¢é˜Ÿä¸­å·¥ä½œå­¦ä¹ ï¼›</li>
<li>å‰å››å¹´æ·±è€•æŠ€æœ¯ï¼Œä¸æ–­å­¦ä¹ ï¼Œæ²‰æ·€æŠ€æœ¯æ ˆï¼Œæ‹“å®½è§†é‡ï¼›</li>
<li>æŠ“ä½æœºé‡ï¼Œç¬¬å…­ã€ä¸ƒå¹´åº”è˜ç®¡ç†å±‚ï¼Œæ¥ä¸šåŠ¡ï¼Œå¸¦å›¢é˜Ÿï¼Œä¸€ä¸ªäººçš„åŠ›é‡ç»ˆç©¶æ˜¯æœ‰é™çš„ï¼Œåªæœ‰æ¿€å‘å›¢é˜Ÿçš„åŠ›é‡æ‰èƒ½åŠæˆå¤§äº‹ï¼›</li>
</ul>
<p>ä¸ºäº†è¾¾æˆè¿™äº›è§„åˆ’å…·ä½“ä¼šåšäº›è¡ŒåŠ¨</p>
<ul>
<li>å­¦ä¹ å¤§æ•°æ®ç›¸å…³çš„æŠ€æœ¯æ ˆï¼›</li>
<li>æŠ“ä½ç°æœ‰æœºä¼šï¼Œç§¯ææŠ•èº«å·¥ä½œä¸­ï¼Œä¸æ–­æå‡æŠ€æœ¯èƒ½åŠ›ï¼Œæ‰©å¤§äººè„‰ã€‚è€å¿ƒåœ°ç­‰å¾…æœºé‡ï¼Œå½“æœºé‡æ¥ä¸´æ—¶æœæ–­æŠ“ä½å®ƒï¼›</li>
</ul>
<p>ç»©ç‚¹æ’å</p>
<ul>
<li>å¤§ä¸€åªæœ‰ä¸­æ¸¸æ°´å¹³ï¼Œåé¢å‡ å¹´æ’åé€å¹´ä¸Šå‡ï¼Œå¤§ä¸‰æ‹¿åˆ°äº†å­¦ä¸šå¥–å­¦é‡‘å¹¶è€ƒç ”æˆåŠŸã€‚åœ¨è¯»ç ”æœŸé—´ä¹Ÿèƒ½æœ‰ä¸­ä¸Šæ¸¸çš„ç»©ç‚¹ï¼Œæ‹¿åˆ°äº†å­¦ä¸šå¥–å­¦é‡‘ï¼›</li>
</ul>
<p>å¦‚ä½•çœ‹å¾…åä¸ºå…¬å¸ï¼Ÿä¸ºä»€ä¹ˆæƒ³æ¥åä¸ºå…¬å¸è¿›è¡Œå®ä¹ ï¼Ÿ</p>
<ul>
<li>æ— è®ºæ˜¯åœ¨èŠ¯ç‰‡ã€æ“ä½œç³»ç»Ÿè¿˜æ˜¯åœ¨æ‰‹æœºã€æ±½è½¦ç­‰é¢†åŸŸï¼Œåä¸ºéƒ½æ˜¯ä¸­å›½çš„ä¸€çº¿å“ç‰Œï¼Œåä¸ºå½“ä¸‹åœ¨åšçš„äº‹æƒ…ç›¸å½“äºäº”åå¹´å‰çš„æ ¸æ­¦å™¨ç ”ç©¶ï¼›</li>
<li>å‚åŠ åä¸ºä¸¾åŠçš„ç«èµ›æ„Ÿå—åˆ°åä¸ºçš„äººæ–‡å…³æ€€åšå¾—å¾ˆå¥½ï¼Œæ¯”èµ›åœºåœ°å¸ƒç½®çš„å¾ˆç”¨å¿ƒï¼Œæ¯”èµ›ç»“æŸåè¿˜ä¸¾åŠäº†æ´»åŠ¨ï¼Œåƒäº†å¤§é¤ï¼Œä¸´èµ°è¿˜é€å’Œä¸€è¢‹çºªå¿µå“ï¼ŒåŒ…æ‹¬æ‰€æœ‰äººçš„åˆç…§ï¼›</li>
<li>ä½“éªŒå¤§å‚çš„æ°›å›´å’Œç®¡ç†åˆ¶åº¦ï¼Œå’Œä¼˜ç§€çš„å›¢é˜Ÿä¸€èµ·æˆé•¿ï¼ŒåŠªåŠ›å·¥ä½œï¼Œäº‰å–æ¯•ä¸šç•™åœ¨åä¸ºï¼›</li>
</ul>
<p>èƒ½å¤Ÿå®ä¹ å¤šé•¿æ—¶é—´ï¼Ÿ</p>
<ul>
<li>åŠå¹´ï¼Œç«‹åˆ»åˆ°å²—</li>
</ul>
<p>å¯¹ä»€ä¹ˆæ„Ÿå…´è¶£å¹¶åšäº†ä»€ä¹ˆåŠªåŠ›ï¼Ÿ</p>
<ul>
<li>å¯¹å¤§è¯­è¨€æ¨¡å‹å¾ˆæ„Ÿå…´è¶£ï¼›LLM
çš„è®­ç»ƒå’Œå¾®è°ƒå¯¹ç¡¬ä»¶å’Œæ•°æ®é›†çš„è¦æ±‚é«˜ï¼Œä½†å®éªŒå®¤åªæœ‰ A6000ï¼Œæ›´åŠ é€‚åˆ LLM
çš„åº”ç”¨å¼€å‘ï¼Œçœ‹äº†å¾ˆå¤šè®ºæ–‡ã€å¼€æºé¡¹ç›®å’ŒæŠ€æœ¯åšå®¢ï¼Œæœ€ç»ˆè®©åŸºäºå¤§è¯­è¨€æ¨¡å‹å®ç°ä¸€ä¸ªå…·ä½“éœ€æ±‚çš„è¿‡ç¨‹éå¸¸æœ‰æˆå°±æ„Ÿï¼›</li>
</ul>
<p>ç§‘ç ”æœŸé—´æœ€å¤§çš„å›°éš¾</p>
<ul>
<li>å¯¹è¯­è¨€æ¨¡å‹æ²¡æœ‰ä»»ä½•äº†è§£ï¼Œå®éªŒå®¤ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è¯­è¨€æ¨¡å‹çš„é¡¹ç›®ï¼Œæ²¡æœ‰ä»»ä½•æ²‰æ·€ï¼Œä¸€å¼€å§‹ä¸Šæ‰‹å¾ˆè‰°éš¾ï¼Œåªèƒ½ä¸æ–­é‡å¤å»çœ‹ç½‘è¯¾å’Œæ•™ç¨‹ï¼›</li>
</ul>
<p>å¦‚ä½•è·å–èµ„æ–™</p>
<ul>
<li>è®ºæ–‡ã€æŠ€æœ¯åšå®¢ã€å¼€æºé¡¹ç›®ã€ç¤¾ç¾¤å®£è®²ä¼š</li>
</ul>
<p>ä»€ä¹ˆä¸œè¥¿èµ·äº†å¾ˆå¤§çš„ä½œç”¨</p>
<ul>
<li>æŠ€æœ¯åšå®¢ï¼Œå› ä¸ºå®ƒæ›´åŠ è´´è¿‘å®é™…è½åœ°çš„å·¥ä½œï¼Œå¤§ä½¬ä»¬ç•™ä¸‹çš„ç»éªŒå¾€å¾€ç»™æˆ‘çµæ„Ÿ</li>
</ul>
<p>é‡å¤§çš„æŒ«æŠ˜</p>
<ul>
<li>äººç”Ÿä¸­æœ€å¤§çš„æŒ«æŠ˜åº”è¯¥æ˜¯ä¸­è€ƒï¼Œæˆ‘å½“åˆå†²é‡é«˜ä¿åº•ä¼˜é«˜ï¼Œæœ€åå‘æŒ¥å¤±å¸¸åªè€ƒä¸Šäº†èŒé«˜ï¼›</li>
<li>é«˜ä¸­
ä¿æŒå­¦ä¹ çš„åŠ²å¤´ï¼Œç¨³æ‰ç¨³æ‰“ï¼Œé«˜è€ƒè¶…é‡ç‚¹çº¿ï¼›è¿™æ®µç»å†è®©æˆ‘ä»»ä½•æ—¶å€™éƒ½ä¸ä¼šè½»è¨€æ”¾å¼ƒï¼Œå³ä½¿å¤±è´¥äº†ä¹Ÿæ²¡äº‹ï¼Œæ€»ç»“åæ€ä¹‹åå†å‡ºå‘ï¼Œå®¶äººå’Œæœ‹å‹ä¸€ç›´éƒ½åœ¨ï¼ŒæˆåŠŸä¸å¦åªæ˜¯æˆ‘è‡ªå·±çš„é€‰æ‹©ï¼›</li>
</ul>
<p>å‹åŠ›ç‰¹åˆ«å¤§çš„æ—¶å€™</p>
<ul>
<li>è·‘æ­¥ã€çˆ¬å±±ã€éª‘è¡Œ</li>
</ul>
<h2 id="ç§‘ç ”å†…å®¹">ç§‘ç ”å†…å®¹</h2>
<p>åº”ç”¨èƒŒæ™¯ï¼šå°†çŸ¥è¯†å›¾è°±åº”ç”¨åœ¨å¤§æ¨¡å‹é¢†åŸŸï¼Œæå‡ LLM
å“åº”çš„å‡†ç¡®æ€§å’Œé€»è¾‘æ€§ï¼›</p>
<p>åˆ›æ–°ç‚¹ï¼šä¸åŒäºç›®å‰æµè¡Œ RAGæ¶æ„ æ€æƒ³ï¼Œå¹¶ä¸æ˜¯é€šè¿‡ Prompt
å¸®åŠ©æ¨¡å‹è·å–å¤–éƒ¨çŸ¥è¯†ï¼Œè€Œæ˜¯å°†çŸ¥è¯†å›¾è°±ä¸­çš„æ•°æ®è®­ç»ƒåˆ°æ¨¡å‹ä¸­ï¼Œå¾®è°ƒåçš„æ¨¡å‹ä¸ä»…å¾—åˆ°äº†å›¾è°±ä¸­çš„å¤–éƒ¨çŸ¥è¯†ï¼Œè¿˜è·å–äº†å›¾è°±ä¸­èŠ‚ç‚¹ä¹‹é—´çš„é€»è¾‘æ€§ï¼ˆå¯¹è¯è¿‡ç¨‹ä¸­çš„ï¼‰ï¼›</p>
<p>å…·ä½“å®ç°ï¼š</p>
<p>ï¼ˆ1ï¼‰
æå‡ºäº†åŠ¨æ€ç­–ç•¥æ¨¡å‹ï¼Œè·Ÿè¸ªå†å²å¯¹è¯ä¸­ç”¨æˆ·è¯­å¥å¤šç±»ç‰¹å¾çš„åŠ¨æ€å˜åŒ–ï¼ŒæŠ½å–å¯¹è¯ä¸­æ·±å±‚æ¬¡çš„å…³ç³»å’Œå±æ€§ã€‚</p>
<p>ï¼ˆ2ï¼‰è®¾è®¡äº†ä¸€ä¸ªåŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„å¼‚æ„å›¾ç½‘ç»œï¼Œå°†ç”¨æˆ·çš„æ„å›¾ã€å†å²ç­–ç•¥å’Œä¸Šä¸‹æ–‡å¯¹è¯è¿›è¡Œäº¤äº’ï¼Œé€‰æ‹©æœ€ä¼˜çš„æ”¯æŒç­–ç•¥ä»¥ç”Ÿæˆæœ‰æ•ˆçš„æ”¯æŒå“åº”ã€‚</p>
<p>ï¼ˆ3ï¼‰è€ƒè™‘åˆ°å…¨å±€ç­–ç•¥æ§åˆ¶ç€æ•´ä¸ªå¯¹è¯æµï¼ŒDSAè®¾è®¡äº†ç›‘æ§å…¨å±€ç­–ç•¥ä¿¡æ¯çš„å­ä»»åŠ¡å’Œä¸Šä¸‹æ–‡åˆ°å…¨å±€çŠ¶æ€å’Œå…¨å±€çŠ¶æ€åˆ°ä¸Šä¸‹æ–‡çš„é—¨é™æ§åˆ¶ç½‘ç»œã€‚</p>
<p>å®éªŒï¼šåº”ç”¨äºæƒ…æ„Ÿæ”¯æŒå¯¹è¯é¢†åŸŸï¼Œå°†æƒ…æ„Ÿæ”¯æŒç­–ç•¥è§†ä½œä¸€ç§ç±»å‹çš„çŸ¥è¯†å›¾è°±ï¼ŒåŒæ—¶å¼•å…¥å¸¸è¯†æ€§çŸ¥è¯†å›¾è°±ï¼Œå¾®è°ƒ
BlenderBot æ¨¡å‹å­¦ä¹ çŸ¥è¯†å›¾è°±çš„èŠ‚ç‚¹ç‰¹å¾ï¼Œæé«˜æ¨¡å‹çš„åœ¨ ESConv
æ•°æ®é›†ä¸Šçš„æŒ‡æ ‡ï¼›</p>
<p><strong>æ­¥éª¤</strong></p>
<p>ã€3ã€‘</p>
<p>3 Methodã€2ã€‘</p>
<ul>
<li>3.1 overall
<ul>
<li>æå‡ºxxxï¼Œæœ‰æ•ˆè§£å†³xxxï¼Œæ¯”åˆ«äººå¥½åœ¨å“ªxxxã€‚åŒ…å«äº†ä¸‰ä¸ªæ¨¡å—ï¼Œä»‹ç»xxxï¼Œæ•°æ®æµxxxï¼Œæé«˜äº†å“ªäº›xxxï¼›ç”±äºè¿™ä¸‰ä¸ªç‰¹å¾ä¸èƒ½æœ‰æ•ˆè¡¨ç¤ºxxxï¼Œæ‰€ä»¥ç”¨å¼‚æ„å›¾ç½‘ç»œxxxï¼Œå¯å¾—åˆ°ä¸¤ä¸ªçŠ¶æ€ï¼Œxxxã€‚å› æ­¤ï¼Œæå‡ºçš„æ¨¡å‹ï¼Œæœ‰ä¸€æ ·ä¹Ÿæœ‰æœ‰ä¸ä¸€æ ·ã€æ€»åˆ†æ€»ã€‘</li>
</ul></li>
<li>3.2 archieve</li>
<li>3.3</li>
<li>3.4</li>
</ul>
<p>4 å®éªŒã€3ã€‘</p>
<ul>
<li></li>
<li>æŒ‡æ ‡ï¼Œè§£é‡Šï¼Œä¸ºä»€ä¹ˆå¥½ï¼Œå¥½åœ¨å“ª</li>
</ul>
<p>5 ç»“æœã€1ã€‘</p>
<p>6 æ€»ç»“ã€3ã€‘</p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>é¢è¯•è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä¿æŒä¸“æ³¨</title>
    <url>/#2024/Stay-Focused/</url>
    <content><![CDATA[<p>ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼Œå¼„æ˜ç™½å¦‚ä½•åšäº‹æ¯”ç³Šé‡Œç³Šæ¶‚çš„åšæ›´é‡è¦ã€‚å½“ä¸‹çš„ç›®æ ‡æ˜¯é€šè¿‡ä¸æ–­<strong>å®è·µè¯•é”™</strong>å¹¶<strong>æ€»ç»“çº é”™</strong>ï¼Œä»è€Œæ‰¾åˆ°æœ€é€‚åˆæˆ‘çš„é«˜æ•ˆä¸“æ³¨çš„åšäº‹æ–¹æ³•ã€‚åœ¨æ­¤ï¼Œå†ä»¥é«˜ä¸­çš„åº§å³é“­æ¿€åŠ±è‡ªå·±ï¼šå½“ä½ è§‰å¾—ä¸ºæ—¶å·²æ™šçš„æ—¶å€™ï¼Œæ°æ°æ˜¯æœ€æ—©çš„æ—¶å€™ã€‚ä»å­¦ç”Ÿå˜æˆç¤¾ä¼šäººã€ä»å­©å­å˜æˆå®¶åº­æ”¯æŸ±ã€ä»åšäº‹çš„å˜æˆç®¡äººçš„ï¼ˆæ€»ä¼šæœ‰é‚£å¤©çš„å•¦ï¼‰ï¼Œæˆ‘è¿˜æœ‰å¾ˆå¤šè¦æ”¹è¿›è¦å­¦ä¹ çš„åœ°æ–¹ï¼ˆå¦‚ä½•æ¸…æ¥šæ˜ç¡®çš„è¡¨è¾¾è‡ªå·±çš„å·¥ä½œå†…å®¹ï¼Œå¦‚ä½•é«˜æ•ˆæ˜ç¡®çš„å’Œåˆ«äººæ²Ÿé€šï¼‰ï¼Œè¿™äº›å˜åŒ–ä¸æ˜¯ä¸ºäº†é€‚åº”ç¤¾ä¼šçš„è¡¨æ¼”ï¼Œè€Œæ˜¯æˆå¹´äººçš„è´£ä»»ã€‚<del>ï¼ˆtmdè¿™æ–‡å­—åƒæ˜¯åˆä¸­ç”Ÿå†™å‡ºæ¥çš„ï¼Œæ–‡åŒ–æ²™æ¼ äº†å±äºæ˜¯ï¼Œæœ‰æ—¶é—´è¿˜æ˜¯å¾—å¤šçœ‹çœ‹ä¹¦æï¼‰</del></p>
<blockquote>
<p>Thought is already is late, exactly is the earliest time.</p>
</blockquote>
<h1 id="å¯åŠ¨">å¯åŠ¨</h1>
<p>å¸ƒç½®å¥½å·¥ä½œç¯å¢ƒï¼Œå®‰æ’å¥½å·¥ä½œå†…å®¹ï¼Œè®©è‡ªå·±å‘è‡ªå†…å¿ƒå¾—å¸Œæœ›æŠŠäº‹æƒ…å®Œæˆã€‚</p>
<ul>
<li><strong>æ—©èµ·ï¼Œç«‹å³å¼€å§‹å·¥ä½œ</strong>ã€‚æ—©èµ·ä¼šç«‹å³ç»™è‡ªå·±ä¸€ä¸ªæ½œæ„è¯†çš„ä¿¡å·ï¼Œè®©è‡ªå·±åœ¨é‚£å¤©åŠªåŠ›å·¥ä½œã€‚</li>
<li><strong>åˆ¶å®šä¸€ä¸ªè¡ŒåŠ¨è®¡åˆ’</strong>ã€‚ç”¨ 10
åˆ†é’Ÿæ¥ç­¹åˆ’æ¥ä¸‹æ¥çš„å‡ ä¸ªå°æ—¶è¦åšçš„äº‹æƒ…ï¼Œè®©äº‹æƒ…å¯ä»¥æ¨åŠ¨è‡ªå·±å‰è¿›ã€‚</li>
<li><strong>æå‰å®Œæˆä¸€è¿ä¸²çš„å·¥ä½œ</strong>ã€‚æ¸…æ™¨å°±å¤„ç†å®Œå½“å¤©æœ€ç´§è¦çš„å·¥ä½œï¼Œç™½å¤©çš„æ—¶é—´å°±ä¼šæ˜¾å¾—ä»å®¹ï¼Œè¿™ä¹Ÿä¼šäº§ç”Ÿç§¯æçš„å¯åŠ¨ï¼Œè¿™å°†æŒç»­ä¸€æ•´å¤©ã€‚</li>
</ul>
<h1 id="æ— å¹²æ‰°ä¼‘æ¯">æ— å¹²æ‰°ä¼‘æ¯</h1>
<p>ä¼‘æ¯å¯ä»¥å¸®åŠ©è‡ªå·±ä»¥æ–°çš„æ–¹å¼æ€è€ƒé—®é¢˜ï¼Œå¯ä»¥æ¸…é†’å¤´è„‘ï¼Œä»è€Œé‡æ–°é›†ä¸­æ³¨æ„åŠ›ã€‚æ— å¹²æ‰°çš„ä¼‘æ¯æ„å‘³ç€ä¼‘æ¯ä¸ä¼šæ‰¼æ€ä½ çš„åŠ¨åŠ›ï¼Œè¿™æ ·ä½ å°±å¯ä»¥é‡æ–°æŒ¯ä½œèµ·æ¥ï¼Œè€Œä¸ä¼šé™·å…¥æ‹–å»¶çš„å¼¯è·¯ã€‚</p>
<ul>
<li><strong>é¿å…å‚ä¸å¼çš„ä¼‘æ¯</strong>ã€‚çŸ­è§†é¢‘ï¼Œæ¸¸æˆï¼Œå¾®ä¿¡ç­‰ä¼šå æ®å¤´è„‘çš„ä¸œè¥¿éƒ½ä¼šæ‰“æ–­åšäº‹çš„åŠ¿å¤´ã€‚</li>
<li><strong>ä¸“æ³¨äºæ”¾æ¾</strong>ã€‚èµ°ä¸€å°æ®µè·¯ã€å–ä¸€æ¯æ°´æˆ–ä¼¸å±•èº«ä½“éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä»ä¼‘æ¯ä¸­æŠ½èº«å‡ºæ¥å›å»å·¥ä½œã€‚</li>
</ul>
<p>ä¼‘æ¯ä¸æ˜¯ä¸ºäº†ç©å¾—å¼€å¿ƒï¼Œè¿™æ‰æ˜¯çœŸæ­£ä¼‘æ¯çš„ç›®çš„ã€‚ä¼‘æ¯æ˜¯å…³äºæˆ˜ç•¥æ€§åœ°æ¢å¤ä½ çš„èƒ½é‡å’Œæ³¨æ„åŠ›ï¼Œä»¥é‡æ–°å¤„ç†æ‰‹å¤´çš„å·¥ä½œã€‚æŠŠç”µè§†ã€æ¸¸æˆå’Œå¨±ä¹æ´»åŠ¨ç•™ç»™æ™šä¸Šå¯ä»¥æ— æ„§ç–šåœ°æ”¾æ¾çš„æ—¶å€™ã€‚</p>
<h1 id="ç§¯æå·¥ä½œ">ç§¯æå·¥ä½œ</h1>
<p>è¢«åŠ¨ä»»åŠ¡æ¯”ä¸»åŠ¨ä»»åŠ¡æ›´éš¾é›†ä¸­æ³¨æ„åŠ›ã€‚æ”¹å˜è¿™ç§çŠ¶å†µçš„å…³é”®æ˜¯ï¼Œæˆ–è€…ã€‚</p>
<ul>
<li><strong>ä½¿ä»»åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€</strong>ã€‚å°†è¢«åŠ¨å­¦ä¹ ä»»åŠ¡è½¬æ¢ä¸ºä¸»åŠ¨å­¦ä¹ ä»»åŠ¡ï¼Œå¦‚å†™æçº²ã€è®°å½•é‡ç‚¹ã€‚</li>
<li><strong>ç©¿æ’æ´»åŠ¨ä»»åŠ¡</strong>ã€‚å°†è¢«åŠ¨å­¦ä¹ ä¸ä¸»åŠ¨ä»»åŠ¡ç©¿æ’åœ¨ä¸€èµ·ï¼Œä»¥å®šæœŸæé«˜æ³¨æ„åŠ›ï¼Œå¦‚è¡¨è¾¾è‡ªå·±è§è§£ã€ç”¨è‡ªå·±çš„è¯å¤è¿°ä¸€éã€‚</li>
</ul>
<blockquote>
<p><strong><a href="https://www.youtube.com/watch?v=FrNqSLPaZLc">Feynman
å­¦ä¹ æ³•</a></strong></p>
<p>Step1: choose your conceptã€å†™ä¸‹ä½ è¦å­¦ä¹ çš„æ¦‚å¿µã€‘</p>
<p>Step2: Pretend You're Teaching the ldea to a New
Studentã€å‡è±¡ä½ åœ¨æ•™ä¸€ä½ä¸æ‡‚è¿™ä»¶äº‹æƒ…çš„äººè¿™ä¸ªæ¦‚å¿µï¼Œå°è¯•å°†è¿™ä»¶äº‹æƒ…è¯´æ˜ç™½ã€‘</p>
<p>Step3: If You Get Stuck, Go Back to the
Bookã€å¦‚æœä½ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°äº†å›°éš¾ï¼Œå›åˆ°è¯¾æœ¬å’Œè§†é¢‘ä¸­è¿›ä¸€æ­¥å­¦ä¹ ã€‘</p>
<p>Step4: Simplify and Create
Analogiesã€å°è¯•ç²¾ç®€è‡ªå·±çš„è§£é‡Šï¼Œå¹¶å°†å…¶ä¸å…¶ä»–æ¦‚å¿µåšç±»æ¯”ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£æ¦‚å¿µã€‘</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œå½“ä½ å¯ä»¥æ•™ä¼šæŸäººä¸€ä¸ªtaå®Œå…¨ä¸æ‡‚çš„æ¦‚å¿µçš„æ—¶å€™ï¼Œè¯´æ˜ä½ çœŸæ­£æŒæ¡äº†è¿™ä¸ªæ¦‚å¿µ</p>
</blockquote>
<h1 id="å›ºå®šæ—¥ç¨‹å®‰æ’">å›ºå®šæ—¥ç¨‹å®‰æ’</h1>
<p>åŠªåŠ›å·¥ä½œçš„æœ€å¥½æ–¹å¼å°±æ˜¯æ‹¥æœ‰ç”Ÿæ´»</p>
<ul>
<li><p><strong>ä¿è¯ä¼‘æ¯</strong>ï¼Œåº”å¯¹å¤§é‡å·¥ä½œä»»åŠ¡çš„åŠæ³•æ˜¯ä¿è¯è‡ªå·±æœ‰ä¼‘æ¯æ—¶é—´ã€‚å¦‚æœä½ ç™½å¤©ä¸å¥½å¥½å·¥ä½œï¼Œå´é€¼è¿«è‡ªå·±æ•´å¤œå­¦ä¹ çš„è¯ï¼Œä½ å¾ˆå®¹æ˜“å°±ä¼šç­‹ç–²åŠ›å°½çš„ã€‚æ— è®ºå‹åŠ›å†å¤§ä»»åŠ¡å†å¤šï¼Œéƒ½è¦ä¿è¯ä¼‘æ¯æ—¶é—´ï¼Œä¸€é¢—æ¸…é†’çš„å¤§è„‘å†³å®šäº†å·¥ä½œçš„è´¨é‡ã€‚</p></li>
<li><p>ä½¿ç”¨æ—¶é—´åˆ†å—æ³•æˆ–æ¯å‘¨/æ¯æ—¥ç›®æ ‡æ³•ï¼Œ<strong>å°†å·¥ä½œå’Œç”Ÿæ´»æ¸…æ™°åœ°åˆ†ç¦»å¼€</strong>ï¼Œå¥½å¥½å·¥ä½œå¥½å¥½ç©ã€‚</p></li>
</ul>
<blockquote>
<p><strong>æ—¶é—´åˆ†å—æ³•</strong></p>
<p>å°†ä¸€å¤©åˆ†æˆæ›´å°çš„æ—¶é—´åˆ†å—æ³•ã€‚åœ¨æ¯ä¸€æ®µæ—¶é—´é‡Œï¼Œä¸“æ³¨äºä¸€é¡¹ä»»åŠ¡æˆ–ä¸€ç»„ç›¸ä¼¼çš„ä»»åŠ¡ã€‚å…¶é‡ç‚¹æ˜¯<strong>è§„åˆ’å‡ºéœ€è¦å®Œæˆçš„ä»»åŠ¡</strong>ï¼Œç„¶å<strong>åˆ’åˆ†ç‰¹å®šçš„æ—¶é—´æ®µä¸“æ³¨å®Œæˆè¿™äº›ä»»åŠ¡</strong>ã€‚</p>
<p>å½“ä½ æŠŠä¸€æ•´å¤©åˆ†æˆæ—¶é—´æ®µåï¼Œå®ƒä¼šè®©ä½ ä¸“æ³¨äºä»»åŠ¡ï¼Œå¹¶é™åˆ¶å…¶ä»–äººå ç”¨ä½ çš„æ—¶é—´ã€‚</p>
<p>æ—¶é—´åˆ†å—æ³•è®©ä½ æ¯å¤©éƒ½æœ‰ä¸€ä¸ªè¦å®Œæˆçš„å…·ä½“ä»»åŠ¡çš„æ—¶é—´è¡¨ï¼Œè€Œä¸æ˜¯éµå¾ªä¸€ä¸ªä¸æ–­æ‰©å¤§çš„å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼Œä½ åªéœ€è¦å…³æ³¨äºå½“ä¸‹åº”è¯¥åšçš„äº‹æƒ…ã€‚</p>
</blockquote>
<p><a
href="https://www.scotthyoung.com/blog/2011/11/28/focus-without-caffeine/">Refer</a></p>
]]></content>
      <categories>
        <category>æ€è€ƒ</category>
      </categories>
      <tags>
        <tag>ä¿æŒä¸“æ³¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo ä½¿ç”¨æŒ‡å—</title>
    <url>/#2024/Hexo/</url>
    <content><![CDATA[<blockquote>
<p><a href="https://hexo.io/docs/">å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<h1 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h1>
<table>
<thead>
<tr class="header">
<th>æ–¹æ³•</th>
<th>ä»£ç </th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>å¿«é€Ÿéƒ¨ç½²</td>
<td>hexo g -d</td>
</tr>
<tr class="even">
<td>æ¸…é™¤ç¼“å­˜</td>
<td>hexo clean</td>
</tr>
<tr class="odd">
<td>é¢„è§ˆ</td>
<td>hexo s</td>
</tr>
<tr class="even">
<td>éƒ¨ç½²</td>
<td>hexo d</td>
</tr>
<tr class="odd">
<td>ç”Ÿæˆé™æ€é¡µé¢</td>
<td>hexo generate</td>
</tr>
</tbody>
</table>
<h1 id="åˆå§‹åŒ–é…ç½®">åˆå§‹åŒ–é…ç½®</h1>
<p>åˆå§‹åŒ–é¡¹ç›®ç»“æ„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>
<p>æ–°å¢æ ‡ç­¾é¡µï¼Œè®¾ç½®å±æ€§ï¼ˆtype: "tags"ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure>
<p>æ–°å¢åˆ†ç±»ï¼Œè®¾ç½®å±æ€§ï¼ˆtype: "categories"ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new page categories</span><br></pre></td></tr></table></figure>
<p>é…ç½® next ä¸»é¢˜è®¾ç½®</p>
<ul>
<li>è®¾ç½® menu èœå•æ </li>
<li>æ‰“å¼€ code ä»£ç å¤åˆ¶</li>
</ul>
<p>Debug</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo clean --debug</span><br><span class="line">hexo s --debug</span><br></pre></td></tr></table></figure>
<p><strong>Git ä¸Šä¼ æ’ä»¶</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p><strong>latex å…¬å¼</strong></p>
<p>å®‰è£… <code>hexo-renderer-markdown-it-plus</code> åï¼ŒKatex ä¸ mathJax
ä¼šé‡å¤ï¼Œéœ€è¦åœ¨ next ä¸­é…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mathjax:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="string">none</span></span><br><span class="line"><span class="attr">katex:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">copy_tex:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p><strong>æœ¬åœ°å›¾ç‰‡</strong></p>
<p><del>é…ç½®æœ¬åœ°å›¾ç‰‡ä¸Šä¼  <a
href="https://bkystop.github.io/2022/01/05/hexo-markdown%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/index.html">Link</a>
<a href="https://muxiner.github.io/organize-files/">Link</a></del></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-asset-img --save  // ä»£æ›¿ hexo-asset-image</span><br></pre></td></tr></table></figure>
<p><strong>Markdown æ–‡å­—é«˜äº®</strong></p>
<p><a
href="https://blog.csdn.net/qq_42951560/article/details/123596899">Link</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm un hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-markdown-it-plus --save</span><br></pre></td></tr></table></figure>
<p>_config.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">markdown:</span></span><br><span class="line">    <span class="attr">preset:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line">    <span class="attr">plugins:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">markdown-it-mark</span></span><br></pre></td></tr></table></figure>
<p><strong>æ·»åŠ Sitemap</strong></p>
<p>ä¸ºè‡ªå·±çš„ç½‘ç«™é…ç½®sitemapï¼Œå¯ä»¥æœ‰æ•ˆåœ°æå‡SEO</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br><span class="line">npm install hexo-generator-baidu-sitemap --save</span><br></pre></td></tr></table></figure>
<p>å¹¶åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶<code>_config.yml</code>çš„æœ«å°¾æ·»åŠ ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">sitemap:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">sitemap.xml</span></span><br><span class="line"><span class="attr">baidusitemap:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">baidusitemap.xml</span></span><br></pre></td></tr></table></figure>
<p><strong>æ”¹ blockquote é¢œè‰²</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">blockquote</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#d0a7020d</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">4px</span> solid <span class="number">#d0a702</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--blockquote-color);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">cite</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å¤‡ä»½æœ¬åœ°åšå®¢">å¤‡ä»½æœ¬åœ°åšå®¢</h1>
<p><a
href="https://blog.csdn.net/u014532291/article/details/131805350">åˆ©ç”¨mklinkå®ç°OneDriveè‡ªå®šä¹‰æ–‡ä»¶åŒå‘åŒæ­¥</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MKLINK [[/D] | [/H] | [/J]] Link Target</span><br><span class="line"></span><br><span class="line">        /D      åˆ›å»ºç›®å½•ç¬¦å·é“¾æ¥ã€‚é»˜è®¤ä¸ºæ–‡ä»¶ç¬¦å·é“¾æ¥ã€‚</span><br><span class="line">        /H      åˆ›å»ºç¡¬é“¾æ¥è€Œéç¬¦å·é“¾æ¥ã€‚</span><br><span class="line">        /J      åˆ›å»ºç›®å½•è”æ¥ã€‚</span><br><span class="line">        Link    æŒ‡å®šæ–°çš„ç¬¦å·é“¾æ¥åç§°ã€‚</span><br><span class="line">        Target  æŒ‡å®šæ–°é“¾æ¥å¼•ç”¨çš„è·¯å¾„</span><br><span class="line">                (ç›¸å¯¹æˆ–ç»å¯¹)ã€‚</span><br></pre></td></tr></table></figure>
<p>ç®¡ç†å‘˜ PowerShell <code>cmd /c mklink /D ç›®æ ‡åœ°å€ æºåœ°å€</code>
å°†åšå®¢<u>ç¡¬é“¾æ¥</u>åˆ° OneDrive æ–‡ä»¶å¤¹ä¸‹å¤‡ä»½</p>
<h1 id="æ›´æ–°ä¸»é¢˜-next">æ›´æ–°ä¸»é¢˜ Next</h1>
<blockquote>
<p>ç”±äº NexT ä»¥å‰ä½¿ç”¨çš„ swig æ¨¡ç‰ˆå¼•æ“åœæ­¢ç»´æŠ¤ï¼Œå»å¹´è¿ç§»åˆ°äº†
Nunjucksï¼Œä½†æ˜¯
ç›®å½•ä¸‹çš„æ¨¡ç‰ˆæ–‡ä»¶åç¼€åæ²¡æœ‰æ›´æ”¹ã€‚åŸå› æ˜¯ä¿®æ”¹åç¼€åå½±å“å¤ªå¹¿ï¼Œä¼šä½¿ç”¨æˆ·åœ¨æ‰§è¡Œ
è¿›è¡Œæ›´æ–°æ—¶äº§ç”Ÿå¤§é‡çš„å†²çªã€‚è¿™æ¬¡æ›´æ¢ä»“åº“ä¸ºäº†è§£å†³è¿™äº›å†å²é—ç•™é—®é¢˜ï¼Œæ²¡æœ‰ä¿ç•™ä¹‹å‰çš„
commit å†å²ã€‚</p>
</blockquote>
<p>2024.4.23 æŒ‰ç…§<a
href="https://theme-next.js.org/docs/getting-started/">å®˜ç½‘</a>é…ç½®</p>
<h1 id="debug">DeBug</h1>
<p><a href="https://blog.csdn.net/liuergo/article/details/102640098">Git
æäº¤æ–‡ä»¶åå…¨å˜å°å†™é—®é¢˜</a></p>
]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Control Globally, Understand Locally</title>
    <url>/-2023/Control%20Globally,%20Understand%20Locally/</url>
    <content><![CDATA[<p><strong>Title:</strong> Control Globally, Understand Locally. A
Global-to-Local Hierarchical Graph Network for Emotional Support
Conversation.</p>
<p>åˆ›æ–°ç‚¹ï¼š</p>
<ul>
<li>åœ¨ Encoder å’Œ Decoder ä¹‹é—´åŠ äº†ä¸€å±‚ GCNConv å’Œ RGCNConv</li>
</ul>
<img data-src="/-2023/Control%20Globally,%20Understand%20Locally/image-20240414083742062-17138602623661-17138606243731.png" class="" title="image.png">
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li><p>ç›®å‰ç ”ç©¶çš„ç¼ºé™·</p>
<ul>
<li>å…³æ³¨åºåˆ—ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¿½ç•¥äº†å…¨å±€åŸå› å’Œå±€éƒ¨å¿ƒç†æ„å›¾ä¸å…¶çš„å±‚æ¬¡å…³ç³»</li>
</ul></li>
<li><p>æœ¬æ–‡</p>
<ul>
<li>æå‡ºäº†ä¸€ä¸ªå…¨å±€åˆ°å±€éƒ¨çš„<strong>å±‚æ¬¡å›¾ç½‘ç»œ</strong>æ¥æ•è·å¤šæºä¿¡æ¯(å…¨å±€åŸå› ã€å±€éƒ¨æ„å›¾å’Œå¯¹è¯å†å²)å¹¶å»ºæ¨¡å®ƒä»¬ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼Œè¯¥ç½‘ç»œç”±ä¸€ä¸ªå¤šæºç¼–ç å™¨ã€ä¸€ä¸ªå±‚æ¬¡å›¾æ¨ç†å™¨å’Œä¸€ä¸ªå…¨å±€å¼•å¯¼è§£ç å™¨ç»„æˆ</li>
<li>è®¾è®¡äº†ä¸€ä¸ªæ–°çš„è®­ç»ƒç›®æ ‡æ¥ç›‘æµ‹å…¨å±€çš„è¯­ä¹‰ä¿¡æ¯ ## Introduction</li>
</ul></li>
<li><p>æ¢ç´¢æ±‚åŠ©è€…æƒ…ç»ªé—®é¢˜çš„åŸå› ï¼š<strong>å…¨å±€</strong>åœ°æ§åˆ¶æƒ…æ„Ÿæ”¯æŒå¯¹è¯çš„æ•´ä¸ªæµç¨‹</p></li>
<li><p>äº†è§£æ±‚åŠ©è€…çš„å¿ƒç†æ„å›¾ï¼šå¸®åŠ©ç³»ç»Ÿ<strong>å±€éƒ¨</strong>äº†è§£æ±‚åŠ©è€…å½“å‰æ—¶çš„å¿ƒç†çŠ¶æ€</p></li>
<li><p>æœ¬æ–‡ç›®æ ‡</p>
<ul>
<li>æ•è·å…¨å±€åŸå› å’Œå±€éƒ¨å¿ƒç†æ„å›¾</li>
<li>å»ºæ¨¡å…¨å±€ä¸å±€éƒ¨ä¹‹é—´çš„å…³ç³»</li>
</ul></li>
<li><p>è§£å†³æ–¹æ³•ã€å…¨å±€åˆ°å±€éƒ¨å±‚æ¬¡å›¾ç½‘ç»œGLHGã€‘</p>
<ul>
<li>å¤šæºç¼–ç å™¨ï¼šCOMETæå–å±€éƒ¨å¿ƒç†æ„å›¾</li>
<li>å±‚æ¬¡å›¾æ¨ç†æœºï¼šå…¨å±€åŸå› (å¯¹è¯çº§)ã€å±€éƒ¨å¿ƒç†æ„å›¾(å¥å­çº§)å’Œå¯¹è¯å†å²ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¿›è¡Œå»ºæ¨¡</li>
<li>è§£ç å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªæ–°çš„è®­ç»ƒç›®æ ‡æ¥ç›‘æ§å…¨å±€åŸå› çš„è¯­ä¹‰ä¿¡æ¯ ## Related
Work</li>
</ul></li>
<li><p>å›¾å»ºæ¨¡å¯¹è¯</p>
<ul>
<li>GCN åˆ©ç”¨è‡ªæˆ‘å’Œå¯¹è¯è€…é—´ä¾èµ–æ€§æ¥æ¨¡æ‹Ÿä¼šè¯ä¸Šä¸‹æ–‡</li>
<li>EGAE ä½¿ç”¨å›¾ç½‘ç»œæ•è·é¢å‘ä»»åŠ¡å¯¹è¯ä¸­çš„å¯¹è¯æ¨¡å¼</li>
</ul></li>
<li><p>å¸¸è¯†æ€§çŸ¥è¯†</p>
<ul>
<li>ä¸æœ¬äººæœ‰å…³çš„å¿ƒç†çŠ¶æ€ï¼šxReactã€xIntent ## Approach</li>
</ul></li>
<li><p>é—®é¢˜å®šä¹‰</p></li>
<li><p>å¤šæºç¼–ç å™¨</p>
<ul>
<li>BlenderBot Encoder + Max-pooling</li>
<li>ä¸Šä¸‹æ–‡ + å…¨å±€åŸå›  + å±€éƒ¨åŸå› </li>
</ul></li>
<li><p>åˆ†å±‚å›¾æ¨ç†æœº</p>
<ul>
<li>GAT
å›¾æ³¨æ„åŠ›ç½‘ç»œï¼šå…¶ä»–é‚»åŸŸä¿¡æ¯çš„ç‰¹å¾ä¼ æ’­åˆ°å½“å‰èŠ‚ç‚¹ï¼Œå…·æœ‰ç¡®å®šèŠ‚ç‚¹ä¹‹é—´é‡è¦æ€§å’Œç›¸å…³æ€§çš„ä¼˜ç‚¹</li>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777471738-5656cb06-b30d-458c-9dd1-432cf59fc949.png" class="" title="img">
æ³¨æ„åŠ›å‡½æ•°ï¼ˆ2017å‡ºç‰ˆ)</li>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777606138-33d97b8c-8966-4a59-9359-ce99195ba4db.webp" class="" title="image.png">
<img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777482262-fd172bc6-5f7f-4b43-b667-c12cd9b52505.png" class="" title="img">
æ³¨æ„åŠ›æœºåˆ¶</li>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777489757-3d64bf9e-8b95-4298-a754-239e59ec6e7b.png" class="" title="img"></li>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777519559-801ad4da-0c7f-47f2-8ab6-ed20e4e19101.png" class="" title="img">
æ³¨æ„åŠ›æœºåˆ¶</li>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777507833-1ff3f1f2-17cb-4ba0-991b-a61b42818cfc.png" class="" title="img"></li>
</ul></li>
<li><p>Global-guide è§£ç å™¨</p>
<ul>
<li>å“åº”ç”Ÿæˆ
<ul>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777873314-d88aa900-555f-40b2-8a87-4589351ce738.png" class="" title="img">
ï¼Œvè¡¨ç¤ºå›¾ç¥ç»ç½‘ç»œå¾—åˆ°çš„å…¨å±€å˜é‡</li>
</ul></li>
<li>ç›‘ç£å…¨å±€è¯­ä¹‰ä¿¡æ¯ï¼šé¢„æµ‹é—®é¢˜ç±»å‹
<ul>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701777996376-86594b70-a6b5-4f21-90e2-e6bbdbc222b0.png" class="" title="img"></li>
</ul></li>
</ul></li>
<li><p>è”åˆè®­ç»ƒ</p>
<ul>
<li>å¯¹æ•°ä¼¼ç„¶æŸå¤±+äº¤å‰ç†µæŸå¤±</li>
<li><img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701778036470-9378fc9b-a533-40a9-9990-69ffe0036656.png" class="" title="img">
<img data-src="/-2023/Control%20Globally,%20Understand%20Locally/1701778063569-1fc4c281-c256-4804-ba39-785ddd2e4b1e.png" class="" title="img">
<h2 id="experiments">Experiments</h2></li>
</ul></li>
<li><p>æŒ‡æ ‡ï¼šplexity (PPL), BLEU-n (B-n), ROUGE-L (R-L),
Distinct-1(D-1), and Distinct-2 (D-2)</p></li>
<li><p>ç”±äºæœ‰äº†æ„å›¾ç‰¹å¾ï¼Œæå‡ºå»ºè®®æ›´å…·ä½“æœ‰æ•ˆ ## Conclusion</p></li>
<li><p>å…¨å±€åˆ°å±€éƒ¨çš„å±‚æ¬¡å›¾ç½‘ç»œ(Global-to-Local Hierarchical Graph
network, GLHG)æ¥æ•è·å¤šæºä¿¡æ¯å¹¶ä»å…¨å±€åˆ°å±€éƒ¨çš„è§’åº¦å»ºæ¨¡å±‚æ¬¡å…³ç³»</p></li>
<li><p>æ–°çš„è®­ç»ƒç›®æ ‡â€œé¢„æµ‹Seekeré‡åˆ°é—®é¢˜çš„ç±»å‹â€ # å…³æ³¨çš„é—®é¢˜ /
æœ¬æ–‡çš„ä¼˜åŠ¿</p></li>
</ul>
<h1 id="è§£å†³æ–¹æ³•-åˆ›æ–°ç‚¹">è§£å†³æ–¹æ³• / åˆ›æ–°ç‚¹</h1>
<ul>
<li><strong>å¤šæºç¼–ç å™¨</strong>åˆ©ç”¨æƒ…å¢ƒä¿¡æ¯å¹¶å°†å¿ƒç†æ„å›¾ä¸COMETç»“åˆï¼Œæ•è·å…¨å±€åŸå› å’Œå±€éƒ¨æ„å›¾</li>
<li><strong>åˆ†å±‚å›¾æ¨ç†æœº</strong>åœ¨å…¨å±€åŸå› ã€å±€éƒ¨å¿ƒç†æ„å›¾å’Œå¯¹è¯å†å²ä¹‹é—´è¿›è¡Œäº¤äº’ï¼Œå»ºæ¨¡ä¸åŒå±‚æ¬¡çš„å…³ç³»ï¼ˆhierarchical
graph reasonerï¼‰ # å®éªŒç»“è®º</li>
</ul>
<h1 id="æœ‰å¾…æå‡çš„éƒ¨åˆ†">æœ‰å¾…æå‡çš„éƒ¨åˆ†</h1>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
        <tag>å¼‚æ„å›¾ç¥ç»ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>AugESC</title>
    <url>/-2023/AugESC/</url>
    <content><![CDATA[<p><strong>Title:</strong> Large-scale Data Augmentation for Emotional
Support Conversation with Pre-trained Language Models</p>
<blockquote>
<p>ç ”ç©¶å¼€æ”¾å¼å¯¹è¯æ•°æ®å¢å¼ºï¼Œé‡‡ç”¨å¤§è¯­è¨€æ¨¡å‹ GPT-3 æ‹“å±•äº† ESConv
æ•°æ®é›†å¤§å°</p>
</blockquote>
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li>åˆ©ç”¨LLMè¿›è¡Œæ•°æ®å¢å¼ºï¼Œä½¿ç”¨å…¬å¼€çš„å¯¹è¯å¸–å­è§¦å‘å„ç§ä¸»é¢˜çš„å¯¹è¯</li>
</ul>
<h2 id="introduction">Introduction</h2>
<ul>
<li><p>ç›®å‰å·¥ä½œçš„ç¼ºé™·</p>
<ul>
<li>æˆæœ¬é«˜ã€è€—æ—¶é•¿</li>
<li>é¢„ç®—é™åˆ¶ï¼Œæ‰€æ”¶é›†çš„å¯¹è¯è§„æ¨¡å°ï¼Œä¸»é¢˜å°‘</li>
</ul></li>
<li><p>æœ¬æ–‡ä¸»è¦è´¡çŒ®</p>
<ul>
<li>å…³é”®å‘ç°</li>
<li>ä½¿ç”¨ GPT-J å’Œå…¬å¼€å¯¹è¯å¸–å­è§¦å‘å„ç§ä¸»é¢˜çš„å¯¹è¯</li>
<li>æ„å»ºæœºå™¨å¢å¼ºæ•°æ®é›†AUGESï¼Œå…·æœ‰æ›´å¹¿æ³›å’Œå¤šæ ·åŒ–çš„ä¸»é¢˜è¦†ç›–èŒƒå›´ï¼Œå¯ä»¥æä¾›æ›´æœ‰æ•ˆçš„æƒ…æ„Ÿæ”¯æŒ
## Related Work</li>
</ul></li>
<li><p>é¢„è®­ç»ƒæ¨¡å‹</p></li>
<li><p>é¢„è®­ç»ƒæ¨¡å‹çš„æ•°æ®å¢å¼º ## Key Findings</p></li>
<li><p>è¯­è¨€æ¨¡å‹ä¼˜äºå¯¹è¯æ¨¡å‹</p>
<ul>
<li>è¯­è¨€æ¨¡å‹å­˜å‚¨äº†ä»å¤§è§„æ¨¡è®­ç»ƒè¯­æ–™åº“ä¸­å­¦ä¹ åˆ°çš„æ›´ä¸°å¯Œçš„çŸ¥è¯†ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°æ³›åŒ–åˆ°å„ç§å¯¹è¯ä¸»é¢˜</li>
<li>ä¸ä¼šè¯æ¨¡å‹ BlenderBot
ç›¸æ¯”ï¼Œgptç”Ÿæˆçš„å¯¹è¯å…·æœ‰æ›´å¥½çš„å¯¹è¯è¿è´¯æ€§å’Œä¸€è‡´æ€§</li>
</ul></li>
<li><p>è¯­è¨€æ¨¡å‹æ¯”äº¤äº’å¼ä»¿çœŸæ›´é€‚åˆå¼€æ”¾å¼å¯¹è¯æ•°æ®å¢å¼º</p></li>
<li><p>æç¤ºGPTä¸å¦‚å¾®è°ƒGPTæ¨¡å‹</p>
<ul>
<li>æç¤ºå‹GPT-3ç”Ÿæˆå¯æ§æ€§å·®</li>
<li>åªæœ‰å¾®è°ƒæ‰èƒ½æŒæ¡ä»»åŠ¡åœºæ™¯å’Œæ‰€éœ€ç‰¹å¾</li>
</ul></li>
<li><p>å°‘æ ·æœ¬ï¼ˆFew-shotï¼‰å¾®è°ƒå¯¼è‡´æ›´å¥½çš„æ³›åŒ–å’Œæ›´é«˜çš„å¤šæ ·æ€§</p>
<ul>
<li>ä¿æŒè¯­è¨€æ¨¡å‹çš„å†…åœ¨çŸ¥è¯†</li>
<li>å¢åŠ è°ƒä¼˜æ ·æœ¬æˆ–è®­ç»ƒæ­¥éª¤ä¼šå¯¼è‡´å¯¹åŸŸå¤–ä¸»é¢˜çš„æ³›åŒ–èƒ½åŠ›å·®</li>
<li>åœ¨å¤§è§„æ¨¡è‡ªåŠ¨æ•°æ®å¢å¼ºçš„å¸®åŠ©ä¸‹ï¼Œè®­ç»ƒå¯¹è¯æ¨¡å‹å¯èƒ½åªéœ€è¦å°‘é‡æ‰‹åŠ¨ç­–åˆ’çš„å¯¹è¯æ ·æœ¬</li>
</ul></li>
<li><p>ä¿¡æ¯æ€§æŸ¥è¯¢ï¼ˆç¬¬ä¸€ä¸ªå¯¹è¯å¸–å­ï¼‰æ˜¯è§¦å‘ä¸»é¢˜å¯¹è¯çš„å¿…è¦æ¡ä»¶</p>
<ul>
<li>æ³›å‹å’Œæ— ä¿¡æ¯çš„æŸ¥è¯¢å¾€å¾€å¯¼è‡´ç¦»é¢˜å’Œè‚¤æµ…çš„å¯¹è¯ ## Methodology</li>
</ul></li>
<li><p>ä¸»å¹²æ¨¡å‹ï¼šGPT-3ï¼Œå¾®è°ƒåçš„GPT-J</p></li>
<li><p>æç¤ºæ¨¡æ¿ï¼šå¯¹è¯åœºæ™¯+æƒ…æ„Ÿæ”¯æŒ</p></li>
<li><p>å°†ç¬¬ä¸€ä¸ªå¯¹è¯æ¡†ä½œä¸ºè§¦å‘æŸ¥è¯¢ï¼Œæ¨¡å‹ç”Ÿæˆåç»­çš„å¯¹è¯</p></li>
<li><p>ä¸é‡‡ç”¨Promptæç¤ºï¼Œä½¿ç”¨ESConvå¾®è°ƒGPT-J</p></li>
<li><p>è§¦å‘Query</p>
<ul>
<li>æ•°æ®æ¥æºï¼šEmpatheticDialoguesï¼ˆç§»æƒ…å¯¹è¯æ•°æ®é›†ï¼‰Redditï¼ˆå¿ƒç†å¥åº·ç›¸å…³çš„å¸–å­ï¼‰</li>
<li>ä¿ç•™å¸¦æœ‰è´Ÿé¢æƒ…ç»ªçš„Query</li>
</ul></li>
<li><p>è¿‡æ»¤ç»“æœï¼Œåˆ é™¤éæ³•å¯¹è¯ ## AUGESC
ç›¸æ¯”ESConvå¯¹è¯è½®æ¬¡æ›´å°‘ï¼Œå†…å®¹æ›´é•¿ã€‚è¯­æ–™åº“è§„æ¨¡çš„æ‰©å¤§å¯¼è‡´å”¯ä¸€äºŒå…ƒåˆ†è¯çš„æ•°é‡</p></li>
<li><p>ESConvä¸­çš„å¯¹è¯è¯é¢˜ä¸æ•°æ®æ”¶é›†æ—¶æœŸ(å¦‚covid, pandemic,
christmas)å¯†åˆ‡ç›¸å…³</p></li>
<li><p>AUGESC-ED
æ¶µç›–äº†æ›´å¤šå…³äºæ—¥å¸¸ç”Ÿæ´»çš„ä¸»é¢˜(ä¾‹å¦‚ï¼Œæ±½è½¦ã€ç‹—ã€æˆ¿å­ã€é‚»å±…)</p></li>
<li><p>AUGESC-Reddit æ¶µç›–äº†å…³äºå¿ƒç†å¥åº·çš„ä¸»é¢˜(ä¾‹å¦‚ï¼ŒæŠ‘éƒã€ç„¦è™‘ã€æ²»ç–—å¸ˆ)
## Quality Evaluation åœ¨ä¿¡æ¯ä¸€è‡´æ€§ã€è¯é¢˜ä¸€è‡´æ€§å’Œå¯¹è¯åŸºç¡€ç­‰æ–¹é¢å­˜åœ¨é—®é¢˜
## Interactive Evaluation &gt;
AUGESCæ˜¯å¯¹ESConvçš„ä¸€ç§è¡¥å……ï¼Œç”¨AUGESC+ESConvè®­ç»ƒå‡ºæ¥çš„æ¨¡å‹è¡¨ç°ä¼˜äºåªä½¿ç”¨ESConvçš„æ¨¡å‹</p></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>AUGESCèƒ½å¤Ÿæ˜¾è‘—å¢å¼ºå¯¹è¯æ¨¡å‹æä¾›æƒ…æ„Ÿæ”¯æŒçš„èƒ½åŠ›</p>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
        <tag>å¯¹è¯æ•°æ®é›†å¢å¼º</tag>
      </tags>
  </entry>
  <entry>
    <title>DQ-HGAN</title>
    <url>/-2023/DQ-HGAN/</url>
    <content><![CDATA[<p><strong>Title:</strong> A heterogeneous graph attention network based
deep Q-learning for emotional support conversation generation</p>
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li>å…³æ³¨çš„é—®é¢˜
<ul>
<li>åŠ¨æ€å»ºæ¨¡å¯¹ç”¨æˆ·çŠ¶æ€ï¼ŒåŒ…å«ä¸ªä½“çš„æ„å›¾å’Œæƒ…æ„Ÿ</li>
<li>ç»¼åˆå„ç±»å› ç´ é€‰æ‹©æœ€åˆé€‚çš„æ”¯æŒç­–ç•¥</li>
</ul></li>
<li>æå‡ºçš„æ–¹æ³•ã€åŸºäºå¼‚æ„å›¾æ³¨æ„åŠ›ç½‘ç»œçš„æ·±åº¦Q-learningæƒ…æ„Ÿæ”¯æŒå¯¹è¯ç”Ÿæˆã€‘
<ul>
<li>ä¸ºäº†æ•è·ç”¨æˆ·æ„å›¾ã€æƒ…æ„Ÿå’Œå†å²å¯¹è¯ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼ŒåŸºäºæ„å›¾è¯å…¸å’Œæƒ…æ„Ÿåˆ†ç±»å™¨ï¼Œæ„å»ºäº†å¼‚æ„å›¾æ³¨æ„åŠ›ç½‘ç»œ</li>
<li>é‡‡ç”¨åŸºäºDQNçš„æœ€ä¼˜å“åº”ç­–ç•¥ä»¥æŒ‡å¯¼å“åº”ç”Ÿæˆï¼Œä¼˜äºä¼ ç»Ÿçš„åŸºäºè§„åˆ™æˆ–å¯å‘å¼æ–¹æ³•
## Introduction</li>
</ul></li>
<li>ç›®å‰ç ”ç©¶
<ul>
<li>ESCä»»åŠ¡è¦æ±‚èƒ½å¤Ÿç¡®å®šæ±‚åŠ©è€…çš„å¿ƒç†æ„å›¾å’Œæƒ…ç»ªçŠ¶æ€ï¼Œä»¥ä¾¿æä¾›é€‚å½“çš„æ”¯æŒã€‚å› æ­¤æ•´åˆæ„å›¾è¯†åˆ«å’Œæƒ…æ„Ÿè¯†åˆ«å¯¹äºæé«˜æƒ…æ„Ÿæ”¯æŒå¯¹è¯çš„è´¨é‡è‡³å…³é‡è¦ï¼Œä¸”ç›®å‰çš„æ–¹æ³•å¯¹ç”¨æˆ·çŠ¶æ€å»ºæ¨¡ä¸å……åˆ†ã€‚</li>
</ul></li>
<li>å…³æ³¨çš„é—®é¢˜
<ul>
<li>å»ºæ¨¡ç”¨æˆ·çŠ¶æ€</li>
<li>é€‰æ‹©æœ€ä¼˜ç­–ç•¥ï¼Œä»¥äº§ç”Ÿæœ‰æ•ˆçš„ä¿éšœå“åº”</li>
</ul></li>
<li>æå‡ºçš„æ–¹æ³•
<ul>
<li>è®¾è®¡äº†åŸºäºæ³¨æ„åŠ›çš„<strong>å¼‚æ„å›¾ç½‘ç»œ</strong>ï¼Œä¸ç”¨æˆ·çš„æ„å›¾ã€æƒ…æ„Ÿå’Œå†å²å¯¹è¯äº¤äº’ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ•è·å’Œå»ºæ¨¡å›¾ä¸­ä¸åŒç±»å‹çš„èŠ‚ç‚¹å’Œè¾¹</li>
<li>æ„å»º<strong>æ„å›¾è¯å…¸</strong>å’Œ<strong>æƒ…æ„Ÿåˆ†ç±»å™¨</strong>æ¥æ•æ‰æ±‚åŠ©è€…åœ¨è¯­å¢ƒä¸­çš„ç»†å¾®æƒ…æ„Ÿè¡¨è¾¾</li>
<li><strong>DQNç®—æ³•</strong>å¯¹ç”¨æˆ·æœªæ¥åé¦ˆçš„æœŸæœ›å€¼è¿›è¡Œä¼°è®¡ï¼Œå¸®åŠ©ç³»ç»Ÿé€‰æ‹©è·å¾—æœ€ä¼˜é•¿æœŸå€¼çš„ç­–ç•¥ã€‚å…¶å…è®¸ç³»ç»Ÿä»ç”¨æˆ·çš„åé¦ˆä¸­å­¦ä¹ ï¼Œè°ƒæ•´å…¶ç­–ç•¥ï¼Œä»¥æä¾›æœ€æœ‰æ•ˆçš„æ”¯æŒå“åº”ã€‚</li>
</ul></li>
<li>ä¸»è¦è´¡çŒ®
<ul>
<li>æå‡ºäº†ä¸€ç§æ–°çš„æ–¹æ³•DQ-HGANï¼Œå°†<strong>æ„å›¾å’Œæƒ…æ„Ÿè¯†åˆ«ä¸ç­–ç•¥ç”Ÿæˆç›¸ç»“åˆ</strong>ï¼Œä»¥æé«˜æƒ…æ„Ÿæ”¯æŒå¯¹è¯ç³»ç»Ÿçš„è´¨é‡å’Œä¸ªæ€§åŒ–</li>
<li>æ„å»º<strong>æ„å›¾è¯å…¸å’Œæƒ…æ„Ÿåˆ†ç±»å™¨</strong>ï¼Œæ•æ‰æ±‚åŠ©è€…åœ¨è¯­å¢ƒä¸­çš„ç»†å¾®æƒ…æ„Ÿè¡¨è¾¾å¹¶è·Ÿè¸ªå…¶çŠ¶æ€</li>
<li>è®¾è®¡äº†ä¸€ç§åŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„<strong>å¼‚æ„å›¾ç½‘ç»œ</strong>ï¼Œä¸ç”¨æˆ·çš„æ„å›¾ã€æƒ…æ„Ÿå’Œå†å²å¯¹è¯è¿›è¡Œäº¤äº’ï¼Œå¹¶é€‰æ‹©æœ€ä¼˜çš„æ”¯æŒç­–ç•¥ä»¥ç”Ÿæˆæœ‰æ•ˆçš„æ”¯æŒå“åº”</li>
<li>ESCç”Ÿæˆä¸­ä½¿ç”¨ESCç”Ÿæˆä¸­ä½¿ç”¨<strong>å¼ºåŒ–å­¦ä¹ </strong>ï¼Œå…·ä½“æ¥è¯´ï¼Œä½¿ç”¨DQNç®—æ³•ï¼ˆDeep
Q-Networkï¼‰ä¼°è®¡ç”¨æˆ·æœªæ¥åé¦ˆçš„æœŸæœ›å€¼ï¼ŒåŠ¨æ€è°ƒæ•´ç­–ç•¥ä»¥æä¾›æœ€æœ‰æ•ˆçš„æ”¯æŒå“åº”
## Related Work</li>
</ul></li>
<li>å¯¹è¯ä¸­çš„æ„å›¾å’Œæƒ…æ„Ÿè¯†åˆ«ã€åœ¨æ¨¡å‹ä¸­èåˆäº†â€œæ„å›¾â€è¿™ä¸ªç‰¹å¾ã€‘
<ul>
<li>å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶
<ul>
<li>å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶æ¥æ•æ‰ç”¨æˆ·çš„æ„å›¾å’Œæƒ…æ„Ÿã€‚ç¼ºç‚¹ï¼šç¼ºä¹æœ‰æ•ˆæ•æ‰ç”¨æˆ·ç»†å¾®æƒ…æ„Ÿè¡¨è¾¾çš„èƒ½åŠ›</li>
<li>ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¢å¼ºPLMå¯¹è¯ç›¸å…³æ€§ï¼Œè¯†åˆ«å¯¹è¯æ„å›¾ã€æ¨æ–­å¯¹è¯æƒ…æ„Ÿã€‚ç¼ºç‚¹ï¼šä¸æ˜¯ä¸“é—¨ä¸ºESCä»»åŠ¡å®šåˆ¶çš„ï¼Œæ€§èƒ½å·®</li>
</ul></li>
<li>è¯å…¸
<ul>
<li>è¯å…¸åŒ…å«ç‰¹å®šæ„å›¾æˆ–æƒ…æ„Ÿç›¸å…³çš„è¯æ±‡å’ŒçŸ­è¯­ï¼Œåˆ©ç”¨åŸºäºè§„åˆ™çš„ç®—æ³•å°†contextä¸æ„å›¾è¯å…¸è¿›è¡ŒåŒ¹é…ï¼Œå¹¶åˆ†é…ç›¸åº”çš„æ„å›¾æ ‡ç­¾ã€‚ç¼ºç‚¹ï¼šåªå°†å•ä¸ªå•è¯ä¸æ ‡ç­¾åŒ¹é…ï¼Œå¯èƒ½ä¼šå¿½ç•¥æ•´ä¸ªå¥å­çš„æ„å›¾æˆ–æƒ…æ„Ÿå«ä¹‰</li>
</ul></li>
</ul></li>
<li>å›¾å»ºæ¨¡ã€æ•è·ä¼šè¯ç³»ç»Ÿä¸­ç”¨æˆ·æ„å›¾ã€æƒ…æ„Ÿå’Œå¯¹è¯å†å²ä¹‹é—´çš„å¤æ‚å…³ç³»ã€‘
<ul>
<li>åŒæ„å›¾ã€å¿½ç•¥äº†ç”¨æˆ·æ„å›¾å’Œæƒ…æ„Ÿçš„å¼‚æ„æ€§ã€‘
<ul>
<li>GAT
å›¾æ³¨æ„åŠ›ç½‘ç»œï¼Œåˆ©ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶æ¥æ•è·å¯¹è¯å›¾ä¸­æ„å›¾å’Œæƒ…æ„ŸèŠ‚ç‚¹ä¹‹é—´çš„äº¤äº’</li>
<li>GCN
å›¾å·ç§¯ç½‘ç»œï¼Œåˆ©ç”¨å›¾ç»“æ„åœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ æ’­ä¿¡æ¯ï¼Œå¹¶æ•è·å¯¹è¯æ•°æ®ä¸­çš„ä¸Šä¸‹æ–‡ä¾èµ–</li>
</ul></li>
<li><strong>å¼‚æ„å›¾æ³¨æ„åŠ›ç½‘ç»œæ˜¯ä¸“ä¸ºè¡¨ç¤ºå›¾ä¸­ä¸åŒç±»å‹çš„èŠ‚ç‚¹å’Œè¾¹è€Œè®¾è®¡çš„</strong>ï¼Œå®ƒæ“…é•¿å¯¹<strong>ä¸åŒçš„èŠ‚ç‚¹</strong>ç±»å‹è¿›è¡Œå»ºæ¨¡ï¼Œå¦‚ç”¨æˆ·è¯è¯­ã€ç³»ç»Ÿå“åº”ã€æƒ…æ„ŸçŠ¶æ€å’Œæ„å›¾ï¼Œä»è€Œæ›´å…¨é¢åœ°äº†è§£ç”¨æˆ·çš„æƒ…æ„ŸçŠ¶æ€ï¼›è¿˜æ“…é•¿æ•æ‰<strong>ä¸åŒç±»å‹çš„è¾¹</strong>ï¼ŒåŒ…æ‹¬é¡ºåºä¾èµ–ã€è‡ªä¾èµ–å’ŒçŠ¶æ€ä¾èµ–ï¼Œä»è€Œèƒ½å¤Ÿæ›´å‡†ç¡®åœ°è¡¨ç¤ºç”¨æˆ·çš„æƒ…æ„ŸçŠ¶æ€ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜åŒ…å«äº†ä¸€ç§<strong>æ³¨æ„åŠ›æœºåˆ¶</strong>æ¥è¿›è¡Œé‡è¦æ€§åŠ æƒï¼Œå…è®¸å®ƒåœ¨èšåˆè¿‡ç¨‹ä¸­ä¸“æ³¨äºæœ€ç›¸å…³çš„ä¿¡æ¯ï¼Œä»è€Œæ›´å…¨é¢åœ°äº†è§£ç”¨æˆ·çš„çŠ¶æ€ã€‚</li>
</ul></li>
<li>ç­–ç•¥é€‰æ‹©
<ul>
<li>åŸºäºè§„åˆ™æˆ–å¯å‘å¼æ–¹æ³•</li>
<li>å¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼ˆå¦‚ï¼šQ-learningï¼‰
<ul>
<li>é‡‡ç”¨DQNä¼°è®¡ä¸åŒå¯¹è¯åŠ¨ä½œçš„æœŸæœ›å€¼ï¼Œå¹¶å­¦ä¹ äº†ä¸€ç§æœ€å¤§åŒ–è¯¥å€¼çš„ç­–ç•¥ã€‚ä»ç”¨æˆ·åé¦ˆä¸­å­¦ä¹ ï¼Œå¹¶ç”Ÿæˆæ›´æœ‰å¸å¼•åŠ›å’Œä¿¡æ¯é‡çš„å“åº”</li>
</ul></li>
</ul></li>
<li>å“åº”ç”Ÿæˆ
<ul>
<li>ç›®å‰æµè¡Œçš„Encoder-Decoderæ¨¡å‹å¾€å¾€ä¸“æ³¨äºæ ¹æ®å¯¹è¯å†å²ç”Ÿæˆå›å¤ï¼Œè€Œæ²¡æœ‰è€ƒè™‘ç”¨æˆ·çš„æ„å›¾ã€æƒ…æ„Ÿä»¥åŠåˆé€‚çš„æ”¯æŒç­–ç•¥
## Preliminaries</li>
</ul></li>
<li>ESConvï¼šæ ‡è®°å¯¹è¯ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºè¯åµŒå…¥ï¼Œä»¥å°†å…¶è¾“å…¥åˆ°æ¨¡å‹ä¸­</li>
<li>COMETï¼šä½¿ç”¨COMETåˆå§‹åŒ–æ¨¡å‹çš„è¯åµŒå…¥ï¼Œå¹¶åœ¨ESConvæ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒï¼Œä»¥æé«˜å…¶æ„å»ºæ„å›¾è¯å…¸çš„æœ‰æ•ˆæ€§</li>
<li>ATOMICï¼šå¾—åˆ°æ„å›¾æˆ–ç›®çš„ï¼ˆxIntentï¼‰</li>
<li>NRC VAD
è¯å…¸ï¼šå¾—åˆ°æƒ…æ„Ÿè¯å…¸ï¼Œæ¯ä¸ªå•è¯å¯¹åº”çš„æ•ˆä»·-è§‰é†’-æ”¯é…ï¼ˆValence-Arousal-Dominanceï¼‰</li>
<li>é—®é¢˜å®šä¹‰ï¼šä¸Šä¸‹æ–‡+ç­–ç•¥+Query
=&gt;å“åº”Ytã€‚æœ€ä¼˜ç­–ç•¥åŸºäºå½“å‰çŠ¶æ€å’ŒæœŸæœ›çš„é•¿æœŸå›æŠ¥ï¼ˆé€šè¿‡Q-learningé¢„æµ‹ï¼‰
## Method <img data-src="/-2023/DQ-HGAN/1701484543763-403c4648-68f4-4644-bf00-e2356c06841c.jpg" class="" title="88c61f5be72a795a087441904fcd0ad9_3_Figure_2_780332990.png"></li>
</ul>
<h3 id="å¤šæºç¼–ç å™¨">å¤šæºç¼–ç å™¨</h3>
<img data-src="/-2023/DQ-HGAN/1701484574764-c5051f60-2b3c-40cf-a161-5848c1d67bc2.png" class="" title="img">
<ul>
<li>transformerç¼–ç å™¨ï¼ˆTransformerEncoderï¼‰
<ul>
<li>ht = TransformerEncoder(Ht)</li>
</ul></li>
<li>æ„å›¾è¯å…¸ï¼ˆCOMETï¼‰ï¼šé€šè¿‡å¯¹ATOMIC
å¾®è°ƒï¼ŒåŒå»æ„å›¾å…³é”®è¯ï¼Œæ„å»ºæ„å›¾è¯å…¸ï¼ˆæ„å›¾å…³é”®è¯ï¼Œå¯¹åº”çš„è¯åµŒå…¥ï¼‰
<ul>
<li><span
class="math display">\[g_{t}=TransformerEncoder\left(\sum_{w_{i}\in\mathscr{F}}\operatorname{softmax}\left(c_{i}^{T}
h_{t}\right)c_{i}\right) \]</span></li>
</ul></li>
<li>æƒ…æ„Ÿåˆ†ç±»å™¨ï¼ˆNRC VADè¯å…¸ï¼‰
<ul>
<li><span
class="math display">\[e_{t}=\text{TransformerEncoder}\left(\sum_{w_{k}
\in \mathscr{Z}}\operatorname{softmax}\left(z_{k}^{T} h_{t}\right)
g_{t}\right) \text { }\]</span></li>
</ul></li>
</ul>
<h3
id="åŸºäºå¼‚æ„å›¾çš„ç”¨æˆ·çŠ¶æ€è·Ÿè¸ª">åŸºäºå¼‚æ„å›¾çš„ç”¨æˆ·çŠ¶æ€è·Ÿè¸ª<img data-src="/-2023/DQ-HGAN/1701484605842-86e4e5d2-9d20-4ffd-ae60-37220c9258dd.png" class="" title="img"></h3>
<h3 id="dqnå¼ºåŒ–å­¦ä¹ ">DQNå¼ºåŒ–å­¦ä¹ <img data-src="/-2023/DQ-HGAN/1701484626201-fde66e58-39a7-40f7-9e6e-fe70a7cd8dd7.png" class="" title="img"></h3>
<h3 id="å“åº”ç”Ÿæˆè§£ç å™¨">å“åº”ç”Ÿæˆè§£ç å™¨<img data-src="/-2023/DQ-HGAN/1701484638477-fd1f5c6b-b6f5-43f0-af14-a22d10dfe762.png" class="" title="img"></h3>
<h2 id="experiments">Experiments</h2>
<p>Conclusion</p>
<h1 id="å…³æ³¨çš„é—®é¢˜-æœ¬æ–‡çš„ä¼˜åŠ¿">å…³æ³¨çš„é—®é¢˜ / æœ¬æ–‡çš„ä¼˜åŠ¿</h1>
<h1 id="è§£å†³æ–¹æ³•-åˆ›æ–°ç‚¹">è§£å†³æ–¹æ³• / åˆ›æ–°ç‚¹</h1>
<h1 id="å®éªŒç»“è®º">å®éªŒç»“è®º</h1>
<h1 id="æœ‰å¾…æå‡çš„éƒ¨åˆ†">æœ‰å¾…æå‡çš„éƒ¨åˆ†</h1>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
        <tag>å¼‚æ„å›¾ç¥ç»ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Feedback-Aware Double</title>
    <url>/-2023/FADO/</url>
    <content><![CDATA[<p><strong>Title:</strong> Feedback-Aware Double COntrolling Network for
Emotional Support Conversation</p>
<img data-src="/-2023/FADO/1701141604157-75101287-52dc-426c-abea-73184a8b8cda.png" class="" title="img">
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li><p>åŒå±‚åé¦ˆç­–ç•¥é€‰æ‹©å™¨ï¼šé€šè¿‡åé¦ˆä¿¡æ¯é¢„æµ‹ç­–ç•¥</p></li>
<li><p>åŒå±‚æ§åˆ¶é˜…è¯»å™¨ï¼šé€šè¿‡ç­–ç•¥çº¦æŸä¸Šä¸‹æ–‡å“åº”</p></li>
<li><p>ç­–ç•¥è¯å…¸ï¼šä¸°å¯Œç­–ç•¥çš„è¯­ä¹‰ä¿¡æ¯ ## Introduction ## Related Work ##
Problem Formulation ## Approach</p></li>
<li><p>ä¸Šä¸‹æ–‡ç¼–ç å™¨</p>
<ul>
<li>BlenderBoté¢„è®­ç»ƒç¼–ç å™¨ç¼–ç ä¸Šä¸‹æ–‡å†å²å¯¹è¯Uï¼Œå¾—åˆ°Ht</li>
</ul></li>
<li><p>åŒå±‚åé¦ˆç­–ç•¥é€‰æ‹©å™¨</p>
<ul>
<li>ç­–ç•¥é€‰æ‹©
<ul>
<li>è¾“å…¥
<ul>
<li>BlenderBot Encoder ç¼–ç ä¸Šä¸‹æ–‡å†å²å¯¹è¯Uï¼Œå¾—åˆ°éšçŠ¶æ€Ht</li>
<li>BlenderBot Encoder ç¼–ç ç­–ç•¥S</li>
<li>EmoBERTa Encoder ç¼–ç ä¸Šä¸‹æ–‡å¯¹è¯U</li>
</ul></li>
<li>å…¬å¼
<ul>
<li>ä¸Šä¸‹æ–‡ç¼–ç å™¨ï¼ˆç­–ç•¥SåŒç†ï¼‰ï¼š<span
class="math display">\[\boldsymbol{H}=\operatorname{Enc}_{cxt}\left(\boldsymbol{[CLS]},
\boldsymbol{u}_{1}, \boldsymbol{[SEP]}, \boldsymbol{u}_{2}, ...,
\boldsymbol{u}_{M}\right)\]</span>ï¼ŒMä¸ºå¯¹è¯æ•°
<ul>
<li><span
class="math display">\[\boldsymbol{H}=\left(\boldsymbol{u}_{1},...,
\boldsymbol{u}_{T}\right)\]</span>ï¼ŒTä¸ºTokenæ•°</li>
</ul></li>
<li>æƒ…æ„Ÿç¼–ç å™¨ï¼š<span
class="math display">\[\boldsymbol{E}=\operatorname{EmoBERTa}\left(\boldsymbol{[CLS]},
\boldsymbol{u}_{1}, \boldsymbol{[SEP]}, \boldsymbol{u}_{2}, ...,
\boldsymbol{u}_{M}\right)\]</span>ï¼ŒMä¸ºå¯¹è¯æ•°
<ul>
<li><span
class="math display">\[\boldsymbol{E}=\left(\boldsymbol{e}_{1},...,
\boldsymbol{e}_{T}\right)\]</span>ï¼ŒTä¸ºTokenæ•°</li>
</ul></li>
<li>åˆ†ç±»ï¼š<span
class="math display">\[\boldsymbol{o}=\operatorname{MLP}\left(\tanh
\left(\boldsymbol{W}_{o}^{T}[\boldsymbol{s} ; \boldsymbol{c} ;
\boldsymbol{r}]+\boldsymbol{b}_{\boldsymbol{o}}\right)\right)\]</span>
<ul>
<li>sã€cã€r ä¸ºç­–ç•¥Sã€ä¸Šä¸‹æ–‡Hã€æƒ…æ„Ÿåˆ†ç±»Eã€‚ç¼–ç +å¹³å‡æ± åŒ–æ“ä½œåå¾—åˆ°</li>
</ul></li>
</ul></li>
</ul></li>
<li>åŒå±‚åé¦ˆ
<ul>
<li>å›åˆçº§åé¦ˆï¼šå±€éƒ¨å˜é‡ï¼Œå½“å‰ç”¨æˆ·çš„æ„Ÿå—ã€‚åŒ…å«æ¯è½®å¯¹è¯Seekeræƒ…æ„ŸÎ”eå’ŒSeekerè¯„åˆ†å˜åŒ–Î”r</li>
<li>å¯¹è¯çº§åé¦ˆï¼šå…¨å±€å˜é‡Î”cï¼Œç”¨æˆ·çš„å…¨å±€çŠ¶æ€ã€‚åŒ…å«Seekeråœ¨è°ˆè¯åçš„æƒ…ç»ªå‹åŠ›ã€Supporterå¯¹è¯é¢˜çš„å›åº”çš„ç›¸å…³æ€§ã€Supporterå¯¹Seekeræ„Ÿå—çš„ç†è§£å’Œå…±æƒ…</li>
<li>èåˆadapterï¼šæ•´åˆå›åˆçº§å’Œä¼šè¯çº§åé¦ˆçš„ä¸¤ç±»è¯­ä¹‰ä¿¡æ¯ã€‚Î”s = Î”e + Î”r +
uÎ”cã€è®¡ç®—æŸå¤±æ—¶ï¼Œç»™äºˆæ­£å‘æˆ–è´Ÿå‘çš„åé¦ˆã€‘</li>
</ul></li>
</ul></li>
<li><p>åŒæ§è¯»å–å™¨ï¼ˆæ¨¡ä»¿æƒ…æ„ŸèŠå¤©æœºå™¨ECMï¼‰</p>
<ul>
<li>context-to-strategyï¼šåˆ©ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥é€‰æ‹©ä¸Šä¸‹æ–‡ç›¸å…³çš„ç­–ç•¥
<ul>
<li><span class="math display">\[\boldsymbol{g}^{c} =
\operatorname{sigmoid}\left(
\boldsymbol{W}_{c}^{T} \boldsymbol{c} + \boldsymbol{b}_{c}
\right)\]</span></li>
</ul></li>
<li>strategy-to-contextï¼šç¼–ç é˜¶æ®µå¯ä»¥å…³æ³¨ä¸ç­–ç•¥ç›¸å…³çš„ä¸Šä¸‹æ–‡ï¼Œä»è€Œç”Ÿæˆç­–ç•¥çº¦æŸçš„å“åº”
<ul>
<li><span class="math display">\[\boldsymbol{g}^{o} =
\operatorname{sigmoid}\left(
\boldsymbol{W}_{o}^{T} \boldsymbol{o} + \boldsymbol{b}_{o}
\right)\]</span></li>
</ul></li>
<li>æ®‹å·®è¿æ¥ï¼šåœ¨åŸå§‹ä¿¡æ¯å’Œæ›´æ–°ä¿¡æ¯ä¹‹é—´è¿›è¡Œæƒè¡¡
<ul>
<li><span class="math display">\[\begin{array}{r}
o^{\prime}=(1-\beta) \cdot o+\beta \cdot g^{c} \otimes o \\
h_{t}^{\prime}=(1-\alpha) \cdot h_{t}+\alpha \cdot g^{o} \otimes h_{t}
\end{array}\]</span></li>
</ul></li>
</ul></li>
<li><p>ç­–ç•¥å­—å…¸</p>
<ul>
<li>è¾“å…¥ç­–ç•¥ä»¤ç‰Œçš„æè¿°ï¼Œ
è€Œä¸æ˜¯ç­–ç•¥ä»¤ç‰Œï¼Œä»¥ä¾¿æ¨¡å‹å¯¹ç­–ç•¥è¿›è¡Œæ›´æ·±å…¥çš„ç†è§£</li>
<li>Encoder-Decoder
ä¹‹é—´çš„çŠ¶æ€ä¼ è¾“ç±»ä¼¼äºMISCï¼Œé‡‡ç”¨cross-attentionä»£æ›¿self-attention<a
href="https://www.yuque.com/jinzang/lnx420/wrq82cgnp6p47q59?view=doc_embed">MISC:
A MIxed Strategy-Aware Model Integrating COMET for Emotional Support
Conversation</a></li>
</ul></li>
<li><p>å“åº”ç”Ÿæˆ</p>
<ul>
<li>BlenderBot Decoderï¼š<span
class="math display">\[\boldsymbol{p}\left(y_{z} \mid
\boldsymbol{y}_{&lt;z}, \boldsymbol{h}_{\boldsymbol{t}}^{\prime},
\boldsymbol{V}\right)=\text { Generator }\left(\boldsymbol{W}_{y&lt;z},
\boldsymbol{h}_{\boldsymbol{t}}^{\prime},
\boldsymbol{V}\right)\]</span></li>
</ul></li>
<li><p>è”åˆè®­ç»ƒ</p>
<ul>
<li>ç­–ç•¥é¢„æµ‹ï¼šåé¦ˆæ„ŸçŸ¥è´Ÿå¯¹æ•°ä¼¼ç„¶ feedback-aware negative log-likelihood
<ul>
<li><span
class="math display">\[\mathcal{L}_{1}=\left\{\begin{array}{ccc}
-\hat{o} \log
\left(\operatorname{softmax}\left(\boldsymbol{o}^{\prime}\right)\right)
&amp; \text { if } &amp; \Delta s&gt;0 \\
-\hat{o} \log
\left(1-\operatorname{softmax}\left(\boldsymbol{o}^{\prime}\right)\right)
&amp; \text { if } &amp; \Delta s \leq 0
\end{array}\right.\\\]</span></li>
</ul></li>
<li>å“åº”ç”Ÿæˆï¼šæ ‡å‡†äº¤å‰ç†µæŸå¤±ä¼˜åŒ– cross-entropy
<ul>
<li><span class="math display">\[\mathcal{L}_{2}=-\sum_{z=1}^{Z} \log
\boldsymbol{p}\left(y_{z} \mid \boldsymbol{y}_{&lt;z},
\boldsymbol{h}_{\boldsymbol{t}}^{\prime}, \boldsymbol{V}\right)\]</span>
## Experiment</li>
</ul></li>
</ul></li>
<li><p>é‡‡ç”¨EmoBERTa-baseä½œä¸ºç‰¹å¾æå–å™¨ï¼Œä»¥è·å–Seekerçš„æƒ…æ„Ÿå¾—åˆ†å’Œæƒ…æ„Ÿè¡¨å¾ï¼Œæƒ…æ„Ÿå¾—åˆ†ç”±softmaxå‡½æ•°ä½¿ç”¨EmoBERTa-baseçš„[CLS]è¡¨ç¤ºè·å¾—
## Experimental Results ## Analyses ## conclusion # å…³æ³¨çš„é—®é¢˜</p></li>
</ul>
<ol type="1">
<li><p>é¢„æµ‹ç­–ç•¥åªä¾é å¯¹è¯å†å²ï¼Œè€Œä¸è€ƒè™‘æ±‚åŠ©è€…åé¦ˆï¼Œå¯¼è‡´é¢„æµ‹çš„ç»“æœä¸ç”¨æˆ·æ— å…³</p></li>
<li><p>å»ºæ¨¡è¿‡ç¨‹åªå…³æ³¨ä¸Šä¸‹æ–‡åˆ°ç­–ç•¥ï¼Œè€Œä¸å…³æ³¨ç­–ç•¥åˆ°ä¸Šä¸‹æ–‡å’Œä¸ç­–ç•¥ç›¸å…³çš„ä¸Šä¸‹æ–‡
# è§£å†³æ–¹æ³•</p></li>
<li><p>åŒå±‚åé¦ˆç­–ç•¥é€‰æ‹©å™¨ï¼šåˆ©ç”¨å›åˆçº§å’Œä¼šè¯çº§åé¦ˆä¿¡æ¯æ¥æ¿€åŠ±æˆ–æƒ©ç½šç­–ç•¥</p></li>
<li><p>åŒå±‚æ§åˆ¶é˜…è¯»å™¨ï¼šç­–ç•¥åˆ°ä¸Šä¸‹æ–‡æµæ¥ç”Ÿæˆç­–ç•¥çº¦æŸå“åº” # åˆ›æ–°ç‚¹ /
æœ¬æ–‡çš„ä¼˜åŠ¿</p></li>
</ol>
<h1 id="å®éªŒç»“è®º">å®éªŒç»“è®º</h1>
<h1 id="æœ‰å¾…æå‡çš„éƒ¨åˆ†">æœ‰å¾…æå‡çš„éƒ¨åˆ†</h1>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>HEAL</title>
    <url>/-2023/HEAL_%20A%20Knowledge%20Graph%20for%20Distress%20Management%20Conversations/</url>
    <content><![CDATA[<p><strong>Title:</strong> A Knowledge Graph for Distress Management
Conversations</p>
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li><p>ç›¸æ¯”äºseq2seqçš„ä¸ç¡®å®šæ€§ï¼ŒèŠå¤©æœºå™¨äººåˆ©ç”¨çŸ¥è¯†å›¾è°±è¿›è¡Œæ¨ç†ï¼Œè¢«è§†ä¸ºç«¯åˆ°ç«¯æ¨¡å‹çš„é«˜æ•ˆã€ä¸‡æ— ä¸€å¤±çš„è§£å†³æ–¹æ¡ˆ</p></li>
<li><p>æå‡ºHEALçŸ¥è¯†å›¾è°±</p>
<ul>
<li>åŸºäº1Mç—›è‹¦å™è¿°åŠå…¶ç›¸åº”çš„å®‰æ…°å›åº”è€Œå¼€å‘çš„çŸ¥è¯†å›¾è°±</li>
<li>å›¾è°±å¯è§†åŒ–ï¼šè¡¨ç°äº†å¯¹è¯åŒæ–¹çš„æƒ…ç»ªåŠ¨æ€å’Œå¸®åŠ©ç¼“è§£æƒ…ç»ªçš„æœ‰æ•ˆæ–¹æ³•</li>
<li>ç»„æˆéƒ¨åˆ†
<ul>
<li>22k Node èŠ‚ç‚¹ï¼šè¯†åˆ«ä¸åŒç±»å‹çš„stressors, speaker expectations,
responses, feedback types</li>
<li>104k Edge è¿æ¥ï¼šä¸åŒç±»å‹çš„èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å’Œ41ç§æƒ…ç»ªçŠ¶æ€ç›¸å…³è” ## Introduction</li>
</ul></li>
</ul></li>
<li><p>ç¥ç»ç½‘ç»œæ¶æ„æ¨¡å‹ç¼ºä¹å¯æ§æ€§å’Œé»‘ç®±æ€§è´¨ï¼Œå¯¼è‡´å…¶å¹¶ä¸å¯é </p></li>
<li><p>ä½¿ç”¨å¸¸è¯†æ¨ç†å’ŒçŸ¥è¯†å›¾ç»“æ„è¡¨ç¤ºï¼Œå¯ä»¥ç”Ÿæˆé€‚åˆçš„ã€å¯é¢„æµ‹çš„ã€å¤šç­–ç•¥çš„å›åº”</p></li>
<li><p>ç›¸å…³å·¥ä½œ</p>
<ul>
<li>ConceptNetã€ATOMICä¸»è¦æ˜¯é€šè¿‡æ•è·äº‹å®çŸ¥è¯†ï¼Œåœ¨å¼€æ”¾å¯¹è¯ä¸­åµŒå…¥å¸¸è¯†æ¨ç†è¾…åŠ©å¯¹è¯ï¼Œä¸é€‚ç”¨äºç§»æƒ…å¯¹è¯</li>
</ul></li>
<li><p>æœ¬æ–‡ï¼Œé€šè¿‡å­Redditç²¾å¿ƒé€‰æ‹©çš„å¯¹å‹åŠ›äº‹ä»¶å™è¿°å’Œå›åº”ï¼Œç”Ÿæˆäº†ä¸€ä¸ªå‹åŠ›å¯¹è¯ç®¡ç†çŸ¥è¯†å›¾è°±HEAL</p>
<ul>
<li>äº”ç±»èŠ‚ç‚¹ï¼šå‹åŠ›æºã€æœŸæœ›ã€å›åº”ç±»å‹ã€åé¦ˆç±»å‹ã€æƒ…æ„ŸçŠ¶æ€</li>
<li>å¯ä»¥å‡†ç¡®æè¿°ä»¥ç—›è‹¦ä¸ºå¯¼å‘å¯¹è¯çš„æ½œåœ¨èƒŒæ™¯ï¼Œä½¿å¯¹è¯æ¨¡å‹å¯ä»¥æ£€ç´¢åˆ°æ›´å…·ä½“çš„ä¸Šä¸‹æ–‡å“åº”ã€‚æå–å“åº”ä¼šå¯¼è‡´çš„åé¦ˆç±»å‹å’Œæ˜¯å¦èƒ½è¾¾åˆ°æœŸæœ›ç­‰ä¿¡æ¯ï¼Œä»è€Œäº§ç”Ÿæ›´ä¸ºåˆé€‚çš„ååº”
## Related Work</li>
</ul></li>
<li><p>çŸ¥è¯†å›¾è°±å¯ä»¥å¸®åŠ©NLPç†è§£ç”¨æˆ·çš„è¾“å…¥ï¼Œæ‹“å±•ç”¨æˆ·è¾“å…¥ä¸­çš„äº‹å®å’Œå¸¸è¯†æ€§çŸ¥è¯†</p></li>
<li><p>ç›®å‰å·¥ä½œå…³æ³¨äºçŸ¥è¯†æ„ŸçŸ¥å’Œæ¨ç†å¯¹è¯ï¼Œä¸ä¼šæ•æ‰æƒ…æ„Ÿæ¨ç†å’Œç§»æƒ…ååº” ##
Methodology</p></li>
<li><p>æ•°æ®é›†ç®¡ç†</p>
<ul>
<li>é‡‡ç”¨redditæ•°æ®é›†ï¼Œé€šè¿‡Pushshift
APIï¼Œæ”¶é›†å’Œå¤„ç†8ä¸ªå­redditå¯¹è¯ä¸»é¢˜ï¼šmentalhealthsupportã€offmychestã€sadã€anxietyhelpã€depressionã€suicidewatchã€depressedã€depressionhelp</li>
<li>æ•°æ®é¢„å¤„ç†</li>
</ul></li>
<li><p>æ¦‚è¦</p>
<ul>
<li>é’ˆå¯¹è¿‡é•¿è€Œè¶…å‡ºé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹è¾“å…¥ä¸Šé™çš„å¯¹è¯ï¼Œæœ¬æ–‡é‡‡ç”¨SMMRYæ‘˜è¦ç®—æ³•ä¿ç•™å™äº‹æœ¬è´¨</li>
</ul></li>
<li><p>å‡èšèšç±»</p>
<ul>
<li>è‡ªåŠ¨èšç±»ï¼šåŒºåˆ†å¯¹è¯ä¸­çš„å‹åŠ›æºã€æœŸæœ›ã€å“åº”å’Œåé¦ˆç±»å‹</li>
<li>å‡èšèšç±»æ³•ï¼šé€’å½’åœ°åˆå¹¶å¢åŠ æœ€å°é“¾æ¥è·ç¦»çš„ç°‡å¯¹</li>
<li>é“¾æ¥è·ç¦»ï¼šå¯¹SentenceBERTç”Ÿæˆçš„embeddingä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—</li>
</ul></li>
<li><p>å®šä¹‰å‹åŠ›æº</p>
<ul>
<li>æ¯ä¸ªé˜ˆå€¼è®¡ç®—äº†å„ç§èšç±»è´¨é‡æŒ‡æ ‡ï¼Œç»“æœæ˜¾ç¤ºä»¥0.85çš„ç›¸ä¼¼åº¦é˜ˆå€¼åŒºåˆ†å‹åŠ›æºæœ€åˆé€‚ï¼Œå°†å‹åŠ›æºä¸­çš„4.7%åˆ†ä¸ºäº†4363ä¸ªç±»ã€‚</li>
<li>å°†èšç±»ç»“æœæŒ‰ç…§TF-IDFå»ºæ¨¡ï¼Œå¯ä»¥æ˜æ˜¾åŒºåˆ†å‹åŠ›æºï¼Œè¡¨æ˜èšç±»ç»“æœçš„å¯é æ€§ã€‚</li>
</ul></li>
<li><p>æœŸæœ›ã€å›å¤ã€åé¦ˆç±»å‹</p>
<ul>
<li>æå–å¸¦æœ‰â“çš„å¥å­ä½œä¸ºé—®é¢˜ï¼Œä»¥æ­¤é—®é¢˜æå–ç›¸å…³çš„å“åº”å’Œåé¦ˆã€‚ä½¿ç”¨NLTKåˆ†ç¦»å“åº”å’Œåé¦ˆä¸­çš„å•ä¸ªå¯¹è¯ï¼Œæ–¹ä¾¿åç»­å¯¹å…¶è¿›è¡Œå•ä¸€ç§ç±»çš„èšç±»ã€‚</li>
<li>èšç±»æ–¹æ³•ä¸å‹åŠ›æºä¸€è‡´ï¼Œæ¯ä¸ªé›†ç¾¤è‡³å°‘æœ‰ä¸¤ä¸ªä¸åŒçš„é›†ç¾¤å…ƒç´ ã€‚</li>
</ul></li>
<li><p>æƒ…æ„ŸçŠ¶æ€å»ºæ¨¡</p>
<ul>
<li>ä½¿ç”¨Puæå‡ºçš„åŸºäºBERTçš„æƒ…æ„Ÿåˆ†ç±»å™¨ï¼Œå°†æ¯ä¸€ä¸ªç°‡ä¸æŸä¸€æƒ…æ„ŸçŠ¶æ€ç›¸å…³è”ï¼Œå…±æœ‰41ç§æƒ…æ„ŸçŠ¶æ€ã€‚å…ˆå°†æ¯ä¸€ä¸ªç°‡ä¸‹çš„æ¯ä¸ªæ–‡æœ¬è¿›è¡Œåˆ†ç±»ï¼Œå†æŒ‰ç…§æƒ…æ„Ÿå‡ºç°æ¬¡æ•°å’Œåˆ†ç±»ç½®ä¿¡åº¦æ’åºï¼Œé€‰å–æœ€ç›¸å…³çš„æƒ…æ„ŸçŠ¶æ€ã€‚
## Statistical Analysis</li>
</ul></li>
<li><p>HEALçŸ¥è¯†å›¾è°±ï¼š2.2ké›†ç¾¤èŠ‚ç‚¹å’Œæƒ…æ„ŸçŠ¶æ€ï¼Œ104kè¿æ¥</p></li>
<li><p>åé¦ˆé›†ç¾¤ä¸­ï¼Œè´Ÿé¢æƒ…ç»ªæ˜æ˜¾å‡å°‘ï¼Œè¯æ˜HEALä¸­å­˜åœ¨å¸®åŠ©äººä»¬é™ä½è´Ÿé¢æƒ…æ„ŸçŠ¶æ€çš„æœ‰ç”¨å“åº”
## Visualization and Interpretation</p></li>
<li><p>è¡¨ç¤ºå¤§å¤šæ•°å›ç­”éƒ½æ˜¯æ­£å‘ç§¯æåé¦ˆ ## Evaluating the Utility of HEAL
in Responding to Distress Prompts</p></li>
<li><p>è·å–å…±æƒ…å“åº”</p>
<ul>
<li>ä»æµ‹è¯•é›†ä¸­é€‰å–å’Œå‹åŠ›æºä¸­ç°æœ‰å™è¿°ç›¸ä¼¼æ€§é«˜äº0.75çš„æ–°å¯¹è¯</li>
<li>æ ¹æ®å‹åŠ›æºå’Œå“åº”ä¹‹é—´è¾¹æƒçš„æƒé‡ã€å“åº”ç°‡å¤§å°è¿›è¡Œæ’åºï¼Œé€‰æ‹©æ’åé«˜çš„å“åº”</li>
</ul></li>
<li><p>è‡ªåŠ¨è¯„ä¼°</p>
<ul>
<li>HEALçš„å“åº”æ›´åŠ å¤šæ ·åŒ–ï¼Œå¯ä»¥æ ¹æ®ç»™å®šçš„æƒ…å†µç»™å‡ºç‰¹å®šçš„å“åº”</li>
<li>åœ¨å…¶ä»–è‡ªåŠ¨æŒ‡æ ‡BLEUã€METEORå’ŒROUGEæ–¹é¢è¡¨ç°ä¸ä½³</li>
</ul></li>
<li><p>äººç±»è¯„ä¼°ã€DOI: 10.18653/v1/d16-1230ã€‘</p>
<ul>
<li>HEALæ¨¡å‹å˜ç°æ›´å¥½ ## Discussion and Conclusion</li>
</ul></li>
<li><p>HEALï¼šåˆ©ç”¨Redditä¸Šçº¦1Mä¸ªä¸ç—›è‹¦ç›¸å…³çš„å¯¹è¯å¾—å‡ºçš„çŸ¥è¯†å›¾è°±ã€‚åœ¨ä¸åŒç±»å‹çš„å‹åŠ›æºã€è¯´è¯è€…æœŸæœ›ã€æ±‚åŠ©è€…ååº”å’Œæ±‚åŠ©è€…åé¦ˆç±»å‹ä¹‹é—´å½¢æˆè”ç³»ï¼ŒåŒæ—¶å°†æ¯ä¸ªèŠ‚ç‚¹ä¸41ç§æƒ…æ„ŸçŠ¶æ€ä¸­çš„ä¸€ç§è”ç³»èµ·æ¥</p></li>
<li></li>
</ul>
<h1 id="å…³æ³¨çš„é—®é¢˜-æœ¬æ–‡çš„ä¼˜åŠ¿">å…³æ³¨çš„é—®é¢˜ / æœ¬æ–‡çš„ä¼˜åŠ¿</h1>
<ul>
<li><p>ç«¯åˆ°ç«¯å¯¹è¯ç»å¸¸ä¼šäº§ç”Ÿé€šç”¨å’Œé‡å¤æ€§å¯¹è¯ï¼Œç¼ºä¹å¯æ§æ€§ã€‚ä½¿ç”¨å¸¸è¯†æ¨ç†å’ŒçŸ¥è¯†å›¾ç»“æ„è¡¨ç¤ºï¼Œå¯ä»¥ç”Ÿæˆé€‚åˆçš„ã€å¯é¢„æµ‹çš„ã€å¤šç­–ç•¥çš„å›åº”ã€‚</p></li>
<li><p>ç›®å‰çš„çŸ¥è¯†å›¾è°±ä¸é€‚ç”¨äºç§»æƒ…å¯¹è¯ã€‚ç§»æƒ…é¢†åŸŸç¼ºä¹æ•°æ®é›†å’Œæ¨¡å‹å¸®åŠ©äº§ç”Ÿç§»æƒ…ååº”ï¼Œè¿˜ç¼ºä¹å…·æœ‰ä¸Šä¸‹æ–‡-ç›¸åº”ä¹‹é—´å…³ç³»çš„çŸ¥è¯†å›¾è°±ã€‚
# è§£å†³æ–¹æ³• / åˆ›æ–°ç‚¹</p></li>
<li><p>å¼€å‘å¤§è§„æ¨¡çŸ¥è¯†å›¾è°±HEALï¼Œè¯†åˆ«ä¸åŒçš„å‹åŠ›æºã€æœŸæœ›ã€å“åº”ã€åé¦ˆå’Œè¯¥å¯¹è¯çš„æƒ…æ„ŸçŠ¶æ€</p></li>
<li><p>ç»Ÿè®¡å’Œå¯è§†åŒ–åˆ†æï¼Œè¯†åˆ«å¯¼è‡´æƒ…ç»ªå¼ºåº¦é™ä½çš„æœ‰åˆ©ååº”</p></li>
<li><p>è¯„ä¼°é€šè¿‡HEALæ£€ç´¢åˆ°çš„å›åº”ï¼Œåœ¨è§£å†³æƒ…æ„Ÿå›°æ‰°é—®é¢˜ä¸Šçš„å…±æƒ…æ€§ã€å¤šæ ·æ€§ã€å¯é æ€§
# å®éªŒç»“è®º</p></li>
<li><p>ä¸RoBERTaã€Blenderè¿›è¡Œæ¯”è¾ƒï¼ŒHEALèƒ½å¤Ÿäº§ç”Ÿæ›´å¤šæ ·åŒ–ã€æ›´ç§»æƒ…çš„ååº”</p></li>
<li><p>ç»Ÿè®¡å’Œå¯è§†åŒ–åˆ†æè¯å®äº†åœ¨HEALä¸­å­˜åœ¨æœ‰ç”¨çš„ååº”ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥é™ä½äº†é­å—ç—›è‹¦çš„äººçš„è´Ÿé¢æƒ…æ„ŸçŠ¶æ€</p></li>
<li><p>ä½¿ç”¨çº¯ç”Ÿæˆæ¨¡å‹æ¥è§£å†³ç—›è‹¦å­˜åœ¨å±é™©ï¼ŒHEALé€šè¿‡æˆ˜ç•¥æ€§åœ°è¯†åˆ«ä¸ç»™å®šæç¤ºç›¸å…³çš„ç‰¹å®šå‹åŠ›æºæ¥é¿å…ä¸é€‚å½“çš„ååº”
# æœ‰å¾…æå‡çš„éƒ¨åˆ†</p></li>
<li><p>åªä½¿ç”¨äº†å‹åŠ›æºä¸å›å¤çš„è¾¹ç¼˜æƒé‡ï¼Œè¿›ä¸€æ­¥å¯ä»¥é€šè¿‡å°†è¾¹ç¼˜æƒé‡ä¸è¯´è¯è€…çš„æœŸæœ›å’Œåé¦ˆç»“åˆèµ·æ¥æ¥å¼€å‘</p></li>
<li><p>çŸ¥è¯†å›¾çš„ä¿¡æ¯å¯ä»¥ç”¨äºå¢å¼ºç¥ç»ååº”ç”Ÿæˆæ¨¡å‹ï¼Œå¹¶ä¸ºè¿™äº›æ¨¡å‹å¼•å…¥æ›´å¤šçš„å¯æ§æ€§å’Œå¯è§£é‡Šæ€§ï¼Œä»è€Œæé«˜å¯é æ€§</p></li>
<li><p>ä»…é™äºè¯†åˆ«â‰ˆ4Kçš„å‹åŠ›æºï¼Œå¯ä»¥ä»ç½‘ç»œä¸Šè·å–æ›´å¤šæ•°æ®æ¥å¢å¼ºçŸ¥è¯†å›¾è°±ï¼Œè¿™å°†å¸®åŠ©å…¶èƒ½å¤Ÿå¤„ç†æ›´å¤§èŒƒå›´çš„å‹åŠ›æºå’ŒæœŸæœ›</p></li>
</ul>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
        <tag>çŸ¥è¯†å›¾è°±</tag>
      </tags>
  </entry>
  <entry>
    <title>KEMI</title>
    <url>/-2023/Knowledge-enhanced%20Mixed-initiative%20Dialogue%20System%20for%20Emotional%20Support%20Conversations/</url>
    <content><![CDATA[<p><strong>Title:</strong> Knowledge-enhanced Mixed-initiative Dialogue
System for Emotional Support Conversations</p>
<img data-src="/-2023/Knowledge-enhanced%20Mixed-initiative%20Dialogue%20System%20for%20Emotional%20Support%20Conversations/1699406609845-c98dd4cb-e2ae-41f2-99b8-aed67482d60d.png" class="" title="image.png">
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li><p>æ··å’Œä¸»åŠ¨æ€§ï¼šæŒ‰ç…§è¯´è¯è€…è§’è‰²å’Œä¸»åŠ¨ç±»å‹åˆ†ä¸ºå››ç±»</p></li>
<li><p>æå‡ºå››ä¸ªæƒ…ç»ªæ”¯æŒæŒ‡æ ‡</p></li>
<li><p>æå‡ºä¸€ç§ç”¨äº ESC çš„çŸ¥è¯†å¢å¼ºæ··åˆä¸»åŠ¨æ¡†æ¶ (KEMI) ##
Introduction</p></li>
<li><p>ESCç³»ç»Ÿ</p>
<ul>
<li>åœ¨é€‚å½“çš„æ—¶å€™å‘èµ·è®¨è®ºï¼Œç›®çš„æ˜¯æå‡ºå»ºè®®ï¼Œå¹¶è§£å†³é—®é¢˜</li>
</ul></li>
<li><p>ç›¸å…³å·¥ä½œ</p>
<ul>
<li>CIS(conversational
information-seeking)å¯ä»¥ä¸»åŠ¨å‘èµ·å¯¹è¯ï¼Œæ¾„æ¸…äº¤äº’å¹¶æ¢ç´¢æ›´å¤šçš„ä¿¡æ¯</li>
<li>æƒ…æ„Ÿæ¨ç†ç”¨æ¥ç”Ÿæˆå…±æƒ…ååº”</li>
<li>identifying the dialogue acts of the utterances</li>
<li>ESC ç³»ç»Ÿé¢„æµ‹ä¸‹ä¸€ä¸ªå¯¹è¯ç­–ç•¥</li>
</ul></li>
<li><p>ESCé—®é¢˜çš„ä¸‰ä¸ªæŒ‘æˆ˜</p>
<ul>
<li>ç³»ç»Ÿåº”è¯¥åœ¨å¯¹è¯è¿‡ç¨‹ä¸­ä½•æ—¶é‡‡å–ä¸»åŠ¨ï¼Ÿ</li>
<li>ç³»ç»Ÿå‘èµ·å­å¯¹è¯éœ€è¦ä»€ä¹ˆæ ·çš„ä¿¡æ¯ï¼Ÿ</li>
<li>ç³»ç»Ÿå¦‚ä½•ä¿ƒè¿›æ··åˆä¸»åŠ¨äº¤äº’ï¼Ÿ</li>
</ul></li>
<li><p>è§£å†³æ–¹æ³•</p>
<ul>
<li>ç­–ç•¥é¢„æµ‹ï¼šç¡®å®šä¸‹ä¸€å›åˆæ··åˆä¸»åŠ¨ç­–ç•¥</li>
<li>çŸ¥è¯†é€‰æ‹©ï¼šæ”¶é›†ä¸‹ä¸€å›åˆçš„å¿…è¦çŸ¥è¯†</li>
<li>å“åº”ç”Ÿæˆï¼šåœ¨é€‚å½“çš„æ··åˆä¸»åŠ¨ç­–ç•¥å’ŒçŸ¥è¯†ä¸‹äº§ç”Ÿæƒ…æ„Ÿæ”¯æŒå“åº”</li>
</ul></li>
<li><p>æå‡ºçš„æ–°ä¸œè¥¿</p>
<ul>
<li>æ··åˆä¸»åŠ¨æ€§ç‰¹å¾
<ul>
<li>EAFRæ¨¡å¼ï¼šè¯è¯­æ³¨é‡Šä¸ºä¸åŒç±»å‹çš„è¯´è¯è€…è§’è‰²å’Œä¸»åŠ¨ç±»å‹</li>
<li>Expression, Action, Reflection, Feedback</li>
</ul></li>
<li>æƒ…æ„Ÿæ”¯æŒæŒ‡æ ‡
<ul>
<li>Proactivity, Information, Repetition, Relaxation</li>
</ul></li>
<li>KEMI
<ul>
<li>ä½¿ç”¨ç”Ÿæˆçš„å¸¸è¯†çŸ¥è¯†ä½œä¸ºæŸ¥è¯¢å›¾æ¥æ‰©å±•ç”¨æˆ·è¯è¯­ï¼Œåœ¨çŸ¥è¯†å›¾è°±ä¸Šæ‰§è¡Œå­å›¾æ£€ç´¢</li>
<li>å“åº”ç”Ÿæˆæ¨¡å—ä»¥åºåˆ—åˆ°åºåˆ—çš„æ–¹å¼ï¼Œå¯¹ç­–ç•¥é¢„æµ‹å’Œå“åº”ç”Ÿæˆè¿›è¡Œã€å¤šä»»åŠ¡å­¦ä¹ ã€‘ï¼Œä»¥ç”Ÿæˆå…·æœ‰å¤–éƒ¨çŸ¥è¯†çš„æ··åˆä¸»åŠ¨å“åº”</li>
</ul></li>
</ul></li>
<li><p>ä¸»è¦è´¡çŒ®</p>
<ul>
<li>EAFR æ³¨é‡Šæ¨¡å¼å’Œå››ç§æƒ…æ„Ÿæ”¯æŒæŒ‡æ ‡</li>
<li>ä½¿ç”¨ç”¨å¸¸è¯†çŸ¥è¯†æ‰©å±•çš„æŸ¥è¯¢å›¾ï¼Œé€šè¿‡å­å›¾æ£€ç´¢ä»å¿ƒç†å¥åº·çŸ¥è¯†å›¾è°±ä¸­æ£€ç´¢å¤–éƒ¨çŸ¥è¯†
## Related Works</li>
</ul></li>
<li><p>ESC</p>
<ul>
<li>æ£€æµ‹ç”¨æˆ·æƒ…ç»ª</li>
<li>å°†æƒ…æ„Ÿä¿¡å·æ”¾å…¥Respondä¸­</li>
<li>æƒ…ç»ªæ„ŸçŸ¥ååº”ï¼Œæƒ…æ„Ÿé£æ ¼è½¬ç§»</li>
<li>å…±æƒ…å¯¹è¯ç³»ç»Ÿ
<ul>
<li>æƒ…æ„Ÿæ¨ç†æŠ€å·§</li>
<li>åˆ©ç”¨å¤–éƒ¨çŸ¥è¯†æ¥æé«˜æƒ…ç»ªæ¨ç†çš„å»ºæ¨¡èƒ½åŠ›ï¼šçŸ¥è¯†å›¾ã€å¸¸è¯†æ€§æ¨¡å‹ã€ç‰¹å®šé¢†åŸŸçŸ¥è¯†ã€å¸¸è¯†æ€§çŸ¥è¯†</li>
</ul></li>
</ul></li>
<li><p>æ··åˆä¸»åŠ¨å¯¹è¯ ## Preliminary Analysis</p></li>
<li><p>EAFR</p>
<ul>
<li>å››ç§æ³¨é‡Šæ–¹æ³•ï¼šæŒ‰ç…§è§’è‰²å’Œä¸»åŠ¨ç±»å‹åŒºåˆ†</li>
<li>å››ç§è¯„ä»·æŒ‡æ ‡ï¼šã€å¾…çœ‹ã€‘</li>
</ul></li>
<li><p>æ··åˆä¸»åŠ¨æ€§åˆ†æ</p></li>
<li><p>æ··å’Œä¸»åŠ¨æ€§çš„æŒ‘æˆ˜</p>
<ul>
<li>ç³»ç»Ÿä½•æ—¶é‡‡å–ä¸»åŠ¨ï¼Ÿ</li>
<li>ç³»ç»Ÿå‘èµ·å­å¯¹è¯æ—¶ï¼Œéœ€è¦ä»€ä¹ˆä¿¡æ¯ï¼Ÿ
<ul>
<li>æƒ…æ„Ÿè¯†åˆ«ï¼šè¯†åˆ«ç”¨æˆ·æƒ…æ„ŸçŠ¶æ€</li>
<li>å› æœè¯†åˆ«ï¼šå¯¼è‡´æƒ…æ„ŸçŠ¶æ€çš„å‹åŠ›æº</li>
<li>è®¤çŸ¥è¯†åˆ«ï¼šè§£å†³é—®é¢˜çš„è¿‡ç¨‹</li>
</ul></li>
<li>æ ¹æ®å†å²å¯¹è¯ï¼Œç³»ç»Ÿè‡ªå‘åˆ¤æ–­å“åº”çš„ä¸»åŠ¨æˆ–è¢«åŠ¨</li>
</ul></li>
<li><p>é—®é¢˜å®šä¹‰</p>
<ul>
<li>ç»™å®šå†å²å¯¹è¯Cå’Œç”¨æˆ·æƒ…å†µsï¼Œäº§ç”Ÿç›¸åº”r
<ul>
<li>ç­–ç•¥é¢„æµ‹yï¼Œç»†ç²’åº¦ä¸»åŠ¨æ€§</li>
<li>çŸ¥è¯†é€‰æ‹©k</li>
<li>ä½¿ç”¨yå’Œkç”Ÿæˆæ··åˆä¸»åŠ¨ç›¸åº”r ## Method</li>
</ul></li>
</ul></li>
<li><p>çŸ¥è¯†è·å–</p>
<ul>
<li>æ£€ç´¢å¿ƒç†å¥åº·çŸ¥è¯†å›¾è°±HEALï¼Œå¼¥è¡¥å¸¸è¯†æ€§çŸ¥è¯†çš„ä¸è¶³
<ul>
<li>COMETå¸¸è¯†æ€§çŸ¥è¯†æ‰©å±•æŸ¥è¯¢ï¼šCp = COMET(p, ut)</li>
<li>æ„é€ æŸ¥è¯¢å›¾ï¼šÃ» = {ut, {Cp}}
<ul>
<li>expectationï¼šut</li>
<li>affectiveï¼š[xReact]</li>
<li>stressorï¼š[xIntent]</li>
<li>responsesï¼š[xWant] [xNeed] [xEffect]</li>
</ul></li>
<li>å­å›¾æ£€ç´¢
<ul>
<li>ç›¸ä¼¼åº¦è®¡ç®—ï¼šsentence-BERT</li>
<li>é’ˆå¯¹æ¯ä¸ª Ã»t
ä¸­çš„æŠ½è±¡æè¿°ï¼Œè·å–ä¸å…¶æœ€ç›¸ä¼¼çš„top-Kä¸ªHEALä¸­çš„å®ä½“ï¼ŒåŸºäºHEALä¸­çš„è¾¹ç¼˜è¿æ¥ï¼Œæ„æˆå€™é€‰å­å›¾</li>
<li>é’ˆå¯¹æ¯ä¸ª E
ä¸­çš„ç±»å‹èŠ‚ç‚¹ï¼ŒæŒ‰ç…§å­å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ç›¸ä¼¼åº¦å¾—åˆ†ä¹‹å’Œæ’åºå­å›¾ï¼Œé€‰æ‹©top-Nä½œä¸ºæ£€ç´¢åˆ°çš„çŸ¥è¯†K</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>æ··åˆä¸»åŠ¨å“åº”ç”Ÿæˆ</p>
<ul>
<li>ä½¿ç”¨åŸºäºä¸Šä¸‹æ–‡çš„ç¼–ç å™¨ï¼Œç¼–ç ä¸Šä¸‹æ–‡å¯¹è¯Cå’ŒçŸ¥è¯†K</li>
<li>Xï¼š[CLS]<context>[know.]&lt;know.&gt;ï¼›Yï¼š[strategy]y[response]r</li>
<li>ä¼˜åŒ–æŸå¤±å‡½æ•°ï¼Œæœ€å¤§åŒ–è´Ÿå¯¹æ•°ä¼¼ç„¶å‡½æ•°L ## Experiment</li>
</ul></li>
<li><p>å®éªŒåŸºç¡€</p>
<ul>
<li>æ•°æ®é›†ï¼šESConvã€MI</li>
<li>è¯„ä¼°å‚æ•°ï¼šæµåˆ©åº¦Perplexity (PPL)ã€å†…å®¹ä¿ç•™åº¦BLEU-n
(B-n)ã€å†…å®¹ä¿ç•™åº¦ROUGE-L (R-L)</li>
</ul></li>
<li><p>æ€»ä½“è¡¨ç°</p>
<ul>
<li>BlenderBotä¼˜äºTransformer</li>
<li>GLHGã€MISIæœ‰æ•ˆåœ°åˆ©ç”¨äº†å¸¸è¯†æ€§çŸ¥è¯†</li>
<li>åŸºäºç­–ç•¥çš„è”åˆå­¦ä¹ å¯ä»¥æé«˜æ€§èƒ½</li>
<li>KEMIæ˜æ˜¾ä¼˜äºå…¶ä»–æ–¹æ³•ï¼šHEALçŸ¥è¯†ç›¸æ¯”å¸¸è¯†æ€§çŸ¥è¯†æ›´æœ‰æ•ˆåœ°æ”¯æŒäº†é¢„æµ‹ç­–ç•¥ï¼Œå‡è½»äº†å¯¹é¢„è®­ç»ƒå¤§æ¨¡å‹çš„ä¾èµ–</li>
</ul></li>
<li><p>äººå·¥è¯„ä»·</p>
<ul>
<li>ä»æµç•…åº¦ã€è¾¨è¯†åº¦ã€èˆ’é€‚åº¦ã€å»ºè®®æœ‰æ•ˆæ€§ã€æ€»ä½“å›åº”äº”ä¸ªæ–¹é¢ä¸BlenderBot-jointã€MISCè¿›è¡Œå¯¹æ¯”ï¼ŒMISCå®Œèƒœ</li>
</ul></li>
<li><p>æ¶ˆèå®éªŒ</p>
<ul>
<li>HEALå¯ä»¥æœ‰æ•ˆæå‡ç­–ç•¥é¢„æµ‹å‡†ç¡®åº¦</li>
<li>èˆå¼ƒCOMETï¼Œå¯ä»¥æé«˜pplå‡†ç¡®åº¦ï¼Œå› ä¸ºå¸¸è¯†æ€§çŸ¥è¯†ä¸æ˜¯è‡ªç„¶è¯­å¥ï¼›ä½†ä¼šé™ä½å†…å®¹ä¿ç•™åº¦ï¼Œå› ä¸ºç®€æ´çš„å¸¸è¯†æ€§çŸ¥è¯†æ›´ä¸ºç²¾ç¡®</li>
<li>è®¤çŸ¥è¯†åˆ«æ˜¯æœ€æœ‰æ•ˆçš„</li>
<li>å¯¹æ¯”Oracleï¼Œè¿˜æœ‰å¾ˆå¤§çš„æå‡ç©ºé—´</li>
</ul></li>
<li><p>æ··å’Œä¸»åŠ¨æ€§åˆ†æ</p>
<ul>
<li>æƒ…æ„Ÿæ”¯æŒæŒ‡æ ‡åˆ†æ
<ul>
<li>KEMIæœ‰æ•ˆçš„å¹³è¡¡äº†ä¸»åŠ¨æ€§å’Œéä¸»åŠ¨æ€§å›å¤</li>
<li>KEMIå›å¤çš„ä¿¡æ¯æ›´åŠ ä¸°å¯Œ</li>
<li>KEMIå®¹æ˜“ç”Ÿæˆé‡å¤æ€§å›å¤</li>
<li>KEMIæœ‰æ•ˆåœ°å¸®åŠ©ç”¨æˆ·è§£å†³æƒ…ç»ªé—®é¢˜</li>
</ul></li>
<li>ä¼šè¯è¿›åº¦
<ul>
<li>ç›¸æ¯”BlenderBotå’ŒMISCï¼ŒKEMIåœ¨å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œä¸»åŠ¨æ€§å’Œéä¸»åŠ¨æ€§çš„åˆ†å¸ƒæ›´åŠ å¹³è¡¡</li>
<li>KEMIåœ¨å¯¹è¯ä¸­åæœŸæ›´èƒ½ä¸»åŠ¨ç›¸åº”å¹¶ç¼“è§£ç”¨æˆ·è´Ÿé¢æƒ…ç»ª</li>
</ul></li>
</ul></li>
<li><p>æ¡ˆä¾‹åˆ†æ ## Conclusions</p></li>
<li><p>é¦–æ¬¡æå‡ºESCä¸­æ··å’Œä¸»åŠ¨æ€§çš„ç‰¹ç‚¹ï¼Œå¹¶é˜è¿°å…¶é‡è¦æ€§</p></li>
<li><p>KEMIæ¡†æ¶</p>
<ul>
<li>é€šè¿‡æŸ¥è¯¢æ‰©å±•å’Œå­å›¾æ£€ç´¢ï¼Œä»å¤§è§„æ¨¡å¿ƒç†å¥åº·å›¾è°±ä¸­æ£€ç´¢å®é™…ç—…ä¾‹çŸ¥è¯†</li>
<li>é€šè¿‡æ£€ç´¢åˆ°çš„çŸ¥è¯†ï¼Œè¿›è¡Œç­–ç•¥é¢„æµ‹å’Œå“åº”ç”Ÿæˆçš„å¤šä»»åŠ¡å­¦ä¹ </li>
</ul></li>
<li><p>ç»“åˆå®é™…æ¡ˆä¾‹å’Œåˆ†ææŒ‡æ ‡ï¼Œç»“æœè¯æ˜KEMIä¼˜äºç°æœ‰æ–¹æ³•ï¼Œå¹¶åœ¨æ··åˆä¸»åŠ¨äº¤äº’æ–¹é¢å…·æœ‰ä¼˜åŠ¿
## Limitations</p></li>
<li><p>è¯„ä»·æŒ‡æ ‡æœ‰å¾…æ”¹è¿›</p></li>
<li><p>æ²¡æœ‰è€ƒè™‘ä¸åŒçŸ¥è¯†æ£€ç´¢æ–¹æ³•çš„ä¸åŒ</p></li>
<li><p>ä»å¤æ‚çš„KGå›¾ä¸­æ£€ç´¢çŸ¥è¯†çš„æ–¹æ³•æœ‰å¾…æé«˜</p></li>
<li><p>æŸäº›åº”ç”¨çš„çŸ¥è¯†å›¾éš¾ä»¥è·å–</p></li>
<li><p>çŸ¥è¯†åº“çš„å»ºç«‹éœ€è¦å…·æœ‰ä¸“ä¸šçŸ¥è¯†çš„äººå‘˜ ## Appendix</p></li>
<li><p>æ··å’Œä¸»åŠ¨æ€§</p>
<ul>
<li>å¯¹è¯ä¸»åŠ¨æ€§åˆ†æ
<ul>
<li>ä¸»åŠ¨æ€§åˆ†ææ¨¡å‹ï¼šåœ¨ESConvæ•°æ®é›†å¢åŠ æ··åˆä¸»åŠ¨çš„ç±»å‹å±æ€§ï¼ŒæŠŠå†å²å¯¹è¯å’Œå½“å‰è¯è¯­ä½œä¸ºäºŒå…ƒè¾“å…¥ï¼Œåˆ¤æ–­ä¸»åŠ¨æ€§ã€‚å¾®è°ƒRoBERTTalargeï¼Œåˆ†åˆ«è®­ç»ƒä¸¤ä¸ªæ¨¡å‹ï¼Œåˆ¤æ–­ç”¨æˆ·å’Œç³»ç»Ÿçš„ä¸»åŠ¨æ€§</li>
<li>æƒ…ç»ªå¼ºåº¦é¢„æµ‹æ¨¡å‹ï¼šæ ¹æ®ç”¨æˆ·è¯è¯­é¢„æµ‹è´Ÿé¢æƒ…ç»ªå¼ºåº¦</li>
<li>ç”¨æˆ·æ¨¡æ‹Ÿå¹¶æ³¨é‡Šå››ç§è¯„ä»·æŒ‡æ ‡ ï¼šã€å¾…çœ‹ã€‘</li>
</ul></li>
<li>å¯¹è¯æµåˆ†æ
<ul>
<li>ESCåœ¨å¯¹è¯ä¸­å……å½“ä¸»åŠ¨è§’è‰²ï¼›EDåœ¨å¯¹è¯ä¸­å……å½“è¢«åŠ¨è§’è‰²</li>
</ul></li>
<li>å¯¹è¯è¿‡ç¨‹
<ul>
<li>ç ”ç©¶å†…å®¹ï¼šä¸»åŠ¨æ€§å’Œæƒ…ç»ªå¼ºåº¦å˜åŒ–çš„å…³ç³»</li>
<li>ç»“è®º
<ul>
<li>äº¤äº’æ—¶é—´å¾ˆé‡è¦</li>
<li>æƒ…ç»ªç¼“è§£åæ‰æ›´æœ‰åˆ©äºè§£å†³é—®é¢˜</li>
</ul></li>
</ul></li>
<li>ESæŒ‡æ ‡</li>
</ul></li>
<li><p>COMET</p>
<ul>
<li>å¸¸è¯†æ€§å…³ç³»</li>
</ul></li>
<li><p>HEAL</p>
<ul>
<li>æƒ…ç»ªå‹åŠ›å’Œå®‰æ…°å›åº”ä¹‹é—´çš„çŸ¥è¯†å›¾è°±</li>
<li>è¡¨ç°äº†å¯¹è¯åŒæ–¹çš„æƒ…ç»ªåŠ¨æ€ï¼Œç¡®å®šç¼“è§£æƒ…ç»ªçš„æ–¹æ³• # è§£å†³äº†ä»€ä¹ˆé—®é¢˜</li>
</ul></li>
<li><p>å¸¸è¯†æ€§çŸ¥è¯†æ˜¯ç›¸å½“æŠ½è±¡çš„ï¼Œæ²¡æœ‰è¯¦ç»†çš„ä¿¡æ¯ï¼Œå› æ­¤å®ƒå¯¹ESCç³»ç»Ÿäº§ç”Ÿæœ‰æ„ä¹‰å’Œä¿¡æ¯ä¸°å¯Œçš„å“åº”çš„å¸®åŠ©ä¸å¤§ã€‚åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨<strong>ç”Ÿæˆå¼å¸¸è¯†æ¨¡å‹</strong>è¿›è¡ŒæŸ¥è¯¢æ‰©å±•ï¼Œä»å¤–éƒ¨çŸ¥è¯†å›¾ä¸­æ£€ç´¢å®é™…æ¡ˆä¾‹çŸ¥è¯†ã€‚
# æ€ä¹ˆè§£å†³çš„ / è¯¥æ–¹æ³•çš„ä¼˜åŠ¿</p></li>
</ul>
<ol type="1">
<li><p>å¸¸è¯†çŸ¥è¯†ç”Ÿæˆå™¨ COMETï¼š</p></li>
<li><p>å¸¸è¯†æ€§çŸ¥è¯†è·å– HEALï¼š # æœ‰ä»€ä¹ˆåˆ›æ–°ç‚¹</p></li>
<li><p>æå‡ºESCçŸ¥è¯†å¢å¼ºæ··åˆä¸»åŠ¨æ¡†æ¶</p>
<ol type="1">
<li>äººç±»å’Œç³»ç»Ÿéƒ½å¯ä»¥ä¸»åŠ¨å¼•å¯¼äº¤äº’æ–¹å‘</li>
<li>é€šè¿‡å­å›¾æ£€ç´¢ä»å¿ƒç†å¥åº·çŸ¥è¯†å›¾è°±ä¸­æ£€ç´¢å¤–éƒ¨çŸ¥è¯†</li>
</ol></li>
<li><p>æ–°çš„åˆ†ææ–¹æ³• &gt; ä¿ç•™è¯„ä¼° å’Œ æ··åˆä¸»åŠ¨æ€§åˆ†æ
æ–¹é¢å‡æœ‰æ•ˆä¼˜äºç°æœ‰æ–¹æ³•</p>
<ol type="1">
<li>æŒ‰ç…§è¯´è¯è€…è§’è‰²å’Œä¸»åŠ¨ç±»å‹å°†è¯è¯­æ³¨é‡Šä¸ºä¸åŒç±»å‹
<ol type="1">
<li>Expressionï¼šç”¨æˆ·ä¸»åŠ¨</li>
<li>Actionï¼šç³»ç»Ÿä¸»åŠ¨</li>
<li>Feedbackï¼šç”¨æˆ·éä¸»åŠ¨</li>
<li>Reflectionï¼šç³»ç»Ÿéä¸»åŠ¨</li>
</ol></li>
<li>æå‡ºå››ä¸ªæƒ…æ„Ÿæ”¯æŒæŒ‡æ ‡æ¥è¡¡é‡ESCä¸­ä¸»åŠ¨æ€§å’Œéä¸»åŠ¨æ€§äº¤äº’çš„ç‰¹å¾
<ol type="1">
<li>Proactivityï¼šç³»ç»Ÿä¸»åŠ¨çš„å¯¹è¯å ç³»ç»Ÿå¯¹è¯çš„æ¯”ä¾‹</li>
<li>Informationï¼šç³»ç»Ÿé¦–æ¬¡æå‡ºçš„é¢‘ç¹è¯å æ¯”</li>
<li>Repetitionï¼šç³»ç»Ÿé‡å¤ç”¨æˆ·æå‡ºçš„æœ¯è¯­çš„é¢‘æ¬¡å æ¯”</li>
<li>Relaxationï¼šæƒ…ç»ªå¼ºåº¦çš„æ”¹å–„ # å®éªŒç»“æœå¥½åœ¨å“ªé‡Œï¼Œæ€ä¹ˆè¯æ˜çš„</li>
</ol></li>
</ol></li>
</ol>
<h1 id="ç›¸å…³å·¥ä½œåˆ†æ">ç›¸å…³å·¥ä½œåˆ†æ</h1>
<h1 id="å¯ä»¥æå‡çš„åœ°æ–¹">å¯ä»¥æå‡çš„åœ°æ–¹</h1>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>MISC</title>
    <url>/-2023/MISC_%20A%20MIxed%20Strategy-Aware%20Model%20Integrating%20COMET%20for%20Emotional%20Support%20Conversation/</url>
    <content><![CDATA[<p><strong>Title:</strong> A MIxed Strategy-Aware Model Integrating
COMET for Emotional Support Conversation</p>
<img data-src="/-2023/MISC_%20A%20MIxed%20Strategy-Aware%20Model%20Integrating%20COMET%20for%20Emotional%20Support%20Conversation/1699523191286-4f020d4d-6fee-4fc2-b943-e0443b1ca667.png" class="" title="image.png">
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li><p>å…ˆå‰å·¥ä½œçš„å±€é™æ€§</p>
<ul>
<li>é‡‡ç”¨å¯¹è¯çº§åˆ«çš„æƒ…æ„Ÿæ ‡ç­¾ï¼Œè¿™ç§æ ‡ç­¾è¿‡äºç²—ç²’åº¦ï¼Œæ— æ³•æ•æ‰ç”¨æˆ·çš„å³æ—¶ç²¾ç¥çŠ¶æ€</li>
<li>å¤§å¤šä¾§é‡äºåœ¨å›åº”ä¸­è¡¨è¾¾åŒç†å¿ƒï¼Œè€Œä¸æ˜¯é€æ¸å‡è½»ç”¨æˆ·çš„ç—›è‹¦</li>
</ul></li>
<li><p>æœ¬æ–‡æå‡ºäº†MISC</p>
<ul>
<li>é¦–å…ˆæ¨æ–­ç”¨æˆ·çš„ç»†ç²’åº¦æƒ…æ„ŸçŠ¶æ€ï¼Œç„¶åä½¿ç”¨æ··åˆç­–ç•¥å·§å¦™åœ°å“åº”</li>
<li>åœ¨åŸºå‡†æ•°æ®é›†ä¸Šçš„å®éªŒç»“æœè¯æ˜äº†æ–¹æ³•çš„æœ‰æ•ˆæ€§ï¼Œå¹¶æ­ç¤ºäº†ç»†ç²’åº¦æƒ…æ„Ÿç†è§£å’Œæ··åˆç­–ç•¥å»ºæ¨¡çš„å¥½å¤„
## Introduction</li>
</ul></li>
<li><p>ç›®å‰çš„å·¥ä½œä¸é€‚ç”¨äºESC</p>
<ul>
<li>ç²—ç²’åº¦é™æ€çš„å¯¹è¯çº§æƒ…æ„Ÿæ ‡ç­¾æ— æ³•å…³æ³¨åˆ°å¯¹è¯è¿‡ç¨‹ä¸­ç”¨æˆ·æƒ…æ„Ÿå‘ç”Ÿçš„å˜åŒ–</li>
<li>åªæœ‰ç§»æƒ…ååº”ï¼Œè€Œä¸è€ƒè™‘è§£å†³æ±‚åŠ©è€…çš„æƒ…æ„Ÿé—®é¢˜</li>
</ul></li>
<li><p>æœ¬æ–‡æå‡ºçš„è§£å†³æ–¹æ³•</p>
<ul>
<li>æœ‰é€‰æ‹©åœ°é‡‡ç”¨COMETï¼ˆé¢„è®­ç»ƒç”Ÿæˆå¼å¸¸è¯†æ¨ç†æ¨¡å‹ï¼‰ç”Ÿæˆçš„çŸ¥è¯†å…ƒç»„è¿›è¡Œç»†ç²’åº¦æƒ…æ„Ÿç†è§£</li>
<li>æ··åˆç­–ç•¥ï¼Œè€Œä¸æ˜¯é¢„æµ‹å•ä¸€ç­–ç•¥</li>
<li>è®¾è®¡ä¸€å¥—æ³¨æ„åŠ›æœºåˆ¶</li>
</ul></li>
<li><p>å®éªŒåˆ†æ</p>
<ul>
<li>å›ç­”ç­–ç•¥å»ºæ¨¡çš„é‡è¦æ€§ï¼Œèƒ½å¤Ÿæé«˜æ¨¡å‹çš„å…±æƒ…èƒ½åŠ› ## Related Work</li>
</ul></li>
<li><p>æƒ…ç»ªæ„ŸçŸ¥å“åº”ç”Ÿæˆ</p></li>
<li><p>NLPä¸­çš„å¸¸è¯†æ€§çŸ¥è¯†</p></li>
<li><p>ç­–ç•¥æ„ŸçŸ¥å¯¹è¯æ¨¡å‹ ## Preliminaries</p></li>
<li><p>ESConvæ•°æ®é›†</p></li>
<li><p>é—®é¢˜è®¾å®š</p>
<ul>
<li>é€šè¿‡å¯¹è¯å†å²ã€åœºæ™¯ã€æ±‚åŠ©è€…æœ€åä¸€å¥è¯ï¼Œé¢„æµ‹å›å¤ç­–ç•¥å’Œå›å¤å†…å®¹ ##
Model: MISC</li>
</ul></li>
<li><p>æƒ…æ„ŸçŠ¶æ€å¢å¼ºEncoder</p>
<ul>
<li>åˆ©ç”¨COMETæå–åœºæ™¯situationå’Œè¯­å¥xçš„å¸¸è¯†æ€§çŸ¥è¯†ï¼Œå°†å¸¸è¯†æ€§çŸ¥è¯†è¾“å…¥Encoderå¾—åˆ°H'så’ŒH'x</li>
</ul></li>
</ul>
<p><span
class="math display">\[\boldsymbol{B}^{s}=\bigcup_{j=1}^{N_{r}}\operatorname{COMET}\left(\mathrm{rel}_{j},\boldsymbol{s}\right)\]</span></p>
<ul>
<li>å°†H'så’ŒH'xåˆ†åˆ«ä¸å†å²å¯¹è¯cåšcross-attentionï¼Œå¾—åˆ°Hså’ŒHx</li>
<li>å°†å†å²å¯¹è¯cè¾“å…¥Encoderå¾—åˆ°C</li>
<li>æ··åˆç­–ç•¥å­¦ä¹ æ¨¡å—ã€ä»VQ-VAE's codebookæ–‡ç« ä¸­æŠ„æ¥çš„ã€‘
<ul>
<li>Cè¾“å…¥å¤šå±‚æ„ŸçŸ¥æœº+softmaxå¾—åˆ°Pgï¼ˆPgå¤§å°æ˜¯strategy_sizeï¼‰</li>
<li>Pgä½œä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œhg=Pg*Tï¼ˆTä¸ºç­–ç•¥åµŒå…¥ï¼‰
<ul>
<li>é•¿å¯¹è¯å›å¤ä¸­å¯ä»¥å¼•å…¥å¤šç§ç­–ç•¥ï¼Œä¸”æ¨¡å‹å­¦ä¹ çµæ´»æ–¹ä¾¿</li>
</ul></li>
</ul></li>
<li>å¤šå› ç´ æ„ŸçŸ¥Decoder
<ul>
<li>å°†æƒ…ç»ªçŠ¶æ€å’Œç­–ç•¥è¡¨å¾ä¼ å…¥Decoderé‡Œçš„Cross-attention ##
Experiments</li>
</ul></li>
<li>ESConvä¸­çš„æ¯åä¸ªè¯è¯­ä½œä¸ºä¸€ä¸ªæ ·æœ¬</li>
<li>è¯„ä»·æŒ‡æ ‡
<ul>
<li>ç­–ç•¥é¢„æµ‹ç²¾åº¦ï¼šAcc</li>
<li>ä¼ ç»ŸNLPæŒ‡æ ‡ï¼šPPLã€BLEUã€ROUGE-L</li>
<li>ç›¸åº”å¤šæ ·æ€§ï¼šDistinct</li>
<li>äººç±»è¯„ä¼°</li>
</ul></li>
<li>åŸºå‡†æ¨¡å‹
<ul>
<li>MT Transformerã€MoELã€MIMEã€BlenderBot-Joint</li>
</ul></li>
<li>å…·ä½“å®ç°</li>
<li>å®éªŒç»“æœ
<ul>
<li>åŠ¨æ€ç»†ç²’åº¦æƒ…æ„Ÿæ ‡ç­¾æ›´èƒ½å‡†ç¡®ç»™äºˆç”¨æˆ·å›åº”</li>
<li>ç»†ç²’åº¦å…±æƒ…ï¼Œå¤šç­–ç•¥å¹³ç¨³è¿‡æ¸¡ç­–ç•¥ï¼Œå¯ä»¥æ›´è‡ªç„¶åœ°è¡¨è¾¾å…±æƒ…å¹¶æä¾›å¸®åŠ©</li>
<li>ç­–ç•¥ä½œä¸ºå•ç‹¬çš„ä»»åŠ¡è¿›è¡Œé¢„æµ‹æ¯”å•ä¸€é¢„æµ‹æ›´æœ‰åˆ©</li>
<li>MISCçš„çŸ¥è¯†Knowå¾—åˆ†æœ€é«˜ï¼ŒæˆåŠŸå­¦ä¹ åˆ°äº†COMETä¸­çš„å¿ƒç†çŠ¶æ€çŸ¥è¯† ##
Analysis</li>
</ul></li>
<li>æ¶ˆèå®éªŒ</li>
<li>æ¡ˆä¾‹ç ”ç©¶</li>
<li>ç»†ç²’åº¦æƒ…æ„Ÿç†è§£
<ul>
<li>ç”¨ç²—ç²’åº¦çš„æƒ…æ„Ÿæ ‡ç­¾ä»£æ›¿ç»†ç²’åº¦çš„å¿ƒç†ä¿¡æ¯å¯ä»¥æ˜¾è‘—æé«˜æŒ‡æ ‡</li>
</ul></li>
<li>æ··åˆç­–ç•¥æ„ŸçŸ¥ç§»æƒ…ååº”
<ul>
<li>æ··åˆç­–ç•¥æœ‰åˆ©äºå¹³æ»‘çš„æƒ…æ„Ÿæ”¯æŒ</li>
<li>æ··åˆç­–ç•¥æ¯”å•ä¸€ç­–ç•¥æ›´æœ‰æ•ˆ</li>
<li>æ··åˆç­–ç•¥é€‚ç”¨äºESCæ¡†æ¶ ## Conclusions</li>
</ul></li>
<li>å¼•å…¥COMETæ¥æ•æ‰ç”¨æˆ·çš„å³æ—¶å¿ƒç†çŠ¶æ€</li>
<li>è®¾è®¡äº†ä¸€ä¸ªæ··åˆç­–ç•¥æ„ŸçŸ¥è§£ç å™¨æ¥äº§ç”Ÿæ”¯æŒå“åº” # è§£å†³äº†ä»€ä¹ˆé—®é¢˜ /
æ€ä¹ˆè§£å†³çš„</li>
</ul>
<h1 id="è¯¥æ–¹æ³•çš„ä¼˜åŠ¿">è¯¥æ–¹æ³•çš„ä¼˜åŠ¿</h1>
<ul>
<li><p>é•¿å¯¹è¯ä¸­çš„è¿‡åº¦æ›´åŠ é¡ºç•… # æœ‰ä»€ä¹ˆåˆ›æ–°ç‚¹</p></li>
<li><p>æå‡ºseq2seqæ¨¡å‹MISCï¼Œåœ¨ESCä¸­æ·»åŠ äº†å¸¸è¯†æ€§çŸ¥è¯†å’Œæ··åˆååº”ç­–ç•¥</p></li>
<li><p>æå‡ºäº†ä¸åŒçš„ç­–ç•¥æ¨¡å‹å¹¶åœ¨å¯¹è¯ä¸­ç»™äºˆæç¤º #
å®éªŒç»“æœå¥½åœ¨å“ªé‡Œï¼Œæ€ä¹ˆè¯æ˜çš„</p></li>
<li><p>ä»SOTAå»¶ç»­ä¸‹æ¥çš„ç»†ç²’åº¦æƒ…æ„Ÿè¡¨ç°è¾ƒç²—ç²’åº¦é™æ€æƒ…æ„Ÿæ›´å¥½ #
ç›¸å…³å·¥ä½œåˆ†æ</p></li>
</ul>
<h1 id="å¯ä»¥æå‡çš„åœ°æ–¹">å¯ä»¥æå‡çš„åœ°æ–¹</h1>
<ul>
<li>ä»¥åŠ¨æ€çš„æ–¹å¼å­¦ä¹ æ··åˆå“åº”ç­–ç•¥</li>
</ul>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>BlenderBot</title>
    <url>/-2023/Recipes%20for%20building%20an%20open-domain%20chatbot/</url>
    <content><![CDATA[<p><strong>Title:</strong> Recipes for building an open-domain
chatbot</p>
<blockquote>
<p>FaceBook åœ¨æœ¬æ–‡ä¸­æå‡ºäº† BlenderBot ç¼–è§£ç å™¨æ¨¡å‹</p>
</blockquote>
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<h2 id="abstract">Abstract</h2>
<ul>
<li><p>å¼€æ”¾åŸŸèŠå¤©æœºå™¨äººéœ€è¦è‰¯å¥½çš„è°ˆè¯æŠ€å·§ï¼šæå‡ºæœ‰å¸å¼•åŠ›çš„è¦ç‚¹ï¼Œå€¾å¬åˆ«äººçš„æ„è§ï¼Œé€‚å½“å±•ç¤ºçŸ¥è¯†ã€åŒç†æ€§å’Œä¸ªæ€§ï¼Œä¿æŒå‰åä¸€è‡´</p></li>
<li><p>æœ¬æ–‡è¯å®ï¼šåŸºäºé€‚å½“çš„è®­ç»ƒæ•°æ®å’Œç”Ÿæˆç­–ç•¥ï¼Œå¤§æ¨¡å‹å¯ä»¥å­¦ä¹ ä¸Šè¿°æŠ€å·§ ##
Introduction</p></li>
<li><p>ç ”ç©¶çš„ä¸»è¦å†…å®¹</p>
<ul>
<li>æ··åˆæŠ€å·§ï¼šæ¨¡å‹ä¸“æ³¨äºä¸ªæ€§å’Œå¸å¼•åŠ›ã€çŸ¥è¯†ã€åŒç†å¿ƒã€‚é‡‡ç”¨ Blended Skill
Talk
å®ç°ï¼Œå…·ä½“æ˜¯é€šè¿‡æä¾›è®­ç»ƒæ•°æ®å’Œåˆå§‹åŒ–ä¸Šä¸‹æ–‡æ¥å®ç°ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å‡å°‘ä»å¤§è¯­æ–™åº“ä¸­å­¦ä¹ åˆ°ä¸è‰¯ç‰¹å¾ã€‚</li>
<li>ç”Ÿæˆç­–ç•¥ï¼šè§£ç ç®—æ³•éå¸¸é‡è¦ï¼Œå¯¹è¯é•¿åº¦å¼ºç›¸å…³äºå¯¹è¯è´¨é‡ï¼Œæœ¬æ–‡å®éªŒè¡¨æ˜é‡‡æ ·ä¼˜äºæŸæœç´¢</li>
</ul></li>
<li><p>æœ¬æ–‡çš„ä¼˜åŠ¿å’Œå­˜åœ¨çš„é—®é¢˜ ## Model architectures</p></li>
<li><p>æ£€ç´¢</p>
<ul>
<li>å°†è®­ç»ƒé›†ä½œä¸ºå€™é€‰å“åº”é›†ï¼Œæ¯ä¸ªå¯èƒ½çš„å€™é€‰å“åº”éƒ½å‚ä¸Encoderï¼Œå¹¶åšèšç±»ã€poly-encoderã€‘</li>
</ul></li>
<li><p>ç”Ÿæˆ</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†çš„Seq2Seq Transformeræ¶æ„ç”Ÿæˆå“åº”</li>
</ul></li>
<li><p>æ£€ç´¢å’Œæç‚¼</p>
<ul>
<li>å¸®åŠ©æ¨¡å‹è®¿é—®æ²¡æœ‰åµŒå…¥å…¶æ¨¡å‹å‚æ•°çš„å¤–éƒ¨çŸ¥è¯†</li>
<li>å¯¹è¯æ£€ç´¢ï¼šé€šè¿‡æ£€ç´¢æ¨¡å‹ç”Ÿæˆå“åº”ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°Decoderçš„è¾“å…¥åºåˆ—ä¸­ï¼Œå¹¶ç”¨åˆ†éš”ç¬¦åˆ†å¼€ã€‚ä½¿ç”¨ä¿®æ”¹åçš„è¾“å…¥åºåˆ—ç”Ÿæˆæ­£å¸¸çš„å“åº”</li>
<li>çŸ¥è¯†æ£€ç´¢ï¼šæ£€ç´¢Wikiç”Ÿæˆåˆå§‹å€™é€‰é›†ï¼Œä½¿ç”¨ä¸Šæ–‡æåˆ°çš„æ£€ç´¢æ¨¡å‹ï¼Œæ’åºå€™é€‰è¯å¹¶é€‰æ‹©æ¡ä»¶ç”Ÿæˆçš„å¥å­ã€‚æ­¤å¤–ï¼Œè®­ç»ƒä¸€ä¸ªåˆ†ç±»å™¨ï¼Œé€šè¿‡ä¸Šä¸‹æ–‡åˆ¤æ–­ä½•æ—¶éœ€è¦æ£€ç´¢çŸ¥è¯†
## Training Objectives</li>
</ul></li>
<li><p>æ£€ç´¢æ’åº</p>
<ul>
<li>æ¨¡å‹è®­ç»ƒä½¿ç”¨æœ¬æ–‡å›ç­”ä½œä¸ºæ­£ä¾‹ï¼Œå…¶ä»–å¯¹è¯å›ç­”ä½œä¸ºè´Ÿä¾‹</li>
</ul></li>
<li><p>å“åº”ç”Ÿæˆæ¨¡å‹çš„ä¼¼ç„¶è®­ç»ƒ</p>
<ul>
<li>å»ºæ¨¡æ•´ä¸ªåºåˆ—çš„æ¦‚ç‡åˆ†å¸ƒ</li>
</ul></li>
<li><p>Î±-æ··åˆæ£€ç´¢å’Œæç‚¼</p>
<ul>
<li>ç”Ÿæˆæ¨¡å‹å¸¸å¸¸ä¸è€ƒè™‘å¯¹è¯æ£€ç´¢è¯­å¥ï¼Œä¸ºç¡®ä¿å…¶è¢«ä½¿ç”¨ï¼Œå°†æ£€ç´¢ç›¸åº”ä¸­çš„Î±%æ›¿æ¢æˆçœŸå®å“åº”ï¼ŒÎ±ä¸ºè¶…å‚æ•°</li>
<li>çŸ¥è¯†æ£€ç´¢çš„æ•°æ®é›†é‡Œï¼ŒçŸ¥è¯†æ¡ä»¶å’Œå“åº”ä¹‹é—´æœ‰æ˜ç¡®çš„å¯¹åº”å…³ç³»</li>
<li>å› æ­¤è®­ç»ƒé˜¶æ®µåªä½¿ç”¨çŸ¥è¯†æ£€ç´¢çš„æ•°æ®ï¼Œå……å®æ¨¡å‹å‚æ•°ä¸­å­¦åˆ°çš„çŸ¥è¯†</li>
</ul></li>
<li><p>å“åº”ç”Ÿæˆæ¨¡å‹çš„éä¼¼ç„¶æŸå¤±</p>
<ul>
<li>ä½¿ç”¨é«˜äºçœŸå®æ•°æ®æ•°é‡çš„nå…ƒè¯­æ³•ä¸­çš„tokenä½œä¸ºå€™é€‰è´Ÿæ ·æœ¬ï¼Œä¿®æ­£å·²çŸ¥çš„åå·®
## Decoding é€‰æ‹©è§£ç æ–¹æ³•å¯¹ç»™å®šçš„å†å²å¯¹è¯çš„å“åº”</li>
</ul></li>
<li><p>ç¡®å®šæ€§è§£ç æ–¹æ³•</p>
<ul>
<li>æŸæœç´¢</li>
<li>è´ªå¿ƒæœç´¢</li>
</ul></li>
<li><p>é‡‡æ ·</p>
<ul>
<li>å¤šé¡¹é‡‡æ ·ï¼šæ ¹æ®é¢„æµ‹ç»“æœæ¦‚ç‡åˆ†å¸ƒï¼Œå®šä¹‰å€™é€‰Tokenè¢«é€‰ä¸­çš„æ¦‚ç‡ã€‚é˜²æ­¢é‡‡æ ·åˆ°ä½æ¦‚ç‡Tokenï¼Œå¯ä»¥å°†é‡‡æ ·é™åˆ¶åœ¨è¯æ±‡è¡¨çš„å­é›†å†…ï¼Œå¹¶æ ¹æ®å­é›†æ¦‚ç‡é‡é‡‡æ ·</li>
<li>å¹³æ»‘åˆ†å¸ƒé‡‡æ ·ï¼šTemparature+SoftMax+multinomial</li>
<li>top-k
samplingï¼šTemparature+Top-k+SoftMax+multinomialï¼Œå°†top-kå¤–çš„tokenæ¦‚ç‡ç½®ä¸º0</li>
<li>sample-and-rankï¼šå¤šæ¬¡é‡‡æ ·ï¼Œå–æœ€é«˜æ¦‚ç‡çš„å“åº”</li>
</ul></li>
<li><p>å“åº”é•¿åº¦</p>
<ul>
<li>çº¦æŸæœ€å°ç”Ÿæˆé•¿åº¦ï¼šåœ¨å®ç°æœ€å°åºåˆ—é•¿åº¦ä¹‹å‰ï¼Œå¼ºåˆ¶ä¸ç”Ÿæˆç»“æŸæ ‡è®°</li>
<li>é¢„æµ‹é•¿åº¦ï¼šæ ¹æ®ä¸Šä¸‹æ–‡é¢„æµ‹ç›¸åº”é•¿åº¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå››åˆ†ç±»é—®é¢˜</li>
</ul></li>
<li><p>å­åºåˆ—åˆ†å—</p>
<ul>
<li>n-gramsï¼šè€ƒè™‘å“åº”å’Œè¾“å…¥ä¸Šä¸‹æ–‡ä¸­å¯¹äºn-gramsçš„é‡å¤æ€§ ## Training
Details</li>
</ul></li>
<li><p>é¢„è®­ç»ƒæ’åºæ¨¡å‹</p></li>
<li><p>é¢„è®­ç»ƒç”Ÿæˆæ¨¡å‹</p></li>
<li><p>å¾®è°ƒ</p>
<ul>
<li>Fairseq-styleæ··åˆç²¾åº¦è®­ç»ƒ</li>
</ul></li>
</ul>
<p>Training Data Safety Characteristics Evaluation Methods Related Work
Results &amp; Analysis Released code and models Discussion # å…³æ³¨çš„é—®é¢˜
/ æœ¬æ–‡çš„ä¼˜åŠ¿</p>
<ul>
<li>æˆå¯¹æ¯”è¾ƒå’Œäººæ€§æ–¹é¢ä¼˜äºMeena # è§£å†³æ–¹æ³• / åˆ›æ–°ç‚¹</li>
</ul>
<h1 id="å®éªŒç»“è®º">å®éªŒç»“è®º</h1>
<h1 id="æœ‰å¾…æå‡çš„éƒ¨åˆ†">æœ‰å¾…æå‡çš„éƒ¨åˆ†</h1>
<ul>
<li>å¦‚æœå¯¹è¯ä¸­æ·±å…¥è¯¢é—®æŸä¸€æ–¹é¢ï¼Œç”±äºç¼ºä¹çŸ¥è¯†æ¨¡å‹æ²¡æ³•ç»™å‡ºè¯¦ç»†çš„å›ç­”</li>
<li>æ¨¡å‹å€¾å‘äºç®€å•çš„å›ç­”</li>
<li>æ¨¡å‹å€¾å‘äºäº§ç”Ÿé‡å¤æ˜“æ··æ·†çš„å¥å­</li>
</ul>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>ESConv</title>
    <url>/-2023/Towards%20Emotional%20Support%20Dialog%20Systems/</url>
    <content><![CDATA[<p><strong>Title:</strong> Towards Emotional Support Dialog Systems</p>
<span id="more"></span>
<h1 id="è®ºæ–‡é€Ÿè§ˆ">è®ºæ–‡é€Ÿè§ˆ</h1>
<ul>
<li>Abstract
<ul>
<li>æœ¬æ–‡å…³æ³¨äºæƒ…æ„Ÿæ”¯æŒå¯¹è¯ï¼Œæä¾›äº†ä¸€ä¸ªå¸¦ç­–ç•¥çš„æƒ…ç»ªæ”¯æŒæ•°æ®é›†</li>
</ul></li>
<li>Introduction
<ul>
<li>æƒ…æ„Ÿæ”¯æŒåº”ç”¨å¹¿æ³›</li>
<li>æƒ…ç»ªæ”¯æŒæ•°æ®é›†åº”è¯¥åŒ…æ‹¬explorationã€understandã€suggestionä¸‰ä¸ªè¿‡ç¨‹ï¼Œè¿˜åŒ…æ‹¬æœ‰ç”¨æˆ·çš„æƒ…ç»ªå¼ºåº¦å˜åŒ–</li>
<li>ç›®å‰çš„ç ”ç©¶æ¨¡å‹ä¸­æ²¡æœ‰å…·ä½“æœ‰æ•ˆçš„æƒ…ç»ªæ”¯æŒæ–¹æ³•ï¼›é‡‡é›†æ•°æ®é›†æ—¶éœ€è¦è®­ç»ƒæœ‰ç´ çš„æ”¯æŒè€…</li>
<li>ESCæ¡†æ¶ï¼šä¸‰ä¸ªé˜¶æ®µï¼Œå¤šç§ç­–ç•¥ï¼›ä¼—åŒ…åšæ•°æ®é›†ï¼›åœ¨æƒ…ç»ªæ”¯æŒæ–¹é¢æœ‰æå‡</li>
</ul></li>
<li>Related Work
<ul>
<li>ç§»æƒ…ã€åŒæ„Ÿå¯¹è¯</li>
<li>æƒ…ç»ªæ”¯æŒçš„æ•°æ®é›†</li>
<li>æƒ…ç»ªæ”¯æŒå¯¹è¯
<ul>
<li>ä»»åŠ¡å®šä¹‰</li>
<li>ESCæ¡†æ¶
<ul>
<li>ä¸‰ä¸ªé˜¶æ®µï¼šæ¢ç´¢ã€ç†è§£ã€å»ºè®®</li>
<li>å…«ç§ç­–ç•¥</li>
</ul></li>
</ul></li>
</ul></li>
<li>Data Collection
<ul>
<li>è·å–æ•°æ®é›†çš„æ–¹æ³•</li>
</ul></li>
<li>Data Characteristics
<ul>
<li>æ•°æ®å±•ç¤º</li>
</ul></li>
<li>Experiments
<ul>
<li>åŸºå‡†æ¨¡å‹ï¼šBlenderBotã€DialoGPT</li>
<li>æ¨¡å‹å˜ç§ï¼šä¸å¸¦ç­–ç•¥ï¼šVanillaï¼›å¸¦ç­–ç•¥ï¼šRandomã€Jointã€Oracle</li>
<li>è¯„ä¼°æŒ‡æ ‡ï¼šPPLã€B-2ã€R-Lã€Extrema</li>
<li>å®éªŒç»“æœï¼š
<ul>
<li>å¸¦ç­–ç•¥çš„Oracleä¼˜äºä¸å¸¦ç­–ç•¥çš„Vanilla</li>
<li>å¸¦ç­–ç•¥çš„Oracleç¨å¾®å¼±äºä¸å¸¦ç­–ç•¥çš„Vanillaï¼Œå› ä¸ºä¸€æ—¦ç­–ç•¥é¢„æµ‹é”™è¯¯ï¼Œrespondä¼šå®Œå…¨ä¸åŒ</li>
<li>BlenderBot å˜ä½“å§‹ç»ˆæ¯” DialoGPT å˜ä½“è¡¨ç°æ›´å¥½</li>
</ul></li>
<li>äººç±»äº’åŠ¨è¯„ä»·ç»“æœï¼š
<ul>
<li>å¾®è°ƒåESèƒ½åŠ›æå‡</li>
<li>å¸¦ç­–ç•¥å¾®è°ƒåèƒ½æ›´åŠ é€‚åˆç”¨æˆ·éœ€æ±‚</li>
<li>æ­£ç¡®çš„ç­–ç•¥æ›´é‡è¦</li>
</ul></li>
</ul></li>
<li>Conclusion
<ul>
<li>ä¸‰ä¸ªé˜¶æ®µã€å¤šç§ç­–ç•¥ã€ESConv</li>
<li>é“å¾·è¯„ä¼° # è§£å†³äº†ä»€ä¹ˆé—®é¢˜</li>
</ul></li>
</ul>
<ol type="1">
<li><p>ç›®å‰çš„å¯¹è¯ç³»ç»Ÿæ²¡æœ‰é’ˆå¯¹æƒ…æ„Ÿæ”¯æŒçš„ä»»åŠ¡å’Œè¯­æ–™åº“ï¼Œå› æ­¤ESCæ–¹å‘è¿˜æ²¡æœ‰è¢«æ¢ç´¢åˆ°ï¼Œå¯¹è¯åœºæ™¯ä¸­ç¼ºä¹æƒ…æ„Ÿæ”¯æŒã€‚</p></li>
<li><p>æƒ…æ„Ÿæ”¯æŒï¼ˆESï¼‰æ—¨åœ¨å‡å°‘ä¸ªäººçš„æƒ…ç»ªå›°æ‰°ï¼Œå¸®åŠ©ä»–ä»¬ç†è§£å’Œåº”å¯¹æ‰€é¢ä¸´çš„æŒ‘æˆ˜ã€‚ç›®å‰çš„æ¨¡å‹å¤§éƒ½åªèƒ½è¡¨ç¤ºå…±æƒ…è€Œä¸èƒ½è§£å†³é—®é¢˜ã€‚</p></li>
<li><p>é€šè¿‡ç¤¾äº¤è€Œä¸æ˜¯ä¸“ä¸šå’¨è¯¢çš„æ–¹å¼æä¾›æƒ…æ„Ÿæ”¯æŒã€‚ #
æ€ä¹ˆè§£å†³çš„/è¯¥æ–¹æ³•çš„ä¼˜åŠ¿</p></li>
<li><p>åŸºäºHillçš„å¸®åŠ©æŠ€èƒ½ç†è®ºï¼Œæå‡ºäº†ESCæ¡†æ¶</p>
<ol type="1">
<li>æƒ…æ„Ÿæ”¯æŒè¿‡ç¨‹
<ol type="1">
<li>ç†è§£é‡åˆ°çš„å›°éš¾ï¼Œexploration</li>
<li>è¡¨è¾¾ç†è§£å’ŒåŒæƒ…ï¼Œinsight/comforting</li>
<li>æå‡ºè§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œaction</li>
</ol></li>
</ol></li>
<li><p>æ„å»ºESConvæ•°æ®é›†ï¼Œæœ‰ä¸°å¯Œçš„æ³¨é‡Šï¼ˆæ”¯æŒç­–ç•¥ï¼‰</p>
<ol type="1">
<li>æ¯ä¸ªèŠå¤©ä¼šéƒ½ä¼šæ ‡è®°ï¼š
<ol type="1">
<li>é—®é¢˜ç±»åˆ«</li>
<li>ç”¨æˆ·æƒ…ç»ªç±»åˆ«</li>
<li>ç”¨æˆ·æƒ…ç»ªå¼ºåº¦</li>
<li>é‡åˆ°å›°éš¾çš„ç®€ä»‹</li>
</ol></li>
</ol></li>
<li><p>ESCç³»ç»Ÿ</p>
<ol type="1">
<li>é€‰æ‹©æ”¯æŒç­–ç•¥ï¼Œç”Ÿæˆç­–ç•¥çº¦æŸRespond</li>
<li>æƒ…ç»ªçŠ¶æ€å»ºæ¨¡ï¼Œè·Ÿè¸ªç”¨æˆ·æƒ…ç»ªå˜åŒ–ã€å¾…åˆ†æã€‘</li>
<li>æå‡ºäº†è¯„ä¼°ESå®éªŒæ•ˆæœçš„æ–°æ–¹æ³• # æœ‰ä»€ä¹ˆåˆ›æ–°ç‚¹</li>
</ol></li>
</ol>
<h1 id="å®éªŒç»“æœå¥½åœ¨å“ªé‡Œæ€ä¹ˆè¯æ˜çš„">å®éªŒç»“æœå¥½åœ¨å“ªé‡Œï¼Œæ€ä¹ˆè¯æ˜çš„</h1>
<h1 id="ç›¸å…³å·¥ä½œåˆ†æ">ç›¸å…³å·¥ä½œåˆ†æ</h1>
<ol type="1">
<li>è¡¨è¾¾æƒ…æ„Ÿ
<ol type="1">
<li>ECMï¼šæƒ…æ„Ÿå¯¹è¯ï¼Œå¯ä»¥ç”Ÿæˆæƒ…æ„Ÿååº”ã€‚æœ‰æƒ…å•†è€Œä¸åªæ˜¯æ™ºå•†</li>
<li>ESï¼šæœ‰æƒ…ç»ªæ”¯æŒçš„èƒ½åŠ›ï¼Œå¯ä»¥å‡å°‘ç”¨æˆ·æƒ…ç»ªå›°æ‰°</li>
</ol></li>
<li>å…±æƒ…èƒ½åŠ›
<ol type="1">
<li>ååº”å‡ºåŒæƒ…å¿ƒï¼Œä¸èƒ½åšæƒ…ç»ªæ”¯æŒ</li>
</ol></li>
<li>æ•°æ®é›†
<ol type="1">
<li>æ•°æ®é›†ä¸­çš„å¯¹è¯çŸ­ï¼Œä¸é€‚åˆESä»»åŠ¡</li>
</ol></li>
<li>ESCç³»ç»Ÿ
<ol type="1">
<li>å¤§å¤šç ”ç©¶éƒ½äººä¸ºé¢„å…ˆè§„å®šå¥½çš„è§„åˆ™å’Œå›å¤è¯å…¸ # å¯ä»¥æå‡çš„åœ°æ–¹</li>
</ol></li>
</ol>
]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>æƒ…ç»ªæ”¯æŒå¯¹è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>Java å¹¶å‘é”</title>
    <url>/#developer/JUC-Lock/</url>
    <content><![CDATA[<p>Java.util.concurrent ä¸­æœ‰å¾ˆå¤š Java å¹¶å‘ç›¸å…³å·¥å…·ï¼Œä¾‹å¦‚ é”
<code>ReentrantLock</code>ã€çº¿ç¨‹ <code>Callable</code>
<code>FutureTask</code>ã€ä¿¡å·é‡ <code>Semaphore</code>ã€å…±äº«é”
<code>CountDownLatch</code></p>
<p>æ­¤å¤– Java åŸç”Ÿçš„ <code>volatile</code> å’Œ <code>synchronized</code>
å…³é”®å­—ä¹Ÿæ˜¯å¹¶å‘ç¼–ç¨‹çš„å…³é”®ã€‚</p>
<span id="more"></span>
<p>ç®€å•çš„ CAS å®ç°ï¼š<code>AtomicInteger.compareAndSet(1, 2)</code></p>
<h1 id="synchronized-å…³é”®å­—">synchronized å…³é”®å­—</h1>
<p><strong>å±æ€§ï¼šå¯é‡å…¥é”ã€ç‹¬å é”ã€éå…¬å¹³é”</strong></p>
<p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>monitor</code>
å¯¹è±¡äºä¹‹å…³è”ï¼Œ<code>synchronized</code> é€šè¿‡å¯¹è±¡ç›‘è§†å™¨
<code>monitor</code> å’Œæ“ä½œç³»ç»Ÿçš„ <code>Mutex Lock</code>
å®ç°åŠ é”å’Œè§£é”ï¼Œè¢«é”ä½çš„åŒºåŸŸæ˜¯<code>ä¸´ç•ŒåŒº</code>ï¼šä¸´ç•ŒåŒºå†…è¢«é”ä¿æŠ¤ï¼Œçº¿ç¨‹é—´åªèƒ½ä¸²è¡Œè®¿é—®çš„ä»£ç ï¼›</p>
<p><strong>ä½œç”¨åŸŸ</strong>ï¼š</p>
<ul>
<li>ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œé”å½“å‰å¯¹è±¡å®ä¾‹ã€‚
<ul>
<li>ä¿®é¥°çš„æ–¹æ³•åœ¨ç¼–è¯‘æˆå­—èŠ‚ç çš„æ—¶å€™ï¼Œåœ¨ flag ä¸Šæ ‡è®° ACC_SYNCHRONIZED</li>
</ul></li>
<li>ä¿®é¥°é™æ€æ–¹æ³•ï¼Œé”å½“å‰ç±»ï¼Œä¼šä½œç”¨äºæ‰€æœ‰å®ä¾‹ã€‚</li>
<li>ä¿®é¥°åŒæ­¥è¯­å¥å—ï¼Œç¨‹åºæŒ‡å®š Object / .classã€‚
<ul>
<li>é€šè¿‡ monitorenter å’Œ monitorexit æŒ‡ä»¤å®ç°</li>
</ul></li>
</ul>
<p><strong>é”ç²—åŒ–å’Œé”æ¶ˆé™¤</strong>ï¼š</p>
<ul>
<li>é”ç²—åŒ–ï¼šå°†å¤šæ¬¡é”è¯·æ±‚åˆå¹¶æˆä¸€ä¸ªè¯·æ±‚ï¼Œä»¥é™ä½çŸ­æ—¶é—´å†…å¤§é‡é”è¯·æ±‚ã€åŒæ­¥ã€é‡Šæ”¾å¸¦æ¥çš„æ€§èƒ½æŸè€—</li>
<li>é”æ¶ˆé™¤ï¼šJava è™šæ‹Ÿæœºåœ¨ JIT
ç¼–è¯‘æ—¶ï¼Œé€šè¿‡å¯¹è¿è¡Œä¸Šä¸‹æ–‡çš„æ‰«æï¼Œå»é™¤ä¸å¯èƒ½å­˜åœ¨å…±äº«èµ„æºç«äº‰çš„é”ï¼Œé€šè¿‡é”æ¶ˆé™¤ï¼Œå¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”æ—¶é—´</li>
</ul>
<blockquote>
<p>.java -&gt; .class å­—èŠ‚ç ï¼šJavac</p>
<p>å­—èŠ‚ç  -&gt; æœºå™¨ç ï¼šJITï¼ˆJust-in-timeï¼‰åŠ¨æ€ï¼ˆå³æ—¶ï¼‰ç¼–è¯‘ï¼›AOTï¼ˆAhead
Of Timeï¼‰è¿è¡Œå‰ç¼–è¯‘</p>
</blockquote>
<h2 id="é”å‡çº§ç­–ç•¥"><a
href="https://www.cnblogs.com/yescode/p/14474104.html#autoid-0-0-0">é”å‡çº§ç­–ç•¥</a></h2>
<ul>
<li><p>åå‘é”ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œæ— ç«äº‰æƒ…å†µæ—¶ï¼Œçº¿ç¨‹å¯ä»¥ç›´æ¥è·å¾—é”ï¼Œæ²¡æœ‰é¢å¤–çš„å¼€é”€ã€‚CAS
ä¿®æ”¹ Markword å¤´ä¿¡æ¯ï¼Œè¯¥æ“ä½œä¸€èˆ¬ä¸ä¼šæ’¤é”€ï¼Œä»¥é¿å… CAS å¼€é”€ã€‚</p></li>
<li><p>è½»é‡çº§é”ï¼šå¤šä¸ªçº¿ç¨‹éƒ½æ˜¯åœ¨ä¸åŒçš„æ—¶é—´æ®µæ¥è¯·æ±‚åŒä¸€æŠŠé”æ—¶ï¼ŒJVM
ä¼šä½¿ç”¨è½»é‡çº§é”ï¼šé€šè¿‡ CAS
å°è¯•è·å–é”ï¼Œä¸é˜»å¡çº¿ç¨‹ã€‚å¦‚æœç«äº‰å¤±è´¥ç›´æ¥ä¼šå‡çº§æˆé‡é‡çº§é”ï¼Œå‡çº§è¿‡ç¨‹ä¼šè‡ªæ—‹å°è¯•è·å–é”ã€‚</p></li>
<li><p>é‡é‡çº§é”ï¼šåŠ é”çš„è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨è‡ªé€‚åº”è‡ªæ—‹ï¼Œé¿å…ç›´æ¥é˜»å¡çº¿ç¨‹ã€‚è‡ªæ—‹å¤±è´¥æ‰ä¼šé˜»å¡çº¿ç¨‹å¹¶å…¥é˜Ÿï¼Œé˜»å¡æ“ä½œ<code>LockSupport.park</code>ç”±æ“ä½œç³»ç»Ÿæ¥å®ç°ï¼Œæ€§èƒ½æ¶ˆè€—é«˜ã€‚å”¤é†’çº¿ç¨‹çš„ç­–ç•¥è§ä¸‹å›¾ï¼šï¼ˆwaitset
ç¯å½¢åŒå‘é“¾è¡¨ï¼›cxq æ ˆï¼›entrylist åŒå‘é“¾è¡¨ï¼‰</p></li>
</ul>
<img data-src="/" class="" title="img">
<p>ä¸‹å›¾æ˜¯<strong>å¯¹è±¡å¤´ä¸­çš„ MarkWord</strong>ï¼šMarkWord
ç»“æ„ä¹‹æ‰€ä»¥æå¾—è¿™ä¹ˆå¤æ‚ï¼Œæ˜¯å› ä¸ºéœ€è¦èŠ‚çœå†…å­˜ï¼Œè®©åŒä¸€ä¸ªå†…å­˜åŒºåŸŸåœ¨ä¸åŒé˜¶æ®µæœ‰ä¸åŒçš„ç”¨å¤„ï¼ˆå›¾æœ‰è¯¯ï¼Œhashcode
å  32 ä½ï¼‰</p>
<ul>
<li>æŒ‡å‘çº¿ç¨‹æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ = æŒæœ‰é”çº¿ç¨‹çš„ lockRecord çš„æŒ‡é’ˆ</li>
<li>æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆ = æŒ‡å‘ monitor çš„æŒ‡é’ˆ</li>
</ul>
<img data-src="/" class="" title="img">
<h1 id="reentrantlock">ReentrantLock</h1>
<p><strong>å±æ€§ï¼šå¯é‡å…¥é”ã€ç‹¬å é”ã€å…¬å¹³é” or éå…¬å¹³é”</strong></p>
<p><strong>ç‰¹ç‚¹ï¼šå¯é™æ—¶ç­‰å¾…ã€å¯å“åº”ä¸­æ–­ã€å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥</strong></p>
<p>ä½¿ç”¨åœºæ™¯ï¼šé˜»å¡é˜Ÿåˆ— <code>ArrayBlockingQueue</code>
<code>LinkedBlockingDeque</code> é€šè¿‡ Condition
å®ç°é˜Ÿåˆ—æ»¡æ’å…¥å’Œé˜Ÿåˆ—ç©ºå–å‡ºçš„é˜»å¡ï¼›ä½œä¸ºè¯»å†™é”
<code>ReentrantReadWriteLock</code> çš„çˆ¶ç±»</p>
<p>æºç ç»“æ„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReentrantLock</span> <span class="keyword">implements</span> <span class="title class_">Lock</span> &#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥æ§åˆ¶å™¨ï¼ˆæŒ‡å‘å…¬å¹³é”æˆ–éå…¬å¹³é”ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync sync;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Sync</span> <span class="keyword">extends</span> <span class="title class_">AbstractQueuedSynchronizer</span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">nonfairTryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;...&#125;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> releases)</span> &#123;...&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸å…¬å¹³é”</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">NonfairSync</span> <span class="keyword">extends</span> <span class="title class_">Sync</span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;...&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…¬å¹³é”</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">FairSync</span> <span class="keyword">extends</span> <span class="title class_">Sync</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;...&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®ç° Lock æ¥å£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.lock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sync.nonfairTryAcquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ReentrantLock</code>ç‹¬å é”è¿è¡Œè¿‡ç¨‹ï¼ˆå¯é‡å…¥é”çš„
<code>state</code> è¡¨ç¤º==é‡å…¥çš„æ¬¡æ•°==ï¼Œä¼šå¤§äº1ï¼‰</p>
<style>.kxhwiuwhmjwg{}</style>
<img data-src="/" class="kxhwiuwhmjwg" alt="AQS ç‹¬å æ¨¡å¼è·å–é”">
<h2 id="åŠ é”å¤±è´¥æ—¶é˜»å¡">åŠ é”å¤±è´¥æ—¶é˜»å¡</h2>
<p><code>ReentrantLock</code>åœ¨ CAS åŠ é”å¤±è´¥ä¹‹åä¼šå°† Thread
å°è£…æˆä¸€ä¸ª<code>Node</code>ç±»å‹çš„å¯¹è±¡åŠ å…¥<code>CLH</code>é˜Ÿåˆ—ä¸­</p>
<p>ç„¶åè°ƒç”¨<code>LockSupport.park(this)</code>è¿›è¡Œé˜»å¡ï¼ˆ<code>LockSupport</code>æ˜¯ä¸€ä¸ª
native æ–¹æ³•å®ç°çš„å·¥å…·ç±»ï¼Œåœ¨ hotspot
æºç ä¸­é€šè¿‡<code>mutex</code>æ¥å®ç°çš„ï¼‰</p>
<h2 id="ä¸-synchronized-å¯¹æ¯”">ä¸ synchronized å¯¹æ¯”</h2>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 38%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="header">
<th>æ¯”è¾ƒ</th>
<th style="text-align: left;">ReentrantLock</th>
<th>synchronized</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>å¦‚ä½•å®ç°ä»»åŠ¡çš„ç­‰å¾…-å”¤é†’ï¼Ÿ</td>
<td style="text-align: left;">Condition ç±»
<code>await/signal</code>ï¼Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥</td>
<td>Object çš„ <code>wait/notify</code>ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹æ˜¯ç”± JVM é€‰æ‹©çš„</td>
</tr>
<tr class="even">
<td>å¦‚ä½•é‡Šæ”¾é”ï¼Ÿ</td>
<td style="text-align: left;">éœ€è¦æ‰‹åŠ¨é‡Šæ”¾é”</td>
<td>å‡ºä»£ç å—åè‡ªåŠ¨é‡Šæ”¾</td>
</tr>
<tr class="odd">
<td>åº•å±‚å¦‚ä½•å®ç°ï¼Ÿ</td>
<td style="text-align: left;">API å®ç°</td>
<td>JVM å†…éƒ¨é”å‡çº§ç­–ç•¥</td>
</tr>
<tr class="even">
<td>æ˜¯å¦å¯å®ç°å¯ä¸­æ–­é”ã€å…¬å¹³é”ï¼Ÿ</td>
<td style="text-align: left;">å¯ä»¥</td>
<td>ä¸å¯ä»¥</td>
</tr>
<tr class="odd">
<td>å ç”¨èµ„æºå¤§ä¸å¤§ï¼Ÿ</td>
<td
style="text-align: left;">é€šè¿‡è‡ªæ—‹<code>CAS</code>å’Œ<code>Unsafe.park/unpark</code>æŒ‚èµ·å”¤é†’çº¿ç¨‹</td>
<td>é”å‡çº§ç­–ç•¥ï¼šè½»é‡çº§é”<code>CAS</code>ä¸ä¼šé˜»å¡æŒ‚èµ·ï¼›é‡é‡çº§é”æ‰ä¼šå’Œ<code>ReentrantLock</code>ä¸€æ ·<code>park/unpark</code></td>
</tr>
</tbody>
</table>
<p>å¯ä¸­æ–­é”ï¼šè·å–é”çš„è¿‡ç¨‹ä¸­å¯ä»¥è¢«ä¸­æ–­ï¼Œä¸éœ€è¦ä¸€ç›´ç­‰åˆ°è·å–é”ä¹‹åæ‰èƒ½è¿›è¡Œå…¶ä»–é€»è¾‘å¤„ç†ã€‚</p>
<p>ä¸å¯ä¸­æ–­é”ï¼šä¸€æ—¦çº¿ç¨‹ç”³è¯·äº†é”ï¼Œå°±åªèƒ½ç­‰åˆ°æ‹¿åˆ°é”ä»¥åæ‰èƒ½è¿›è¡Œå…¶ä»–çš„é€»è¾‘å¤„ç†ã€‚</p>
<h1 id="abstractqueuedsynchronizer-æŠ½è±¡ç±»">AbstractQueuedSynchronizer
æŠ½è±¡ç±»</h1>
<p>ReentrantLockã€å€’è®¡æ—¶å™¨ã€ä¿¡å·é‡çš„ Sync å’Œçº¿ç¨‹æ± çš„ worker éƒ½æ˜¯åŸºäº AQS
å®ç°çš„ã€‚AQS
å°è£…äº†çº¿ç¨‹çš„å…¥é˜Ÿä¸å‡ºé˜Ÿã€çŠ¶æ€æ›´æ–°ä»¥åŠé˜»å¡ä¸å”¤é†’ç­‰åº•å±‚ç»†èŠ‚ï¼Œé€šè¿‡é‡å†™<code>tryAcquire(int)</code>ã€<code>tryRelease(int)</code>ç­‰æ–¹æ³•ï¼Œå®ç°ç±»å¯ä»¥å®ç°å…·ä½“çš„èµ„æºæ§åˆ¶é€»è¾‘ã€‚</p>
<p>AQS
æ ¸å¿ƒæ€æƒ³ï¼šå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†<strong>å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€</strong>ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé€šè¿‡
CLH é”å®ç°<strong>çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…</strong>ã€‚</p>
<p>CLH é”ï¼šè‡ªæ—‹é”çš„ä¸€ç§æ”¹è¿›ï¼Œåˆ©ç”¨ ==FIFO åŒç«¯é˜Ÿåˆ—== å’Œ ==Node èŠ‚ç‚¹==
ç»´æŠ¤ç­‰å¾…è·å–èµ„æºçš„çº¿ç¨‹é˜Ÿåˆ—ï¼Œ==state
æˆå‘˜å˜é‡==è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸­åŒ…æ‹¬äº†çº¿ç¨‹çš„å¼•ç”¨ã€
å½“å‰èŠ‚ç‚¹åœ¨é˜Ÿåˆ—ä¸­çš„çŠ¶æ€ã€å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹ã€‚</p>
<p>æºç ç»“æ„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractQueuedSynchronizer</span> <span class="keyword">extends</span> <span class="title class_">AbstractOwnableSynchronizer</span> &#123;</span><br><span class="line">    <span class="comment">// è¡¨ç¤ºé”çš„æŒæœ‰æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> state;</span><br><span class="line">    <span class="comment">// åŒå‘é˜Ÿåˆ—ï¼ˆé“¾è¡¨å®ç°ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node tail;</span><br><span class="line">    <span class="comment">// æœ¬åœ°æ–¹æ³• eg:unsafe.compareAndSwapInt</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line">    <span class="comment">// å°è£…çº¿ç¨‹çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="comment">// æ ‡è¯†å½“å‰èŠ‚ç‚¹å¯¹åº”çš„ç­‰å¾…çŠ¶æ€ï¼ˆä¸éè´Ÿæ•°æ—¶ï¼Œä»…ä½œä¸ºæ™®é€šæ ‡è¯†ï¼Œä¸‹æ–‡æœ‰è¯¦ç»†ä»‹ç»ï¼‰</span></span><br><span class="line">        <span class="keyword">volatile</span> <span class="type">int</span> waitStatus;</span><br><span class="line">        <span class="keyword">volatile</span> Node prev;</span><br><span class="line">        <span class="keyword">volatile</span> Node next;</span><br><span class="line">        <span class="keyword">volatile</span> Thread thread;</span><br><span class="line">        <span class="comment">// å…±äº«é”ï¼šSemaphoreã€CountDownLatch</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">SHARED</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        <span class="comment">// ç‹¬å é”ï¼šReentrantLock</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">EXCLUSIVE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹æƒ³è¦è·å–çš„æ˜¯æ’ä»–é”è¿˜æ˜¯å…±äº«é”</span></span><br><span class="line">        Node nextWaiter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¡ä»¶é˜Ÿåˆ—ï¼Œä¿å­˜æœ‰è§¦å‘æ¡ä»¶çš„ Nodeï¼Œå®ç°é€‰æ‹©æ€§é€šçŸ¥</span></span><br><span class="line">    <span class="comment">// ä½œç”¨ç±»ä¼¼äº Object å†…ç½®çš„ç›‘è§†å™¨æ–¹æ³•ï¼šwait notify notifyAll</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConditionObject</span> <span class="keyword">implements</span> <span class="title class_">Condition</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">transient</span> Node firstWaiter;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">transient</span> Node lastWaiter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¶…æ—¶ä¸­æ–­</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">spinForTimeoutThreshold</span> <span class="operator">=</span> <span class="number">1000L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>waitStatus çŠ¶æ€æšä¸¾å€¼ï¼ˆåˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºåˆå§‹åŒ–çŠ¶æ€ï¼‰ã€ä½¿ç”¨æƒ…å†µã€‘
<ul>
<li><code>CANCELLED</code> è¡¨ç¤ºçº¿ç¨‹å·²ç»è¢«<u>å–æ¶ˆ</u>ã€å“åº”ä¸­æ–­ã€‘</li>
<li><code>SIGNAL</code> è¡¨ç¤ºåç»§èŠ‚ç‚¹çš„çº¿ç¨‹éœ€è¦è¢«å”¤é†’ã€åŒæ­¥é˜Ÿåˆ—ã€‘</li>
<li><code>CONDITION</code>
è¡¨ç¤ºçº¿ç¨‹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…æŸä¸ª<u>æ¡ä»¶</u>æ»¡è¶³ã€æ¡ä»¶é˜Ÿåˆ—ã€‘</li>
<li><code>PROPAGATE</code> è¡¨ç¤ºå…±äº«æ¨¡å¼ä¸‹çš„èµ„æºä¼ æ’­ã€å…±äº«é”ã€‘</li>
</ul></li>
</ul>
<p><strong>å®ç°ç±»å¯ä»¥æ˜¯ç‹¬å é”æˆ–è€…å…±äº«é”</strong></p>
<ul>
<li>ç‹¬å é”ï¼štryAcquire-tryRelease</li>
<li>å…±äº«é”ï¼štryAcquireShared-tryReleaseShared</li>
</ul>
<p><strong>çº¿ç¨‹è°ƒåº¦é€»è¾‘</strong>ï¼š
å½“çº¿ç¨‹å°è¯•è·å–èµ„æºå¤±è´¥æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª==NodeèŠ‚ç‚¹==å¹¶å°†å½“å‰çº¿ç¨‹åŒ…è£…è¿›å»ï¼Œç„¶ååˆ©ç”¨==CASç®—æ³•==å°†å…¶å®‰å…¨åœ°åŠ å…¥åˆ°==ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨==ï¼Œå¹¶é˜»å¡ã€‚<a
href="https://www.bilibili.com/video/BV1mP4y1i7Vm/?p=6&amp;spm_id_from=pageDriver">Link</a></p>
<style>.gqylmpcnqwko{zoom:67%;}</style>
<img data-src="/" class="gqylmpcnqwko" alt="image-20240415164535374">
<p>åœ¨é‡Šæ”¾èµ„æºæ—¶ï¼ŒAQSä¼šæ ¹æ®èµ„æºç®¡ç†ç­–ç•¥ä»é˜Ÿåˆ—ä¸­é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹å¹¶å”¤é†’å¯¹åº”çº¿ç¨‹ã€‚</p>
<h2 id="clh-é”">CLH é”</h2>
<blockquote>
<p>Craig, Landin, and Hagersten locks
å®ç°çº¿ç¨‹<u>é˜»å¡ç­‰å¾…</u>ä»¥åŠ<u>è¢«å”¤é†’æ—¶é”åˆ†é…</u>çš„æœºåˆ¶</p>
</blockquote>
<p>CLH é”æ˜¯å¯¹è‡ªæ—‹é”çš„ä¸€ç§æ”¹è‰¯ï¼Œæ˜¯ä¸€ç§éšå¼çš„é“¾è¡¨é˜Ÿåˆ—</p>
<img data-src="/" class="" title="CLH é˜Ÿåˆ—">
<p>é‡‡ç”¨<strong>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</strong></p>
<p>æ¨¡æ¿æ–¹æ³•ï¼šæŠ½è±¡å‡ºæ­¥éª¤çš„æ‰§è¡Œé¡ºåºä½œä¸ºæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°æ–¹æ³•äº¤ç»™å­ç±»å®ç°ã€‚</p>
<p>è‡ªå®šä¹‰ <code>Synchronizer</code> æ—¶éœ€è¦é‡å†™å‡ ä¸ª AQS
æä¾›çš„é’©å­æ–¹æ³•ï¼ˆé€šè¿‡é’©å­æ–¹æ³•æ§åˆ¶ <code>state</code>
ä¸ºä½•å€¼æ—¶ä»£è¡¨åŠ é”æˆåŠŸ/å¤±è´¥ã€è§£é”æˆåŠŸ/å¤±è´¥ï¼‰ï¼štryAcquire-tryReleaseã€tryAcquireShared-tryReleaseSharedã€isHeldExclusively</p>
<ul>
<li>è§£é‡Šä¸€ä¸‹ä¿¡å·é‡ã€å€’è®¡æ—¶å™¨ã€å¯é‡å…¥é”çš„ state çš„å«ä¹‰</li>
</ul>
<h2 id="locksupport-ç±»">LockSupport ç±»</h2>
<p>æ“ä½œ Node ä¸­çš„ threadï¼Œå®ç°çº¿ç¨‹çš„é˜»å¡ <code>park</code> å’Œè§£é™¤é˜»å¡
<code>unpark</code> ã€‚<a
href="https://juejin.cn/post/7023021536231555086">Link</a></p>
<p>å…·ä½“æ¥è¯´ï¼Œæ“ä½œâ€è®¸å¯â€œï¼ˆå¤šæ¬¡ unpark
ä¹Ÿåªèƒ½è·å–ä¸€æ¬¡è®¸å¯ï¼Œä¸å¯å åŠ ï¼‰ï¼Œåº•å±‚é€šè¿‡<code>mutex</code>ï¼ˆäº’æ–¥é‡ï¼‰å’Œ<code>condition</code>ï¼ˆæ¡ä»¶å˜é‡ï¼‰å®ç°ã€‚ã€<code>mutex</code>å­˜åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€‘</p>
<blockquote>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="header">
<th>Java çº¿ç¨‹ä¸­æ–­æ–¹æ³•</th>
<th>æ–¹æ³•æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Thread.currentThread().interrupt()</code></td>
<td>å°†çº¿ç¨‹çš„çŠ¶æ€ç½®ä¸º"ä¸­æ–­"</td>
</tr>
<tr class="even">
<td><code>Thread.interrupted()</code></td>
<td>è·å–å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šæ¸…é™¤çº¿ç¨‹çš„çŠ¶æ€æ ‡è®°ï¼Œé™æ€æ–¹æ³•</td>
</tr>
<tr class="odd">
<td><code>Thread.isInterrupted()</code></td>
<td>è·å–è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æ‰€è¡¨ç¤ºçš„çº¿ç¨‹ï¼Œä¸ä¼šæ¸…é™¤çº¿ç¨‹çš„çŠ¶æ€æ ‡è®°ï¼Œå®ä¾‹æ–¹æ³•é˜»å¡å’Œä¸­æ–­çš„åŒºåˆ«ï¼Ÿ</td>
</tr>
</tbody>
</table>
<p>é˜»å¡å’Œä¸­æ–­çš„åŒºåˆ«ï¼Ÿ</p>
</blockquote>
<h2 id="lock-æ¥å£">Lock æ¥å£</h2>
<table>
<colgroup>
<col style="width: 45%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="header">
<th>æ–¹æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>lock(): void</td>
<td>åŠ é”ï¼ˆReentrantLock é»˜è®¤ä¸å¯å“åº”ä¸­æ–­ï¼‰</td>
</tr>
<tr class="even">
<td>lockInterruptibly(): void</td>
<td>åŠ é”ï¼Œé˜»å¡ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›¸åº”ä¸­æ–­</td>
</tr>
<tr class="odd">
<td>tryLock(): boolean</td>
<td>éé˜»å¡è·å–é”</td>
</tr>
<tr class="even">
<td>tryLock(long, TimeUnit): boolean</td>
<td>æ—¶é—´æ®µå†…è·å–é”</td>
</tr>
<tr class="odd">
<td>unlock(): void</td>
<td>è§£é”</td>
</tr>
<tr class="even">
<td>newCondition(): Condition</td>
<td>è·å–æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—</td>
</tr>
</tbody>
</table>
<h2 id="å…¬å¹³é”-éå…¬å¹³é”">å…¬å¹³é” &amp; éå…¬å¹³é”</h2>
<p><code>AbstractQueuedSynchronizer.hasQueuedPredecessors()</code>
çº¿ç¨‹åœ¨è·å–é”å‰ï¼Œå…ˆåˆ¤æ–­ä¸€ä¸‹è‡ªå·±åœ¨ä¸åœ¨é˜Ÿåˆ—çš„é¦–ä½ï¼Œåªæœ‰é˜Ÿé¦–çº¿ç¨‹èƒ½è¢«è¿è¡Œ</p>
<h1 id="reentrantreadwritelock">ReentrantReadWriteLock</h1>
<p>ç»§æ‰¿è‡ª ReentrantLock</p>
<p>è¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬å é”ï¼›è¯»è¯»ä¸äº’æ–¥ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥ï¼›å†™é”å¯ä»¥å‡çº§æˆè¯»é”</p>
<ul>
<li><strong>å…±äº«é”</strong>ï¼šä¸€æŠŠé”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å¾—ã€‚</li>
<li><strong>ç‹¬å é”</strong>ï¼šä¸€æŠŠé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ã€‚</li>
</ul>
<h1 id="stampedlock">StampedLock</h1>
<p>ä¸æ˜¯ç›´æ¥å®ç° <code>Lock</code>æˆ–
<code>ReadWriteLock</code>æ¥å£ï¼Œè€Œæ˜¯åŸºäº <strong>CLH é”</strong>
å®ç°çš„</p>
<h1 id="semaphore">Semaphore</h1>
<p>ä¿¡å·é‡ï¼Œå¯é€‰æ‹©å…¬å¹³ / éå…¬å¹³é”ã€‚</p>
<p>æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œé€šå¸¸ç”¨äºé‚£äº›èµ„æºæœ‰æ˜ç¡®è®¿é—®æ•°é‡é™åˆ¶çš„åœºæ™¯ï¼Œæ¯”å¦‚é™æµï¼ˆä»…é™äºå•æœºæ¨¡å¼ï¼Œå®é™…é¡¹ç›®ä¸­æ¨èä½¿ç”¨
Redis +Lua æ¥åšé™æµï¼‰</p>
<h1 id="countdownlatch">CountDownLatch</h1>
<p>å€’è®¡æ—¶å™¨ï¼š<code>await()</code>é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“
<code>count</code>ä¸ºé›¶ï¼ˆå³ stateï¼‰æ—¶ï¼Œå”¤é†’æ‰€æœ‰è¢«é˜»å¡çš„çº¿ç¨‹ã€‚</p>
<p><code>CountDownLatch</code>
æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè®¡æ•°å™¨çš„å€¼åªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åæ²¡æœ‰ä»»ä½•æœºåˆ¶å†æ¬¡å¯¹å…¶è®¾ç½®å€¼ï¼Œå½“
<code>CountDownLatch</code> ä½¿ç”¨å®Œæ¯•åï¼Œå®ƒä¸èƒ½å†æ¬¡è¢«ä½¿ç”¨</p>
<h1 id="cyclicbarrier">CyclicBarrier</h1>
<p>å¾ªç¯æ …æ ï¼šè®©==ä¸€ç»„çº¿ç¨‹==åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹éƒ½ä¼šç»§ç»­å¹²æ´»ã€‚</p>
]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Javaå¹¶å‘</tag>
        <tag>Javaå¹¶å‘é”</tag>
      </tags>
  </entry>
  <entry>
    <title>ThreadPoolExecutor å’Œ CompletableFuture å®è·µ</title>
    <url>/#developer/JUC-ThreadPool/</url>
    <content><![CDATA[<p>æ± åŒ–æ€æƒ³ï¼Œç»´æŠ¤ä¸€ä¸ªæ± å­ï¼Œå‡å°‘åˆ›å»º/é”€æ¯çš„å¼€é”€ï¼Œåˆç†åˆ†é…ç³»ç»Ÿèµ„æºï¼Œä½†ä¼šå¢åŠ è°ƒåº¦å¼€é”€ã€‚<a
href="https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html">å‚è€ƒç¾å›¢æŠ€æœ¯åšå®¢</a>ï¼šåº•å±‚è®¾è®¡æ€æƒ³ã€ä¸šåŠ¡å®ç°</p>
<h1 id="threadpoolexecutor-çº¿ç¨‹æ± å®ç°ç±»">ThreadPoolExecutor
çº¿ç¨‹æ± å®ç°ç±»</h1>
<p><strong>æ‰§è¡Œæµç¨‹å›¾</strong></p>
<img data-src="/" class="" title="å›¾2 ThreadPoolExecutorè¿è¡Œæµç¨‹">
<p><strong>çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸ</strong></p>
<img data-src="/" class="" title="å›¾3 çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸ">
<p><strong>ä»»åŠ¡è°ƒåº¦æµç¨‹</strong></p>
<p>æ‰€æœ‰ä»»åŠ¡çš„è°ƒåº¦éƒ½æ˜¯ç”±executeæ–¹æ³•å®Œæˆçš„ï¼Œè¿™éƒ¨åˆ†å®Œæˆçš„å·¥ä½œæ˜¯ï¼šæ£€æŸ¥ç°åœ¨çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ã€è¿è¡Œçº¿ç¨‹æ•°ã€è¿è¡Œç­–ç•¥ï¼Œå†³å®šæ¥ä¸‹æ¥æ‰§è¡Œçš„æµç¨‹ï¼Œæ˜¯ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œï¼Œæˆ–æ˜¯ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œäº¦æˆ–æ˜¯ç›´æ¥æ‹’ç»è¯¥ä»»åŠ¡ã€‚å…¶æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>é¦–å…ˆæ£€æµ‹çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯<code>RUNNING</code>ï¼Œåˆ™ç›´æ¥æ‹’ç»ï¼Œçº¿ç¨‹æ± è¦ä¿è¯åœ¨RUNNINGçš„çŠ¶æ€ä¸‹æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>å¦‚æœ<code>workerCount &lt; corePoolSize</code>ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ã€‚</li>
<li>å¦‚æœ<code>workerCount &gt;= corePoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—æœªæ»¡</code>ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜»å¡é˜Ÿåˆ—ä¸­ã€‚</li>
<li>å¦‚æœ<code>workerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡</code>ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ã€‚</li>
<li>å¦‚æœ<code>workerCount &gt;= maximumPoolSizeï¼Œå¹¶ä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡</code>,
åˆ™æ ¹æ®<u>æ‹’ç»ç­–ç•¥</u>æ¥å¤„ç†è¯¥ä»»åŠ¡, é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚</li>
</ol>
<img data-src="/" class="" title="å›¾4 ä»»åŠ¡è°ƒåº¦æµç¨‹">
<h2 id="åº•å±‚ç»“æ„">åº•å±‚ç»“æ„</h2>
<p><strong>ThreadPoolExecutor æ„é€ å‡½æ•°</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="type">int</span> corePoolSize,  //çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡</span></span><br><span class="line"><span class="params">    <span class="type">int</span> maximumPoolSize,  //çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="params">    <span class="type">long</span> keepAliveTime,  //å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´</span></span><br><span class="line"><span class="params">    TimeUnit unit,  //æ—¶é—´å•ä½</span></span><br><span class="line"><span class="params">    BlockingQueue&lt;Runnable&gt; workQueue,  //ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="params">    ThreadFactory threadFactory,  //çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯</span></span><br><span class="line"><span class="params">    RejectedExecutionHandler handler  //æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡</span></span><br><span class="line"><span class="params">)</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼šCPU å¯†é›†å‹ä»»åŠ¡(N+1) I/O å¯†é›†å‹ä»»åŠ¡(2N) CPU æ ¸å¿ƒæ•° N</p>
<h3 id="é˜»å¡é˜Ÿåˆ—-blockingqueue">é˜»å¡é˜Ÿåˆ— BlockingQueue</h3>
<p><a href="https://juejin.cn/post/6999798721269465102">Link</a></p>
<p>é˜»å¡é˜Ÿåˆ—ä¸­ä¿å­˜å³å°†è¿è¡Œçš„ä»»åŠ¡ï¼ŒBlockingQueue ä¸ Queue
çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li>é€šè¿‡åœ¨å…¥é˜Ÿå’Œå‡ºé˜Ÿæ—¶è¿›è¡ŒåŠ é”ï¼Œä¿è¯äº†é˜Ÿåˆ—çº¿ç¨‹å®‰å…¨</li>
<li>æ”¯æŒé˜»å¡çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ–¹æ³•ï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œä¼šé˜»å¡å…¥é˜Ÿçš„çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸æ»¡ï¼›å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä¼šé˜»å¡å‡ºé˜Ÿçš„çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ ã€‚</li>
</ul>
<p>åº•å±‚å®ç°</p>
<ul>
<li>é‡‡ç”¨ ReentrantLock åŒæ­¥é˜Ÿåˆ—å®ç°åŠ é”è§£é”ã€é˜»å¡é‡Šæ”¾</li>
<li>é˜Ÿåˆ—ä¸ºç©ºæˆ–å·²æ»¡çš„æƒ…å†µï¼Œé‡‡ç”¨æ¡ä»¶é˜Ÿåˆ— Condition</li>
</ul>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="header">
<th>é˜»å¡é˜Ÿåˆ—</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ArrayBlockingQueue</td>
<td>æœ‰ç•Œé˜Ÿåˆ—</td>
</tr>
<tr class="even">
<td>LinkedBlockingQueue</td>
<td>ä¸è®¾ç½®å¤§å°çš„è¯ï¼Œé»˜è®¤æ— ç•Œé˜Ÿåˆ—</td>
</tr>
<tr class="odd">
<td>SynchronousQueue</td>
<td>å¦‚æœæœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨ç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼›å¦åˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡</td>
</tr>
<tr class="even">
<td>DelayedWorkQueue</td>
<td>å†…éƒ¨å…ƒç´ å¹¶ä¸æ˜¯æŒ‰ç…§æ”¾å…¥çš„æ—¶é—´æ’åºï¼Œè€Œæ˜¯ä¼šæŒ‰ç…§å»¶è¿Ÿçš„æ—¶é—´é•¿çŸ­å¯¹ä»»åŠ¡è¿›è¡Œæ’åº</td>
</tr>
<tr class="odd">
<td>PriorityBlockingQueue</td>
<td>ä¼˜å…ˆçº§é˜»å¡é˜Ÿåˆ—</td>
</tr>
</tbody>
</table>
<h3 id="åˆ›å»ºçº¿ç¨‹å·¥å‚ç±»-threadfactory">åˆ›å»ºçº¿ç¨‹å·¥å‚ç±» ThreadFactory</h3>
<blockquote>
<p>å‚æ•°å¯ä»¥è®¾å®šçº¿ç¨‹å</p>
</blockquote>
<ul>
<li>java rtåŒ…ï¼šåŸç”Ÿ ThreadFactory ç±»</li>
<li>hutoolï¼š ThreadFactoryBuilder</li>
<li>google guava.jarï¼š ThreadFactoryBuilder</li>
</ul>
<p>è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">testThreadPoolFactory</span> <span class="keyword">implements</span> <span class="title class_">ThreadFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">threadIdx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String threadNamePrefix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">testThreadPoolFactory</span><span class="params">(String Prefix)</span> &#123;</span><br><span class="line">        threadNamePrefix = Prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">        thread.setName(threadNamePrefix + <span class="string">&quot;-xxljob-&quot;</span> + threadIdx.getAndIncrement());</span><br><span class="line">        <span class="keyword">return</span> thread;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä»»åŠ¡æ‹’ç»ç­–ç•¥">ä»»åŠ¡æ‹’ç»ç­–ç•¥</h3>
<blockquote>
<p>åœ¨ä½¿ç”¨çº¿ç¨‹æ± å¹¶ä¸”ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—çš„æ—¶å€™ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± çš„æ—¶å€™å°±ä¼šæ‹’ç»ï¼Œå…·ä½“çš„æ‹’ç»ç­–ç•¥å¯ä»¥è®¾å®š</p>
</blockquote>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="header">
<th>æ‹’ç»ç­–ç•¥</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AbortPolicy</td>
<td>çº¿ç¨‹æ± é˜Ÿåˆ—æ»¡äº†ä¸¢æ‰è¿™ä¸ªä»»åŠ¡å¹¶ä¸”æŠ›å‡º RejectedExecutionException
å¼‚å¸¸</td>
</tr>
<tr class="even">
<td>DiscardPolicy</td>
<td>å¦‚æœçº¿ç¨‹æ± é˜Ÿåˆ—æ»¡äº†ï¼Œä¼šç›´æ¥ä¸¢æ‰è¿™ä¸ªä»»åŠ¡å¹¶ä¸”ä¸ä¼šæœ‰ä»»ä½•å¼‚å¸¸</td>
</tr>
<tr class="odd">
<td>DiscardOldestPolicy</td>
<td>å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¼šå°†æœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„ä»»åŠ¡åˆ æ‰è…¾å‡ºç©ºé—´ï¼Œå†å°è¯•åŠ å…¥é˜Ÿåˆ—</td>
</tr>
<tr class="even">
<td>CallerRunsPolicy</td>
<td>å¦‚æœæ·»åŠ åˆ°çº¿ç¨‹æ± å¤±è´¥ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹ä¼šè‡ªå·±å»æ‰§è¡Œè¯¥ä»»åŠ¡</td>
</tr>
</tbody>
</table>
<p>è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRejectPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor executor)</span> &#123;</span><br><span class="line">        <span class="comment">//Senderæ˜¯æˆ‘çš„Runnableç±»ï¼Œé‡Œé¢æœ‰messageå­—æ®µ</span></span><br><span class="line">        <span class="keyword">if</span> (r <span class="keyword">instanceof</span> Sender) &#123;</span><br><span class="line">            <span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> (Sender) r;</span><br><span class="line">            <span class="comment">//ç›´æ¥æ‰“å°</span></span><br><span class="line">            System.out.println(sender.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="çº¿ç¨‹æ± å®ç°æ¥å£">çº¿ç¨‹æ± å®ç°æ¥å£</h2>
<img data-src="/" class="" title="å›¾1 ThreadPoolExecutor UMLç±»å›¾">
<p>ExecutorServiceæ¥å£ï¼šï¼ˆ1ï¼‰æ‰©å……æ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›ï¼Œè¡¥å……å¯ä»¥ä¸º<strong>ä¸€ä¸ªæˆ–ä¸€æ‰¹å¼‚æ­¥ä»»åŠ¡</strong>ç”Ÿæˆ
Future
çš„æ–¹æ³•ï¼›ï¼ˆ2ï¼‰æä¾›äº†<strong>ç®¡æ§çº¿ç¨‹æ± </strong>çš„æ–¹æ³•ï¼Œæ¯”å¦‚åœæ­¢çº¿ç¨‹æ± çš„è¿è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ExecutorService</span> <span class="keyword">extends</span> <span class="title class_">Executor</span> &#123;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œå¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå…³é—­ ExecutorService  </span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span>;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œç›´æ¥å…³é—­ ExecutorServiceï¼Œè¿”å›æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨  </span></span><br><span class="line">    List&lt;Runnable&gt; <span class="title function_">shutdownNow</span><span class="params">()</span>;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//åˆ¤æ–­ExecutorServiceæ˜¯å¦å…³é—­  </span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isShutdown</span><span class="params">()</span>;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//åˆ¤æ–­ExecutorServiceæ˜¯å¦ç»ˆæ­¢  </span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isTerminated</span><span class="params">()</span>;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//ç­‰å¾…ExecutorServiceåˆ°è¾¾ç»ˆæ­¢çŠ¶æ€  </span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">awaitTermination</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å½“taskæ‰§è¡ŒæˆåŠŸçš„æ—¶å€™future.get()è¿”å›æ‰§è¡Œç»“æœ</span></span><br><span class="line">    &lt;T&gt; Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Callable&lt;T&gt; task)</span>;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//å½“taskæ‰§è¡ŒæˆåŠŸçš„æ—¶å€™future.get()è¿”å›result  </span></span><br><span class="line">    &lt;T&gt; Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Runnable task, T result)</span>;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//å½“taskæ‰§è¡ŒæˆåŠŸçš„æ—¶å€™future.get()è¿”å›null  </span></span><br><span class="line">    Future&lt;?&gt; submit(Runnable task);  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//æ‰¹é‡æäº¤ä»»åŠ¡å¹¶è·å¾—ä»–ä»¬çš„futureï¼ŒTaskåˆ—è¡¨ä¸Futureåˆ—è¡¨ä¸€ä¸€å¯¹åº”  </span></span><br><span class="line">    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class="title function_">invokeAll</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span> <span class="keyword">throws</span> InterruptedException;  </span><br><span class="line"> </span><br><span class="line">    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class="title function_">invokeAll</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, <span class="type">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//æ‰¹é‡æäº¤ä»»åŠ¡å¹¶è·å¾—ä¸€ä¸ªå·²ç»æˆåŠŸæ‰§è¡Œçš„ä»»åŠ¡çš„ç»“æœ  </span></span><br><span class="line">    &lt;T&gt; T <span class="title function_">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException;  </span><br><span class="line">  </span><br><span class="line">    &lt;T&gt; T <span class="title function_">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, <span class="type">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>é¡¶å±‚æ¥å£ Executor
ï¼š==å°†ä»»åŠ¡æäº¤å’Œä»»åŠ¡æ‰§è¡Œè¿›è¡Œè§£è€¦==ã€‚ç”¨æˆ·æ— éœ€å…³æ³¨å¦‚ä½•åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚ä½•è°ƒåº¦çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç”¨æˆ·åªéœ€æä¾›Runnableå¯¹è±¡ï¼Œå°†ä»»åŠ¡çš„è¿è¡Œé€»è¾‘æäº¤åˆ°æ‰§è¡Œå™¨(Executor)ä¸­ï¼Œç”±Executoræ¡†æ¶å®Œæˆçº¿ç¨‹çš„è°ƒé…å’Œä»»åŠ¡çš„æ‰§è¡Œéƒ¨åˆ†ã€‚
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´æ‰§è¡Œ command ï¼ˆæ–¹æ³•ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸä¸å¦ï¼‰</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="executors-çº¿ç¨‹æ± å·¥å‚ç±»">Executors çº¿ç¨‹æ± å·¥å‚ç±»</h1>
<p><strong>FixedThreadPool å›ºå®šçº¿ç¨‹æ•°</strong></p>
<p>è¿è¡Œä¸­çš„ FixedThreadPoolï¼ˆæœªæ‰§è¡Œ shutdown()æˆ–
shutdownNow()ï¼‰ä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡æ¯”è¾ƒå¤šçš„æ—¶å€™ä¼šå¯¼è‡´
OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img data-src="/" class="" title="img">
<p><strong>SingleThreadExecutor
åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </strong>ï¼ˆFixedThreadPool çš„ç‰¹ä¾‹ï¼‰</p>
<p><strong>CachedThreadPool æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± </strong></p>
<img data-src="/" class="" title="img">
<h1 id="completablefuture-å¼‚æ­¥æ‰§è¡Œç»“æœç±»">CompletableFuture
å¼‚æ­¥æ‰§è¡Œç»“æœç±»</h1>
<blockquote>
<p>RxJavaã€Reactor æ¯” CompletableFuture
å¢åŠ äº†æ“ä½œèåˆã€å»¶è¿Ÿæ‰§è¡Œã€å›å‹ç­‰ç‰¹æ€§</p>
</blockquote>
<p>CompletableFutureå®ç° Futureã€CompletionStage æ¥å£ã€‚</p>
<ul>
<li>Future
è¡¨ç¤ºå¼‚æ­¥<strong>è®¡ç®—çš„ç»“æœ</strong>ï¼Œå¯ä»¥é€šè¿‡<code>Future</code>
ç±»è·å–åˆ°è€—æ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœ</li>
<li>CompletionStage
ç”¨äºè¡¨ç¤ºå¼‚æ­¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ª<strong>æ­¥éª¤</strong>ï¼ˆStageï¼‰ï¼Œè¿™ä¸ªæ­¥éª¤å¯èƒ½æ˜¯ç”±å¦å¤–ä¸€ä¸ª
CompletionStage è§¦å‘çš„ï¼Œéšç€å½“å‰æ­¥éª¤çš„å®Œæˆï¼Œä¹Ÿå¯èƒ½ä¼šè§¦å‘å…¶ä»–ä¸€ç³»åˆ—
CompletionStage
çš„æ‰§è¡Œã€‚ä»è€Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡å¯¹è¿™äº›æ­¥éª¤è¿›è¡Œå¤šæ ·åŒ–çš„<strong>ç¼–æ’ç»„åˆ</strong>ï¼ŒCompletionStage
æ¥å£æ­£æ˜¯å®šä¹‰äº†è¿™æ ·çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶æä¾›çš„ thenAppyã€thenCompose
ç­‰å‡½æ•°å¼ç¼–ç¨‹æ–¹æ³•æ¥ç»„åˆç¼–æ’è¿™äº›æ­¥éª¤ã€‚</li>
</ul>
<p><code>FutureTask</code>ç›¸å½“äºå¯¹<code>Callable</code>
è¿›è¡Œäº†å°è£…ï¼Œç®¡ç†ç€ä»»åŠ¡æ‰§è¡Œçš„æƒ…å†µï¼Œå­˜å‚¨äº† <code>Callable</code> çš„
<code>call</code> æ–¹æ³•çš„ä»»åŠ¡æ‰§è¡Œç»“æœ</p>
<h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>Future éœ€è¦è·å–è¿”å›å€¼ï¼Œæ‰èƒ½è·å–å¼‚å¸¸ä¿¡æ¯ï¼ˆå³çº¿ç¨‹éœ€è¦å®ç°
<code>Callable</code> æ¥å£ï¼Œè€Œ <code>Runnable</code>
æ¥å£åˆ›å»ºçº¿ç¨‹ä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼‰</li>
<li>CompletableFuture çš„ get() æ–¹æ³•æ˜¯é˜»å¡ç­‰å¾…çš„</li>
<li>å¼‚æ­¥è°ƒç”¨å¼ºåˆ¶ä¼ è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œåšå¥½çº¿ç¨‹æ± éš”ç¦»</li>
<li>è‡ªå®šä¹‰çº¿ç¨‹æ± æ—¶ï¼Œä»”ç»†è€ƒè™‘å»¶è¿Ÿé˜Ÿåˆ—æ»¡æ—¶ï¼Œåº”é‡‡å–ä»€ä¹ˆæ‹’ç»ç­–ç•¥</li>
</ul>
<p><strong>Q1</strong>ï¼šç¨‹åºæ‰§è¡Œåœ¨å“ªä¸ªçº¿ç¨‹ä¸Šï¼Ÿ</p>
<p><strong>A1</strong>ï¼š</p>
<p>åŒæ­¥æ–¹æ³•ï¼ˆå³ä¸å¸¦Asyncåç¼€çš„æ–¹æ³•ï¼‰æœ‰ä¸¤ç§æƒ…å†µã€‚</p>
<ul>
<li><p>å¦‚æœæ³¨å†Œæ—¶è¢«ä¾èµ–çš„æ“ä½œå·²ç»æ‰§è¡Œå®Œæˆï¼Œåˆ™ç›´æ¥ç”±å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚</p></li>
<li><p>å¦‚æœæ³¨å†Œæ—¶è¢«ä¾èµ–çš„æ“ä½œè¿˜æœªæ‰§è¡Œå®Œï¼Œåˆ™ç”±å›è°ƒçº¿ç¨‹ï¼ˆæŒ‰ç…§å½“å‰ CF
è¿è¡Œæƒ…å†µåŒºåˆ†ï¼‰æ‰§è¡Œã€‚</p></li>
</ul>
<p>å¼‚æ­¥æ–¹æ³•ï¼ˆå³å¸¦Asyncåç¼€çš„æ–¹æ³•ï¼‰ï¼šå¯ä»¥é€‰æ‹©æ˜¯å¦ä¼ é€’çº¿ç¨‹æ± å‚æ•°Executorè¿è¡Œåœ¨æŒ‡å®šçº¿ç¨‹æ± ä¸­ï¼›å½“ä¸ä¼ é€’Executoræ—¶ï¼Œä¼šä½¿ç”¨ForkJoinPoolä¸­çš„å…±ç”¨çº¿ç¨‹æ± CommonPool</p>
<p><strong>Q2</strong>ï¼šåŒæ­¥å›è°ƒå’Œå¼‚æ­¥å›è°ƒçš„åŒºåˆ«</p>
<p><strong>A2</strong>ï¼š</p>
<p>åŒæ­¥å›è°ƒï¼šæŠŠå‡½æ•° b ä¼ é€’ç»™å‡½æ•° aã€‚æ‰§è¡Œ a çš„æ—¶å€™ï¼Œå›è°ƒäº† bï¼Œa
è¦ä¸€ç›´ç­‰åˆ° b æ‰§è¡Œå®Œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼›</p>
<p>å¼‚æ­¥å›è°ƒï¼šæŠŠå‡½æ•° b ä¼ é€’ç»™å‡½æ•° aã€‚æ‰§è¡Œ a çš„æ—¶å€™ï¼Œå›è°ƒäº† bï¼Œç„¶å a
å°±ç»§ç»­å¾€åæ‰§è¡Œï¼Œb ç‹¬è‡ªæ‰§è¡Œã€‚</p>
<h3 id="çº¿ç¨‹æ± å¾ªç¯å¼•ç”¨ä¼šå¯¼è‡´æ­»é”">çº¿ç¨‹æ± å¾ªç¯å¼•ç”¨ä¼šå¯¼è‡´æ­»é”</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">doGet</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">ExecutorService</span> <span class="variable">threadPool1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0L</span>, TimeUnit.MILLISECONDS, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">100</span>));</span><br><span class="line">  <span class="type">CompletableFuture</span> <span class="variable">cf1</span> <span class="operator">=</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">  <span class="comment">//do sth</span></span><br><span class="line">    <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;child&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;child&quot;</span>;</span><br><span class="line">      &#125;, threadPool1).join();<span class="comment">//å­ä»»åŠ¡</span></span><br><span class="line">    &#125;, threadPool1);</span><br><span class="line">  <span class="keyword">return</span> cf1.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>threadPool1 å¤§å°ä¸º 10ï¼Œå½“åŒä¸€æ—¶åˆ»æœ‰ 10 ä¸ªè¯·æ±‚åˆ°è¾¾ï¼Œåˆ™ threadPool1
è¢«æ‰“æ»¡ï¼Œå­ä»»åŠ¡è¯·æ±‚çº¿ç¨‹æ—¶è¿›å…¥é˜»å¡é˜Ÿåˆ—æ’é˜Ÿï¼Œä½†æ˜¯çˆ¶ä»»åŠ¡çš„å®Œæˆåˆä¾èµ–äºå­ä»»åŠ¡ï¼Œè¿™æ—¶ç”±äºå­ä»»åŠ¡å¾—ä¸åˆ°çº¿ç¨‹ï¼Œçˆ¶ä»»åŠ¡æ— æ³•å®Œæˆã€‚ä¸»çº¿ç¨‹æ‰§è¡Œ
cf1.join() è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶ä¸”æ°¸è¿œæ— æ³•æ¢å¤ã€‚</p>
<h3
id="å¼‚æ­¥rpcè°ƒç”¨æ³¨æ„ä¸è¦é˜»å¡ioçº¿ç¨‹æ± ">å¼‚æ­¥RPCè°ƒç”¨æ³¨æ„ä¸è¦é˜»å¡IOçº¿ç¨‹æ± </h3>
<p>å¦‚æœæ˜¯ä½¿ç”¨åŸºäº NIOï¼ˆæ¯”å¦‚Nettyï¼‰çš„å¼‚æ­¥ RPCï¼Œåˆ™è¿”å›ç»“æœæ˜¯ç”± IO
çº¿ç¨‹è´Ÿè´£è®¾ç½®çš„ï¼Œå³==å›è°ƒæ–¹æ³•ç”± IO çº¿ç¨‹è§¦å‘==ï¼ŒCompletableFuture
åŒæ­¥å›è°ƒï¼ˆå¦‚thenApplyã€thenAcceptç­‰æ— Asyncåç¼€çš„æ–¹æ³•ï¼‰å¦‚æœä¾èµ–çš„å¼‚æ­¥ RPC
è°ƒç”¨çš„è¿”å›ç»“æœï¼Œé‚£ä¹ˆè¿™äº›==åŒæ­¥å›è°ƒå°†è¿è¡Œåœ¨IOçº¿ç¨‹==ä¸Šï¼Œè€Œæ•´ä¸ªæœåŠ¡åªæœ‰ä¸€ä¸ªIOçº¿ç¨‹æ± ï¼Œè¿™æ—¶éœ€è¦==ä¿è¯åŒæ­¥å›è°ƒä¸­ä¸èƒ½æœ‰é˜»å¡ç­‰è€—æ—¶è¿‡é•¿çš„é€»è¾‘==ï¼Œå¦åˆ™åœ¨è¿™äº›é€»è¾‘æ‰§è¡Œå®Œæˆå‰ï¼ŒIOçº¿ç¨‹å°†ä¸€ç›´è¢«å ç”¨ï¼Œå½±å“æ•´ä¸ªæœåŠ¡çš„å“åº”ã€‚</p>
<h2 id="å®é™…ä½¿ç”¨åœºæ™¯">å®é™…ä½¿ç”¨åœºæ™¯</h2>
<blockquote>
<p><a
href="https://tech.meituan.com/2022/05/12/principles-and-practices-of-completablefuture.html">ç¾å›¢æŠ€æœ¯åšå®¢</a></p>
</blockquote>
<p>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¿¡æ¯äº¤æ¢é¢‘ç¹ï¼Œæå‡ç³»ç»Ÿååé‡</p>
<p>I/Oå¯†é›†å‹ä»»åŠ¡ï¼Œå¯¹å†…<strong>è°ƒåº¦</strong>å„ä¸ªä¸‹æ¸¸æœåŠ¡è·å–æ•°æ®è¿›è¡Œ<strong>èšåˆ</strong></p>
<p>å¯¹ä¸šåŠ¡æµç¨‹è¿›è¡Œç¼–æ’ï¼Œé™ä½ä»»åŠ¡ä¾èµ–å¯¼è‡´çš„é˜»å¡</p>
<p>é¿å… guava çš„ ListenableFuture å›è°ƒæ‰€å¯¼è‡´çš„å›è°ƒåœ°ç‹±</p>
<h3 id="é›¶ä¾èµ–-æ„é€ æ–¹æ³•">é›¶ä¾èµ–-æ„é€ æ–¹æ³•</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"><span class="comment">//1ã€ä½¿ç”¨runAsyncæˆ–supplyAsyncå‘èµ·å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line">CompletableFuture&lt;String&gt; cf1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;result1&quot;</span>;</span><br><span class="line">&#125;, executor);</span><br><span class="line"><span class="comment">//2ã€CompletableFuture.completedFuture()ç›´æ¥åˆ›å»ºä¸€ä¸ªå·²å®ŒæˆçŠ¶æ€çš„CompletableFuture</span></span><br><span class="line">CompletableFuture&lt;String&gt; cf2 = CompletableFuture.completedFuture(<span class="string">&quot;result2&quot;</span>);</span><br><span class="line"><span class="comment">//3ã€å…ˆåˆå§‹åŒ–ä¸€ä¸ªæœªå®Œæˆçš„CompletableFutureï¼Œç„¶åé€šè¿‡complete()ã€completeExceptionally()ï¼Œå®Œæˆè¯¥CompletableFuture</span></span><br><span class="line">CompletableFuture&lt;String&gt; cf = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;&gt;();</span><br><span class="line">cf.complete(<span class="string">&quot;success&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ä¸€å…ƒä¾èµ–-å¼‚æ­¥å›è°ƒ">ä¸€å…ƒä¾èµ–-å¼‚æ­¥å›è°ƒ</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; cf3 = cf1.thenApply(result1 -&gt; &#123;</span><br><span class="line">  <span class="comment">//result1ä¸ºCF1çš„ç»“æœ</span></span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;result3&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">CompletableFuture&lt;String&gt; cf5 = cf2.thenApply(result2 -&gt; &#123;</span><br><span class="line">  <span class="comment">//result2ä¸ºCF2çš„ç»“æœ</span></span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;result5&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="äºŒå…ƒä¾èµ–-å¤šä»»åŠ¡">äºŒå…ƒä¾èµ–-å¤šä»»åŠ¡</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; cf4 = cf1.thenCombine(cf2, (result1, result2) -&gt; &#123;</span><br><span class="line">  <span class="comment">//result1å’Œresult2åˆ†åˆ«ä¸ºcf1å’Œcf2çš„ç»“æœ</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;result4&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="å¤šå…ƒä¾èµ–">å¤šå…ƒä¾èµ–</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CompletableFuture&lt;Void&gt; cf6 = CompletableFuture.allOf(cf3, cf4, cf5);</span><br><span class="line">CompletableFuture&lt;String&gt; result = cf6.thenApply(v -&gt; &#123;</span><br><span class="line">  <span class="comment">//è¿™é‡Œçš„joinå¹¶ä¸ä¼šé˜»å¡ï¼Œå› ä¸ºä¼ ç»™thenApplyçš„å‡½æ•°æ˜¯åœ¨CF3ã€CF4ã€CF5å…¨éƒ¨å®Œæˆæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œ ã€‚</span></span><br><span class="line">  result3 = cf3.join();</span><br><span class="line">  result4 = cf4.join();</span><br><span class="line">  result5 = cf5.join();</span><br><span class="line">  <span class="comment">//æ ¹æ®result3ã€result4ã€result5ç»„è£…æœ€ç»ˆresult;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;result&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h2>
<p><a href="https://zhuanlan.zhihu.com/p/647743286">æ–¹æ³•æ±‡æ€»</a></p>
<h3 id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨é»˜è®¤å†…ç½®çº¿ç¨‹æ± ForkJoinPool.commonPool()ï¼Œæ ¹æ®supplieræ„å»ºæ‰§è¡Œä»»åŠ¡  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier)</span>  </span><br><span class="line">    </span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œæ ¹æ®supplieræ„å»ºæ‰§è¡Œä»»åŠ¡  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier, Executor executor)</span>  </span><br><span class="line">    </span><br><span class="line"><span class="comment">// ä½¿ç”¨é»˜è®¤å†…ç½®çº¿ç¨‹æ± ForkJoinPool.commonPool()ï¼Œæ ¹æ®runnableæ„å»ºæ‰§è¡Œä»»åŠ¡  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title function_">runAsync</span><span class="params">(Runnable runnable)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œæ ¹æ®runnableæ„å»ºæ‰§è¡Œä»»åŠ¡  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title function_">runAsync</span><span class="params">(Runnable runnable, Executor executor)</span>  </span><br></pre></td></tr></table></figure>
<h3 id="è·å–ç»“æœæ–¹æ³•">è·å–ç»“æœæ–¹æ³•</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span>  </span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span>  </span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">getNow</span><span class="params">(T valueIfAbsent)</span>  </span><br><span class="line"><span class="comment">// ä¸æŠ›å‡ºå¼‚å¸¸ </span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">join</span><span class="params">()</span>  </span><br></pre></td></tr></table></figure>
<h3 id="å¼‚æ­¥å›è°ƒæ–¹æ³•"><strong>å¼‚æ­¥å›è°ƒæ–¹æ³•</strong></h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯å…±ç”¨åŒä¸€ä¸ªçº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;Void&gt; <span class="title function_">thenRunAsync</span><span class="params">(Runnable action)</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶ï¼Œä½¿ç”¨ç»™å®šçš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;Void&gt; <span class="title function_">thenRunAsync</span><span class="params">(Runnable action, Executor executor)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ªå›è°ƒæ–¹æ³•ä»»åŠ¡ï¼Œä¼šå°†è¯¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œä½œä¸ºå…¥å‚ï¼Œä¼ é€’åˆ°å›è°ƒæ–¹æ³•ä¸­ï¼Œä½†æ˜¯å›è°ƒæ–¹æ³•æ˜¯æ²¡æœ‰è¿”å›å€¼çš„</span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;Void&gt; <span class="title function_">thenAcceptAsync</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; action)</span>;</span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;Void&gt; <span class="title function_">thenAcceptAsync</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; action, Executor executor)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç¬¬äºŒä¸ªå›è°ƒæ–¹æ³•ä»»åŠ¡ï¼Œä¼šå°†ç¬¬ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œä½œä¸ºå…¥å‚ï¼Œä¼ é€’åˆ°å›è°ƒæ–¹æ³•ä¸­ï¼Œå¹¶ä¸”å›è°ƒæ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„</span></span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenApplyAsync</span><span class="params">(Function&lt;? <span class="built_in">super</span> T,? extends U&gt; fn)</span>;</span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenApplyAsync</span><span class="params">(Function&lt;? <span class="built_in">super</span> T,? extends U&gt; fn, Executor executor)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="å¼‚å¸¸å¤„ç†æ–¹æ³•"><strong>å¼‚å¸¸å¤„ç†</strong>æ–¹æ³•</h3>
<p>ç”±äºå¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡åœ¨å…¶ä»–çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè€Œå¼‚å¸¸ä¿¡æ¯å­˜å‚¨åœ¨çº¿ç¨‹æ ˆä¸­ï¼Œå› æ­¤å½“å‰çº¿ç¨‹é™¤éé˜»å¡ç­‰å¾…è¿”å›ç»“æœï¼Œå¦åˆ™æ— æ³•é€šè¿‡tryã€‚CompletableFutureæä¾›äº†å¼‚å¸¸æ•è·å›è°ƒexceptionallyï¼Œç›¸å½“äºåŒæ­¥è°ƒç”¨ä¸­çš„tryã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> WmOrderAdditionInfoThriftService wmOrderAdditionInfoThriftService;<span class="comment">//å†…éƒ¨æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;Integer&gt; <span class="title function_">getCancelTypeAsync</span><span class="params">(<span class="type">long</span> orderId)</span> &#123;</span><br><span class="line">    CompletableFuture&lt;WmOrderOpRemarkResult&gt; remarkResultFuture = wmOrderAdditionInfoThriftService.findOrderCancelledRemarkByOrderIdAsync(orderId);<span class="comment">//ä¸šåŠ¡æ–¹æ³•ï¼Œå†…éƒ¨ä¼šå‘èµ·å¼‚æ­¥rpcè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> remarkResultFuture</span><br><span class="line">          .thenApply(result -&gt; &#123;<span class="comment">//è¿™é‡Œå¢åŠ äº†ä¸€ä¸ªå›è°ƒæ–¹æ³•thenApplyï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸thenApplyå†…éƒ¨ä¼šé€šè¿‡new CompletionException(throwable) å¯¹å¼‚å¸¸è¿›è¡ŒåŒ…è£…</span></span><br><span class="line">      <span class="comment">//è¿™é‡Œæ˜¯ä¸€äº›ä¸šåŠ¡æ“ä½œ</span></span><br><span class="line">        &#125;)</span><br><span class="line">      .exceptionally(err -&gt; &#123;<span class="comment">//é€šè¿‡exceptionally æ•è·å¼‚å¸¸ï¼Œè¿™é‡Œçš„errå·²ç»è¢«thenApplyåŒ…è£…è¿‡ï¼Œå› æ­¤éœ€è¦é€šè¿‡Throwable.getCause()æå–å¼‚å¸¸</span></span><br><span class="line">         log.error(<span class="string">&quot;WmOrderRemarkService.getCancelTypeAsync Exception orderId=&#123;&#125;&quot;</span>, orderId, ExceptionUtils.extractRealException(err));</span><br><span class="line">         <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Throwable <span class="title function_">extractRealException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">          <span class="comment">//è¿™é‡Œåˆ¤æ–­å¼‚å¸¸ç±»å‹æ˜¯å¦ä¸ºCompletionExceptionã€ExecutionExceptionï¼Œå¦‚æœæ˜¯åˆ™è¿›è¡Œæå–ï¼Œå¦åˆ™ç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (throwable <span class="keyword">instanceof</span> CompletionException || throwable <span class="keyword">instanceof</span> ExecutionException) &#123;</span><br><span class="line">            <span class="keyword">if</span> (throwable.getCause() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> throwable.getCause();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> throwable;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ CompletableFuture çš„ä»»åŠ¡ä¸è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯å‡ºç°å¼‚å¸¸å®ƒéƒ½ä¼šè°ƒç”¨
<code>whenComplete</code> è¿™å›è°ƒå‡½æ•°ã€‚</p>
<ul>
<li>æ­£å¸¸å®Œæˆï¼š<code>whenComplete</code> è¿”å›ç»“æœå’Œä¸Šçº§ä»»åŠ¡ä¸€è‡´ï¼Œå¼‚å¸¸ä¸º
nullï¼›</li>
<li>å‡ºç°å¼‚å¸¸ï¼š<code>whenComplete</code> è¿”å›ç»“æœä¸º
nullï¼Œå¼‚å¸¸ä¸ºä¸Šçº§ä»»åŠ¡çš„å¼‚å¸¸ï¼›</li>
</ul>
<h3 id="å¤šä»»åŠ¡ç»„åˆå›è°ƒæ–¹æ³•"><strong>å¤šä»»åŠ¡ç»„åˆå›è°ƒæ–¹æ³•</strong></h3>
<p>thenCompose
å¯ä»¥ç”¨äºç»„åˆå¤šä¸ªCompletableFutureï¼Œå°†å‰ä¸€ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœä½œä¸ºä¸‹ä¸€ä¸ªä»»åŠ¡çš„å‚æ•°ï¼Œå®ƒä»¬ä¹‹é—´å­˜åœ¨ç€<strong>ä¸šåŠ¡é€»è¾‘</strong>ä¸Šçš„å…ˆåé¡ºåºï¼Œå‰åçº¿ç¨‹æ‰§è¡Œæ˜¯åŒæ­¥çš„ï¼Œå‰é¢é˜»å¡åé¢ä¸ä¼šæ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenCompose</span><span class="params">(Function&lt;? <span class="built_in">super</span> T, ? extends CompletionStage&lt;U&gt;&gt; fn)</span>;</span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenComposeAsync</span><span class="params">(Function&lt;? <span class="built_in">super</span> T, ? extends CompletionStage&lt;U&gt;&gt; fn)</span> ;</span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenComposeAsync</span><span class="params">(Function&lt;? <span class="built_in">super</span> T, ? extends CompletionStage&lt;U&gt;&gt; fn, Executor executor)</span> ;</span><br></pre></td></tr></table></figure>
<p>thenCombine ç¬¬ä¸€ä¸ªå…¥å‚ CompletionStage
æ˜¯å¼‚æ­¥çš„ï¼Œåˆå¹¶ç»“æœçš„BiFunctionæ˜¯åŒæ­¥çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;U,V&gt; CompletionStage&lt;V&gt; <span class="title function_">thenCombine</span> <span class="params">(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? <span class="built_in">super</span> T,? <span class="built_in">super</span> U,? extends V&gt; fn)</span>;</span><br></pre></td></tr></table></figure>
<p>applyToEitheræ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä½¿ç”¨ç›¸åº”çš„ç»“æœä½œä¸ºæ‰€æä¾›å‡½æ•°çš„å‚æ•°æ¥æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletionStage&lt;U&gt; <span class="title function_">applyToEither</span> <span class="params">(CompletionStage&lt;? extends T&gt; other, Function&lt;? <span class="built_in">super</span> T, U&gt; fn)</span>;</span><br></pre></td></tr></table></figure>
<h2 id="åº•å±‚ä»£ç ">åº•å±‚ä»£ç </h2>
<img data-src="/" class="" title="å›¾10 CFåŸºæœ¬ç»“æ„">
<p>result
ç”¨äºå­˜å‚¨å½“å‰CFçš„ç»“æœï¼Œstackï¼ˆCompletionï¼‰è¡¨ç¤ºå½“å‰CFå®Œæˆåéœ€è¦è§¦å‘çš„ä¾èµ–åŠ¨ä½œï¼ˆDependency
Actionsï¼‰ï¼Œå»è§¦å‘ä¾èµ–å®ƒçš„CFçš„è®¡ç®—ï¼Œä¾èµ–åŠ¨ä½œå¯ä»¥æœ‰å¤šä¸ªï¼ˆè¡¨ç¤ºæœ‰å¤šä¸ªä¾èµ–å®ƒçš„CFï¼‰ï¼Œä»¥æ ˆï¼ˆTreiber
stackï¼‰çš„å½¢å¼å­˜å‚¨ï¼Œstackè¡¨ç¤ºæ ˆé¡¶å…ƒç´ ã€‚</p>
<p><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼šä¾èµ–åŠ¨ä½œï¼ˆDependency
Actionï¼‰éƒ½å°è£…åœ¨ä¸€ä¸ªå•ç‹¬Completionå­ç±»ä¸­ã€‚CompletableFuture
ä¸­çš„æ¯ä¸ªæ–¹æ³•éƒ½å¯¹åº”äº†å›¾ä¸­çš„ä¸€ä¸ª Completion
çš„å­ç±»ï¼ŒCompletionæœ¬èº«æ˜¯<strong>è§‚å¯Ÿè€…</strong>çš„åŸºç±»ã€‚</p>
<img data-src="/" class="" title="å›¾11 CFç±»å›¾">
<p>ä¸€å…ƒä¾èµ–ä¸­çš„ thenApply ä¸ºä¾‹ï¼Œä¸¾ä¾‹â€œè§‚å¯Ÿè€…æ¨¡å¼â€çš„è®¾è®¡æ€æƒ³</p>
<img data-src="/" class="" title="å›¾12 thenApplyç®€å›¾">
<p><strong>è¢«è§‚å¯Ÿè€…</strong></p>
<ol type="1">
<li>æ¯ä¸ªCompletableFutureéƒ½å¯ä»¥è¢«çœ‹ä½œä¸€ä¸ªè¢«è§‚å¯Ÿè€…ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ªCompletionç±»å‹çš„é“¾è¡¨æˆå‘˜å˜é‡stackï¼Œç”¨æ¥å­˜å‚¨æ³¨å†Œåˆ°å…¶ä¸­çš„æ‰€æœ‰è§‚å¯Ÿè€…ã€‚å½“è¢«è§‚å¯Ÿè€…æ‰§è¡Œå®Œæˆåä¼šå¼¹æ ˆstackå±æ€§ï¼Œä¾æ¬¡é€šçŸ¥æ³¨å†Œåˆ°å…¶ä¸­çš„è§‚å¯Ÿè€…ã€‚ä¸Šé¢ä¾‹å­ä¸­æ­¥éª¤fn2å°±æ˜¯ä½œä¸ºè§‚å¯Ÿè€…è¢«å°è£…åœ¨UniApplyä¸­ã€‚</li>
<li>è¢«è§‚å¯Ÿè€…CFä¸­çš„resultå±æ€§ï¼Œç”¨æ¥å­˜å‚¨è¿”å›ç»“æœæ•°æ®ã€‚è¿™é‡Œå¯èƒ½æ˜¯ä¸€æ¬¡RPCè°ƒç”¨çš„è¿”å›å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»»æ„å¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å¯¹åº”æ­¥éª¤fn1çš„æ‰§è¡Œç»“æœã€‚</li>
</ol>
<p><strong>è§‚å¯Ÿè€…</strong></p>
<p>CompletableFutureæ”¯æŒå¾ˆå¤šå›è°ƒæ–¹æ³•ï¼Œä¾‹å¦‚thenAcceptã€thenApplyã€exceptionallyç­‰ï¼Œè¿™äº›æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°
fï¼Œç”Ÿæˆä¸€ä¸ª Completion ç±»å‹çš„å¯¹è±¡ï¼ˆå³è§‚å¯Ÿè€…ï¼‰ï¼Œå¹¶å°†å…¥å‚å‡½æ•° f èµ‹å€¼ç»™
Completion çš„æˆå‘˜å˜é‡ fnï¼Œç„¶åæ£€æŸ¥å½“å‰ CF æ˜¯å¦å·²å¤„äºå®ŒæˆçŠ¶æ€ï¼ˆå³result
!= nullï¼‰ï¼Œå¦‚æœå·²å®Œæˆç›´æ¥è§¦å‘ fnï¼Œå¦åˆ™å°†è§‚å¯Ÿè€… Completion åŠ å…¥åˆ° CF
çš„è§‚å¯Ÿè€…é“¾ stack
ä¸­ï¼Œå†æ¬¡å°è¯•è§¦å‘ï¼Œå¦‚æœè¢«è§‚å¯Ÿè€…æœªæ‰§è¡Œå®Œåˆ™å…¶æ‰§è¡Œå®Œæ¯•ä¹‹åé€šçŸ¥è§¦å‘ã€‚</p>
<ol type="1">
<li>è§‚å¯Ÿè€…ä¸­çš„ dep å±æ€§ï¼šæŒ‡å‘å…¶å¯¹åº”çš„ CompletableFutureï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­
dep æŒ‡å‘ CF2ã€‚</li>
<li>è§‚å¯Ÿè€…ä¸­çš„ src å±æ€§ï¼šæŒ‡å‘å…¶ä¾èµ–çš„ CompletableFutureï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­
src æŒ‡å‘ CF1ã€‚</li>
<li>è§‚å¯Ÿè€… Completion ä¸­çš„ fn
å±æ€§ï¼šç”¨æ¥å­˜å‚¨å…·ä½“çš„ç­‰å¾…è¢«å›è°ƒçš„å‡½æ•°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<u>ä¸åŒçš„å›è°ƒæ–¹æ³•</u>ï¼ˆthenAcceptã€thenApplyã€exceptionallyç­‰ï¼‰<u>æ¥æ”¶çš„å‡½æ•°ç±»å‹ä¹Ÿä¸åŒ</u>ï¼Œå³fnçš„ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­fnæŒ‡å‘fn2ã€‚</li>
</ol>
<p><strong>Q1</strong>ï¼šä¸ºä»€ä¹ˆè¦åœ¨å…¥æ ˆå‰å’Œå…¥æ ˆåéƒ½æ£€æŸ¥<code>result == null</code></p>
<p><strong>A1</strong>ï¼šå› ä¸ºæŸ¥ result å’Œåˆ¤æ–­ result==null
æ˜¯ä¸¤ä¸ªæ“ä½œï¼ŒCompletableFuture
æ²¡æœ‰å¯¹å…¶åŠ é”ï¼Œè‹¥è¢«è§‚å¯Ÿè€…åœ¨è¿™ä¸¤ä¸ªæ“ä½œæ•°ä¹‹é—´å®Œæˆï¼Œä¼šå¯¼è‡´è§‚å¯Ÿè€…å¾—ä¸åˆ°é€šçŸ¥</p>
<p><strong>Q2</strong>ï¼šå½“ä¾èµ–å¤šä¸ªCFæ—¶ï¼Œè§‚å¯Ÿè€…ä¼šè¢«å‹å…¥æ‰€æœ‰ä¾èµ–çš„CFçš„æ ˆä¸­ï¼Œæ¯ä¸ªCFå®Œæˆçš„æ—¶å€™éƒ½ä¼šè¿›è¡Œï¼Œé‚£ä¹ˆä¼šä¸ä¼šå¯¼è‡´ä¸€ä¸ªæ“ä½œè¢«å¤šæ¬¡æ‰§è¡Œå‘¢
ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå³å½“CF1ã€CF2åŒæ—¶å®Œæˆæ—¶ï¼Œå¦‚ä½•é¿å…CF3è¢«å¤šæ¬¡è§¦å‘ã€‚</p>
<img data-src="/" class="" title="å›¾15 å¤šæ¬¡è§¦å‘">
<p><strong>A2</strong>ï¼šCompletableFutureçš„å®ç°æ˜¯è¿™æ ·è§£å†³è¯¥é—®é¢˜çš„ï¼šè§‚å¯Ÿè€…åœ¨æ‰§è¡Œä¹‹å‰ä¼šå…ˆé€šè¿‡CASæ“ä½œè®¾ç½®ä¸€ä¸ªçŠ¶æ€ä½ï¼Œå°†statusç”±0æ”¹ä¸º1ã€‚å¦‚æœè§‚å¯Ÿè€…å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œé‚£ä¹ˆCASæ“ä½œå°†ä¼šå¤±è´¥ï¼Œå–æ¶ˆæ‰§è¡Œã€‚</p>
<p>CompletableFuture å¤„ç†å¹¶è¡Œé—®é¢˜çš„æ•´ä½“æµç¨‹å›¾ï¼š</p>
<img data-src="/" class="" title="å›¾16 å®Œæ•´æµç¨‹">
<p><strong>äºŒå…ƒä¾èµ–</strong></p>
<p>thenCombine æ“ä½œè¡¨ç¤ºä¾èµ–ä¸¤ä¸ª CompletableFutureã€‚å…¶è§‚å¯Ÿè€…å®ç°ç±»ä¸º
BiApplyï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒBiApply é€šè¿‡ src å’Œ snd ä¸¤ä¸ªå±æ€§å…³è”è¢«ä¾èµ–çš„ä¸¤ä¸ª
CFï¼Œfn å±æ€§çš„ç±»å‹ä¸º
BiFunctionã€‚ä¸å•ä¸ªä¾èµ–ä¸åŒçš„æ˜¯ï¼Œåœ¨ä¾èµ–çš„CFæœªå®Œæˆçš„æƒ…å†µä¸‹ï¼ŒthenCombine
ä¼šå°è¯•å°† BiApply å‹å…¥è¿™ä¸¤ä¸ªè¢«ä¾èµ–çš„ CF çš„æ ˆä¸­ï¼Œæ¯ä¸ªè¢«ä¾èµ–çš„ CF
æˆæ—¶éƒ½ä¼šå°è¯•è§¦å‘è§‚å¯Ÿè€… BiApplyï¼ŒBiApply
ä¼šæ£€æŸ¥ä¸¤ä¸ªä¾èµ–æ˜¯å¦éƒ½å®Œæˆï¼Œå¦‚æœå®Œæˆåˆ™å¼€å§‹æ‰§è¡Œã€‚è¿™é‡Œä¸ºäº†è§£å†³é‡å¤è§¦å‘çš„é—®é¢˜ï¼ŒåŒæ ·ç”¨çš„æ˜¯ä¸Šä¸€ç« èŠ‚æåˆ°çš„
CAS æ“ä½œï¼Œæ‰§è¡Œæ—¶ä¼šå…ˆé€šè¿‡ CAS è®¾ç½®çŠ¶æ€ä½ï¼Œé¿å…é‡å¤è§¦å‘ã€‚</p>
<img data-src="/" class="" title="å›¾17 äºŒå…ƒä¾èµ–æ•°æ®ç»“æ„">
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çŠ¶æ€ä½ Status å®šä¹‰äº ForkJoinTask ç±»ä¸­</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Completion</span> <span class="keyword">extends</span> <span class="title class_">ForkJoinTask</span>&lt;Void&gt; <span class="keyword">implements</span> <span class="title class_">Runnable</span>, AsynchronousCompletionTask&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ForkJoinTask</span>&lt;V&gt; <span class="keyword">implements</span> <span class="title class_">Future</span>&lt;V&gt;&#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å¤šå…ƒä¾èµ–</strong></p>
<p>ä¾èµ–å¤šä¸ªCompletableFutureçš„å›è°ƒæ–¹æ³•åŒ…æ‹¬<code>allOf</code>ã€<code>anyOf</code>ï¼ŒåŒºåˆ«åœ¨äº<code>allOf</code>è§‚å¯Ÿè€…å®ç°ç±»ä¸ºBiRelayï¼Œéœ€è¦æ‰€æœ‰è¢«ä¾èµ–çš„CFå®Œæˆåæ‰ä¼šæ‰§è¡Œå›è°ƒï¼›è€Œ<code>anyOf</code>è§‚å¯Ÿè€…å®ç°ç±»ä¸ºOrRelayï¼Œä»»æ„ä¸€ä¸ªè¢«ä¾èµ–çš„CFå®Œæˆåå°±ä¼šè§¦å‘ã€‚äºŒè€…çš„å®ç°æ–¹å¼éƒ½æ˜¯å°†å¤šä¸ªè¢«ä¾èµ–çš„CFæ„å»ºæˆä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ï¼Œæ‰§è¡Œç»“æœå±‚å±‚é€šçŸ¥ï¼Œç›´åˆ°æ ¹èŠ‚ç‚¹ï¼Œè§¦å‘å›è°ƒç›‘å¬ã€‚</p>
<img data-src="/" class="" title="å›¾18 å¤šå…ƒä¾èµ–ç»“æ„æ ‘">
]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Javaå¹¶å‘</tag>
        <tag>Javaçº¿ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>Java å¹¶å‘åŸºç¡€</title>
    <url>/#developer/JUC/</url>
    <content><![CDATA[<img data-src="/" class="" title="image-20240516133953621">
<h1 id="threadlocal">ThreadLocal</h1>
<p>æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸“å±æœ¬åœ°å˜é‡ï¼Œé€šè¿‡ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼é¿å…å¹¶å‘ä¸‹çº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<ul>
<li>å®Œæ•´çš„ä¸€æ¬¡è¯·æ±‚å¤„ç†ï¼Œäºå”¯ä¸€ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡ ThreadLocal
å…±äº«æ•°æ®</li>
<li>ThreadLocal.set æ–¹æ³•æ˜¯å°†å€¼å­˜å‚¨åˆ° <strong>Thread çº¿ç¨‹æœ¬èº«çš„
ThreadLocalMap</strong> é‡Œé¢</li>
</ul>
<p><strong>åŸç†</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalMap</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">            Object value;</span><br><span class="line">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">                <span class="built_in">super</span>(k);</span><br><span class="line">                value = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å­˜æ”¾æ•°æ®</span></span><br><span class="line">        <span class="keyword">private</span> Entry[] table;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•´ä½“ç»“æ„å›¾</p>
<style>.hmxfvmqqaxep{zoom:50%;}</style>
<img data-src="/" class="hmxfvmqqaxep" alt="img">
<p>å¼•ç”¨å…³ç³»å›¾</p>
<style>.wecmngmhghja{zoom:50%;}</style>
<img data-src="/" class="wecmngmhghja" alt="img">
<h2 id="qa">Q&amp;A</h2>
<p><strong>Entryçš„keyä¸ºä»€ä¹ˆè®¾è®¡æˆå¼±å¼•ç”¨ï¼Ÿ</strong></p>
<p>ThreadLocal å˜é‡ç”Ÿå‘½å‘¨æœŸç»“æŸåï¼ŒThreadLocal å¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶ï¼›</p>
<p><strong>ThreadLocalä¸ºä»€ä¹ˆä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</strong></p>
<p>è™½ç„¶ getã€set æˆ– remove æ–¹æ³•ä¼šå›æ”¶ key ä¸º null çš„ value
å€¼ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰è°ƒç”¨è¿™äº›æ–¹æ³•ï¼ŒEntry å’ŒThreadLocalMap
å°†ä¼šé•¿æœŸå­˜åœ¨ä¸‹å»ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼›</p>
<p>ä½¿ç”¨å®Œ ThreadLocal å¯¹è±¡ä¹‹åï¼Œè°ƒç”¨ remove æ–¹æ³•ï¼›</p>
<p><strong>ThreadLocal æ˜¯å¦‚ä½•å®šä½æ•°æ®çš„ï¼Ÿ</strong></p>
<p><code>int i = key.threadLocalHashCode &amp; (len-1);</code></p>
<p>å¦‚æœæœ‰å†²çªå°±é€šè¿‡çº¿æ€§æ¢æµ‹å†æ•£åˆ—ï¼Œç›´åˆ°æ‰¾åˆ°ç©º binï¼›</p>
<blockquote>
<p>å…¶ä»–Hashå†²çªè§£å†³æ–¹æ³•ï¼šå¼€æ”¾å¯»å€æ³•ï¼ˆå†æ•£åˆ—ï¼‰ã€æ‹‰é“¾æ³•</p>
</blockquote>
<p><strong>ThreadLocal æ˜¯å¦‚ä½•æ‰©å®¹çš„ï¼Ÿ</strong></p>
<p><strong>çˆ¶å­çº¿ç¨‹å¦‚ä½•å…±äº«æ•°æ®ï¼Ÿ</strong></p>
<p>InheritableThreadLocalï¼šåˆå§‹åŒ–æ—¶ä¼šæ‹·è´ä¸€ä»½çˆ¶çº¿ç¨‹ä¸­ ThreadLocal
å€¼ï¼Œåˆ°å­çº¿ç¨‹ InheritableThreadLocal ä¸­ï¼›</p>
<p><strong>ThreadLocal ä½œä¸ºæˆå‘˜å˜é‡æ—¶ï¼Œä¸ºä»€ä¹ˆå®šä¹‰æˆ static
æ›´å¥½ï¼Ÿ</strong></p>
<p>å°† ThreadLocal å®šä¹‰ä¸º static å¯ä»¥ç¡®ä¿æ‰€æœ‰çº¿ç¨‹éƒ½è®¿é—®åŒä¸€ä¸ª ThreadLocal
å®ä¾‹ï¼Œä½†å®ƒä»¬å„è‡ªå­˜å‚¨çš„æ•°æ®æ˜¯ç‹¬ç«‹çš„ï¼›</p>
<p>ç¡®ä¿å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œè€Œä¸æ˜¯ä¸ç±»çš„å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼›</p>
<p><strong>ä½¿ç”¨ InheritableThreadLocal
æ—¶ï¼Œå¦‚æœçˆ¶çº¿ç¨‹ä¸­é‡æ–°setå€¼ï¼Œåœ¨å­çº¿ç¨‹ä¸­èƒ½å¤Ÿæ­£ç¡®çš„è·å–ä¿®æ”¹åçš„æ–°å€¼å—ï¼Ÿ</strong></p>
<p>ä¸ä¼šå½±å“åˆ°å·²ç»å­˜åœ¨çš„å­çº¿ç¨‹ä¸­ InheritableThreadLocal
çš„å€¼ï¼Œå­çº¿ç¨‹å°†ä¿æŒå®ƒåœ¨åˆ›å»ºæ—¶ä»çˆ¶çº¿ç¨‹ä¸­ç»§æ‰¿çš„åŸå§‹å€¼ï¼›</p>
<h1 id="jmm">JMM</h1>
<ul>
<li><p>æŠ½è±¡äº† happens-before
åŸåˆ™æ¥è§£å†³è¿™ä¸ªæŒ‡ä»¤é‡æ’åºé—®é¢˜ï¼Œä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯è§æ€§ã€‚</p></li>
<li><p>æŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»ï¼Œæä¾›ä¸€å¥—å†…å­˜æ¨¡å‹ä»¥å±è”½ç³»ç»Ÿå·®å¼‚</p></li>
</ul>
<h2 id="æ¦‚å¿µ">æ¦‚å¿µ</h2>
<p>CPU é«˜é€Ÿç¼“å­˜ï¼šä¸ºè§£å†³ CPU å¤„ç†é€Ÿåº¦å’Œå†…å­˜ä¸åŒ¹é…çš„é—®é¢˜ï¼›</p>
<p>æŒ‡ä»¤é‡æ’åºã€ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’ â€”&gt; æŒ‡ä»¤å¹¶è¡Œé‡æ’ â€”&gt;
å†…å­˜ç³»ç»Ÿé‡æ’ã€‘ï¼šæŒ‡ä»¤é‡æ’åºå¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰ä¹Ÿä¸€è‡´ï¼›</p>
<blockquote>
<p>å†…å­˜å±éšœå¯ä»¥ç¦æ­¢å¤„ç†å™¨æŒ‡ä»¤å‘ç”Ÿé‡æ’åºï¼Œä»è€Œä¿éšœæŒ‡ä»¤æ‰§è¡Œçš„æœ‰åºæ€§ã€‚æ­¤å¤–ï¼Œè¿˜èƒ½ä¿è¯æŒ‡ä»¤æ‰§è¡Œçš„å¯è§æ€§ã€‚</p>
</blockquote>
<h2 id="happens-before-åŸåˆ™">happens-before åŸåˆ™</h2>
<p>å‰ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯¹äºåä¸€ä¸ªæ“ä½œæ˜¯å¯è§çš„ï¼Œæ— è®ºè¿™ä¸¤ä¸ªæ“ä½œæ˜¯å¦åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œ</p>
<ul>
<li>åªè¦ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ€ä¹ˆè¿›è¡Œé‡æ’åºä¼˜åŒ–éƒ½è¡Œï¼›</li>
<li>ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMM
è¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¿…é¡»ç¦æ­¢è¿™ç§é‡æ’åºï¼›</li>
</ul>
<h2 id="å¹¶å‘çš„ä¸‰å¤§ç‰¹æ€§">å¹¶å‘çš„ä¸‰å¤§ç‰¹æ€§</h2>
<p>åŸå­æ€§ï¼šä¸€æ¬¡æ“ä½œæˆ–è€…å¤šæ¬¡æ“ä½œï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œå…¨éƒ¨éƒ½å¾—åˆ°æ‰§è¡Œå¹¶ä¸”ä¸ä¼šå—åˆ°ä»»ä½•å› ç´ çš„å¹²æ‰°è€Œä¸­æ–­ï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</p>
<ul>
<li>synchronizedã€å„ç§ Lock ä»¥åŠå„ç§åŸå­ç±»ï¼›</li>
</ul>
<p>å¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå¦å¤–çš„çº¿ç¨‹éƒ½æ˜¯ç«‹å³å¯ä»¥çœ‹åˆ°ä¿®æ”¹åçš„æœ€æ–°å€¼</p>
<ul>
<li>synchronizedã€Volatile ä»¥åŠå„ç§ Lock å®ç°å¯è§æ€§ï¼›</li>
</ul>
<p>æœ‰åºæ€§ï¼šä»£ç çš„æ‰§è¡Œé¡ºåºæœªå¿…å°±æ˜¯ç¼–å†™ä»£ç æ—¶å€™çš„é¡ºåº</p>
<ul>
<li><p>Volatile
å…³é”®å­—ï¼š<strong>ä¿è¯å˜é‡çš„å¯è§æ€§å’Œä»£ç æ‰§è¡Œçš„æœ‰åºæ€§</strong>ï¼Œä½†æ— æ³•åœ¨å¤šçº¿ç¨‹è¯»å†™å˜é‡æ—¶ä¿è¯æ“ä½œåŸå­æ€§ï¼›</p></li>
<li><p>å†…å­˜å±éšœï¼š<code>Unsafe</code> ç±»çš„ <code>fullFence()</code>
å¯ä»¥é¿å…ä»£ç é‡æ’åºï¼›</p></li>
</ul>
]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Javaå¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•å¸¸è§é¢˜æ”¶é›†</title>
    <url>/#developer/Java-Interview/</url>
    <content><![CDATA[<h1 id="java-basic">Java-basic</h1>
<h1 id="jvm">JVM</h1>
<ol type="1">
<li>äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶å—ï¼Ÿæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶æ˜¯æ€ä¹ˆæ ·çš„</li>
</ol>
<h1 id="juc">JUC</h1>
<ol type="1">
<li>ç®€è¦æè¿°çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»ï¼ŒåŒºåˆ«åŠä¼˜ç¼ºç‚¹ï¼Ÿ</li>
<li>çº¿ç¨‹ä¹‹é—´å“ªäº›èµ„æºæ˜¯å…±äº«çš„ï¼Œå“ªäº›èµ„æºæ˜¯ç§æœ‰çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li>
<li>è¯´ä¸€ä¸‹ä½ å¯¹äº AQS åŸç†çš„ç†è§£ã€‚</li>
<li>å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ</li>
</ol>
<h1 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h1>
<ol type="1">
<li>äº†è§£è¿‡æ¶ˆæ¯ä¸­é—´ä»¶å—ï¼Ÿè¯´ä¸€ä¸‹ä½¿ç”¨åœºæ™¯</li>
</ol>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>é¢è¯•å‡†å¤‡</tag>
      </tags>
  </entry>
  <entry>
    <title>Java è¯­è¨€</title>
    <url>/#developer/Java/</url>
    <content><![CDATA[<h1 id="åŸºç¡€">åŸºç¡€</h1>
<h2 id="åŸºæœ¬æ•°æ®ç±»å‹">åŸºæœ¬æ•°æ®ç±»å‹</h2>
<p>é™¤å…«ä¸ªåŸºæœ¬ç±»å‹ï¼ŒJava çš„æ‰€æœ‰æ•°æ®ç±»å‹éƒ½æ˜¯å¼•ç”¨ï¼ŒJava
ä¸­æ²¡æœ‰æŒ‡é’ˆçš„æ¦‚å¿µï¼Œæ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½æ˜¯ä¼ å€¼ï¼ˆå¼•ç”¨å¯ä»¥çœ‹ä½œæ˜¯åœ°å€å€¼ï¼Œæ‰€æœ‰å¼•ç”¨å€¼éƒ½å å››ä¸ªå­—èŠ‚ï¼‰</p>
<p>åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±» Byte Short Integer Long Character æœ‰å¸¸é‡æ± </p>
<h2 id="ç¼–è¯‘è¿è¡Œ">ç¼–è¯‘è¿è¡Œ</h2>
<ul>
<li>Java ç¼–è¯‘å™¨ Javac æ˜¯ç”¨ Java å®ç°çš„ï¼Œç”¨äºå°† .java æ–‡ä»¶ç¼–è¯‘æˆå­—èŠ‚ç 
.class</li>
<li>.class é€šè¿‡è§£é‡Šå™¨å¯¹è¿™äº›å­—èŠ‚ç è¿›è¡Œè§£é‡Šæ‰§è¡Œ</li>
<li>Java çš„è¿è¡Œç¯å¢ƒ JVM å¦‚ HotSpot VMï¼Œå®ç°äº†å…¶è·¨å¹³å°çš„ç‰¹æ€§</li>
</ul>
<h2 id="ä¸‰å¤§ç‰¹æ€§">ä¸‰å¤§ç‰¹æ€§</h2>
<p><strong>å°è£…</strong></p>
<p>å°†æ•°æ®å’ŒåŸºäºæ•°æ®çš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œä½¿å…¶æ„æˆä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç‹¬ç«‹å®ä½“ï¼›</p>
<p><strong>ç»§æ‰¿</strong></p>
<p>æ”¯æŒç±»ä¹‹é—´çš„å•ç»§æ‰¿ï¼Œä½†æ”¯æŒæ¥å£ä¹‹é—´çš„å¤šç»§æ‰¿ï¼›</p>
<p>ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼ŒæŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–ä½†å¯ä»¥æœ‰æ„é€ æ–¹æ³•ï¼Œå†…éƒ¨ç±»åªèƒ½é€šè¿‡å¤–éƒ¨ç±»åˆ›å»ºï¼›</p>
<p>Object æ˜¯è¶…ç±»ï¼Œæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼ˆæ— çˆ¶ç±»çš„å­ç±»é»˜è®¤ç»§æ‰¿
Objectã€‚jdk6ä¹‹å‰æ˜¯ç¼–è¯‘å™¨å¤„ç†ï¼Œjdk7ä¹‹åæ˜¯è™šæ‹Ÿæœºå¤„ç†ï¼‰ï¼›</p>
<p>Java8 ä¹‹åæ¥å£å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•ï¼Œå…è®¸åœ¨æ¥å£ä¸­å£°æ˜é™æ€æ–¹æ³•ï¼›</p>
<p><strong>å¤šæ€</strong></p>
<p>å…¨é¢æ”¯æŒåŠ¨æ€ç»‘å®šï¼ŒåŠ¨æ€ç»‘å®šæ˜¯å®ç°å¤šæ€ï¼ˆä¸€ä¸ªæ¥å£ï¼Œå¤šç§å®ç°ï¼‰çš„åŸºç¡€ï¼›</p>
<ul>
<li>å¤šæ€æ–¹å¼è°ƒç”¨æ–¹æ³•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥çˆ¶ç±»ä¸­æ˜¯å¦æœ‰è¯¥æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ç¼–è¯‘é”™è¯¯ï¼›å¦‚æœæœ‰ï¼Œå†å»è°ƒç”¨å­ç±»çš„åŒåæ–¹æ³•ï¼ˆA
a=new B()ï¼ŒAæ˜¯çˆ¶ç±»ï¼ŒBæ˜¯å­ç±»ï¼‰</li>
<li><strong>é™æ€ç»‘å®š</strong>ï¼šå¯¹è±¡å±æ€§å’Œ static private final
ä¿®é¥°çš„å¯¹è±¡æ–¹æ³•ï¼ˆæ„é€ å‡½æ•°ï¼‰ï¼Œå“ªé‡Œå£°æ˜ï¼Œå“ªé‡Œä½¿ç”¨</li>
<li><strong>åŠ¨æ€ç»‘å®š</strong>ï¼šè¿è¡Œæ—¶ JVM
å®ç°ç»‘å®šã€‚è‹¥å­ç±»å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œåˆ™è°ƒç”¨å­ç±»çš„å†…å­˜åœ°å€ï¼Œè‹¥æ²¡æœ‰åˆ™è°ƒç”¨å½“å‰å¯¹è±¡ï¼ˆçˆ¶ç±»ï¼‰çš„æ–¹æ³•ã€‚åªèƒ½è°ƒç”¨çˆ¶ç±»çš„å±æ€§ï¼Œè™½ç„¶å®é™…å®ç°çš„æ˜¯å­ç±»ï¼Œå¦‚æœçˆ¶ç±»æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œé‚£å°±æ— æ³•è°ƒç”¨ã€‚å¦‚æœè¦è·å–å­ç±»å±æ€§ï¼Œå°±è¦é‡å†™å­ç±»æ–¹æ³•è·å–è¯¥å±æ€§ï¼Œå‰ææ˜¯è¿™ä¸ªæ–¹æ³•åœ¨çˆ¶ç±»ä¸­åŒæ ·å­˜åœ¨ã€‚</li>
</ul>
<h2 id="å…³é”®å­—">å…³é”®å­—</h2>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="header">
<th>å…³é”®å­—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>final</td>
<td>å¸¸é‡</td>
</tr>
<tr class="even">
<td>static</td>
<td>é™æ€å˜é‡ï¼Œæ— è®ºä¸€ä¸ªç±»å®ä¾‹åŒ–å¤šå°‘å¯¹è±¡ï¼Œå®ƒçš„é™æ€å˜é‡åªæœ‰ä¸€ä»½æ‹·è´ï¼›é™æ€æ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨ç±»çš„éé™æ€å˜é‡ï¼Œç±»åç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦è¿›è¡Œå®ä¾‹åŒ–å¯¹è±¡ã€‚</td>
</tr>
<tr class="odd">
<td>native</td>
<td>æœ¬åœ°ã€åŸç”Ÿæ–¹æ³•ï¼ˆé Java å®ç°ï¼‰</td>
</tr>
<tr class="even">
<td>strictfp</td>
<td>ä¸¥æ ¼æµ®ç‚¹ã€ç²¾å‡†æµ®ç‚¹</td>
</tr>
<tr class="odd">
<td>synchronized</td>
<td>çº¿ç¨‹ã€åŒæ­¥</td>
</tr>
<tr class="even">
<td>transient</td>
<td>ä¿®é¥°çš„æˆå‘˜å±æ€§å˜é‡ä¸è¢«åºåˆ—åŒ–ï¼Œä»…å­˜äºè°ƒç”¨è€…çš„å†…å­˜ä¸­è€Œä¸ä¼šå†™åˆ°ç£ç›˜é‡ŒæŒä¹…åŒ–ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼ˆä¸Serilizableæ¥å£ä¸€åŒä½¿ç”¨ï¼‰å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¢«
transient ä¿®é¥°çš„å˜é‡å€¼ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤ï¼Œç›´æ¥è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚static
ä¸å±äºä»»ä½•å¯¹è±¡ï¼Œå› æ­¤æ°¸è¿œä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</td>
</tr>
<tr class="odd">
<td>volatile</td>
<td>å˜é‡åœ¨ CPU
çš„å¯„å­˜å™¨ä¸­æ˜¯ä¸ç¡®å®šçš„ï¼Œå¿…é¡»ä»ä¸»å­˜ä¸­è¯»å–ã€‚ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å˜é‡çš„å¯è§æ€§ï¼›ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</td>
</tr>
<tr class="even">
<td>instanceof</td>
<td>å®ä¾‹</td>
</tr>
</tbody>
</table>
<h2 id="è¿ç®—ç¬¦ä¼˜å…ˆçº§">è¿ç®—ç¬¦ä¼˜å…ˆçº§</h2>
<img data-src="/" class="" title="image-20240516125841876">
<h2 id="è‡ªåŠ¨è£…ç®±æ‹†ç®±">è‡ªåŠ¨è£…ç®±/æ‹†ç®±</h2>
<blockquote>
<p>jdk1.5 i = Integer.valueOf(3) -128-127</p>
</blockquote>
<p>è‡ªåŠ¨è£…ç®±é€šå¸¸ä¹Ÿä¸ä¼šé€šè¿‡æ˜¾å¼çš„ valueOf
æ–¹æ³•è°ƒç”¨å®ç°ã€‚<strong>ç¼–è¯‘å™¨</strong>ç”Ÿæˆçš„å­—èŠ‚ç å¯èƒ½ç›´æ¥ä½¿ç”¨å†…éƒ¨æŒ‡ä»¤æˆ–æ–¹æ³•æ¥å¤„ç†è£…ç®±å’Œæ‹†ç®±ï¼Œè€Œä¸æ˜¯é€šè¿‡Javaæ–¹æ³•è°ƒç”¨æœºåˆ¶ã€‚å› æ­¤ï¼Œåœ¨
valueOf æ–¹æ³•ä¸Šè®¾ç½®æ–­ç‚¹é€šå¸¸ä¸ä¼šæ•è·åˆ°è‡ªåŠ¨è£…ç®±çš„è¿‡ç¨‹ã€‚
<code>new String("abc")</code> å’Œ <code>String.valueOf("abc")</code>
çš„åŒºåˆ«ï¼šå‰è€…åœ¨å †ä¸­åˆ›å»ºäº†æ–°çš„å¯¹è±¡ï¼Œåè€…è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± å¯¹è±¡çš„å¼•ç”¨ã€‚æ‹†ç®±ï¼šxxxValue()ï¼›è£…ç®±ï¼švalueOf()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">zhuangXiang</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">a2</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">a3</span> <span class="operator">=</span> <span class="number">256</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">a4</span> <span class="operator">=</span> a1 + a2;</span><br><span class="line">    System.out.println(a1 == a2); <span class="comment">// false</span></span><br><span class="line">    System.out.println(a4 == a3); <span class="comment">// false</span></span><br><span class="line">    System.out.println(a1 + a2 == a3); <span class="comment">// true å‘ç”Ÿæ‹†ç®±</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>NPE é—®é¢˜</p>
<ul>
<li>æ•°æ®åº“æŸ¥è¯¢è¿”å›ç»“æœä¸º Nullï¼Œæ— æ³•æ‹†ç®±</li>
<li>ä¸‰ç›®è¿ç®—ç¬¦å¯èƒ½å‡ºç°é—®é¢˜ï¼šflag ? 0 : iï¼ˆåº”ä½¿ç”¨ flag ? new Integer(0) :
iï¼‰</li>
</ul>
<h2 id="åŠ¨æ€ä»£ç†">åŠ¨æ€ä»£ç†</h2>
<p>é™æ€ä»£ç†ï¼šç¼–è¯‘æ—¶å®Œæˆ åŠ¨æ€ä»£ç†ï¼šè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM
ä¸­</p>
<ul>
<li>JDK
åŠ¨æ€ä»£ç†ï¼šé€šè¿‡ç”Ÿæˆä¸€ä¸ªå®ç°è¢«ä»£ç†ç±»æ¥å£çš„å¯¹è±¡æ¥æ‹¦æˆªè¢«ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨
<ul>
<li>å°è£…ï¼šProxy.newProxyInstance() æŒ‡å®š ClassLoader å¯¹è±¡å’Œä¸€ç»„
interface</li>
<li>è°ƒç”¨ï¼šInvocationHandler æ¥å£ invoke æ–¹æ³•</li>
</ul></li>
<li>CGLIB
åŠ¨æ€ä»£ç†ï¼šé€šè¿‡ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»æ¥æ‹¦æˆªè¢«ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨ï¼ˆå­—èŠ‚ç å®ç°ï¼Œä¸èƒ½è¢«
final ä¿®é¥°ï¼Œç¼–è¯‘é€Ÿåº¦æ…¢ï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼‰
<ul>
<li>å°è£…ï¼šEnhancer ç±»</li>
<li>è°ƒç”¨ï¼šMethodInterceptor æ¥å£ intercept æ–¹æ³•</li>
</ul></li>
</ul>
<p>äºŒè€…çš„å…·ä½“å®ç°</p>
<ul>
<li>JDKï¼šè¿è¡Œæ—¶åŠ¨æ€è§£æï¼Œæ— æ³•åº”ç”¨ä¸€äº› JVM ä¼˜åŒ–</li>
<li>CGLibï¼šASM å¼€æºåŒ…ï¼Œä»£ç†å¯¹è±¡ç±»çš„ class
æ–‡ä»¶åŠ è½½æ—¶ï¼Œä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆä»£ç†å­ç±»ï¼ˆASM
æ˜¯åœ¨ç¼–è¯‘æœŸå¤„ç†å­—èŠ‚ç çš„ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§ç¼–è¯‘æœŸçš„ AOP æŠ€æœ¯ï¼‰</li>
</ul>
<p>ä¸ºä»€ä¹ˆ JDK åŠ¨æ€ä»£ç†ï¼Œè¦æ±‚è¢«ä»£ç†å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£ï¼Ÿ</p>
<ul>
<li>å› ä¸º JDK åŠ¨æ€ä»£ç†ç±»å·²ç»ç»§æ‰¿äº† Proxy
è¿™ä¸ªç±»ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡æ¥å£æ¥ä¸è¢«ä»£ç†ç±»å»ºç«‹è”ç³»ï¼ˆä¸¤ä¸ªç±»å»ºç«‹èµ·è”ç³»ï¼Œä¸€æ˜¯ç»§æ‰¿çš„å…³ç³»ã€jdkå·²ç»ä¸èƒ½é€šè¿‡è¿™ä¸ªæ–¹å¼äº†ï¼Œå› ä¸ºjavaä»…æ”¯æŒå•ç»§æ‰¿ã€‘ï¼Œå¦ä¸€ç§å°±æ˜¯å®ç°åŒä¸€ä¸ªæ¥å£ã€JDKåŠ¨æ€ä»£ç†é€‰è¿™ç§ã€‘ï¼‰ï¼Œæ‰€ä»¥å¿…é¡»è¦æ±‚è¢«ä»£ç†ç±»ä¹Ÿå¾—å®ç°ä¸€ä¸ªæ¥å£</li>
</ul>
<h2 id="åŸç”Ÿå·¥å…·ç±»">åŸç”Ÿå·¥å…·ç±»</h2>
<p>Collections é›†åˆæ“ä½œç±»</p>
<ul>
<li>sort(list)</li>
<li>reverse(list)</li>
<li>binarySearch(list, target)</li>
</ul>
<p>Arrays æ•°ç»„æ“ä½œç±»</p>
<ul>
<li>max(list)</li>
<li>sort(array, (o1, o2)-&gt;o1-o2)</li>
<li>copyOf(array, Length)</li>
<li>binarySearch(array, value)</li>
<li>fill(array, value)</li>
</ul>
<p>æ¯”è¾ƒå™¨ é›†åˆæ’åºå·¥å…·</p>
<ul>
<li>Comparator ç±»çº§åˆ«
<ul>
<li>é’ˆå¯¹ä¸åŒçš„æ¯”è¾ƒï¼Œå•ç‹¬å®šä¹‰ä¸€ä¸ªæ¯”è¾ƒç±»</li>
<li>int compare(T o1, T o2);
<ul>
<li>è¿”å›å€¼ä¸ºæ­£æ•°ï¼Œäº¤æ¢ o1 o2 çš„é¡ºåº</li>
<li>è¿”å›å€¼ä¸ºè´Ÿæ•°æˆ–é›¶ï¼Œä¸éœ€è¦è°ƒæ•´</li>
<li>è¿”å›å‡åº o1-o2ï¼Œé™åº o2-o1</li>
</ul></li>
</ul></li>
<li>Comparable æ–¹æ³•çº§åˆ«
<ul>
<li>è‹¥ä¸€ä¸ªç±»å®ç°äº†Comparableæ¥å£ï¼Œå°±æ„å‘³ç€â€œè¯¥ç±»æ”¯æŒæ’åºâ€ï¼Œå¯ä»¥ç”¨Arrays.sort()æ’åº</li>
<li>public int compareTo(T o);</li>
</ul></li>
</ul>
<h2 id="æ¥å£å®ç°">æ¥å£å®ç°</h2>
<p>æ¥å£å’ŒæŠ½è±¡ç±»çš„å…³ç³»</p>
<ul>
<li>å…±åŒç‚¹
<ul>
<li>éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–</li>
<li>éƒ½å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•</li>
<li>æ–¹æ³•å¯ä»¥æœ‰<a
href="https://liushiming.cn/article/java-default-methods.html">é»˜è®¤å®ç°</a>çš„</li>
</ul></li>
<li>åŒºåˆ«
<ul>
<li>æ¥å£ä¸»è¦ç”¨äºå¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œçº¦æŸï¼Œä½ å®ç°äº†æŸä¸ªæ¥å£å°±å…·æœ‰äº†å¯¹åº”çš„è¡Œä¸ºã€‚æŠ½è±¡ç±»ä¸»è¦ç”¨äºä»£ç å¤ç”¨ï¼Œå¼ºè°ƒçš„æ˜¯ä»å±å…³ç³»ã€‚</li>
<li>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</li>
<li>æ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯ public static final
ç±»å‹çš„ï¼Œä¸èƒ½è¢«ä¿®æ”¹ä¸”å¿…é¡»æœ‰åˆå§‹å€¼ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å˜é‡é»˜è®¤
defaultï¼Œå¯åœ¨å­ç±»ä¸­è¢«é‡æ–°å®šä¹‰ï¼Œä¹Ÿå¯è¢«é‡æ–°èµ‹å€¼ã€‚</li>
</ul></li>
<li>æ¥å£ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½é»˜è®¤æ˜¯ç”±public static finalä¿®é¥°çš„</li>
<li>æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½é»˜è®¤æ˜¯ç”±public abstractä¿®é¥°çš„</li>
<li>æ¥å£æ²¡æœ‰æ„é€ æ–¹æ³•</li>
<li>å®ç°æ¥å£çš„ç±»ä¸­å¿…é¡»æä¾›æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•çš„å…·ä½“å®ç°å†…å®¹</li>
<li>å¤šä¸ªæ— å…³çš„ç±»å¯ä»¥å®ç°åŒä¸€ä¸ªæ¥å£</li>
<li>ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ— å…³çš„æ¥å£</li>
<li>ä¸ç»§æ‰¿å…³ç³»ç±»ä¼¼ï¼Œæ¥å£ä¸å®ç°ç±»ä¹‹é—´å­˜åœ¨å¤šæ€æ€§</li>
<li>æ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ï¼Œä½¿ç”¨extendså…³é”®å­—</li>
<li>Java8
åï¼Œæ¥å£å¯ä»¥æ‹¥æœ‰æ™®é€šæ–¹æ³•ï¼Œå®ç°ç±»ä¸éœ€è¦é‡å†™ï¼Œå¯ä»¥è¢«å®ç°ç±»ç»§æ‰¿</li>
</ul>
<h2 id="æ„é€ å™¨">æ„é€ å™¨</h2>
<p>this(å‚æ•°åˆ—è¡¨)æ¥è®¿é—®æœ¬ç±»æ„é€ å™¨éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li>åªèƒ½åœ¨æ„é€ å™¨ä¸­ä½¿ç”¨
this(å‚æ•°åˆ—è¡¨)ï¼›å³åœ¨ä¸€ä¸ªæ„é€ å™¨ä¸­è®¿é—®æœ¬ç±»çš„å¦å¤–ä¸€ä¸ªæ„é€ å™¨ã€‚</li>
<li>æ˜¾ç¤ºä½¿ç”¨ this() æ—¶ï¼Œé»˜è®¤çš„ super() å°±è¢«è¦†ç›–</li>
<li>this(å‚æ•°åˆ—è¡¨)å’Œ super(å‚æ•°åˆ—è¡¨)åœ¨æ„é€ å™¨ä¸­æœ‰ä¸”åªèƒ½å­˜åœ¨ä¸€ä¸ªã€‚</li>
<li>è‹¥åœ¨æ„é€ å™¨ä¸­ä½¿ç”¨ this(å‚æ•°åˆ—è¡¨)ï¼Œåˆ™æ­¤è¯­å¥åªèƒ½ä½äºæ„é€ å™¨ç¬¬ä¸€è¡Œ</li>
</ul>
<h2 id="åŠ¨æ€åŠ è½½">åŠ¨æ€åŠ è½½</h2>
<p>åå°„ï¼ˆè¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯ã€åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ï¼‰</p>
<p>ç±»åŠ è½½å™¨ ClassLoader</p>
]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Javaè¯­è¨€</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM è™šæ‹Ÿæœº</title>
    <url>/#developer/JVM/</url>
    <content><![CDATA[<blockquote>
<p>ã€Šæ·±å…¥ç†è§£ <a
href="https://link.zhihu.com/?target=http%3A//www.shaoqun.com/s/Java.aspx">Java</a>
è™šæ‹Ÿæœº - <a
href="https://link.zhihu.com/?target=http%3A//www.shaoqun.com/s/JVM.aspx">JVM</a>
é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹</p>
</blockquote>
<p>TODOè™šæ‹Ÿæœºå™¨æ‰§è¡Œå­ç³»ç»Ÿã€GCã€å†…å­˜åŒºåŸŸã€è°ƒä¼˜</p>
<h1 id="å†…å­˜ç»“æ„">å†…å­˜ç»“æ„</h1>
<p><a
href="https://blog.csdn.net/xiaojin21cen/article/details/104267301">æ–¹æ³•åŒºã€æ°¸ä¹…ä»£ï¼ˆPermGen
spaceï¼‰ã€å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰çš„å…³ç³»</a></p>
<img data-src="/" class="" title="image-20240429094145753">
<p>æ–¹æ³•åŒº</p>
<ul>
<li>ä¸»è¦å­˜å‚¨ç±»çš„ç›¸å…³ä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹äºåŠ¨æ€ç”Ÿæˆç±»çš„æƒ…å†µæ¯”è¾ƒå®¹æ˜“å‡ºç°æ°¸ä¹…ä»£çš„å†…å­˜æº¢å‡º</li>
<li>æ–¹æ³•åŒºæ˜¯ JVM çš„è§„èŒƒï¼Œå…ƒç©ºé—´æ˜¯ HotSpot è™šæ‹Ÿæœºåœ¨ Java8
å…·ä½“å®ç°çš„æ–¹æ³•åŒºï¼ˆJDK8 ä¹‹å‰æ˜¯æ°¸ä¹…ä»£ï¼‰</li>
</ul>
<p>Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰æ›¿æ¢ PermGenï¼ˆæ°¸ä¹…ä»£ï¼‰çš„åŸå›  &gt;
æ°¸ä¹…ä»£å­˜å‚¨åœ¨è™šæ‹Ÿæœºå †ä¸­ï¼Œå…ƒç©ºé—´å­˜å‚¨åœ¨æœ¬åœ°å†…å­˜ä¸­</p>
<ul>
<li>å­—ç¬¦ä¸²å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œä¸æ–¹ä¾¿ç®¡ç†ç»´æŠ¤ï¼Œéœ€è¦å•ç‹¬è¿›è¡Œåƒåœ¾ç®¡ç†</li>
<li>ç±»åŠæ–¹æ³•çš„ä¿¡æ¯ç­‰æ¯”è¾ƒéš¾ç¡®å®šå…¶å¤§å°ï¼Œå› æ­¤éš¾ä»¥æŒ‡å®šæ°¸ä¹…ä»£çš„å¤§å°ï¼Œå¤ªå°å®¹æ˜“å‡ºç°æ°¸ä¹…ä»£æº¢å‡ºï¼Œå¤ªå¤§åˆ™å®¹æ˜“å¯¼è‡´è€å¹´ä»£æº¢å‡º</li>
<li>æ°¸ä¹…ä»£ä¼šä¸º GC å¸¦æ¥ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½</li>
<li>å’Œå…¶ä»–è™šæ‹Ÿæœºæ¶æ„çœ‹é½ï¼Œæ–¹ä¾¿åˆå¹¶</li>
</ul>
<p>é™æ€å˜é‡å’ŒåŸºæœ¬æ•°æ®ç±»å‹åŒ…è£…ç±»çš„å¸¸é‡æ± å­˜åœ¨å“ªé‡Œï¼Ÿ</p>
<ul>
<li>jdk1.6 åŠä¹‹å‰é™æ€å˜é‡å’Œ String Table åœ¨æ°¸ä¹…ä»£æ–¹æ³•åŒº</li>
<li>jdk1.8å
è¿è¡Œæ—¶å¸¸é‡æ± å’Œé™æ€å˜é‡åœ¨å…ƒç©ºé—´ï¼Œ<strong>å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å †ç©ºé—´</strong></li>
</ul>
<p>è¿è¡Œæ—¶å¸¸é‡æ± </p>
<ul>
<li>å­˜å‚¨å¸¸é‡ã€å¼•ç”¨ã€æ•´æ•°å’Œæµ®ç‚¹æ•°ç­‰å†…å­˜åŒºåŸŸï¼Œæ˜¯ç±»åŠ è½½åçš„ç¬¬ä¸€ä¸ªåˆ›å»ºçš„å†…å­˜åŒºåŸŸï¼Œå¹¶ä¸”åœ¨æ•´ä¸ª
JVM è¿›ç¨‹ä¸­å…±äº«</li>
<li>å¸¸é‡æ± ä¸­çš„å†…å®¹æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥é€šè¿‡ç¬¦å·å¼•ç”¨è¿›è¡Œå…±äº«ï¼Œä»è€Œé¿å…å†…å­˜æµªè´¹</li>
</ul>
<p>æ–¹æ³•åŒºï¼šå…¨å±€ï¼Œæ‰€æœ‰æ ˆéƒ½å¯ä»¥è®¿é—®</p>
<ul>
<li>staticã€ClassLoader</li>
</ul>
<h2 id="jvm-å†…å­˜åŒºåŸŸ">JVM å†…å­˜åŒºåŸŸ</h2>
<p>çº¿ç¨‹ç§æœ‰çš„</p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨ï¼ˆå½“å‰çº¿ç¨‹æ‰§è¡Œä½ç½®ï¼›ä¾æ¬¡è¯»å–ä»£ç ï¼‰</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆå­˜å‚¨æ ˆå¸§ï¼šå±€éƒ¨å˜é‡è¡¨ã€å€¼ã€å¼•ç”¨æŒ‡é’ˆã€å¥æŸ„ã€‘ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å½“ä¸€ä¸ªæ–¹æ³•è¦è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œå°†å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºå…¶åœ¨å†…å­˜åœ°å€ä¸­çš„ç›´æ¥å¼•ç”¨ã€‘ã€æ–¹æ³•è¿”å›åœ°å€ï¼‰</li>
<li>è™šæ‹Ÿæœºæ ˆ</li>
</ul>
<p>çº¿ç¨‹å…±äº«çš„</p>
<ul>
<li>æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ã€æ°¸ä¹…ä»£ï¼‰å½“è™šæ‹Ÿæœºè¦ä½¿ç”¨ä¸€ä¸ªç±»æ—¶ï¼Œå®ƒéœ€è¦è¯»å–å¹¶è§£æ
Class
æ–‡ä»¶è·å–ç›¸å…³ä¿¡æ¯ï¼Œå†å°†ä¿¡æ¯å­˜å…¥åˆ°æ–¹æ³•åŒºã€‚æ–¹æ³•åŒºä¼šå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„
<strong>ç±»ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜</strong>ç­‰æ•°æ®ã€‚ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± ï¼šå³å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€è§£æé˜¶æ®µï¼šJVM
å°†ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ã€‘ï¼‰</li>
<li>å †ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€<a
href="https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html">String#intern</a>ã€‘ã€é™æ€å˜é‡ï¼‰</li>
<li>æœ¬åœ°å†…å­˜</li>
</ul>
<h2 id="å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹">å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h2>
<img data-src="/" class="" title="img">
<p><strong>å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</strong></p>
<ol type="1">
<li>æŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç±»çš„ç¬¦å·å¼•ç”¨</li>
<li>åˆ†é…å†…å­˜ï¼šæŒ‡é’ˆç¢°æ’ OR ç©ºé—²åˆ—è¡¨ï¼ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼šCAS + å¤±è´¥é‡è¯• OR
TLABï¼‰</li>
<li>åˆå§‹åŒ–é›¶å€¼</li>
<li>è®¾ç½®å¯¹è±¡å¤´ï¼šå…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC
åˆ†ä»£å¹´é¾„ã€æ˜¯å¦å¯ç”¨åå‘é”</li>
<li>æ‰§è¡Œ init æ–¹æ³•</li>
</ol>
<img data-src="/" class="" title="img">
<h2 id="å¯¹è±¡è®¿é—®å®šä½">å¯¹è±¡è®¿é—®å®šä½</h2>
<p>é€šè¿‡æ ˆä¸Šçš„ å¼•ç”¨æŒ‡é’ˆ Reference
æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ï¼šå¥æŸ„ã€ç›´æ¥æŒ‡é’ˆ</p>
<ul>
<li>Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference
ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚åœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡æ˜¯éå¸¸æ™®éçš„è¡Œä¸ºï¼‰åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆã€‚</li>
</ul>
<style>.kkaekvdxpets{zoom:50%;}</style>
<img data-src="/" class="kkaekvdxpets" alt="image-20240429100643112">
<ul>
<li>ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ï¼ŒHotSpot
é‡‡ç”¨çš„æ˜¯ç›´æ¥æŒ‡é’ˆ</li>
</ul>
<style>.pjrodkrmeoyd{zoom:50%;}</style>
<img data-src="/" class="pjrodkrmeoyd" alt="image-20240429100908916">
<h2 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h2>
<p>Mark Word
æ˜¯ä¸€ä¸ªå…·æœ‰åŠ¨æ€å®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ï¼Œæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<img data-src="/" class="" title="img">
<h1 id="gc-å †">GC å †</h1>
<p>æ–°ç”Ÿä»£ Young Generation</p>
<ul>
<li>Eden åŒºã€æ–°å»ºå¯¹è±¡åˆ†é…åœ°å€ã€‘</li>
<li>ä¸¤ä¸ª Survivor åŒº S0 å’Œ S1 ã€survivor çš„é˜ˆå€¼å¹´é¾„å–å°ï¼ˆå ç”¨è¶…è¿‡ä¸€åŠ s
åŒºçš„å¹´é¾„ï¼ŒMaxTenuringThresholdï¼‰ã€‘</li>
</ul>
<p>è€ç”Ÿä»£ Old Generation</p>
<p>HotSpot VM çš„å®ç°é‡Œçš„ GC å…¶å®å‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š</p>
<p>éƒ¨åˆ†æ”¶é›† (Partial GC)ï¼š</p>
<ul>
<li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›†ï¼›</li>
<li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old
GCï¼‰ï¼šåªå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Major GC
åœ¨æœ‰çš„è¯­å¢ƒä¸­ä¹Ÿç”¨äºæŒ‡ä»£æ•´å †æ”¶é›†ï¼›
<ul>
<li>è§¦å‘æ¡ä»¶ï¼šè€å¹´ä»£ç©ºé—´ä¸è¶³ã€æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li>
</ul></li>
<li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼š</li>
</ul>
<h1 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶</h1>
<h2 id="gc-root">GC Root</h2>
<p>è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§ã€æ–¹æ³•åŒºä¸­å¸¸é‡ã€JNI
å¼•ç”¨çš„å¯¹è±¡</p>
<p>è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</p>
<p><strong>è®°å¿†é›†ä¸å¡è¡¨</strong>ï¼š</p>
<p>è®°å¿†é›†æ˜¯ä¸€ç§ç”¨äºè®°å½•ä»<strong>éæ”¶é›†åŒºåŸŸæŒ‡å‘æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆé›†åˆ</strong>çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚åœ¨åƒåœ¾æ”¶é›†çš„åœºæ™¯ä¸­ï¼Œæ”¶é›†å™¨åªéœ€è¦é€šè¿‡è®°å¿†é›†åˆ¤æ–­å‡º<strong>æŸä¸€å—éæ”¶é›†åŒºåŸŸæ˜¯å¦å­˜åœ¨æœ‰æŒ‡å‘äº†æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆ</strong>ï¼Œå¹¶ä¸éœ€è¦äº†è§£è¿™äº›è·¨ä»£æŒ‡é’ˆçš„å…¨éƒ¨ç»†èŠ‚ã€‚è€å¹´ä»£åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå°å—ï¼Œæ ‡è¯†å‡ºè€å¹´ä»£å“ªä¸€å—å†…å­˜ä¼šå­˜åœ¨è·¨ä»£å¼•ç”¨ã€‚å½“å‘ç”Ÿ
Minor GC æ—¶ï¼Œåªæœ‰åŒ…å«äº†è·¨ä»£å¼•ç”¨çš„å°å—å†…å­˜ä¸­çš„è€å¹´ä»£å¯¹è±¡æ‰ä¼šåŠ å…¥åˆ° GC
Roots æ‰«æä¸­ï¼Œé¿å…æ•´ä¸ªè€å¹´ä»£åŠ å…¥åˆ° GC Roots ä¸­</p>
<h2 id="åƒåœ¾æ”¶é›†ç®—æ³•">åƒåœ¾æ”¶é›†ç®—æ³•</h2>
<table>
<colgroup>
<col style="width: 13%" />
<col style="width: 38%" />
<col style="width: 38%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th>åƒåœ¾æ”¶é›†ç®—æ³•</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>é€‚ç”¨èŒƒå›´</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>æ ‡è®°æ¸…é™¤æ³•</td>
<td>ä¸éœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œç®€å•é«˜æ•ˆ</td>
<td>æ ‡è®°æ•ˆç‡ä½ï¼ˆè®¿é—®å…¨éƒ¨å†…å­˜ï¼‰å†…å­˜ç¢ç‰‡</td>
<td>è€å¹´ä»£</td>
</tr>
<tr class="even">
<td>æ ‡è®°å¤åˆ¶ç®—æ³•</td>
<td>æ— å†…å­˜ç¢ç‰‡</td>
<td>é¢‘ç¹å¤åˆ¶ï¼›å†…å­˜ä½¿ç”¨ç‡ä½</td>
<td>æ–°ç”Ÿä»£</td>
</tr>
<tr class="odd">
<td>æ ‡è®°æ•´ç†æ³•</td>
<td>ç»“åˆäº†ä¸Šé¢ä¸¤ä¸ªä¼˜ç‚¹</td>
<td>ç§»åŠ¨å±€éƒ¨å¯¹è±¡</td>
<td>è€å¹´ä»£</td>
</tr>
<tr class="even">
<td>åˆ†ä»£æ”¶é›†ç®—æ³•</td>
<td>æ ¹æ®å¯¹è±¡å­˜æ´»æ¦‚ç‡ï¼Œé€‰æ‹©åƒåœ¾æ”¶é›†ç®—æ³•</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="åƒåœ¾å›æ”¶å™¨">åƒåœ¾å›æ”¶å™¨</h2>
<p>GCRootï¼šæ ˆå¸§ä¸­å¼•ç”¨çš„å¯¹è±¡ã€é™æ€å˜é‡ã€å¸¸é‡ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­å¯¹è±¡ STWï¼šStop
the World</p>
<table>
<thead>
<tr class="header">
<th>Young GC</th>
<th>Old GC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Serial ä¸²è¡Œã€æ ‡è®°-å¤åˆ¶</td>
<td>Serial Old æ ‡è®°-æ•´ç†ï¼ˆSTWï¼‰</td>
</tr>
<tr class="even">
<td>PawNew å¹¶è¡Œã€æ ‡è®°-å¤åˆ¶</td>
<td>CMS é™ä½å•æ¬¡åƒåœ¾æ”¶é›†æ—¶é—´</td>
</tr>
<tr class="odd">
<td>Parallel Scavenge ååç‡</td>
<td>Parallel Old</td>
</tr>
</tbody>
</table>
<img data-src="/" class="" title="image.png">
<h3 id="cms">CMS</h3>
<blockquote>
<p>ä»¥è·å¾—æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨</p>
</blockquote>
<p>æµç¨‹</p>
<ul>
<li>åˆæ¬¡æ ‡è®° STWï¼šæ ‡è®°ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡</li>
<li>å¹¶å‘æ ‡è®°ï¼šæ ‡è®°å¯è¾¾å¯¹è±¡ï¼Œè·Ÿè¸ªæ›´æ–°è®°å½•</li>
<li>é‡æ–°æ ‡è®° STWï¼šä¿®æ­£å¹¶å‘æ ‡è®°çš„å˜åŠ¨</li>
<li>å¹¶å‘æ¸…ç†ï¼šæ ‡è®°-æ¸…ç†ï¼ˆä¸ç”¨ STWï¼Œä½†æ¸…ç†ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¤åˆ¶ä¸ä¼šï¼‰</li>
</ul>
<p>ä¼˜ç‚¹</p>
<ul>
<li>å¹¶å‘æ”¶é›†ã€ä½åœé¡¿</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>å¯¹ CPU èµ„æºæ•æ„Ÿï¼›</li>
<li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼›</li>
<li>å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿï¼Œè¿‡é‡ç¢ç‰‡ä¼šå¯¼è‡´
Full GCï¼›</li>
<li>å¹¶å‘å¤±è´¥ï¼šå¹¶å‘æ¸…ç†çš„æ—¶å€™ç”¨æˆ·çº¿ç¨‹æ²¡æœ‰è¶³å¤Ÿçš„ JVM å†…å­˜ï¼Œä¼šå¯¼è‡´ STW
å¹¶äº§ç”Ÿå†…å­˜ç¢ç‰‡<br />
### <a
href="https://github.com/sunwu51/notebook/blob/master/19.09/java_jvm%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8.md">G1</a>
&gt; G1
è·Ÿè¸ªæ¯ä¸ªåŒºåŸŸçš„åƒåœ¾å¤§å°ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„åŒºåŸŸï¼Œå·²è¾¾åˆ°åœ¨æœ‰é™æ—¶é—´å†…è·å–å°½å¯èƒ½é«˜çš„å›æ”¶æ•ˆç‡</li>
</ul>
<img data-src="/" class="" title="image-20240429095131808">
<p>å†…å­˜ç»“æ„</p>
<ul>
<li>Region å¤§å° 1M~32Mã€ä¸ªæ•°å¤§æ¦‚ 2000</li>
<li>&gt;=0.5 Region &lt;1Regionï¼šH åŒºï¼ˆè¶…å¤§å¯¹è±¡å­˜å‚¨åŒºï¼‰</li>
<li>&gt;1Regionï¼šå¤šä¸ªè¿ç»­å­˜å‚¨åŒº</li>
</ul>
<p>æ¦‚å¿µ</p>
<ul>
<li>RememberSetsï¼Œåˆå« Rsets æ˜¯æ¯ä¸ª region
ä¸­éƒ½æœ‰çš„ä¸€ä»½å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜å‚¨æœ¬ region çš„å¯¹è±¡è¢«å…¶ä»– region
å¯¹è±¡çš„å¼•ç”¨è®°å½•</li>
<li>CollectionSetsï¼Œåˆå« Csets æ˜¯ä¸€æ¬¡ GC ä¸­éœ€è¦è¢«æ¸…ç†çš„ regions
é›†åˆï¼Œæ³¨æ„G1æ¯æ¬¡ GC ä¸æ˜¯å…¨éƒ¨ region
éƒ½å‚ä¸çš„ï¼Œå¯èƒ½åªæ¸…ç†å°‘æ•°å‡ ä¸ªï¼Œè¿™å‡ ä¸ªå°±è¢«å«åš Csets</li>
</ul>
<p><a
href="https://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/index.html">Young
GC</a> å¤åˆ¶æ¸…ç†çš„è¿‡ç¨‹ <img data-src="/" class="" title="image-20240429095142614"> MixGCï¼ˆæ²¡æœ‰ Old GC
çš„æ¦‚å¿µï¼Œæ–°è€ä»£ä¸€èµ· GC)ç±»ä¼¼äº CMS</p>
<ul>
<li>åˆæ¬¡æ ‡è®° STWï¼šæ ‡è®°ç›´æ¥ä¸ GCRoot ç›¸è¿çš„å¯¹è±¡ï¼Œå’Œè¯¥å¯¹è±¡æ‰€å¤„çš„
Region(RootRegion)</li>
<li>æ‰«æ RootRrgionï¼šéå† old Regionï¼Œå¦‚æœ rset ä¸­å­˜åœ¨
RootRegionï¼Œåˆ™æ ‡è®°ï¼ˆå³ä¸ºå¯è¾¾çš„ Regionï¼‰</li>
<li>å¹¶å‘æ ‡è®°ï¼šåŒ CMSï¼Œä½†ä»…éå†æ ‡è®°çš„ Region</li>
<li>é‡æ–°æ ‡è®° STWï¼šSATB ç®—æ³•</li>
<li>ç­›é€‰å›æ”¶ STWï¼šå±€éƒ¨çš„æ ‡è®°æ•´ç†åƒåœ¾æ”¶é›†</li>
</ul>
<img data-src="/" class="" title="image-20240429095150787">
<p>å¯¹æ¯”CMSï¼Œæœ‰å“ªäº›ä¸åŒï¼Ÿ</p>
<ul>
<li>regionåŒ–çš„å†…å­˜ç»“æ„ï¼Œé‡‡ç”¨å¤åˆ¶æ¸…ç†çš„æ–¹å¼ï¼Œé¿å…äº†å†…å­˜ç¢ç‰‡ã€‚ä½†æ˜¯è¿™ç§æ¸…ç†ä¹Ÿé€ æˆäº†STW</li>
<li>SATBé€Ÿåº¦æ›´å¿«</li>
<li>åˆå§‹æ ‡è®°ï¼Œå¹¶å‘æ ‡è®°ï¼Œé‡æ–°æ ‡è®°ï¼Œæ¸…ç†åƒåœ¾å››ä¸ªé˜¶æ®µå¾ˆåƒï¼Œä½†æ˜¯G1ä¸­æœ‰å¾ˆå¤šæ ‡è®°regionçš„æ“ä½œï¼Œå¹¶å€ŸåŠ©Rsetè¿›è¡Œäº†èŒƒå›´çš„ç¼©å°ï¼Œæé«˜äº†å¹¶å‘æ ‡è®°çš„é€Ÿåº¦ã€‚å°ç»“ä¸‹å°±æ˜¯åˆå§‹æ ‡è®°å’ŒYGCçš„STWä¸€èµ·äº†ï¼Œæé«˜äº†æ•ˆç‡ï¼›å¹¶å‘æ ‡è®°å› ä¸ºrsetçš„è®¾è®¡ï¼Œæ‰«æèŒƒå›´ç¼©å°äº†ï¼Œæé«˜äº†æ•ˆç‡ï¼›é‡æ–°æ ‡è®°å› ä¸ºä½¿ç”¨äº†SATBæé«˜äº†æ•ˆç‡ï¼›æ¸…ç†è™½ç„¶é€ æˆäº†STWï¼Œä½†æ˜¯å¤åˆ¶ä½¿å†…å­˜ç´§å‡‘ï¼Œé¿å…äº†å†…å­˜ç¢ç‰‡ã€‚åŒæ—¶åªæ¸…ç†åƒåœ¾è¾ƒå¤šçš„regionï¼Œæœ€å¤§é™åº¦çš„é™ä½äº†STWæ—¶é—´</li>
</ul>
<img data-src="/" class="" title="image-20240429095159588">
<p>GC å›æ”¶ï¼Œé’ˆå¯¹å †å†…å­˜ GC å›æ”¶é—®é¢˜ï¼š<a
href="https://heapdump.cn/article/1661497">YGC</a>ã€<a
href="https://heapdump.cn/article/1870333">FGC</a></p>
<h1 id="ç±»åŠ è½½è¿‡ç¨‹">ç±»åŠ è½½è¿‡ç¨‹</h1>
<strong>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šåŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å¸è½½
<style>.jixdnengrqsf{zoom:67%;}</style>
<img data-src="/" class="jixdnengrqsf" alt="image-20240429095206248">
<ul>
<li>åŠ è½½ï¼šé€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼›å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼›åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„
<code>Class</code>
å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ï¼›ã€é€šè¿‡ç±»åŠ è½½å™¨å®ç°åŠ è½½ï¼Œé€šè¿‡åŒäº²å§”æ´¾æ¨¡å‹å†³å®šé‡‡ç”¨å“ªä¸ªç±»åŠ è½½å™¨ã€‘</li>
<li>éªŒè¯ï¼šç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯æ— è¯¯</li>
<li>å‡†å¤‡ï¼šåˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼</li>
<li>è§£æï¼šå°†å¸¸é‡æ± å†…çš„<strong>ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨</strong>ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°ç±»æˆ–è€…å­—æ®µã€æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆæˆ–è€…åç§»é‡ï¼›</li>
<li>åˆå§‹åŒ–ï¼šæ‰§è¡Œå­—èŠ‚ç ä¸­çš„æ„é€ å™¨æ¥åˆå§‹åŒ–ç±»</li>
</ul>
<h1 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨</h1>
<blockquote>
<p>è´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯åŠ è½½ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰åˆ°
JVM ä¸­ï¼ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼‰ï¼›</p>
</blockquote>
<p>å°†â€œé€šè¿‡ç±»çš„å…¨é™å®šåè·å–æè¿°ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€è¿™ä»¶äº‹æ”¾åœ¨è™šæ‹Ÿæœºå¤–éƒ¨ï¼Œç”±åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å®ç°ï¼›
<img data-src="/" class="" title="image-20240429095212841">ï¼ˆå¯åŠ¨ç±»åŠ è½½å™¨ï¼šè™šæ‹Ÿæœºçš„ä¸€éƒ¨åˆ†)</p>
<h2 id="åŒäº²å§”æ´¾æ¨¡å‹">åŒäº²å§”æ´¾æ¨¡å‹</h2>
<blockquote>
<p>å†³å®šç±»ç”±å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½
ç¼–ç¨‹æ€æƒ³ï¼šåœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸€æ¡éå¸¸ç»å…¸çš„è®¾è®¡åŸåˆ™ï¼šç»„åˆä¼˜äºç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ï¼ˆå³åŒäº²å§”æ´¾çš„å®ç°æ–¹æ³•ï¼‰</p>
</blockquote>
<ul>
<li>ClassLoader
ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚
<ul>
<li>è·å–è¯¥ç±»çš„ç±»åŠ è½½å™¨getClassLoader()æ–¹æ³•ï¼›è·å–çˆ¶ç±»çš„ç±»åŠ è½½å™¨getParent()</li>
</ul></li>
<li>ClassLoader
å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆç”¨åŒäº²å§”æ´¾ï¼Ÿ</strong></p>
<ul>
<li>ç›¸åŒäºŒè¿›åˆ¶åç§°çš„ç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œå·²ç»åŠ è½½çš„ç±»ä¼šè¢«æ”¾åœ¨ ClassLoader
ä¸­ï¼Œé˜²æ­¢é‡å¤åŠ è½½ï¼›</li>
<li>ä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹ï¼›</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆæ‰“ç ´åŒäº²å§”æ´¾ï¼Ÿ</strong></p>
<ul>
<li>Tomcat ä¸‹ Web
åº”ç”¨ä¹‹é—´çš„ç±»éœ€è¦å®ç°éš”ç¦»ï¼Œæ‰“ç ´åŒäº²å§”æ´¾å¯ä»¥æ›´å¥½åœ°ç®¡ç†å¤šä¸ªWebåº”ç”¨ç¨‹åºçš„ç±»åŠ è½½ï¼Œå¹¶é¿å…ç±»åŠ è½½å†²çªã€‚</li>
<li>SPI çš„æ¥å£æ˜¯ç”± Java æ ¸å¿ƒåº“æä¾›çš„ï¼ˆBootstrapClassLoaderï¼‰ï¼ŒSPI
çš„å®ç°æ˜¯ç”±ç¬¬ä¸‰æ–¹ä¾›åº”å•†æä¾›çš„ï¼ˆAppClassLoaderï¼‰ï¼Œå®ç°ç±»æ— æ³•é€šè¿‡æ¥å£çš„åŠ è½½å™¨åŠ è½½</li>
</ul>
<p>ClassLoader æŠ½è±¡ç±»ï¼š</p>
<ul>
<li>loadClass(String name, boolean resolve)
ï¼šçˆ¶ç±»çš„åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œåˆ™é€šè¿‡çˆ¶ç±»çš„loadClassæ¥åŠ è½½è¯¥ç±»ã€‚å¦‚æœè¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå°±é‡å†™è¿™ä¸ªæ–¹æ³•ï¼›</li>
<li>findClass(String
name)ï¼šå½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œæ ¹æ®ç±»çš„äºŒè¿›åˆ¶åç§°æ¥åŠ è½½è¯¥ç±»ï¼›</li>
</ul>
<p><a
href="https://javaguide.cn/java/jvm/classloader.html#%E6%89%93%E7%A0%B4%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B%E6%96%B9%E6%B3%95">çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</a></p>
<ul>
<li>ç±»åŠ è½½å™¨ä¿å­˜åœ¨çº¿ç¨‹ç§æœ‰æ•°æ®é‡Œï¼Œè·Ÿçº¿ç¨‹ç»‘å®šã€‚è§£å†³äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªç±»åŠå…¶ä¾èµ–ç±»ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œæ¥å£çš„ç±»åŠ è½½å™¨å’Œå­ç±»æˆ–å®ç°ç±»çš„åŠ è½½å™¨ä¸æ˜¯åŒä¸€ä¸ªåŠ è½½å™¨ã€‚</li>
</ul>
<h1 id="jvm-è°ƒä¼˜">JVM è°ƒä¼˜</h1>
<p>é…ç½®Javaå †å’Œå…ƒç©ºé—´å¤§å°</p>
<p>é€‰æ‹©åƒåœ¾å›æ”¶å™¨ï¼šCMS å‡çº§åˆ° G1ï¼Œç”šè‡³ ZGCã€‚</p>
<p>JVMæ€§èƒ½ç›‘æ§å’Œè°ƒè¯•ï¼Œåˆ†æå †å†…å­˜çŠ¶æ€ï¼Œåˆç†ä¼˜åŒ–ä»£ç </p>
]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>Java å¸¸ç”¨æ•°æ®ç»“æ„çš„åº•å±‚å®ç°</title>
    <url>/#developer/Java-DataStructure/</url>
    <content><![CDATA[<h1 id="arraylist">ArrayList</h1>
<p><code>ArrayList</code> çš„åº•å±‚æ˜¯æ•°ç»„é˜Ÿåˆ—ï¼Œç›¸å½“äºåŠ¨æ€æ•°ç»„ã€‚</p>
<ul>
<li>ä¸æ•°ç»„ç›¸æ¯”ï¼Œå®ƒçš„å®¹é‡èƒ½åŠ¨æ€å¢é•¿ã€‚</li>
<li>ä¸ Vector ç›¸æ¯”ï¼Œå®ƒçš„åº•å±‚ä½¿ç”¨ Object[]
å­˜å‚¨ï¼Œé€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span>, E)</span>;</span><br><span class="line">    E <span class="title function_">set</span><span class="params">(<span class="type">int</span>, E)</span>;</span><br><span class="line">    E <span class="title function_">get</span><span class="params">(<span class="type">int</span>)</span>;</span><br><span class="line">    E <span class="title function_">remove</span><span class="params">(<span class="type">int</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>List</code> :
è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¸‹æ ‡è¿›è¡Œè®¿é—®ã€‚</li>
<li><code>RandomAccess</code> ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å¿—æ¥å£ï¼Œè¡¨æ˜å®ç°è¿™ä¸ªæ¥å£çš„
<code>List</code> é›†åˆæ˜¯æ”¯æŒ <strong>å¿«é€Ÿéšæœºè®¿é—®</strong>
,å¯ä»¥é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡<code>list.get(i)</code>ã€‚</li>
<li><code>Cloneable</code>
ï¼šè¡¨æ˜å®ƒå…·æœ‰æ‹·è´èƒ½åŠ›ï¼Œå¯ä»¥è¿›è¡Œæ·±æ‹·è´æˆ–æµ…æ‹·è´æ“ä½œã€‚</li>
<li><code>Serializable</code> :
è¡¨æ˜å®ƒå¯ä»¥è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµè¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨æˆ–ç½‘ç»œä¼ è¾“ï¼Œéå¸¸æ–¹ä¾¿ã€‚</li>
</ul>
<h2 id="æ‰©å®¹æœºåˆ¶">æ‰©å®¹æœºåˆ¶</h2>
<p>åˆå§‹åŒ–æ—¶é»˜è®¤ç©ºæ•°ç»„
<code>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code>ã€‚</p>
<p>æ·»åŠ å…ƒç´ æ—¶ï¼Œå…ˆåˆ¤æ–­éœ€è¦æ‰©å®¹çš„æœ€å°æ‰©å®¹é‡å¤§å°ï¼ˆDEFAULT_CAPACITY é»˜è®¤æ˜¯
10ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculateCapacity</span><span class="params">(Object[] elementData, <span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦æ‰©å®¹ï¼Œå°±ä¼šè¿›å…¥æ‰©å®¹æ–¹æ³• grow()ï¼Œæ‰©å®¹æ•ˆæœæ˜¯å°äºç­‰äº 1.5
å€çš„ï¼ˆå› ä¸º int å–æ•´ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ‰©å®¹é•¿åº¦è¶…è¿‡å®šä¹‰çš„æ•°ç»„çš„æœ€å¤§é•¿åº¦
<code>MAX_ARRAY_SIZE = Integer.MAX_VALUE-8</code>ï¼Œå°±ä¼šè§¦å‘æœ€å¤§å€¼é™åˆ¶ï¼Œé˜²æ­¢
size æº¢å‡º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hugeCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OutOfMemoryError</span>();</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">        MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†æ—§æ•°ç»„ç§»åŠ¨åˆ°æ–°æ•°ç»„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] copyOf(<span class="type">int</span>[] original, <span class="type">int</span> newLength) &#123;</span><br><span class="line">    <span class="type">int</span>[] copy = <span class="keyword">new</span> <span class="title class_">int</span>[newLength];</span><br><span class="line">    System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>, Math.min(original.length, newLength));</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ‰‹åŠ¨æ‰©å®¹</strong>ï¼Œå¯ä»¥åœ¨éœ€è¦æ’å…¥å¤§é‡æ•°æ®å‰æ‰‹åŠ¨æ‰©å®¹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">minExpand</span> <span class="operator">=</span> (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) ? <span class="number">0</span> : DEFAULT_CAPACITY;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; minExpand) &#123;</span><br><span class="line">        ensureExplicitCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸-linkedlist-çš„å¼‚åŒ">ä¸ LinkedList çš„å¼‚åŒ</h2>
<ul>
<li><p>éƒ½ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</p></li>
<li><p><code>ArrayList</code> åº•å±‚ä½¿ç”¨çš„æ˜¯ <code>Object[]</code>
<strong>æ•°ç»„</strong>ï¼›<code>LinkedList</code> åº•å±‚ä½¿ç”¨çš„æ˜¯
<strong>Node+åŒå‘é“¾è¡¨</strong> æ•°æ®ç»“æ„ï¼ˆJDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7
å–æ¶ˆäº†å¾ªç¯ï¼‰</p></li>
<li><p><strong>æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š</strong></p></li>
<li><ul>
<li><code>ArrayList</code>
å°†æŒ‡å®šçš„å…ƒç´ <strong>è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾</strong>ï¼Œæ—¶é—´å¤æ‚åº¦
<strong>O(1)</strong>ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨<strong>æŒ‡å®šä½ç½® i
æ’å…¥å’Œåˆ é™¤å…ƒç´ </strong>çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦
<strong>O(n)</strong>ã€‚</li>
<li><code>LinkedList</code>
<strong>å¤´å°¾æ’å…¥æˆ–è€…åˆ é™¤</strong>å…ƒç´ ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼ˆ<code>add(E e)</code>ã€<code>addFirst(E e)</code>ã€<code>addLast(E e)</code>ã€<code>removeFirst()</code>ã€
<code>removeLast()</code>ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦
<strong>O(1)</strong>ï¼›<strong>æŒ‡å®šä½ç½® <code>i</code>
æ’å…¥å’Œåˆ é™¤å…ƒç´ </strong>çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼Œ<code>remove(Object o)</code>,<code>remove(int index)</code>ï¼‰ï¼Œ
æ—¶é—´å¤æ‚åº¦ä¸º <strong>O(n)</strong> ã€‚</li>
</ul></li>
<li><p><strong>æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š</strong> <code>LinkedList</code>
ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€Œ <code>ArrayList</code>ï¼ˆå®ç°äº†
<code>RandomAccess</code> æ¥å£ï¼‰ æ”¯æŒã€‚</p></li>
<li><p><strong>å†…å­˜ç©ºé—´å ç”¨ï¼š</strong> <code>ArrayList</code>
çš„ç©ºé—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ
LinkedList çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´  Node éƒ½éœ€è¦æ¶ˆè€—æ¯” ArrayList
æ›´å¤šçš„ç©ºé—´</p></li>
</ul>
<h1 id="linkedlist">LinkedList</h1>
<blockquote>
<p>éœ€è¦ç”¨åˆ° <code>LinkedList</code> çš„åœºæ™¯å‡ ä¹éƒ½å¯ä»¥ä½¿ç”¨
<code>ArrayList</code>
æ¥ä»£æ›¿ï¼Œè€Œä¸”æ€§èƒ½ä¼šæ›´å¥½ã€‚å¤´å°¾æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ çš„æ—¶å€™æ—¶é—´å¤æ‚åº¦è¿‘ä¼¼
O(1)ï¼Œå…¶ä»–æƒ…å†µå¢åˆ å…ƒç´ çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n) ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractSequentialList</span>&lt;E&gt; </span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E item;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line">        Node&lt;E&gt; prev;</span><br><span class="line">        Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">            <span class="built_in">this</span>.item = element;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>List</code> :
è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¸‹æ ‡è¿›è¡Œè®¿é—®ã€‚</li>
<li><code>Deque</code> ï¼šç»§æ‰¿è‡ª <code>Queue</code>
æ¥å£ï¼Œå…·æœ‰åŒç«¯é˜Ÿåˆ—çš„ç‰¹æ€§ï¼Œæ”¯æŒä»ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œæ–¹ä¾¿å®ç°æ ˆå’Œé˜Ÿåˆ—ç­‰æ•°æ®ç»“æ„ã€‚</li>
</ul>
<h2 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</h2>
<ul>
<li>å®ç° List æ¥å£
<ul>
<li>getã€set</li>
</ul></li>
<li>å®ç° Collection æ¥å£
<ul>
<li>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼šcontains</li>
</ul></li>
<li>å®ç° Queue æ¥å£ï¼ˆé€šè¿‡ Deque æ¥å£ï¼‰
<ul>
<li>æŠ¥é”™ï¼šaddã€removeã€element</li>
<li>ä¸æŠ¥é”™ï¼šofferã€pollã€peek</li>
</ul></li>
<li>å®ç° Deque æ¥å£
<ul>
<li>addFirst [push]ã€addLast [add]ï¼šæ— è¿”å›ï¼Œå®¹é‡è¶…å‡ºé™åˆ¶ä¼šæŠ¥é”™</li>
<li>offerFirstã€offerLast [offer]ï¼šè¿”å› Boolean è¡¨ç¤ºæ˜¯å¦åŠ å…¥æˆåŠŸ</li>
<li>removeFirst [remove]ã€removeLastï¼šé˜Ÿåˆ—ä¸ºç©ºæŠ¥é”™</li>
<li>pollFirst [poll]ã€pollLastï¼šé˜Ÿåˆ—ä¸ºç©ºè¿”å› null</li>
<li>getFirst [element]ã€getLastï¼šé˜Ÿåˆ—ä¸ºç©ºæŠ¥é”™</li>
<li>peekFirst [peek]ã€peekLastï¼šé˜Ÿåˆ—ä¸ºç©ºè¿”å› null
<ul>
<li>ã€æ³¨æ„ã€‘é˜Ÿåˆ—å¤´éƒ¨ä¸º null å’Œé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œéƒ½ä¼šè¿”å› null</li>
</ul></li>
<li>removeFirstOccurrence [remove]ã€removeLastOccurrence</li>
<li>pushã€popã€peekï¼šä½œä¸ºæ ˆ</li>
</ul></li>
</ul>
<h1 id="hashmap">HashMap</h1>
<blockquote>
<p>JDK1.8 ä¹‹å‰ HashMap é‡‡ç”¨â€œæ‹‰é“¾æ³•â€å¤„ç†å†²çªï¼Œç”± æ•°ç»„+é“¾è¡¨ ç»„æˆï¼› JDK1.8
ä»¥åï¼Œè‹¥Tableé•¿åº¦å¤§äº 64ï¼Œä¼šå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚</p>
</blockquote>
<style>.vpmlwghjdguh{zoom:50%;}</style>
<img data-src="/" class="vpmlwghjdguh" alt="image-20240425212527868">
<ul>
<li>key å’Œ value å¯ä»¥ä¸º nullï¼Œä½† null ä½œä¸º key åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œ null ä½œä¸º
value å¯ä»¥æœ‰å¤šä¸ª</li>
<li>éçº¿ç¨‹å®‰å…¨çš„</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMap</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">AbstractMap</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>&lt;K,V&gt;, Cloneable, Serializable &#123;</span><br><span class="line">    <span class="comment">// é»˜è®¤çš„åˆå§‹å®¹é‡æ˜¯16</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_INITIAL_CAPACITY</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// æœ€å¤§å®¹é‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAXIMUM_CAPACITY</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line">    <span class="comment">// é»˜è®¤çš„è´Ÿè½½å› å­</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">float</span> <span class="variable">DEFAULT_LOAD_FACTOR</span> <span class="operator">=</span> <span class="number">0.75f</span>;</span><br><span class="line">    <span class="comment">// å½“æ¡¶ä¸Šçš„ç»“ç‚¹æ•°å¤§äºç­‰äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TREEIFY_THRESHOLD</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// å½“æ¡¶ä¸Šçš„ç»“ç‚¹æ•°å°äºç­‰äºè¿™ä¸ªå€¼æ—¶æ ‘è½¬é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">UNTREEIFY_THRESHOLD</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">    <span class="comment">// æ¡¶ä¸­ç»“æ„è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„ table çš„æœ€å°å®¹é‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MIN_TREEIFY_CAPACITY</span> <span class="operator">=</span> <span class="number">64</span>;</span><br><span class="line">    <span class="comment">// å­˜å‚¨æ¡¶ï¼ˆbinï¼‰çš„æ•°ç»„ï¼Œæ°¸è¿œæ˜¯ 2 çš„å¹‚æ¬¡å€</span></span><br><span class="line">    <span class="keyword">transient</span> Node&lt;k,v&gt;[] table;</span><br><span class="line">    <span class="comment">// ä¸€ä¸ªåŒ…å«äº†æ˜ å°„ä¸­æ‰€æœ‰é”®å€¼å¯¹çš„é›†åˆè§†å›¾</span></span><br><span class="line">    <span class="comment">// å…ˆéå†æ•°ç»„ binï¼Œå†é€šè¿‡ Entry.next éå†æ¯ä¸ª bin</span></span><br><span class="line">    <span class="keyword">transient</span> Set&lt;map.entry&lt;k,v&gt;&gt; entrySet;</span><br><span class="line">    <span class="comment">// å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œæ³¨æ„è¿™ä¸ªä¸ç­‰äºæ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="comment">// é˜ˆå€¼=å®¹é‡*è´Ÿè½½å› å­ï¼Œå½“å®é™…å¤§å°è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹</span></span><br><span class="line">    <span class="type">int</span> threshold;</span><br><span class="line">    <span class="comment">// è´Ÿè½½å› å­</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> loadFactor;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt;&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        <span class="comment">// é“¾è¡¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>.Entry&lt;K,V&gt;&#123;</span><br><span class="line">        Entry&lt;K,V&gt; before, after;</span><br><span class="line">        TreeNode&lt;K,V&gt; parent;  <span class="comment">// çº¢é»‘æ ‘é“¾</span></span><br><span class="line">        TreeNode&lt;K,V&gt; left;</span><br><span class="line">        TreeNode&lt;K,V&gt; right;</span><br><span class="line">        TreeNode&lt;K,V&gt; prev;    <span class="comment">// éœ€è¦åœ¨ä¸‹æ¬¡åˆ é™¤æ—¶è§£é™¤é“¾æ¥</span></span><br><span class="line">        <span class="type">boolean</span> red;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>entrySet</code>
é€šè¿‡<code>Nodeçš„nextå±æ€§</code>éå†å…ƒç´ ï¼Œ<code>keySet()</code>ã€<code>values()</code>åŸºäº<code>entrySet</code>å®ç°ï¼Œç”¨äºéå†è®¿é—®æ‰€æœ‰
Node
å…ƒç´ ï¼Œè¿˜æ”¯æŒå…ƒç´ çš„åˆ é™¤æ“ä½œã€ä¸ç¡®å®šï¼ŒentrySetä¸å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯æ•°æ®å¯¹å¤–çš„æ“ä½œæ¥å£ã€‘ã€‚</li>
<li><code>TreeNode</code> ç»§æ‰¿äº† <code>LinkedHashMap.Entry</code>
ï¼Œæœ‰æŒ‡å‘å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆ</li>
</ul>
<p>jdk 1.8 <strong>Key è®¡ç®— hash å€¼çš„æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ‰©å®¹æœºåˆ¶-1">æ‰©å®¹æœºåˆ¶</h2>
<p><strong>ä½•æ—¶è§¦å‘ <code>resize()</code> æ‰©å®¹</strong></p>
<ul>
<li>è¦æ’å…¥æ•°æ®å‰ï¼Œå‘ç°<code>table</code> ä¸­çš„ <code>bin</code> ä¸ºç©º</li>
<li>è¦æ’å…¥æ•°æ®åï¼Œå‘ç°<code>HashMap</code>çš„ <code>size</code> è¶…è¿‡
<code>threshold</code></li>
<li><code>table</code> é•¿åº¦å°äº <code>MIN_TREEIFY_CAPACITY</code>æ—¶ï¼ŒæŸ
<code>Node</code> ä¸Šçš„é“¾é•¿åº¦è¶…è¿‡ <code>TREEIFY_THRESHOLD</code></li>
</ul>
<p><code>resize()</code> æ‰©å®¹ï¼Œä¼šå°† table ä¸­çš„èŠ‚ç‚¹æ•°é‡ &lt;&lt;
1ï¼Œå¹¶é‡æ–° hash æ˜ å°„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå› ä¸º table å˜å¤§äº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„ bin
ä¸‹æ ‡å‘ç”Ÿäº†å˜åŒ–
<code>newTab[e.hash &amp; (newCap - 1)] = e</code>ï¼Œ<code>newCap</code>ä¸º
table çš„æ–°å¤§å°ï¼‰</p>
<p>é“¾è¡¨ä½•æ—¶å˜æˆçº¢é»‘æ ‘ï¼Ÿ</p>
<ul>
<li>è¯¥ <code>bin</code> ä¸Šçš„é“¾é•¿åº¦<code>binCount</code>å¤§äºç­‰äº
<code>TREEIFY_THRESHOLD</code> ä¸” <code>table</code> ä¸­ <code>bin</code>
æ•°é‡å¤§äºç­‰äº <code>MIN_TREEIFY_CAPACITY</code></li>
</ul>
<p>å¦‚æœé“¾è¡¨è½¬çº¢é»‘æ ‘çš„æ—¶å€™ï¼Œåˆæœ‰æ•°æ®è¦æ’å…¥ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>çº¿ç¨‹ä¸å®‰å…¨ã€‚åœ¨æ ‘ç»“æ„æ›¿æ¢é“¾è¡¨æœ€ç»ˆé˜¶æ®µä¼šæ ¡éªŒæ ‘ç»“æ„ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­çš„æ’å…¥ä¼šä½¿è¯¥æ ‘ç»“æ„ä¸æ»¡è¶³çº¢é»‘æ ‘å’ŒåŒé“¾è¡¨çš„ç‰¹æ€§ï¼Œå¯¼è‡´æŠ¥å¼‚å¸¸
<code>assert checkInvariants(root);</code></li>
</ul>
<h1 id="concurrenthashmap">ConcurrentHashMap</h1>
<blockquote>
<p>Java7 ä¸­ ConcurrentHashMap ä½¿ç”¨çš„æ˜¯åˆ†æ®µé”ï¼Œæ¯ä¸€ä¸ª Segment
ä¸ŠåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œï¼Œç»“æ„ä¸Šæ—¶ <code>Segment</code> <strong>æ•°ç»„
+</strong> <code>HashEntry</code> <strong>æ•°ç»„ +
é“¾è¡¨</strong>ã€‚<code>Segment</code>
çš„ä¸ªæ•°ä¸€æ—¦<strong>åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜</strong>ï¼Œé»˜è®¤ <code>Segment</code>
çš„ä¸ªæ•°æ˜¯ 16
ä¸ªï¼Œ<code>Segment</code>ç»§æ‰¿<code>ReentrantLock</code>å®ç°åˆ†æ®µé”ã€‚</p>
<p>Java8 ä¸­çš„ ConcurrentHashMap é€šè¿‡ <strong>Synchronized é”åŠ 
CAS</strong> ä¿è¯å¤šçº¿ç¨‹å®‰å…¨ï¼Œç»“æ„ä¸Šæ˜¯ <code>Node</code>
<strong>æ•°ç»„</strong> + <strong>é“¾è¡¨ / çº¢é»‘æ ‘</strong>ã€‚</p>
</blockquote>
<p>å¦‚æœé“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œåˆæœ‰æ•°æ®è¦æ’å…¥ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<ul>
<li><code>treeifyBin</code> é€šè¿‡ <code>synchronized</code> æŠŠ
<code>bin</code> åŠ é”ï¼Œåç»­æ•°æ®æ’å…¥ä¼šå› ä¸ºæ— æ³•ç«äº‰åˆ°èµ„æºè€Œé˜»å¡</li>
<li>é“¾è¡¨å¼€å§‹è½¬çº¢é»‘æ ‘å‰ï¼Œä¼šå°† Node å¤´èŠ‚ç‚¹ç½®ä¸º
<code>ForwardingNode</code>ï¼Œ<code>ForwardingNode</code> çš„ hash æ˜¯
<code>Moved</code>
è¡¨ç¤ºæ­£åœ¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæ­¤æ—¶ä¼šè‡ªæ—‹ç­‰å¾…è½¬æ¢å®Œæˆåæ’å…¥ï¼ˆå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼‰</li>
</ul>
<p>å¦‚æœæ•°ç»„æ‰©å®¹ï¼Œåˆæœ‰æ•°æ®è¦æ’å…¥ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<ul>
<li>æ‰©å®¹å‰ï¼Œä¼šå°† Node å¤´èŠ‚ç‚¹ç½®ä¸º
<code>ForwardingNode</code>ï¼Œ<code>ForwardingNode</code> çš„ hash æ˜¯
<code>Moved</code> è¡¨ç¤ºæ­£åœ¨æ‰©å®¹ã€‚</li>
<li>æ‰©å®¹æ—¶ï¼Œæ’å…¥æ•°æ®çš„çº¿ç¨‹è‹¥å‘ç° hash
å€¼ä¸ºè´Ÿï¼Œä¼šå»ååŠ©æ‰©å®¹ï¼Œæ‰©å®¹å®Œæˆåå†æ’å…¥æ•°æ®ã€‚</li>
</ul>
<p><a
href="https://blog.csdn.net/ZOKEKAI/article/details/90051567"><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘æ‰©å®¹ï¼Ÿ</strong></a></p>
<ul>
<li>åœ¨è°ƒç”¨ addCount
æ–¹æ³•å¢åŠ é›†åˆå…ƒç´ è®¡æ•°åå‘ç°å½“å‰é›†åˆå…ƒç´ ä¸ªæ•°åˆ°è¾¾æ‰©å®¹é˜ˆå€¼æ—¶å°±ä¼šè§¦å‘æ‰©å®¹</li>
<li>æ‰©å®¹çŠ¶æ€ä¸‹å…¶ä»–çº¿ç¨‹å¯¹é›†åˆè¿›è¡Œæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ã€åˆå¹¶ã€compute
ç­‰æ“ä½œæ—¶é‡åˆ° <code>ForwardingNode</code> èŠ‚ç‚¹ä¼šè§¦å‘æ‰©å®¹ï¼ˆå¸®åŠ©æ‰©å®¹ï¼‰</li>
<li>putAll æ‰¹é‡æ’å…¥æˆ–è€…æ’å…¥èŠ‚ç‚¹åå‘ç°å­˜åœ¨é“¾è¡¨é•¿åº¦è¾¾åˆ° 8
ä¸ªæˆ–ä»¥ä¸Šï¼Œä½†æ•°ç»„é•¿åº¦ä¸º 64 ä»¥ä¸‹æ—¶ä¼šè§¦å‘æ‰©å®¹ ã€‚</li>
</ul>
<p>åŒ HashMapï¼šæ¡¶ä¸Šé“¾è¡¨é•¿åº¦è¾¾åˆ° 8 ä¸ªæˆ–è€…ä»¥ä¸Šï¼Œå¹¶ä¸”æ•°ç»„é•¿åº¦ä¸º 64
ä»¥ä¸‹æ—¶åªä¼šè§¦å‘æ‰©å®¹è€Œä¸ä¼šå°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘</p>
<h1 id="linkedhashmap">LinkedHashMap</h1>
<p><code>LinkedHashMap</code>
å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç¡®ä¿å…¶è¿­ä»£é¡ºåºæ˜¯å’Œæ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œé€šè¿‡é‡å†™
getã€newNodeã€afterNodeAccessã€afterNodeInsertionã€afterNodeRemoval
ç­‰æ–¹æ³•å®ç°ï¼Œæœ€è¿‘æ’å…¥æˆ–è®¿é—®çš„èŠ‚ç‚¹ä½äºé“¾è¡¨å°¾éƒ¨ã€‚</p>
<blockquote>
<p>å¯ä»¥æŒ‰ç…§æ’å…¥é¡ºåºéå† entryï¼ˆaccessOrder=falseï¼‰</p>
<p>ä¹Ÿå¯ä»¥æŒ‰ç…§è®¿é—®é¡ºåºéå† entryï¼ˆaccessOrder=trueï¼‰ï¼Œå³ LRU</p>
</blockquote>
<p>å¯ç”¨äºå®ç° LRUï¼Œå³ è¿­ä»£é¡ºåº==è®¿é—®é¡ºåº</p>
<ul>
<li>æ¯æ¬¡ä¿®æ”¹éƒ½å°†å…ƒç´ åˆ é™¤åé‡æ–°æ’å…¥</li>
<li>å°† <code>accessOrder</code> è®¾ç½®ä¸º true å¹¶é‡å†™
<code>removeEldestEntry</code> æ–¹æ³•å½“é“¾è¡¨å¤§å°è¶…è¿‡å®¹é‡æ—¶è¿”å› true</li>
</ul>
<h1 id="copyonwritelist">CopyOnWriteList</h1>
<blockquote>
<p>å¹¶å‘å®‰å…¨çš„
<code>List</code>ï¼Œé’ˆå¯¹è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œç±»æ¯”è¯»å†™é”çš„æ€æƒ³ï¼Œå®ç°
<strong>è¯»è¯»ä¸äº’æ–¥ã€è¯»å†™ä¸äº’æ–¥ã€å†™å†™äº’æ–¥</strong> çš„å†™æ—¶å¤åˆ¶
Copy-On-Write ç­–ç•¥ã€‚æ­¤å¤–è¿˜æœ‰ <code>Collections.synchronizedList</code>
ï¼Œå¯ä»¥å°†ä»»ä½•<code>List</code>åŒ…è£…æˆä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„<code>List</code></p>
</blockquote>
<p>add æ–¹æ³•å†…éƒ¨ç”¨åˆ°äº† ReentrantLock
åŠ é”ï¼Œé¿å…äº†å¤šçº¿ç¨‹å†™çš„æ—¶å€™ä¼šå¤åˆ¶å‡ºå¤šä¸ªå‰¯æœ¬ï¼Œå¯¼è‡´å¹¶å‘é—®é¢˜</p>
<p><strong>å†™æ—¶å¤åˆ¶çš„ç¼ºç‚¹</strong></p>
<ul>
<li>å†™æ“ä½œèµ„æºå ç”¨å¤šï¼Œå¤åˆ¶æ•°æ®æ—¶å ç”¨å†…å­˜</li>
<li>æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¿®æ”¹åéœ€è¦ç­‰åˆ°èµ‹å€¼ç»™åŸæ•°ç»„æ‰èƒ½è®¿é—®åˆ°ä¿®æ”¹</li>
</ul>
<p><strong>å†™å¤šè¯»å°‘çš„åœºæ™¯ä¸‹ï¼Œåº”è¯¥ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å®ç°å¹¶å‘æ•°ç»„ï¼Ÿ</strong></p>
<p>åˆ†æ®µè¯»å†™é” ReadWriteLockï¼ˆç”±äº Arrays.copyOf()
æ˜¯æ“ä½œç³»ç»Ÿå®ç°ï¼Œæ•°æ®é‡å°‘çš„è¯ä¾ç„¶å¯ç”¨å†™æ—¶å¤åˆ¶ï¼‰</p>
<h1 id="priorityqueue">PriorityQueue</h1>
]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Javaæ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis</title>
    <url>/#developer/Redis/</url>
    <content><![CDATA[<p>Redis çš„ç‰¹æ€§ï¼šå•çº¿ç¨‹ã€åŸå­æ€§ã€åŸºäºå†…å­˜ã€ä¼˜åŒ–æ•°æ®ç»“æ„ã€I/O
å¤šè·¯å¤ç”¨çš„éå…³ç³»å‹æ•°æ®åº“ï¼›</p>
<p>6.0 ç‰ˆæœ¬å‰ç½‘ç»œ I/O å’Œå‘½ä»¤å¤„ç†éƒ½æ˜¯å•çº¿ç¨‹ï¼Œ6.0 ç‰ˆæœ¬åç½‘ç»œ I/O
æ”¹ç”¨å¤šä¸ªçº¿ç¨‹å¤„ç†</p>
<ul>
<li>å¤§éƒ¨åˆ†æ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼ˆåˆ¶çº¦ Redis æ€§èƒ½çš„ç“¶é¢ˆå¹¶ä¸æ˜¯
CPUï¼Œè€Œæ˜¯å†…å­˜å’Œç½‘ç»œå¸¦å®½ï¼‰</li>
<li>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰</li>
<li>I/O å¤šè·¯å¤ç”¨æœºåˆ¶</li>
</ul>
<h1 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</h1>
<p>5
ç§åŸºç¡€æ•°æ®ç±»å‹ï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰
3 ç§ç‰¹æ®Šæ•°æ®ç±»å‹ï¼šHyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ã€Bitmap ï¼ˆä½å›¾ï¼‰ã€Geospatial
(åœ°ç†ä½ç½®)</p>
<h1 id="æŒä¹…åŒ–">æŒä¹…åŒ–</h1>
<p>ä¿è¯å³ä½¿åœ¨æœåŠ¡å™¨é‡å¯çš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®ï¼ˆæˆ–å°‘é‡æŸå¤±ï¼‰</p>
<h2 id="aof-æ—¥å¿—">AOF æ—¥å¿—</h2>
<p>å°†æ¯æ¡æ‰§è¡ŒæˆåŠŸçš„<strong>å†™æ“ä½œå‘½ä»¤</strong>è¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼ŒæŒä¹…åŒ–ä»£ç å‘½ä»¤åœ¨ä¸»è¿›ç¨‹ä¸Šæ‰§è¡Œ</p>
<p>å†™å›ç­–ç•¥ï¼ˆé˜²æ­¢AOFæ—¥å¿—åœ¨æŒä¹…åŒ–è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼‰ï¼š</p>
<style>.ejkogftbvwzo{zoom:67%;}</style>
<img data-src="/" class="ejkogftbvwzo" alt="img">
<p>é‡å†™æœºåˆ¶ï¼ˆé˜²æ­¢AOFæ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼‰ï¼š</p>
<ul>
<li><p>åˆ å»å·²ç»æ— æ„ä¹‰çš„æ—¥å¿—ï¼›</p></li>
<li><p>é‡å†™æ“ä½œç”±åå°å­è¿›ç¨‹å®Œæˆï¼Œå­è¿›ç¨‹å…±äº«çˆ¶è¿›ç¨‹å†…å­˜ï¼ˆä¸ºä»€ä¹ˆä¸ç”¨çº¿ç¨‹ï¼Ÿçˆ¶å­è¿›ç¨‹ä»¥åªè¯»çš„æ–¹å¼å…±äº«æ•°æ®ï¼Œå¦‚æœä»»æ„ä¸€æ–¹ä¿®æ”¹äº†è¯¥å…±äº«å†…å­˜ï¼Œçˆ¶å­è¿›ç¨‹ä¼šæœ‰ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ï¼Œå³<strong>å†™æ—¶å¤åˆ¶</strong>ï¼Œæ³¨æ„è¿™é‡Œåªä¼šå¤åˆ¶ä¸»è¿›ç¨‹ä¿®æ”¹çš„ç‰©ç†å†…å­˜æ•°æ®ï¼Œæ²¡ä¿®æ”¹ç‰©ç†å†…å­˜è¿˜æ˜¯ä¸å­è¿›ç¨‹å…±äº«çš„ã€‚è€Œçº¿ç¨‹å…±äº«å†…å­˜éœ€è¦åŠ é”ï¼‰ï¼›</p></li>
<li><p>AOF
é‡å†™ç¼“å†²åŒºç”¨äºä¿å­˜é‡å†™å­è¿›ç¨‹å¯åŠ¨åï¼Œæ–°äº§ç”Ÿçš„AOFæ—¥å¿—ï¼Œå¹¶åœ¨é‡å†™ç»“æŸåè¿½åŠ åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­ï¼›</p></li>
</ul>
<h2 id="rdb-å¿«ç…§">RDB å¿«ç…§</h2>
<p>æŸä¸€æ—¶åˆ»å†…å­˜æ•°æ®çš„å¿«ç…§ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œæ¢å¤æ—¶ç›´æ¥è¯»å…¥å†…å­˜å³å¯</p>
<p>æ‰§è¡Œ bgsave æ—¶ï¼Œæƒ³è¦ä¿®æ”¹æ•°æ®ï¼Œéœ€é‡‡ç”¨<a
href="https://xiaolincoding.com/redis/storage/rdb.html#%E6%89%A7%E8%A1%8C%E5%BF%AB%E7%85%A7%E6%97%B6-%E6%95%B0%E6%8D%AE%E8%83%BD%E8%A2%AB%E4%BF%AE%E6%94%B9%E5%90%97">å†™æ—¶å¤åˆ¶</a>ï¼ˆCopy-On-Write,
COWï¼‰ï¼Œä»¥å‡å°‘æ€§èƒ½æŸè€—</p>
<h2 id="æ··åˆæŒä¹…åŒ–">æ··åˆæŒä¹…åŒ–</h2>
<p>åœ¨AOFæ—¥å¿—é‡å†™è¿‡ç¨‹ä¸­ï¼Œå°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF
æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ï¼Œå‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF
æ ¼å¼çš„å¢é‡æ•°æ®ï¼Œå³é‡å†™ç¼“å†²åŒºæ•°æ®ã€‚</p>
<h1 id="ç­–ç•¥">ç­–ç•¥</h1>
<h2 id="è¿‡æœŸåˆ é™¤ç­–ç•¥">è¿‡æœŸåˆ é™¤ç­–ç•¥</h2>
<p>æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤</p>
<h2 id="å†…å­˜æ·˜æ±°ç­–ç•¥">å†…å­˜æ·˜æ±°ç­–ç•¥</h2>
<p>ä»…æ·˜æ±°è¿‡æœŸæ•°æ®ï¼šrandomã€ttlã€lruã€lfu</p>
<p>æ·˜æ±°æ‰€æœ‰æ•°æ®ï¼šlruã€lfu</p>
<h1 id="é«˜å¯ç”¨">é«˜å¯ç”¨</h1>
<h2 id="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</h2>
<p>æ¨¡å¼ä¸€ï¼šå…¨é‡å¤åˆ¶ã€å¤šç”¨äºåˆå§‹åŒ–ã€‘</p>
<img data-src="/" class="" title="å›¾ç‰‡">
<ul>
<li>bgsave å‘½ä»¤åˆ›å»ºå­è¿›ç¨‹æ¥åšç”Ÿæˆ RDB æ–‡ä»¶çš„å·¥ä½œï¼Œæ˜¯å¼‚æ­¥å·¥ä½œçš„</li>
</ul>
<p>ä¸ºäº†é¿å…è¿‡å¤šçš„ä»æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨è¿›è¡Œæ•°æ®åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰ï¼Œå¯ä»¥æŠŠä¸€éƒ¨åˆ†ä»æœåŠ¡å™¨å‡çº§æˆåˆ†å‘èŠ‚ç‚¹ï¼Œåˆ©ç”¨ä»èŠ‚ç‚¹åˆ†æ‹…è¯»å–æ“ä½œçš„å‹åŠ›</p>
<p>æ¨¡å¼äºŒï¼šåŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­ã€å¤šç”¨äºä¿æŒåŒæ­¥ã€‘</p>
<p>ä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡åŒæ­¥åï¼ŒåŒæ–¹ä¹‹é—´å°±ä¼šç»´æŠ¤ä¸€ä¸ª TCP
è¿æ¥ï¼Œä¿è¯ç¬¬ä¸€æ¬¡åŒæ­¥åçš„ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p>æ¨¡å¼ä¸‰ï¼š<strong>è¿æ¥æ¢å¤</strong>æ—¶å¯ä»¥é‡‡ç”¨<strong>å¢é‡å¤åˆ¶</strong>ï¼šrepl_backlog_buffer
ç¯å½¢ç¼“å†²åŒºä¿å­˜äº†æœ€è¿‘ä¼ æ’­çš„å†™å‘½ä»¤ï¼Œè‹¥å…¶ä¸­å­˜ç€ä»æœåŠ¡å™¨è¯·æ±‚çš„
offsetï¼Œå°±é‡‡ç”¨å¢é‡å¤åˆ¶ï¼›å¦åˆ™é‡‡ç”¨<strong>å…¨é‡å¤åˆ¶</strong>ã€‚è‹¥æƒ³é™ä½ä¸»ä»æœåŠ¡å™¨æ–­å¼€åå…¨é‡åŒæ­¥çš„æ¦‚ç‡ï¼Œéœ€è¦å¢å¤§
repl_backlog_buffer</p>
<h3 id="qa">QA</h3>
<p><strong>å¦‚ä½•åº”å¯¹å¼‚æ­¥å¤åˆ¶å¯¼è‡´çš„ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Ÿ</strong></p>
<p>å¤–éƒ¨ç¨‹åºæ¥ç›‘æ§ä¸»ä»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦</p>
<p><strong>ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</strong></p>
<ul>
<li>è®¾ç½®å¤åˆ¶å»¶è¿Ÿé™åˆ¶ <code>min-slaves-max-lag</code></li>
<li>å®¢æˆ·ç«¯é™çº§æªæ–½ï¼Œå½“ master ä¸å¯å†™ï¼Œå°±æŠŠæ•°æ®å­˜åˆ°æœ¬åœ°æˆ– kafka
ä¸­ç­‰å¾…ä¸»èŠ‚ç‚¹æ­£å¸¸åå†æ¶ˆè´¹</li>
</ul>
<p><strong>é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±</strong></p>
<p>ä¸»èŠ‚ç‚¹å¿…é¡»è¦æœ‰è‡³å°‘ <code>min-slaves-to-write</code>
ä¸ªä»èŠ‚ç‚¹è¿æ¥ï¼Œä¸»ä»æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡
<code>min-slaves-max-lag</code>
ç§’ã€‚å¦åˆ™åŸä¸»èŠ‚ç‚¹å°±ä¼šè¢«é™åˆ¶æ¥æ”¶å®¢æˆ·ç«¯å†™è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±ä¸èƒ½åœ¨åŸä¸»èŠ‚ç‚¹ä¸­å†™å…¥æ–°æ•°æ®ï¼Œç­‰åˆ°æ–°çš„ä¸»èŠ‚ç‚¹ä¸Šçº¿ä¸€åˆ‡æ¢å¤æ­£å¸¸ã€‚</p>
<h2 id="å“¨å…µæœºåˆ¶">å“¨å…µæœºåˆ¶</h2>
<blockquote>
<p>è‡ªåŠ¨å®Œæˆæ•…éšœå‘ç°å’Œæ•…éšœè½¬ç§»ï¼Œå¹¶é€šçŸ¥ç»™åº”ç”¨æ–¹ï¼Œä»è€Œå®ç°é«˜å¯ç”¨æ€§</p>
</blockquote>
<p>å“¨å…µä¹‹é—´å»ºç«‹è¿æ¥</p>
<style>.usnrkisdvnhw{zoom:50%;}</style>
<img data-src="/" class="usnrkisdvnhw" alt="img">
<p>å“¨å…µä¸ä»èŠ‚ç‚¹å»ºç«‹è¿æ¥</p>
<style>.bbjnpmftewse{zoom:50%;}</style>
<img data-src="/" class="bbjnpmftewse" alt="img">
<h3 id="ç¬¬ä¸€è½®æŠ•ç¥¨åˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿">ç¬¬ä¸€è½®æŠ•ç¥¨ï¼šåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿</h3>
<p>ä¸»è§‚ä¸‹çº¿ï¼šä¸»èŠ‚ç‚¹æˆ–è€…ä»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤</p>
<p>å®¢è§‚ä¸‹çº¿ï¼šä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œä¸»è§‚ä¸‹çº¿ã€åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œé€šè¿‡å¤šä¸ªå“¨å…µèŠ‚ç‚¹ä¸€èµ·åˆ¤æ–­ä¸»èŠ‚ç‚¹æ˜¯å¦ä¸‹çº¿ã€‚å“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„
quorum é…ç½®é¡¹è®¾å®šçš„å€¼åˆ™åˆ¤æ–­ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿</p>
<h3 id="ç¬¬äºŒè½®æŠ•ç¥¨é€‰å‡ºå“¨å…µ-leader">ç¬¬äºŒè½®æŠ•ç¥¨ï¼šé€‰å‡ºå“¨å…µ leader</h3>
<ul>
<li>å“ªä¸ªå“¨å…µèŠ‚ç‚¹åˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ï¼Œè¿™ä¸ªå“¨å…µèŠ‚ç‚¹å°±æ˜¯å€™é€‰è€…ï¼Œæ‰€è°“çš„å€™é€‰è€…å°±æ˜¯æƒ³å½“
Leader çš„å“¨å…µã€‚</li>
<li>å€™é€‰è€…ä¼šå‘å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›æˆä¸º Leader
æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µå¯¹å®ƒè¿›è¡ŒæŠ•ç¥¨ã€‚Raft ç®—æ³•é€‰æ‹©å“¨å…µ Leaderï¼š
<ul>
<li>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›</li>
<li>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</li>
</ul></li>
</ul>
<h3 id="ç”±å“¨å…µ-leader-è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»">ç”±å“¨å…µ leader
è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»</h3>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šåœ¨å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹ï¼ˆæ—§ä¸»èŠ‚ç‚¹ï¼‰å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€é‡Œé¢ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œé€‰æ‹©çš„è§„åˆ™ï¼š
<ul>
<li>è¿‡æ»¤æ‰å·²ç»ç¦»çº¿çš„ä»èŠ‚ç‚¹ï¼›</li>
<li>è¿‡æ»¤æ‰å†å²ç½‘ç»œè¿æ¥çŠ¶æ€ä¸å¥½çš„ä»èŠ‚ç‚¹ï¼›</li>
<li>å°†å‰©ä¸‹çš„ä»èŠ‚ç‚¹ï¼Œè¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID
å·ã€‚åœ¨æ¯ä¸€è½®è€ƒå¯Ÿè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªèƒœå‡ºçš„ä»èŠ‚ç‚¹ï¼Œå°±å°†å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</li>
</ul></li>
<li>ç¬¬äºŒæ­¥ï¼šè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€ä¿®æ”¹å¤åˆ¶ç›®æ ‡ï¼Œä¿®æ”¹ä¸ºå¤åˆ¶ã€Œæ–°ä¸»èŠ‚ç‚¹ã€ï¼›</li>
<li>ç¬¬ä¸‰æ­¥ï¼šå°†æ–°ä¸»èŠ‚ç‚¹çš„ IP
åœ°å€å’Œä¿¡æ¯ï¼Œé€šè¿‡ã€Œå‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ã€é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼›</li>
<li>ç¬¬å››æ­¥ï¼šç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li>
</ul>
<h2 id="é›†ç¾¤">é›†ç¾¤</h2>
<img data-src="/" class="" title="img">
<ul>
<li>åŒä¸€ä¸ªåˆ†åŒºå†…çš„ Redis
èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å®Œå…¨ä¸€æ ·ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¿è¯äº†æ•°æ®æœ‰å¤šä»½å‰¯æœ¬å†—ä½™ä¿å­˜ï¼Œä¸”å¯ä»¥æä¾›é«˜å¯ç”¨ä¿éšœï¼›</li>
<li>ä¸åŒåˆ†ç‰‡ä¹‹é—´çš„æ•°æ®ä¸ç›¸åŒï¼›</li>
<li>é€šè¿‡æ°´å¹³å¢åŠ å¤šä¸ªåˆ†ç‰‡çš„æ–¹å¼ï¼Œå¯ä»¥å®ç°æ•´ä½“é›†ç¾¤å®¹é‡çš„æ‰©å±•ï¼›</li>
</ul>
<h3 id="é›†ç¾¤æ•°æ®åˆ†å¸ƒç­–ç•¥">é›†ç¾¤æ•°æ®åˆ†å¸ƒç­–ç•¥</h3>
<p><strong>Hash æ§½</strong></p>
<ul>
<li>åˆ‡ç‰‡ slot æ§½ï¼Œå…±æœ‰16384ä¸ªæ§½ä½ï¼›</li>
<li>æ•°æ® key é€šè¿‡ â€œCRC16 ç®—æ³• + 16384 å–æ¨¡â€ï¼Œå¾—åˆ°å¯¹åº”å­˜å‚¨çš„å“ˆå¸Œæ§½ï¼›</li>
<li>æ•°æ®å­˜å‚¨åœ¨è¯¥æ§½ä½å¯¹åº”çš„ Redis
åˆ†åŒºä¸­ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰ç‹¬ç«‹çš„ä¸»ä»å“¨å…µä¿è¯é«˜å¯ç”¨ï¼›</li>
</ul>
<p><strong>ä¸€è‡´æ€§Hash</strong></p>
<p>è™šæ‹ŸèŠ‚ç‚¹</p>
<h1 id="ç¼“å­˜">ç¼“å­˜</h1>
<h2 id="ç¼“å­˜é›ªå´©å‡»ç©¿ç©¿é€">ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€</h2>
<p>ç¼“å­˜ç©¿é€ï¼šå¤§é‡è¯·æ±‚äº†ç¼“å­˜å’Œæ•°æ®åº“é‡Œéƒ½æ²¡æœ‰çš„æ•°æ®ï¼Œè¯·æ±‚ç©¿é€ç¼“å­˜å’Œæ•°æ®åº“</p>
<ul>
<li>å‚æ•°æ ¡éªŒï¼šå‚æ•°ä¸åˆæ³•ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li>
<li>ç¼“å­˜æ— æ•ˆ keyï¼šé€‚ç”¨äº key å˜åŒ–ä¸é¢‘ç¹</li>
<li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šæ ¡éªŒ Key
æ˜¯å¦åˆæ³•ï¼ˆæœ‰è¯¯å·®ï¼Œå¯èƒ½ä¼šæŠŠæœªå­˜çš„å€¼å½“ä½œå·²æœ‰ï¼Œå³ä¸åˆæ³•çš„ key
å½“ä½œåˆæ³•çš„ï¼‰</li>
<li>æ¥å£é™æµï¼šå›ºå®šçª—å£ç®—æ³•ã€æ»‘åŠ¨çª—å£ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•</li>
</ul>
<p>ç¼“å­˜å‡»ç©¿ï¼šç¬é—´å¤§é‡è¯·æ±‚æœªç¼“å­˜çš„æ•°æ®åº“æ•°æ®ï¼Œè¯·æ±‚å‡»ç©¿ç¼“å­˜ç›´æ¥æ‰“åˆ°æ•°æ®åº“ä¸Š</p>
<ul>
<li>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸæˆ–è¿‡æœŸæ—¶é—´é•¿</li>
<li>é¢„çƒ­çƒ­ç‚¹æ•°æ®ï¼šå®šæ—¶ä»»åŠ¡é¢„çƒ­ï¼ˆå®šæ—¶è§¦å‘ç¼“å­˜é¢„çƒ­çš„é€»è¾‘ï¼Œå°†æ•°æ®åº“ä¸­çš„çƒ­ç‚¹æ•°æ®æŸ¥è¯¢å‡ºæ¥å¹¶å­˜å…¥ç¼“å­˜ä¸­ï¼‰ã€kafka
å¼‚æ­¥é¢„çƒ­ï¼ˆå°†æ•°æ®åº“ä¸­çš„çƒ­ç‚¹æ•°æ®çš„ä¸»é”®æˆ–è€… ID
å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±ç¼“å­˜æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œæ ¹æ®ä¸»é”®æˆ–è€… ID
æŸ¥è¯¢æ•°æ®åº“å¹¶æ›´æ–°ç¼“å­˜ï¼‰</li>
<li>è®¿é—®æ•°æ®åº“äº’æ–¥é”</li>
</ul>
<p>ç¼“å­˜é›ªå´©ï¼šç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Š</p>
<ul>
<li>Redis é›†ç¾¤</li>
<li>é™æµ</li>
<li>å¤šçº§ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜+Redis</li>
<li>çƒ­ç‚¹æ•°æ®å¤±æ•ˆæ—¶é—´é•¿</li>
<li>é¢„çƒ­çƒ­ç‚¹æ•°æ®</li>
</ul>
<h2 id="å¦‚ä½•ä¿è¯æ•°æ®åº“å’Œç¼“å­˜ä¸€è‡´æ€§">å¦‚ä½•ä¿è¯æ•°æ®åº“å’Œç¼“å­˜ä¸€è‡´æ€§</h2>
<blockquote>
<p>é‡‡ç”¨ Cache Aside
æ—è·¯ç¼“å­˜ç­–ç•¥ï¼šä»¥æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ºå‡†ï¼Œç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æŒ‰éœ€åŠ è½½çš„ï¼›ç¼ºç‚¹ï¼šæ•°æ®å†™å…¥é¢‘ç¹æ—¶ï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹çš„æ¸…ç†ï¼Œé™ä½ç¼“å­˜å‘½ä¸­ç‡ï¼›</p>
</blockquote>
<p>æ›´æ–°æ•°æ®åº“+åˆ é™¤ç¼“å­˜ï¼šå»¶è¿ŸåŒåˆ </p>
<p>æ›´æ–°æ•°æ®åº“+æ›´æ–°ç¼“å­˜ï¼šåˆ†å¸ƒå¼é”</p>
<p>æ›´æ–°æ•°æ®åº“+ä¸æ›´æ–°ç¼“å­˜ï¼šè¾ƒçŸ­çš„ç¼“å­˜æœ‰æ•ˆæœŸ</p>
<p><strong>åˆ é™¤ç¼“å­˜çš„æ—¶å€™å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p>é‡‡ç”¨å¼‚æ­¥åˆ é™¤ï¼š</p>
<ul>
<li>æ¶ˆæ¯é˜Ÿåˆ—ç¡®ä¿ç¼“å­˜åˆ é™¤æˆåŠŸ</li>
<li>è®¢é˜… MySQL çš„ binlogï¼Œæ•°æ®ä¿®æ”¹æ—¶åˆ é™¤ç¼“å­˜</li>
</ul>
<h2 id="ç¼“å­˜é¢„çƒ­">ç¼“å­˜é¢„çƒ­</h2>
<p>æé«˜è®¿é—®é€Ÿåº¦ï¼Œå¹³æ»‘æµé‡å³°å€¼ï¼Œå‡å°‘åç«¯å‹åŠ›ï¼Œä¿è¯æ•°æ®çš„æ—¶æ•ˆæ€§</p>
<p>Redis ç¼“å­˜é¢„çƒ­çš„æ–¹æ³•ï¼šç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½ï¼›å®šæ—¶ä»»åŠ¡åŠ è½½ï¼›</p>
<h1 id="å®æˆ˜">å®æˆ˜</h1>
<h2 id="åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</h2>
<blockquote>
<p>Redis + Lua
è„šæœ¬ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œä¸€ç»„å‘½ä»¤ï¼Œå¯ç”¨äºä¿è¯é”é‡Šæ”¾æ“ä½œçš„åŸå­æ€§ï¼ˆLua
è„šæœ¬åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«ä»»æ„å…¶å®ƒè¯·æ±‚æ‰“æ–­ï¼‰ï¼Œä½†æ— æ³•ç”¨äºäº‹åŠ¡æ‰§è¡Œå¤±è´¥çš„å›æ»šã€‚Redisson
é‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ–¹æ³•ä¿è¯åˆ†å¸ƒå¼é”çš„åŸå­æ€§ã€‚</p>
</blockquote>
<p><strong>SET å‘½ä»¤çš„ NX å‚æ•°</strong>å¯ä»¥å®ç°ï¼škey
ä¸å­˜åœ¨æ‰æ’å…¥ï¼Œå¯ä»¥ç”¨äºå®ç°åˆ†å¸ƒå¼é”</p>
<p>ä¼˜ç‚¹ï¼šæ€§èƒ½é«˜æ•ˆã€å®ç°æ–¹ä¾¿ã€åˆ†å¸ƒå¼é«˜å¯ç”¨</p>
<p>ç¼ºç‚¹ï¼šä¸å¥½è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆè§£å†³æ–¹æ³•ï¼šå®ˆæŠ¤çº¿ç¨‹å®šæœŸç»­çº¦ï¼‰ã€ä¸»ä»å¼‚æ­¥å¤åˆ¶å¯èƒ½å¯¼è‡´ä¸å¯é æ€§ï¼ˆè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼‰</p>
<p>æé«˜å¯é æ€§ï¼ˆRedlock ç®—æ³•ï¼‰ï¼šå®¢æˆ·ç«¯å’Œå¤šä¸ªç‹¬ç«‹çš„ Redis
èŠ‚ç‚¹ä¾æ¬¡è¯·æ±‚ç”³è¯·åŠ é”ï¼Œå¦‚æœå®¢æˆ·ç«¯èƒ½å¤Ÿå’ŒåŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹æˆåŠŸåœ°å®ŒæˆåŠ é”æ“ä½œï¼Œé‚£ä¹ˆå°±è®¤ä¸ºï¼Œå®¢æˆ·ç«¯æˆåŠŸåœ°è·å¾—åˆ†å¸ƒå¼é”ï¼Œå¦åˆ™åŠ é”å¤±è´¥ï¼Œæ‰€æœ‰çš„
redis å®ä¾‹éƒ½ä¼šè¿›è¡Œè§£é”ï¼›</p>
<ul>
<li>å•æœºçš„ redis æ˜¯ cp çš„ï¼Œä½†æ˜¯é›†ç¾¤æƒ…å†µä¸‹ redis æ˜¯ ap çš„ï¼Œæ‰€ä»¥è¿è¡Œ
Redisson
çš„èŠ‚ç‚¹å¿…é¡»æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä¸èƒ½æœ‰ä»èŠ‚ç‚¹ï¼Œé˜²æ­¢ä¸»èŠ‚ç‚¹åŠ é”æˆåŠŸæœªåŒæ­¥ä»èŠ‚ç‚¹å°±å®•æœºï¼Œè€Œå®¢æˆ·ç«¯å´æ”¶åˆ°åŠ é”æˆåŠŸï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redisson;</span><br></pre></td></tr></table></figure>
<h2 id="å»¶è¿Ÿé˜Ÿåˆ—">å»¶è¿Ÿé˜Ÿåˆ—</h2>
<p>æœ‰åºé›†åˆ Zsetï¼›score å­˜å‚¨å»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´</p>
<h2 id="å¤§-key-é—®é¢˜">å¤§ Key é—®é¢˜</h2>
<p>ä¼šå¯¼è‡´çš„é—®é¢˜</p>
<ul>
<li>ç”±äº Redis å•çº¿ç¨‹å¤„ç†ï¼Œå¤§ Key
çš„å¢åˆ æ”¹æŸ¥éƒ½å¾ˆè€—æ—¶ï¼Œä¼šå¯¼è‡´<strong>å·¥ä½œçº¿ç¨‹é˜»å¡ã€å®¢æˆ·å“åº”è¶…æ—¶ã€ç½‘ç»œä¼ è¾“é˜»å¡</strong>ï¼›</li>
<li><strong>å†…å­˜åˆ†å¸ƒä¸å‡</strong>ï¼Œé›†ç¾¤åœºæ™¯ä¸‹ slot æ§½æ•°æ®é‡ä¸å‡ï¼›</li>
<li><strong>æŒä¹…åŒ–é˜»å¡ä¸»çº¿ç¨‹</strong>ï¼Œä¼šä¸»çº¿ç¨‹çš„ä¸¤ä¸ªé˜¶æ®µè€—æ—¶å¢åŠ ï¼šåˆ›å»ºå­è¿›ç¨‹å¤åˆ¶é¡µè¡¨ç»“æ„ã€ä¿®æ”¹å…±äº«æ•°æ®å†™æ—¶å¤åˆ¶ï¼›</li>
</ul>
<p>è§£å†³åŠæ³•</p>
<ul>
<li>æ‹†åˆ†å¤§ keyï¼›</li>
<li>åŠæ—¶/å®šæ—¶æ¸…ç†å¤§ keyï¼Œunlink å¼‚æ­¥åˆ é™¤ä»£æ›¿ del åŒæ­¥åˆ é™¤ï¼›</li>
</ul>
<h2 id="å‘å¸ƒè€…è®¢é˜…è€…">å‘å¸ƒè€…/è®¢é˜…è€…</h2>
<blockquote>
<p>è®¢é˜…å‘½ä»¤ï¼šsubscribe channel [channel ... ]</p>
</blockquote>
<style>.jygtvscafyvb{zoom:40%;}</style>
<img data-src="/" class="jygtvscafyvb" alt="img">
<p><a
href="https://blog.csdn.net/w15558056319/article/details/121490953">Link</a></p>
<h2 id="äº‹åŠ¡å›æ»š">äº‹åŠ¡å›æ»š</h2>
<p>Redis ä¸æ”¯æŒå›æ»šï¼Œäº‹åŠ¡æ²¡æœ‰åŸå­æ€§ï¼ˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼‰</p>
<h2 id="ç®¡é“">ç®¡é“</h2>
<p>æ‰¹å¤„ç†æŠ€æœ¯ï¼Œå¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ª Redis
å‘½ä»¤ï¼Œå‡å°‘å¤šä¸ªå‘½ä»¤æ‰§è¡Œæ—¶çš„ç½‘ç»œç­‰å¾…</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL</title>
    <url>/#developer/MySQL/</url>
    <content><![CDATA[<h1 id="åŸºç¡€">åŸºç¡€</h1>
<h2 id="sql-æŸ¥è¯¢è¯­å¥æ‰§è¡Œè¿‡ç¨‹">SQL æŸ¥è¯¢è¯­å¥æ‰§è¡Œè¿‡ç¨‹</h2>
<ul>
<li>è¿æ¥å™¨ï¼šå®¢æˆ·ç«¯ä¸ Server å±‚å»ºç«‹è¿æ¥ï¼Œç®¡ç†è¿æ¥ã€æ ¡éªŒç”¨æˆ·èº«ä»½ï¼›</li>
<li>æŸ¥è¯¢ç¼“å­˜ï¼šæŸ¥è¯¢è¯­å¥å¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼ˆMySQL
8.0 å·²åˆ é™¤è¯¥æ¨¡å—ï¼‰</li>
<li>è§£æ SQLï¼šé€šè¿‡è§£æå™¨å¯¹ SQL
æŸ¥è¯¢è¯­å¥è¿›è¡Œ<strong>è¯æ³•åˆ†æ</strong>ã€<strong>è¯­æ³•åˆ†æ</strong>ï¼Œç„¶å<strong>æ„å»ºè¯­æ³•æ ‘</strong>ï¼Œæ–¹ä¾¿åç»­æ¨¡å—è¯»å–è¡¨åã€å­—æ®µã€è¯­å¥ç±»å‹ï¼›</li>
<li>æ‰§è¡Œ SQLï¼š
<ul>
<li>é¢„å¤„ç†é˜¶æ®µï¼šæ£€æŸ¥è¡¨æˆ–å­—æ®µæ˜¯å¦å­˜åœ¨ï¼›å°† select * ä¸­çš„ *
ç¬¦å·æ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ï¼›</li>
<li>ä¼˜åŒ–é˜¶æ®µï¼šåŸºäºæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œ
é€‰æ‹©æŸ¥è¯¢æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼›æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼›</li>
<li>æ‰§è¡Œé˜¶æ®µï¼šæ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡Œ SQL
æŸ¥è¯¢è¯­å¥ï¼Œä»å­˜å‚¨å¼•æ“è¯»å–è®°å½•ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li>
</ul></li>
</ul>
<h2 id="mysql-æ•°æ®æ–‡ä»¶">MySQL æ•°æ®æ–‡ä»¶</h2>
<ul>
<li>db.optï¼Œç”¨æ¥å­˜å‚¨å½“å‰æ•°æ®åº“çš„é»˜è®¤å­—ç¬¦é›†å’Œå­—ç¬¦æ ¡éªŒè§„åˆ™ã€‚</li>
<li>table.frm ï¼Œå­˜æ”¾<strong>è¡¨ç»“æ„</strong>ï¼Œåœ¨ MySQL
ä¸­å»ºç«‹ä¸€å¼ è¡¨éƒ½ä¼šç”Ÿæˆä¸€ä¸ª.frm
æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ç”¨æ¥ä¿å­˜æ¯ä¸ªè¡¨çš„å…ƒæ•°æ®ä¿¡æ¯çš„ï¼Œä¸»è¦åŒ…å«è¡¨ç»“æ„å®šä¹‰ã€‚</li>
<li>table.ibdï¼Œå­˜æ”¾<strong>è¡¨æ•°æ®</strong>ï¼Œ<del>è¡¨æ•°æ®æ—¢å¯ä»¥å­˜åœ¨å…±äº«è¡¨ç©ºé—´æ–‡ä»¶ï¼ˆæ–‡ä»¶åï¼šibdata1ï¼‰é‡Œ</del>ï¼Œä¹Ÿå¯ä»¥å­˜æ”¾åœ¨ç‹¬å è¡¨ç©ºé—´æ–‡ä»¶ï¼ˆæ–‡ä»¶åï¼šè¡¨åå­—.ibdï¼‰ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯ç”±å‚æ•°
innodb_file_per_table æ§åˆ¶çš„ï¼Œè‹¥è®¾ç½®äº†å‚æ•° innodb_file_per_table ä¸º
1ï¼Œåˆ™ä¼šå°†å­˜å‚¨çš„<strong>æ•°æ®ã€ç´¢å¼•ç­‰ä¿¡æ¯å•ç‹¬å­˜å‚¨åœ¨ä¸€ä¸ªç‹¬å è¡¨ç©ºé—´</strong>ï¼Œä»
MySQL 5.6.6 ç‰ˆæœ¬å¼€å§‹ï¼Œå®ƒçš„é»˜è®¤å€¼å°±æ˜¯ 1 äº†ï¼Œå› æ­¤ä»è¿™ä¸ªç‰ˆæœ¬ä¹‹åï¼Œ MySQL
ä¸­æ¯ä¸€å¼ è¡¨çš„æ•°æ®éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ .ibd æ–‡ä»¶ã€‚</li>
</ul>
<p><strong>è¡¨ç©ºé—´æ–‡ä»¶çš„ç»“æ„</strong></p>
<style>.fwilctvsedxk{zoom:67%;}</style>
<img data-src="/" class="fwilctvsedxk" alt="img">
<h2 id="innodb-è¡Œæ ¼å¼">InnoDB è¡Œæ ¼å¼</h2>
<p>å…±æœ‰ Redundantã€Compactã€Dynamicã€Compressed å››ç§ï¼Œä¸‹å›¾æ—¶ Compact
è¡Œæ ¼å¼çš„ç»“æ„</p>
<img data-src="/" class="" title="img">
<h2 id="innodb-é¡µæ ¼å¼">InnoDB é¡µæ ¼å¼</h2>
<p>InnoDB çš„æ•°æ®æ˜¯æŒ‰ã€Œæ•°æ®é¡µã€ä¸ºå•ä½æ¥è¯»å†™çš„ï¼Œæ•°æ®é¡µçš„é»˜è®¤å¤§å°æ˜¯
16KB</p>
<style>.zwngpwsxgtyu{zoom:50%;}</style>
<img data-src="/" class="zwngpwsxgtyu" alt="243b1466779a9e107ae3ef0155604a17">
<table>
<thead>
<tr class="header">
<th>åç§°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>æ–‡ä»¶å¤´</td>
<td>é¡µçš„ä¿¡æ¯ï¼›ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘<u>ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªæ•°æ®é¡µ</u></td>
</tr>
<tr class="even">
<td>é¡µå¤´</td>
<td>é¡µçš„çŠ¶æ€ä¿¡æ¯</td>
</tr>
<tr class="odd">
<td>æœ€å°å’Œæœ€å¤§è®°å½•</td>
<td>ä¸¤ä¸ªè™šæ‹Ÿä¼ªè®°å½•ï¼Œåˆ†åˆ«è¡¨ç¤ºé¡µä¸­çš„æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•</td>
</tr>
<tr class="even">
<td><u>ç”¨æˆ·è®°å½•</u></td>
<td>å‚¨å­˜æ‰€æœ‰çš„è¡Œè®°å½•</td>
</tr>
<tr class="odd">
<td>ç©ºé—²ç©ºé—´</td>
<td>è¿˜æ²¡è¢«ç”¨åˆ°çš„ç©ºé—´</td>
</tr>
<tr class="even">
<td><u>é¡µç›®å½•</u></td>
<td>ç”¨æˆ·è®°å½•ç›¸å¯¹ä½ç½®ï¼Œé¡µä¸­æ‰€æœ‰è®°å½•çš„ç´¢å¼•</td>
</tr>
<tr class="odd">
<td>æ–‡ä»¶å°¾</td>
<td>æ ¡éªŒé¡µæ˜¯å¦å®Œæ•´</td>
</tr>
</tbody>
</table>
<p>æ•°æ®é¡µä¸­çš„
é¡µç›®å½•å­˜å‚¨å„ä¸ªæ§½ï¼Œç”¨æˆ·è®°å½•æŒ‰ç…§ã€Œä¸»é”®ã€é¡ºåºç»„æˆå•å‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•çš„æ–¹å¼è¿›è¡Œæ£€ç´¢ã€‚</p>
<h1 id="ç´¢å¼•">ç´¢å¼•</h1>
<p>ç´¢å¼•å­—æ®µç‰¹æ€§åˆ†ç±»</p>
<ul>
<li>ä¸»é”®ç´¢å¼•</li>
<li>å”¯ä¸€ç´¢å¼•</li>
<li>å‰ç¼€ç´¢å¼•</li>
<li>æ™®é€šç´¢å¼•</li>
</ul>
<p>ç´¢å¼•ä¸ªæ•°åˆ†ç±»</p>
<ul>
<li>å•ä¾‹ç´¢å¼•</li>
<li>è”åˆç´¢å¼•ï¼šæœ€å·¦åŒ¹é…åŸåˆ™ï¼ˆMySQL æœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œæ‰€ä»¥å­—æ®µåœ¨ where
å­å¥çš„é¡ºåºå¹¶ä¸é‡è¦ï¼‰</li>
</ul>
<blockquote>
<p>æœ€å·¦åŒ¹é…åŸåˆ™ï¼šæŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ï¼ŒèŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚
&gt;ã€&lt;ï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯èŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†æ˜¯åœ¨èŒƒå›´æŸ¥è¯¢å­—æ®µçš„åé¢çš„å­—æ®µæ— æ³•ç”¨åˆ°è”åˆç´¢å¼•ã€‚æ³¨æ„ï¼Œå¯¹äº
&gt;=ã€&lt;=ã€BETWEENã€like å‰ç¼€åŒ¹é…çš„èŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸ä¼šåœæ­¢åŒ¹é…ã€‚</p>
</blockquote>
<h2 id="innodb-é‡‡ç”¨-btree-ä½œä¸ºç´¢å¼•çš„ä¼˜åŠ¿">Innodb é‡‡ç”¨ B+Tree
ä½œä¸ºç´¢å¼•çš„ä¼˜åŠ¿</h2>
<blockquote>
<p>MySQL åº•å±‚å®ç°çš„ B+ æ ‘åœ¨åŸæœ‰çš„ B+ æ ‘çš„åŸºç¡€ä¸Šåšäº†æ”¹åŠ¨</p>
<ul>
<li>å¶å­èŠ‚ç‚¹é‡‡ç”¨åŒå‘é“¾è¡¨è¿æ¥</li>
<li>æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ 16KB æ•°æ®é¡µ</li>
<li>éå¶å­èŠ‚ç‚¹ä¸­æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ï¼Œå°±æœ‰å¤šå°‘ä¸ªç´¢å¼•</li>
</ul>
<p>nosql çš„ MongoDB é‡‡ç”¨ B
æ ‘å®ç°ï¼Œé€‚ç”¨äºå¤§é‡çš„å•ä¸ªç´¢å¼•ï¼ˆè€Œä¸æ˜¯èŒƒå›´æŸ¥è¯¢ï¼‰æŸ¥è¯¢çš„åœºæ™¯ï¼›</p>
</blockquote>
<ul>
<li><strong>æŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ç£ç›˜
I/Oæ¬¡æ•°å°‘</strong>ã€‚éå¶å­èŠ‚ç‚¹åªå­˜æ”¾ç´¢å¼•ï¼Œç›¸æ¯” B
æ ‘ï¼Œæ¯ä¸ªéå¶å­èŠ‚ç‚¹èƒ½å­˜å‚¨æ›´å¤šçš„ç´¢å¼•ï¼Œæ ‘å½¢ç»“æ„æ›´åŠ çŸ®èƒ–ï¼›</li>
<li><strong>æ’å…¥å’Œåˆ é™¤æ•ˆç‡é«˜</strong>ã€‚éå¶å­èŠ‚ç‚¹ä¸­çš„éƒ½æ˜¯å†—ä½™ç´¢å¼•ï¼Œæ‰€æœ‰ç´¢å¼•éƒ½åœ¨å¶å­èŠ‚ç‚¹ä¸­åˆå­˜å‚¨äº†ä¸€æ¬¡ï¼›</li>
<li><strong>æ ‘å±‚ä½ï¼Œç£ç›˜ I/O æ¬¡æ•°å°‘</strong>ã€‚è‹¥æ¯è¡Œæ•°æ®
1KBï¼Œä¸‰å±‚æœ€å¤šå¯å­˜æ”¾åƒä¸‡çº§æ•°æ®é‡ï¼›</li>
<li><strong>èŒƒå›´æŸ¥è¯¢ï¼Œç£ç›˜ I/O
æ¬¡æ•°å°‘</strong>ã€‚å¶å­èŠ‚ç‚¹é‡‡ç”¨åŒå‘æœ‰åºé“¾è¡¨è¿æ¥ï¼›å…¶ä»–æ ‘ç»“æ„éœ€è¦ä¸­åºéå†ï¼Œç£ç›˜
I/O æ¬¡æ•°å¤šï¼›</li>
</ul>
<p>B+Tree ç´¢å¼•ç»“æ„</p>
<ul>
<li>ä¸»é”®ç´¢å¼•/èšç°‡ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹å­˜æ”¾å®é™…æ•°æ®ã€äº‹åŠ¡ idã€ç”¨äºäº‹åŠ¡å’Œ MVCC
çš„å›æ»šæŒ‡é’ˆï¼›</li>
<li>äºŒçº§ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹å­˜æ”¾ä¸»é”®å€¼ï¼›</li>
</ul>
<h2 id="explain-æ‰§è¡Œè®¡åˆ’">Explain æ‰§è¡Œè®¡åˆ’</h2>
<p>æ•°æ®æ‰«æç±»å‹ type</p>
<ul>
<li>Allï¼šå…¨è¡¨æ‰«æï¼›</li>
<li>indexï¼šå…¨ç´¢å¼•æ‰«æï¼›</li>
<li>index mergeï¼šç´¢å¼•åˆå¹¶ã€‚å…ˆå°†ä½¿ç”¨åˆ°çš„ç´¢å¼•å…ˆè¿›è¡Œæ±‚
äº¤é›†ã€å¹¶é›†ä¹‹ååœ¨è¿›è¡Œå›è¡¨ï¼›</li>
<li>rangeï¼šç´¢å¼•èŒƒå›´æ‰«æã€‚ä½¿ç”¨ &lt; ã€&gt;ã€inã€between
ç­‰å…³é”®è¯ï¼Œåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼›</li>
<li>refï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼åŒ¹é…ï¼›</li>
<li>eq_refï¼šå”¯ä¸€ç´¢å¼• å¤šè¡¨è”æŸ¥ ç­‰å€¼åŒ¹é…ï¼›</li>
<li>constï¼šä¸»é”®æˆ–å”¯ä¸€ç´¢å¼• å¸¸é‡ ç­‰å€¼åŒ¹é…ï¼›</li>
</ul>
<p>é¢å¤–ä¿¡æ¯ extra</p>
<ul>
<li>Using filesort ï¼šå½“æŸ¥è¯¢è¯­å¥ä¸­åŒ…å« group by
æ“ä½œï¼Œè€Œä¸”æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œçš„æ—¶å€™ï¼Œ
è¿™æ—¶ä¸å¾—ä¸é€‰æ‹©ç›¸åº”çš„æ’åºç®—æ³•è¿›è¡Œï¼›</li>
<li>Using temporaryï¼šä½¿äº†ç”¨ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼Œå¦‚æ’åº order by
å’Œåˆ†ç»„æŸ¥è¯¢ group byï¼›</li>
<li>Using whereï¼šå­˜å‚¨å¼•æ“å±‚è¿”å›è¡Œä»¥ååœ¨ MySQL æœåŠ¡å±‚åº”ç”¨ where
è¿‡æ»¤æ¡ä»¶ï¼›</li>
<li>Using
indexï¼šæ‰€éœ€æ•°æ®å¯ä»¥ç›´æ¥åœ¨äºŒçº§ç´¢å¼•å€¼å’Œä¸»é”®å€¼ä¸­å¾—åˆ°ï¼Œé‡‡ç”¨è¦†ç›–ç´¢å¼•ï¼Œä¸å›è¡¨ï¼›</li>
<li>Using index condition ç´¢å¼•ä¸‹æ¨
ï¼šå¯ä»¥åœ¨è”åˆç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹è”åˆç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ï¼›</li>
</ul>
<h2 id="æ˜¯å¦éœ€è¦ç´¢å¼•">æ˜¯å¦éœ€è¦ç´¢å¼•</h2>
<p>éœ€è¦ç´¢å¼•çš„æƒ…å†µ</p>
<ul>
<li>å”¯ä¸€æ€§å­—æ®µ</li>
<li>èŒƒå›´æŸ¥è¯¢ <code>WHERE</code></li>
<li>æ’åºæŸ¥è¯¢ <code>GROUP BY</code> ã€ <code>ORDER BY</code></li>
<li>è¦†ç›–ç´¢å¼•ï¼Œå…¨ç´¢å¼•æ‰«æä¼˜äºå…¨è¡¨æ‰«æ</li>
</ul>
<p>ä¸éœ€è¦ç´¢å¼•çš„æƒ…å†µ</p>
<ul>
<li>ä¸éœ€è¦èŒƒå›´æŸ¥è¯¢ã€æ’åºæŸ¥è¯¢</li>
<li>å¤§é‡é‡å¤æ•°æ®</li>
<li>é¢‘ç¹ä¿®æ”¹</li>
<li>æ•°æ®é‡å°‘</li>
</ul>
<h2 id="ç´¢å¼•ä¼˜åŒ–">ç´¢å¼•ä¼˜åŒ–</h2>
<p><strong>å‰ç¼€ç´¢å¼•</strong>ï¼šå‡å°ç´¢å¼•å­—æ®µå¤§å°ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªç´¢å¼•é¡µä¸­å­˜å‚¨çš„ç´¢å¼•å€¼ï¼Œæœ‰æ•ˆæé«˜ç´¢å¼•çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šè”åˆç´¢å¼•å’Œä¸»é”®å€¼ä¸­åŒ…æ‹¬äº†æŸ¥è¯¢æ•°æ®ï¼Œé¿å…å›è¡¨</p>
<p><strong>ä¸»é”®ç´¢å¼•è‡ªå¢</strong>ï¼šè¿½åŠ è®°å½•æ—¶ä¸éœ€è¦ç§»åŠ¨æ•°æ®ï¼›é¿å…é¡µåˆ†è£‚é€ æˆå†…å­˜ç¢ç‰‡ï¼›</p>
<p><strong>ä¸»é”®å­—æ®µé•¿åº¦å°½å¯èƒ½çŸ­</strong>ï¼šèšç°‡ç´¢å¼•éå¶å­èŠ‚ç‚¹å¯ä»¥è£…ä¸‹æ›´å¤šçš„ç´¢å¼•ï¼›äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹å¯ä»¥è£…ä¸‹æ›´å¤šçš„ä¸»é”®å€¼ï¼Œå ç”¨ç©ºé—´æ›´å°</p>
<p><strong>ç´¢å¼• NOT NULL</strong>ï¼šç®€åŒ–ç´¢å¼•ç»Ÿè®¡ã€å€¼æ¯”è¾ƒè¿‡ç¨‹ï¼›å‡å°‘ 1
å­—èŠ‚çš„è¡Œæ ¼å¼é•¿åº¦ï¼›</p>
<p><strong>è”åˆç´¢å¼•
åŒºåˆ†åº¦å¤§çš„åœ¨å‰</strong>ï¼šå»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œè¦æŠŠåŒºåˆ†åº¦å¤§çš„å­—æ®µæ’åœ¨å‰é¢ï¼Œè¿™æ ·åŒºåˆ†åº¦å¤§çš„å­—æ®µè¶Šæœ‰å¯èƒ½è¢«æ›´å¤šçš„
SQL ä½¿ç”¨åˆ°ã€‚</p>
<blockquote>
<p>å¦‚æœç´¢å¼•çš„åŒºåˆ†åº¦å¾ˆå°ï¼Œå‡è®¾å­—æ®µçš„å€¼åˆ†å¸ƒå‡åŒ€ï¼Œé‚£ä¹ˆæ— è®ºæœç´¢å“ªä¸ªå€¼éƒ½å¯èƒ½å¾—åˆ°ä¸€åŠçš„æ•°æ®ï¼ˆæƒ¯ç”¨çš„ç™¾åˆ†æ¯”ç•Œçº¿æ˜¯"30%"ï¼‰MySQL
æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œä¼šå¿½ç•¥ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æ</p>
</blockquote>
<h2 id="ç´¢å¼•å¤±æ•ˆ">ç´¢å¼•å¤±æ•ˆ</h2>
<ul>
<li>å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…</li>
<li>æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—åšäº†
<ul>
<li>è®¡ç®—</li>
<li>å‡½æ•°</li>
<li>ç±»å‹è½¬æ¢æ“ä½œ</li>
</ul></li>
<li>è”åˆç´¢å¼•æœªéµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™</li>
<li>æ¡ä»¶è¯­å¥ä¸­ OR å‰åå­å¥ä¸€ä¸ªæœ‰ç´¢å¼•ä¸€ä¸ªæ²¡ç´¢å¼•</li>
</ul>
<p><strong>Count è®¡ç®—</strong></p>
<p>éå†ç´¢å¼•ï¼Œä¼˜å…ˆéå† key_len
æœ€å°çš„äºŒçº§ç´¢å¼•ï¼Œåªæœ‰å½“æ²¡æœ‰äºŒçº§ç´¢å¼•çš„æ—¶å€™ï¼Œæ‰ä¼šé‡‡ç”¨ä¸»é”®ç´¢å¼•æ¥è¿›è¡Œç»Ÿè®¡ã€‚</p>
<h1 id="äº‹åŠ¡">äº‹åŠ¡</h1>
<p>äº‹åŠ¡æ˜¯ç”±å­˜å‚¨å¼•æ“å®ç°çš„ï¼ŒInnoDB æ”¯æŒäº‹åŠ¡</p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§</h2>
<ul>
<li>æŒä¹…æ€§æ˜¯é€šè¿‡ redo log ï¼ˆé‡åšæ—¥å¿—ï¼‰ä¿è¯çš„ï¼›</li>
<li>åŸå­æ€§æ˜¯é€šè¿‡ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ ä¿è¯çš„ï¼›</li>
<li>éš”ç¦»æ€§æ˜¯é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ æˆ–é”æœºåˆ¶ä¿è¯çš„ï¼›</li>
<li>ä¸€è‡´æ€§åˆ™æ˜¯é€šè¿‡æŒä¹…æ€§+åŸå­æ€§+éš”ç¦»æ€§ä¿è¯çš„ï¼›</li>
</ul>
<p><strong>å¹¶è¡Œäº‹åŠ¡ä¼šå¼•å‘çš„é—®é¢˜</strong></p>
<ul>
<li>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°äº†å¦ä¸€ä¸ª<u>æœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®</u></li>
<li>ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‡ºç°å‰åä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€æ ·</li>
<li>å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢æŸä¸ªæŸ¥è¯¢æ¡ä»¶çš„è®°å½•æ•°é‡ä¸åŒ</li>
</ul>
<h2 id="éš”ç¦»çº§åˆ«">éš”ç¦»çº§åˆ«</h2>
<table>
<thead>
<tr class="header">
<th>éš”ç¦»çº§åˆ«ï¼ˆæ˜¯å¦ä¼šå‡ºç°xxé—®é¢˜ï¼‰</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>READ-UNCOMMITTED è¯»æœªæäº¤</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr class="even">
<td>READ-COMMITTED è¯»å·²æäº¤</td>
<td>Ã—</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr class="odd">
<td>REPEATABLE-READ å¯é‡å¤è¯»</td>
<td>Ã—</td>
<td>Ã—</td>
<td>âˆš</td>
</tr>
<tr class="even">
<td>SERIALIZABLE å¯ä¸²è¡ŒåŒ–</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
</tbody>
</table>
<ul>
<li>è¯»æœªæäº¤ï¼šå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ã€‚ç›´æ¥è¯»å–æœ€æ–°çš„æ•°æ®</li>
<li>è¯»å·²æäº¤ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚<strong>ã€Œæ¯ä¸ª SQL
è¯­å¥æ‰§è¡Œå‰ã€éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª Read View</strong></li>
<li>å¯é‡å¤è¯»ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚<strong>ã€Œå¯åŠ¨äº‹åŠ¡æ—¶ã€ç”Ÿæˆä¸€ä¸ª
Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read View</strong></li>
<li>å¯ä¸²è¡ŒåŒ–ï¼šæ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œå®Œå…¨æœä» ACID
çš„éš”ç¦»çº§åˆ«ã€‚é‡‡ç”¨åŠ è¯»å†™é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®</li>
</ul>
<p>è™½ç„¶ InnoDB é»˜è®¤é‡‡ç”¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œä½†åŸºæœ¬ä¸ä¼šå‡ºç°å¹»è¯»ï¼Œå› ä¸ºå…¶é‡‡ç”¨
next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰å’Œ MVCC æ¥é¿å…å¹»è¯»çš„å‘ç”Ÿ</p>
<ul>
<li><strong>å¿«ç…§è¯»</strong>ï¼ˆselectï¼‰ï¼šé‡‡ç”¨ MVCC
æ–¹å¼è§£å†³äº†å¹»è¯»ã€‚äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œä¸€ç›´è·Ÿè¿™ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œä¿è¯äº‹åŠ¡éš”ç¦»æ€§ï¼›
<ul>
<li>åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªæŸ¥è¯¢è¯­å¥åï¼Œä¼šåˆ›å»ºä¸€ä¸ª Read Viewï¼Œåç»­çš„æŸ¥è¯¢è¯­å¥åˆ©ç”¨è¿™ä¸ª
Read Viewï¼Œé€šè¿‡è¿™ä¸ª Read View å°±å¯ä»¥åœ¨ undo log
ç‰ˆæœ¬é“¾æ‰¾åˆ°äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®ï¼Œæ‰€ä»¥äº‹åŠ¡è¿‡ç¨‹ä¸­æ¯æ¬¡æŸ¥è¯¢çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„</li>
</ul></li>
<li><strong>å½“å‰è¯»/å…±äº«é”</strong>ï¼ˆselect for updateï¼‰ï¼šé€šè¿‡ next-key
lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰æ–¹å¼è§£å†³äº†å¹»è¯»ï¼Œè¯»åˆ°çš„è®°å½•æ˜¯æœ€æ–°çš„ã€‚å¦‚æœæœ‰å…¶ä»–äº‹åŠ¡åœ¨
Next-Key Lock
èŒƒå›´å†…æ’å…¥äº†ä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’å…¥è¯­å¥å°±ä¼šè¢«é˜»å¡ï¼Œæ— æ³•æˆåŠŸæ’å…¥ï¼›
<ul>
<li>updateã€insertã€delete
éƒ½æ˜¯å½“å‰è¯»ï¼Œè¿™äº›è¯­å¥æ‰§è¡Œå‰éƒ½ä¼š<strong>æŸ¥è¯¢æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®</strong>ï¼Œç„¶åå†åšè¿›ä¸€æ­¥çš„æ“ä½œï¼›</li>
<li>å¦‚æœ update
æ˜¯å·²ç»è¢«é”ä½çš„è®°å½•ï¼Œå°±ç”Ÿæˆæ’å…¥æ„å‘é”å¹¶è¿›å…¥é˜»å¡çŠ¶æ€ï¼›</li>
<li>å½“å‰è¯»ç»™æŸè®°å½•åŠ é”äº†ï¼Œé‚£ä¹ˆå¯¹è¯¥è®°å½•å·²ä¿®æ”¹ä½†æœªæäº¤çš„äº‹ç‰©å°±æ— æ³•æäº¤è¿™ä¸ªä¿®æ”¹äº†ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ï¼›</li>
<li>Next-Key Lock å¯¹ç´¢å¼•è®°å½•åŠ ä¸Šè¡Œé”ï¼ˆRecord
Lockï¼‰ï¼Œå¯¹ç´¢å¼•è®°å½•ä¸¤è¾¹çš„é—´éš™åŠ ä¸Š<strong>é—´éš™é”ï¼ˆGap
Lockï¼‰</strong>ï¼Œæ˜¯é’ˆå¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»æˆ–ä»¥ä¸Šçº§åˆ«è€Œè®¾è®¡çš„ï¼›</li>
</ul></li>
</ul>
<h2 id="mvcc-å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶">MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</h2>
<p>InnoDB äº‹åŠ¡æ˜¯é€šè¿‡ <strong>Read View å’Œ
èšç°‡ç´¢å¼•ä¸­çš„ä¸¤ä¸ªéšè—åˆ—</strong> å®ç° MVCC çš„</p>
<p><strong>Read View å­—æ®µ</strong></p>
<img data-src="/" class="" title="img">
<p><strong>èšç°‡ç´¢å¼•ä¸­çš„ä¸¤ä¸ªéšè—åˆ—</strong></p>
<ul>
<li>trx_idï¼Œå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±ä¼š<strong>æŠŠè¯¥äº‹åŠ¡çš„äº‹åŠ¡
id è®°å½•åœ¨ trx_id éšè—åˆ—é‡Œ</strong>ï¼›</li>
<li>roll_pointerï¼Œæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„è®°å½•å†™å…¥åˆ°
undo
æ—¥å¿—ä¸­ï¼Œç„¶å<strong>è¿™ä¸ªéšè—åˆ—æ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬è®°å½•</strong>ï¼Œäºæ˜¯å°±å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°ä¿®æ”¹å‰çš„è®°å½•ã€‚</li>
</ul>
<p><strong>MVCC å¦‚ä½•å®ç°å¯é‡å¤è¯»ï¼Ÿ</strong></p>
<p>äº‹åŠ¡ A è¯»æŸå­—æ®µæ—¶ï¼Œä¼šå…ˆè¯»å–è¯¥å­—æ®µçš„ trx_idï¼Œå¦‚æœ Read View ä¸­è®°å½•çš„è¯¥
trx_id æ˜¯<strong>æ´»è·ƒäº‹åŠ¡</strong>ï¼Œåˆ™æ²¿ç€ roll_pointerï¼ˆå³ <strong>undo
log ç‰ˆæœ¬é“¾</strong>ï¼‰å¯»æ‰¾æ—§ç‰ˆæœ¬å­—æ®µï¼›å¦‚æœ Read View ä¸­è®°å½•çš„è¯¥ trx_id
æ˜¯<strong>å½“å‰äº‹åŠ¡</strong> æˆ–
<strong>å·²æäº¤äº‹åŠ¡</strong>ï¼Œåˆ™è¿”å›è¯¥è®°å½•ã€‚ã€æ³¨æ„ï¼ŒRead View
å­—æ®µä¸éšæ´»è·ƒäº‹åŠ¡çš„æäº¤è€Œæ”¹å˜ï¼Œå®ƒæ˜¯è¯¥äº‹åŠ¡å¼€å¯æ—¶çš„æ•°æ®åº“äº‹åŠ¡çŠ¶æ€å¿«ç…§ã€‘</p>
<h2 id="å¯é‡å¤è¯»ä¸‹å‘ç”Ÿå¹»è¯»">å¯é‡å¤è¯»ä¸‹å‘ç”Ÿå¹»è¯»</h2>
<ol type="1">
<li>äº‹åŠ¡ A å…ˆå¯¹æŸå—è®°å½•æ‰§è¡Œå¿«ç…§è¯»</li>
<li>äº‹åŠ¡ B æ’å…¥æ•°æ®åˆ°è¯¥å—è®°å½•ä¸­ï¼Œå¹¶æäº¤äº‹åŠ¡ B</li>
<li>äº‹åŠ¡ A å†å¯¹è¯¥å—è®°å½•æ‰§è¡Œå½“å‰è¯»æˆ–æ›´æ–°è®°å½•</li>
<li>ä¼šè¯»å–åˆ°äº‹åŠ¡ B æ’å…¥çš„æ•°æ®ï¼Œå› ä¸ºå½“å‰è¯»ä¼šè¯»å–æœ€æ–°çš„è®°å½•</li>
</ol>
<p><strong>å¦‚ä½•é¿å…ï¼Ÿ</strong></p>
<p>è‹¥äº‹åŠ¡ä¸­ä¼šå¯¹æ•°æ®é‡‡å– å½“å‰è¯»ï¼Œåˆ™åœ¨äº‹åŠ¡åˆšå¼€å§‹æ—¶å°±æ‰§è¡Œï¼Œé€šè¿‡ next-key
lock é¿å…å…¶ä»–äº‹ç‰©å†æ’å…¥æ•°æ®ã€‚</p>
<h1 id="é”">é”</h1>
<blockquote>
<p>MySQL åŠ é”æ—¶ï¼Œå…ˆ ç”Ÿæˆé”ç»“æ„ï¼Œç„¶å
è®¾ç½®é”çš„çŠ¶æ€ï¼Œå³åˆå§‹åŒ–é”å†ç«äº‰é”ï¼›å¦‚æœé”çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼Œåªæœ‰å½“é”çŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€æ—¶ï¼Œæ‰ä»£è¡¨äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼›</p>
</blockquote>
<p><strong>é”çš„ç§ç±»</strong></p>
<ul>
<li>å…¨å±€é”</li>
<li>è¡¨çº§é”
<ul>
<li>è¡¨é”</li>
<li>æ„å‘è¡¨ï¼šç”¨äº<strong>å¿«é€Ÿåˆ¤æ–­è¡¨é‡Œæ˜¯å¦æœ‰è®°å½•è¢«åŠ é”</strong>ã€‚æ„å‘å…±äº«é”å’Œæ„å‘ç‹¬å é”æ˜¯è¡¨çº§é”ï¼Œä¸ä¼šå’Œè¡Œçº§çš„å…±äº«é”å’Œç‹¬å é”å‘ç”Ÿå†²çªï¼Œè€Œä¸”æ„å‘é”ä¹‹é—´ä¹Ÿä¸ä¼šå‘ç”Ÿå†²çªï¼Œåªä¼šå’Œå…±äº«è¡¨é”ï¼ˆlock
tables ... readï¼‰å’Œç‹¬å è¡¨é”ï¼ˆlock tables ... writeï¼‰å‘ç”Ÿå†²çª</li>
<li>å…ƒæ•°æ®è¡¨ MDL é”ï¼šæ›´è¡¨ç»“æ„æ—¶éœ€è¦ç”³è¯· MDL å†™é”</li>
<li>AUTO-INC é”ï¼šé…ç½®æ–‡ä»¶
<code>innodb_autoinc_lock_mode = 2, binlog_format = row</code>ï¼Œæ—¢èƒ½æå‡å¹¶å‘æ€§ï¼Œåˆä¸ä¼šå‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜</li>
</ul></li>
<li>è¡Œçº§é”
<ul>
<li>Record Lock è®°å½•é”ï¼ŒåŒºåˆ†è¯»é”å’Œå†™é”ï¼Œé”å®šå­˜åœ¨çš„è®°å½•ï¼›</li>
<li>Gap Lock
é—´éš™é”ï¼Œä¸åŒºåˆ†è¯»é”å’Œå†™é”ï¼›é—´éš™é”ç”¨æ¥é”ä¸€ä¸ªèŒƒå›´ï¼Œé—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼›</li>
<li>Next-Key Lock ä¸´é”®é”ï¼ŒåŒºåˆ†è¯»é”å’Œå†™é”ï¼›</li>
<li>æ’å…¥æ„å‘é”ï¼Œç‰¹æ®Šçš„é—´éš™é”ï¼Œ<strong>ç”¨äºä¸åŒäº‹åŠ¡çš„å¹¶å‘æ§åˆ¶å’Œå†²çªæ£€æµ‹</strong>ï¼›æ’å…¥æ„å‘é”å’Œä¸åŒäº‹ç‰©çš„é—´éš™é”ä¹‹é—´æ˜¯å†²çªçš„ï¼Œå½“æŸä¸ªäº‹åŠ¡çš„æ’å…¥è¯­å¥é‡åˆ°é—´éš™é”æ—¶ï¼Œä¼šäº§ç”Ÿæ’å…¥æ„å‘é”ï¼›</li>
</ul></li>
<li>éšå¼é”
<ul>
<li>å»¶è¿ŸåŠ é”æœºåˆ¶ï¼Œç‰¹ç‚¹æ˜¯åªæœ‰åœ¨å¯èƒ½å‘ç”Ÿå†²çªæ—¶æ‰åŠ é”</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šäº‹åŠ¡ B æ’å…¥è®°å½•çš„ç´¢å¼• == äº‹åŠ¡ A å·²æ’å…¥ä¸”æœªæäº¤çš„ç´¢å¼•ï¼Œäº‹åŠ¡
A æ’å…¥çš„è®°å½•ä¸Šçš„ã€Œéšå¼é”ã€ä¼šå˜ã€Œæ˜¾ç¤ºé”ã€ä¸”é”ç±»å‹ä¸º X
å‹çš„è®°å½•é”ï¼Œæ‰€ä»¥äº‹åŠ¡ B æƒ³è·å– <del>S å‹</del>next-key
é”æ—¶ä¼šé‡åˆ°é”å†²çªï¼Œäº‹åŠ¡ B è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li>
</ul></li>
</ul>
<h2 id="è¡Œçº§é”å®ç°">è¡Œçº§é”å®ç°</h2>
<blockquote>
<p>è¡Œçº§é”æ—¶ Innodb å®ç°é«˜æ•ˆäº‹åŠ¡çš„å…³é”®</p>
</blockquote>
<p>åŠ é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ã€åŠ è¡Œçº§é”æ—¶è¿˜è¦åŠ è¡¨é”ï¼šX ç±»å‹çš„æ„å‘é”ã€‘</p>
<ul>
<li>å…¨è¡¨å½“å‰è¯»ï¼Œ<strong>éå†</strong>èšç°‡ç´¢å¼•åŠ ä¸´é”®é”ï¼ˆupdate
æœªèµ°ç´¢å¼•çš„æƒ…å†µï¼‰</li>
<li>å…¨ç´¢å¼•å½“å‰è¯»ï¼Œ<strong>éå†</strong>å½“å‰ç´¢å¼•åŠ ä¸´é”®é”</li>
</ul>
<p><strong>äºŒçº§ç´¢å¼•åŠ é”åï¼Œè¿˜è¦åœ¨æŸ¥è¯¢åˆ°çš„è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹åŠ è®°å½•é”</strong></p>
<p><strong>Insert è¯­å¥ï¼ŒåŠ è¡Œçº§é”</strong></p>
<ul>
<li>è®°å½•è¢«é—´éš™é”ï¼Œé˜»å¡
<ul>
<li>æ’å…¥æ„å‘é”</li>
</ul></li>
<li>å”¯ä¸€é”®å†²çªï¼Œæ‰§è¡Œå¤±è´¥
<ul>
<li>å¦‚æœä¸»é”®ç´¢å¼•é‡å¤ï¼Œæ’å…¥æ–°è®°å½•çš„äº‹åŠ¡ä¼šç»™å·²å­˜åœ¨çš„ä¸»é”®å€¼é‡å¤çš„èšç°‡ç´¢å¼•è®°å½•<strong>æ·»åŠ 
S å‹è®°å½•é”</strong>ã€‚</li>
<li>å¦‚æœå”¯ä¸€äºŒçº§ç´¢å¼•é‡å¤ï¼Œæ’å…¥æ–°è®°å½•çš„äº‹åŠ¡éƒ½ä¼šç»™å·²å­˜åœ¨çš„äºŒçº§ç´¢å¼•åˆ—å€¼é‡å¤çš„äºŒçº§ç´¢å¼•è®°å½•<strong>æ·»åŠ 
S å‹ next-key é”</strong>ã€‚</li>
</ul></li>
</ul>
<h3
id="ä¸´é”®é”é€€åŒ–æˆè®°å½•é”æˆ–é—´éš™é”çš„æƒ…å†µ">ä¸´é”®é”é€€åŒ–æˆè®°å½•é”æˆ–é—´éš™é”çš„æƒ…å†µ</h3>
<p>å”¯ä¸€ç´¢å¼•æŸ¥è¯¢</p>
<ul>
<li>ç­‰å€¼æŸ¥è¯¢
<ul>
<li>ï¼ˆæ¡ä»¶å€¼ï¼‰å­˜åœ¨ï¼Œ<strong>è¯¥ç´¢å¼•åŠ è®°å½•é”</strong></li>
<li>ï¼ˆæ¡ä»¶å€¼ï¼‰ä¸å­˜åœ¨ï¼Œ<strong>åä¸€ç´¢å¼•åŠ é—´éš™é”</strong></li>
</ul></li>
<li>èŒƒå›´æŸ¥è¯¢
<ul>
<li>æ¡ä»¶å€¼åœ¨è¡¨ä¸­ï¼Œéç­‰å€¼æŸ¥è¯¢
<ul>
<li>å°äºï¼Œ<strong>è¯¥ç´¢å¼•åŠ é—´éš™é”</strong></li>
<li>å¤§äºï¼Œ<strong>åä¸€ç´¢å¼•åŠ ä¸´é”®é”</strong></li>
</ul></li>
<li>æ¡ä»¶å€¼åœ¨è¡¨ä¸­ä¸”æ¡ä»¶æ˜¯ç­‰å€¼æŸ¥è¯¢
<ul>
<li>å°äºç­‰äºï¼Œ<strong>è¯¥ç´¢å¼•åŠ ä¸´é”®é”</strong></li>
<li>å¤§äºç­‰äºï¼Œ<strong>è¯¥ç´¢å¼•åŠ è®°å½•é”</strong></li>
</ul></li>
</ul></li>
</ul>
<p>éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢</p>
<ul>
<li>ç­‰å€¼æŸ¥è¯¢
<ul>
<li>å­˜åœ¨ï¼Œæ‰«æåˆ°çš„ç´¢å¼•è®°å½•åŠ çš„æ˜¯ next-key
é”ï¼Œè€Œå¯¹äºç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„ç´¢å¼•è®°å½•ï¼Œè¯¥ç´¢å¼•çš„ next-key
é”ä¼šé€€åŒ–æˆé—´éš™é”ï¼›</li>
<li>ä¸å­˜åœ¨ï¼Œæ‰«æåˆ°ç¬¬ä¸€æ¡ä¸ç¬¦åˆæ¡ä»¶çš„ç´¢å¼•è®°å½•ï¼Œè¯¥ç´¢å¼•çš„ next-key
é”ä¼šé€€åŒ–æˆé—´éš™é”ï¼›</li>
</ul></li>
<li>èŒƒå›´æŸ¥è¯¢
<ul>
<li>ä¸ºç¡®ä¿æ¡ä»¶å€¼å‰åéƒ½é”ä½ï¼ŒåŠ é”æ—¶ä¸å­˜åœ¨ä¸´å»ºé”é€€åŒ–ä¸ºé—´éš™é”å’Œè®°å½•é”çš„æƒ…å†µ</li>
</ul></li>
</ul>
<h2 id="æ­»é”">æ­»é”</h2>
<ul>
<li>ä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«åŠ äº†é—´éš™é”ï¼ˆå‰æï¼‰</li>
<li>ä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«å‘å¯¹æ–¹çš„é—´éš™é”æ’å…¥æ•°æ®ï¼Œäºæ˜¯éƒ½äº§ç”Ÿæ’å…¥æ„å‘é”</li>
<li>ç”±äºæ’å…¥æ„å‘é”å’Œé—´éš™é”å†²çªï¼ŒåŒæ–¹éƒ½ä¸ºäº†è·å–æ’å…¥æ„å‘é”ï¼Œä¼šç­‰å¾…å¯¹æ–¹äº‹åŠ¡çš„é—´éš™é”é‡Šæ”¾ï¼Œé™·å…¥å¾ªç¯ç­‰å¾…ï¼Œé€ æˆæ­»é”</li>
</ul>
<p>æ’å…¥æ„å‘é”æ˜¯å¯¹ä¸åŒäº‹åŠ¡æ‰äº§ç”Ÿä½œç”¨çš„ï¼Œå¯¹äºæœ¬èº«äº‹åŠ¡çš„é—´éš™é”æ˜¯å…¼å®¹çš„ã€‚</p>
<p>è§£å†³æ–¹æ³•</p>
<ul>
<li>è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„è¶…æ—¶æ—¶é—´ <code>innodb_lock_wait_timeout</code></li>
<li>å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹ <code>innodb_deadlock_detect</code></li>
</ul>
<h1 id="æ—¥å¿—">æ—¥å¿—</h1>
<blockquote>
<p>ç›®å‰ï¼Œå¾ˆå¤šæ•°æ®åº“é‡‡ç”¨çš„æ˜¯ stealï¼ˆæ²¡æäº¤çš„äº‹åŠ¡å†™çš„è„é¡µä¹Ÿå¯ä»¥é©¬ä¸Šè½ç›˜ï¼‰+
no forceï¼ˆå·²æäº¤çš„äº‹åŠ¡å¯ä»¥ä¸é©¬ä¸Šè½ç›˜ï¼‰æ¨¡å¼ã€‚MySQL ä¹Ÿå‚è€ƒäº†è¿™ä¸ªæ¨¡å¼ï¼Œundo
log å˜æ›´æŒä¹…æ€§å’Œæ•°æ®ä¸€æ ·ï¼Œç”± redo log ä¿è¯ï¼Œå¯¹ undo log
è¿˜æ²¡è½ç›˜çš„ä¿®æ”¹ä¹Ÿä¼šå†™å…¥ redo logã€‚è¿™æ ·ä¸ç®¡æ€ä¹ˆæ ·åŸºäº undo log
åšäº‹åŠ¡å›æ»šæˆ–è€…åš MVCCéƒ½å¯ä»¥ä¿è¯åŸå­å’Œä¸€è‡´æ€§ã€‚</p>
</blockquote>
<ul>
<li>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ï¼šæ˜¯ Innodb
å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„åŸå­æ€§ï¼Œä¸»è¦ç”¨äº<strong>äº‹åŠ¡å›æ»šå’Œ
MVCC</strong>ï¼›</li>
<li>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ï¼šæ˜¯ Innodb
å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„æŒä¹…æ€§ï¼Œä¸»è¦ç”¨äº<strong>æ‰ç”µç­‰æ•…éšœæ¢å¤</strong>ï¼›</li>
<li>bin log ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ï¼šæ˜¯ Server
å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œä¸»è¦ç”¨äº<strong>æ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶</strong>ï¼›</li>
</ul>
<p>å›æ»šæ—¥å¿—ä¸é‡åšæ—¥å¿—çš„åŒºåˆ«</p>
<ul>
<li>redo log
è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡ã€Œå®Œæˆåã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°ä¹‹åçš„å€¼ï¼›é˜²æ­¢å·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹ä¸¢å¤±ï¼›</li>
<li>undo log
è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡ã€Œå¼€å§‹å‰ã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°ä¹‹å‰çš„å€¼ï¼›é˜²æ­¢æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹æ— æ³•å›æ»šï¼›</li>
</ul>
<p>é‡åšæ—¥å¿—å’Œå½’æ¡£æ—¥å¿—çš„åŒºåˆ«</p>
<ul>
<li>bin log
æ˜¯è¿½åŠ å†™ï¼Œå†™æ»¡ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»§ç»­å†™ï¼Œä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ï¼Œä¿å­˜çš„æ˜¯å…¨é‡çš„æ—¥å¿—ã€‚</li>
<li>redo log
æ˜¯å¾ªç¯å†™ï¼Œæ—¥å¿—ç©ºé—´å¤§å°æ˜¯å›ºå®šï¼Œå…¨éƒ¨å†™æ»¡å°±ä»å¤´å¼€å§‹ï¼Œä¿å­˜æœªè¢«åˆ·å…¥ç£ç›˜çš„è„é¡µæ—¥å¿—ã€‚</li>
</ul>
<h2 id="å›æ»šæ—¥å¿—-undo-log">å›æ»šæ—¥å¿— Undo log</h2>
<ul>
<li><strong>å®ç°äº‹åŠ¡å›æ»šï¼Œä¿éšœäº‹åŠ¡çš„åŸå­æ€§</strong>ã€‚äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°äº†é”™è¯¯
æˆ–è€… ç”¨æˆ·æ‰§è¡Œäº† ROLLBACK è¯­å¥ï¼ŒMySQL å¯ä»¥åˆ©ç”¨ undo log
ä¸­çš„å†å²æ•°æ®å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</li>
<li>å®ç° MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å…³é”®å› ç´ ä¹‹ä¸€ã€‚MVCC æ˜¯é€šè¿‡ Read View +
undo log å®ç°çš„ã€‚<strong>undo log
ä¸ºæ¯æ¡è®°å½•ä¿å­˜å¤šä»½å†å²æ•°æ®</strong>ï¼ŒMySQL åœ¨æ‰§è¡Œå¿«ç…§è¯»ï¼ˆæ™®é€š select
è¯­å¥ï¼‰çš„æ—¶å€™ï¼Œä¼šæ ¹æ®äº‹åŠ¡çš„ Read View é‡Œçš„ä¿¡æ¯ï¼Œé¡ºç€ undo log
çš„ç‰ˆæœ¬é“¾æ‰¾åˆ°æ»¡è¶³å…¶å¯è§æ€§çš„è®°å½•ã€‚</li>
</ul>
<p>æŒä¹…åŒ–æ–¹æ³•ï¼šå¼€å¯äº‹åŠ¡åï¼ŒInnoDB å±‚æ›´æ–°è®°å½•å‰ï¼Œé¦–å…ˆè¦è®°å½•ç›¸åº”çš„ undo
logï¼Œå¦‚æœæ˜¯æ›´æ–°æ“ä½œï¼Œéœ€è¦æŠŠè¢«æ›´æ–°çš„åˆ—çš„æ—§å€¼è®°ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¦ç”Ÿæˆä¸€æ¡ undo
logï¼Œundo log ä¼šå†™å…¥ Buffer Pool ä¸­çš„ Undo é¡µé¢ï¼Œå¯¹ undo
é¡µçš„ä¿®æ”¹ä¹Ÿéƒ½ä¼šè®°å½•åˆ° redo logã€‚redo log
ä¼šæ¯ç§’åˆ·ç›˜ï¼Œæäº¤äº‹åŠ¡æ—¶ä¹Ÿä¼šåˆ·ç›˜ï¼Œæ•°æ®é¡µå’Œ undo
é¡µéƒ½æ˜¯é è¿™ä¸ªæœºåˆ¶ä¿è¯æŒä¹…åŒ–çš„ã€‚</p>
<h2 id="é‡åšæ—¥å¿—-redo-log">é‡åšæ—¥å¿— Redo log</h2>
<blockquote>
<p>é˜²æ­¢ Buffer Pool ä¸­çš„è„é¡µä¸¢å¤±</p>
</blockquote>
<ul>
<li>å®ç°<strong>äº‹åŠ¡çš„æŒä¹…æ€§</strong>ï¼Œè®© MySQL æœ‰
<strong>crash-safe</strong> çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿä¿è¯ MySQL
åœ¨ä»»ä½•æ—¶é—´æ®µçªç„¶å´©æºƒï¼Œé‡å¯åä¹‹å‰å·²æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼›</li>
<li>å°†<strong>è„é¡µçš„å†™æ“ä½œ</strong>ä»ã€Œéšæœºå†™ã€å˜æˆäº†ã€Œé¡ºåºå†™ã€ï¼Œæå‡
MySQL å†™å…¥ç£ç›˜çš„æ€§èƒ½ï¼›</li>
</ul>
<p>WALï¼ˆWrite-Ahead Loggingï¼‰ï¼šMySQL
çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå†™ redo log
æ—¥å¿—ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†å°†è„é¡µå†™åˆ°ç£ç›˜ä¸Šã€‚</p>
<p>redo log
æ˜¯<strong>ç‰©ç†æ—¥å¿—</strong>ï¼Œè®°å½•äº†æŸä¸ªæ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹ï¼Œå³æ‰€æœ‰æœªè¿˜æ²¡æŒä¹…åŒ–çš„è„é¡µä¿®æ”¹ã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œåªè¦<strong>å…ˆå°†
redo log æŒä¹…åŒ–åˆ°ç£ç›˜å³å¯</strong>ï¼Œå¯ä»¥ä¸éœ€è¦ç­‰åˆ°å°†ç¼“å­˜åœ¨ Buffer Pool
é‡Œçš„è„é¡µæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶è„é¡µæ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯
redo log å·²ç»æŒä¹…åŒ–ï¼Œæ¥ç€ MySQL é‡å¯åï¼Œå¯ä»¥æ ¹æ® redo log
çš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚</p>
<p><strong>redo log æŒä¹…åŒ–æ“ä½œ</strong>ï¼šæ¯å½“äº§ç”Ÿä¸€æ¡ redo log
æ—¶ï¼Œä¼šå…ˆå†™å…¥åˆ° redo log bufferï¼Œä¸ºäº†åœ¨ MySQL
å¤„ç†å¤§äº‹åŠ¡æ—¶å°½å¯èƒ½å°‘å†™å…¥ç£ç›˜ï¼Œè¿›è€Œæå‡å†™ IO æ€§èƒ½ã€‚<strong>redo log
buffer å†™å…¥ç£ç›˜çš„æ—¶æœº</strong>ï¼š</p>
<ul>
<li>MySQL æ­£å¸¸å…³é—­æ—¶ï¼›</li>
<li>å½“ redo log buffer ä¸­è®°å½•çš„å†™å…¥é‡å¤§äº redo log buffer
<strong>å†…å­˜ç©ºé—´</strong>çš„ä¸€åŠæ—¶ï¼›</li>
<li>InnoDB çš„<strong>åå°çº¿ç¨‹</strong>æ¯éš” 1 ç§’ï¼Œå°† redo log buffer
æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li>
<li>æ¯æ¬¡<strong>äº‹åŠ¡æäº¤</strong>æ—¶éƒ½å°†ç¼“å­˜åœ¨ redo log buffer é‡Œçš„ redo
log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›
<ul>
<li>å‚æ•°ä¸º 0 æ—¶ï¼Œäº‹åŠ¡æäº¤ä¸ä¼šä¸»åŠ¨è§¦å‘å†™å…¥ç£ç›˜çš„æ“ä½œï¼›<strong>MySQL
è¿›ç¨‹å´©æºƒ</strong>ä¼šå¯¼è‡´ä¸Šä¸€ç§’é’Ÿæ‰€æœ‰äº‹åŠ¡æ•°æ®çš„ä¸¢å¤±ï¼›</li>
<li>å‚æ•°ä¸º 1 æ—¶ï¼Œæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½å°†ç¼“å­˜åœ¨ redo log buffer é‡Œçš„ redo log
ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li>
<li>å‚æ•°ä¸º 2 æ—¶ï¼Œæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½åªæ˜¯ç¼“å­˜åœ¨ redo log buffer é‡Œçš„ redo log
å†™åˆ° redo log æ–‡ä»¶ï¼ˆå†™å…¥åˆ° redo log
æ–‡ä»¶å¹¶ä¸æ„å‘³ç€å†™å…¥åˆ°äº†ç£ç›˜ï¼Œè€Œæ˜¯å­˜åœ¨æ“ä½œç³»ç»Ÿé‡Œçš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ Page
Cacheï¼‰ï¼›<strong>æ“ä½œç³»ç»Ÿå´©æºƒæˆ–è€…ç³»ç»Ÿæ–­ç”µ</strong>ä¼šå¯¼è‡´ä¸Šä¸€ç§’é’Ÿæ‰€æœ‰äº‹åŠ¡æ•°æ®çš„ä¸¢å¤±ï¼›</li>
</ul></li>
</ul>
<h3 id="é‡åšæ—¥å¿—æ–‡ä»¶ç»„">é‡åšæ—¥å¿—æ–‡ä»¶ç»„</h3>
<p>redo log æ˜¯ä¸ºäº†é˜²æ­¢ Buffer Pool
ä¸­çš„è„é¡µä¸¢å¤±è€Œè®¾è®¡çš„ï¼Œ<strong>åªè®°å½•æœªè¢«åˆ·å…¥ç£ç›˜çš„æ•°æ®çš„ç‰©ç†æ—¥å¿—</strong>ã€‚éšç€ç³»ç»Ÿè¿è¡Œï¼ŒBuffer
Pool çš„è„é¡µåˆ·æ–°åˆ°äº†ç£ç›˜ä¸­ï¼Œredo log
å¯¹åº”çš„è®°å½•ä¹Ÿå°±æ²¡ç”¨äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æ“¦é™¤è¿™äº›æ—§è®°å½•ï¼Œä»¥è…¾å‡ºç©ºé—´è®°å½•æ–°çš„æ›´æ–°æ“ä½œã€‚é‡åšæ—¥å¿—æ–‡ä»¶ç»„ç”±æœ‰
2 ä¸ª redo log
æ–‡ä»¶ç»„æˆï¼Œä»¥å¾ªç¯å†™çš„æ–¹å¼å·¥ä½œï¼Œä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å°±åˆå›åˆ°å¼€å¤´ï¼Œç›¸å½“äºä¸€ä¸ªç¯å½¢ã€‚</p>
<style>.thlofdsmlkkp{zoom: 50%;}</style>
<img data-src="/" class="thlofdsmlkkp" alt="img">
<ul>
<li>write pos ï½ checkpoint
ä¹‹é—´çš„éƒ¨åˆ†ï¼ˆå›¾ä¸­çº¢è‰²éƒ¨åˆ†ï¼‰ï¼šè®°å½•æ–°çš„æ›´æ–°æ“ä½œï¼›</li>
<li>check point ï½ write pos
ä¹‹é—´çš„éƒ¨åˆ†ï¼ˆå›¾ä¸­è“è‰²éƒ¨åˆ†ï¼‰ï¼šå¾…è½ç›˜çš„è„æ•°æ®é¡µè®°å½•ï¼›</li>
</ul>
<p>å°† Buffer Pool ä¸­çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œç„¶åæ ‡è®° redo log
å“ªäº›è®°å½•å¯ä»¥è¢«æ“¦é™¤ï¼Œæ¥ç€å¯¹æ—§çš„ redo log
è®°å½•è¿›è¡Œæ“¦é™¤ï¼Œç­‰æ“¦é™¤å®Œæ—§è®°å½•è…¾å‡ºäº†ç©ºé—´ï¼Œcheckpoint
å°±ä¼šå¾€åç§»åŠ¨ï¼ˆå›¾ä¸­é¡ºæ—¶é’ˆï¼‰ã€‚ä¸€æ¬¡ checkpoint
çš„è¿‡ç¨‹å°±æ˜¯è„é¡µåˆ·æ–°åˆ°ç£ç›˜ä¸­å˜æˆå¹²å‡€é¡µï¼Œç„¶åæ ‡è®° redo log
å“ªäº›è®°å½•å¯ä»¥è¢«è¦†ç›–çš„è¿‡ç¨‹ã€‚</p>
<h2 id="å½’æ¡£æ—¥å¿—-bin-log">å½’æ¡£æ—¥å¿— Bin log</h2>
<p>è®°å½• MySQL ä¸Šçš„æ‰€æœ‰å˜åŒ–å¹¶ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸Šã€‚MySQL
åœ¨å®Œæˆ<strong>æ•°æ®åº“è¡¨ç»“æ„å˜æ›´æˆ–è¡¨æ•°æ®ä¿®æ”¹</strong>ï¼ˆå¢åˆ æ”¹ï¼‰æ—¶ï¼ŒServer
å±‚ä¼šç”Ÿæˆä¸€æ¡
binlogï¼Œç­‰ä¹‹åäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¼šå°†è¯¥äº‹ç‰©æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰€æœ‰ binlog
ç»Ÿä¸€å†™å…¥ binlog æ–‡ä»¶ã€‚</p>
<ul>
<li>binlog æ—¥å¿—åªèƒ½ç”¨äºæ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶ï¼Œæ²¡æœ‰ crash-safe çš„èƒ½åŠ›ï¼›</li>
<li>binlog
æ˜¯å…¨é‡æ—¥å¿—ï¼Œä¿å­˜äº†æ‰€æœ‰æ•°æ®å˜æ›´çš„æƒ…å†µï¼Œå¯ä»¥æ¢å¤æ•´ä¸ªæ•°æ®åº“æ‰€æœ‰æ•°æ®ï¼›</li>
</ul>
<h3 id="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</h3>
<style>.kpbnlzhnnjjc{zoom:67%;}</style>
<img data-src="/" class="kpbnlzhnnjjc" alt="MySQL ä¸»ä»å¤åˆ¶è¿‡ç¨‹">
<ul>
<li>å†™å…¥ Binlogï¼šæ•°æ®ä¿®æ”¹ -&gt; ä¸»åº“å†™ binlog æ—¥å¿— -&gt; commit äº‹åŠ¡
-&gt; æŒä¹…åŒ–æœ¬åœ°æ•°æ® -&gt; æäº¤äº‹åŠ¡æˆåŠŸï¼›</li>
<li>åŒæ­¥ Binlogï¼šä»åº“ä¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ I/O çº¿ç¨‹ï¼Œè¿æ¥ä¸»åº“çš„ log dump
çº¿ç¨‹ï¼Œæ¥æ¥æ”¶ä¸»åº“çš„ binlog æ—¥å¿—ï¼Œå†æŠŠ binlog ä¿¡æ¯å†™å…¥ relay log
çš„ä¸­ç»§æ—¥å¿—é‡Œï¼Œå†è¿”å›ç»™ä¸»åº“â€œå¤åˆ¶æˆåŠŸâ€çš„å“åº”ã€‚</li>
<li>å›æ”¾ Binlogï¼šè¯» relay log ä¸­ç»§æ—¥å¿—ï¼Œå›æ”¾
binlogï¼Œå¹¶æ›´æ–°ä»åº“ä¸­çš„æ•°æ®ã€‚</li>
</ul>
<p>ä¸»ä»å¤åˆ¶æ¨¡å‹</p>
<ul>
<li>åŒæ­¥å¤åˆ¶ï¼šMySQL
ä¸»åº“æäº¤äº‹åŠ¡çš„çº¿ç¨‹è¦ç­‰å¾…æ‰€æœ‰ä»åº“çš„å¤åˆ¶æˆåŠŸå“åº”ï¼Œæ‰è¿”å›å®¢æˆ·ç«¯ç»“æœï¼›</li>
<li>å¼‚æ­¥å¤åˆ¶ï¼ˆé»˜è®¤æ¨¡å‹ï¼‰ï¼šMySQL ä¸»åº“æäº¤äº‹åŠ¡çš„çº¿ç¨‹å¹¶ä¸ä¼šç­‰å¾… binlog
åŒæ­¥åˆ°å„ä»åº“ï¼Œå°±è¿”å›å®¢æˆ·ç«¯ç»“æœï¼›</li>
<li>åŠåŒæ­¥å¤åˆ¶ï¼šåªè¦æ•°æ®æˆåŠŸå¤åˆ¶åˆ°ä»»æ„ä¸€ä¸ªä»åº“ä¸Šï¼Œä¸»åº“çš„äº‹åŠ¡çº¿ç¨‹å°±å¯ä»¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li>
</ul>
<h3 id="binlog-åˆ·ç›˜">binlog åˆ·ç›˜</h3>
<style>.hkpjnjdprxvo{zoom: 67%;}</style>
<img data-src="/" class="hkpjnjdprxvo" alt="binlog cach">
<ul>
<li>å›¾ä¸­çš„ writeï¼ŒæŠŠ<strong>æ—¥å¿—å†™å…¥åˆ° binlog æ–‡ä»¶ï¼ˆæ–‡ä»¶ç³»ç»Ÿçš„ page
cache é‡Œï¼‰</strong>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li>
<li>å›¾ä¸­çš„ fsyncï¼ŒæŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œï¼Œè¿™é‡Œå°±ä¼šæ¶‰åŠç£ç›˜
I/Oï¼Œæ‰€ä»¥é¢‘ç¹çš„ fsync ä¼šå¯¼è‡´ç£ç›˜çš„ I/O å‡é«˜ï¼›</li>
</ul>
<p>MySQL æä¾›ä¸€ä¸ª sync_binlog å‚æ•°æ¥æ§åˆ¶æ•°æ®åº“çš„ binlog
åˆ·åˆ°ç£ç›˜ä¸Šçš„é¢‘ç‡ï¼š</p>
<ul>
<li>sync_binlog = 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œä¸
fsyncï¼Œåç»­äº¤ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li>
<li>sync_binlog = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼š writeï¼Œç„¶åé©¬ä¸Šæ‰§è¡Œ
fsyncï¼›</li>
<li>sync_binlog =N(N&gt;1) çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ writeï¼Œä½†ç´¯ç§¯ N
ä¸ªäº‹åŠ¡åæ‰ fsyncã€‚</li>
</ul>
<h2 id="ä¸¤é˜¶æ®µæäº¤">ä¸¤é˜¶æ®µæäº¤</h2>
<p>binlog ä¸»ä»å¤åˆ¶å’Œ redo log
å´©æºƒæ¢å¤éœ€è¦ä¿æŒä¸€è‡´ï¼Œä¸ç„¶ä¼šå‡ºç°<strong>ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€å¤‡ä»½æ•°æ®ä¸çœŸå®æ•°æ®ä¸ä¸€è‡´</strong>ç­‰é—®é¢˜ã€‚MySQL
é‡‡ç”¨ä¸¤é˜¶æ®µæäº¤æ¥é¿å…ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´ï¼Œä¸¤é˜¶æ®µæäº¤æ˜¯ä¸€ç§<strong>åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§åè®®</strong>ã€‚</p>
<p>ä¸¤é˜¶æ®µæäº¤ï¼šæŠŠå•ä¸ªäº‹åŠ¡çš„æäº¤æ‹†åˆ†æˆäº† 2
ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯å‡†å¤‡é˜¶æ®µå’Œæäº¤é˜¶æ®µï¼ˆä¸æ˜¯ commit
è¯­å¥ï¼‰ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½ç”±åè°ƒè€…å’Œå‚ä¸è€…å…±åŒå®Œæˆã€‚</p>
<h3 id="å†…éƒ¨-xa-äº‹åŠ¡">å†…éƒ¨ XA äº‹åŠ¡</h3>
<style>.xoqsrbgpgkml{zoom:50%;}</style>
<img data-src="/" class="xoqsrbgpgkml" alt="ä¸¤é˜¶æ®µæäº¤">
<p>ä¸ºäº†ä¿è¯è¿™ä¸¤ä¸ªæ—¥å¿—çš„ä¸€è‡´æ€§ï¼ŒMySQL ä½¿ç”¨äº†å†…éƒ¨ XA äº‹åŠ¡ã€‚å†…éƒ¨ XA äº‹åŠ¡ç”±
binlog ä½œä¸ºåè°ƒè€…ï¼Œå­˜å‚¨å¼•æ“æ˜¯å‚ä¸è€…ï¼Œå¯ä»¥å®ç°è·¨æ•°æ®åº“äº‹åŠ¡ã€‚å°† redo log
çš„å†™å…¥æ‹†æˆäº†<strong>ä¸¤ä¸ªçŠ¶æ€ï¼šprepare å’Œ
commit</strong>ï¼Œä¸­é—´å†ç©¿æ’å†™å…¥binlogã€‚</p>
<ul>
<li>å¦‚æœ binlog ä¸­æ²¡æœ‰å½“å‰å†…éƒ¨ XA äº‹åŠ¡çš„ XIDï¼Œè¯´æ˜ redolog
å®Œæˆåˆ·ç›˜ï¼Œä½†æ˜¯ binlog è¿˜æ²¡æœ‰åˆ·ç›˜ï¼Œåˆ™<strong>å›æ»šäº‹åŠ¡</strong>ã€‚å¯¹åº”æ—¶åˆ»
<strong>A å´©æºƒæ¢å¤</strong>çš„æƒ…å†µï¼›</li>
<li>å¦‚æœ binlog ä¸­æœ‰å½“å‰å†…éƒ¨ XA äº‹åŠ¡çš„ XIDï¼Œè¯´æ˜ redolog å’Œ binlog
éƒ½å·²ç»å®Œæˆäº†åˆ·ç›˜ï¼Œåˆ™<strong>æäº¤äº‹åŠ¡</strong>ã€‚å¯¹åº”æ—¶åˆ» <strong>B
å´©æºƒæ¢å¤</strong>çš„æƒ…å†µï¼›</li>
</ul>
<p>å¯¹äºå¤„äº prepare é˜¶æ®µçš„ redo
logï¼Œå³å¯ä»¥æäº¤äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥å›æ»šäº‹åŠ¡ï¼Œè¿™å–å†³äºæ˜¯å¦èƒ½åœ¨ binlog ä¸­æŸ¥æ‰¾åˆ°ä¸
redo log ç›¸åŒçš„ XIDï¼Œä»¥ binlog å†™æˆåŠŸä¸ºäº‹åŠ¡æäº¤æˆåŠŸçš„æ ‡è¯†ã€‚</p>
<h2 id="ç»„æäº¤">ç»„æäº¤</h2>
<p>é‡‡ç”¨<strong>ç»„æäº¤</strong>ç­–ç•¥ï¼Œå‡å°‘ redolog å’Œ binlog
ä¸¤æ¬¡åˆ·ç›˜å¯¼è‡´çš„ <strong>I/O
æ¬¡æ•°é«˜</strong>å’Œ<strong>é”ç«äº‰æ¿€çƒˆ</strong>çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>å¤šäº‹åŠ¡åœºæ™¯ä¸‹ï¼Œä¸¤é˜¶æ®µæäº¤ä¼šå¯¼è‡´é”ç«äº‰æ¿€çƒˆï¼Œå› ä¸ºä¸ºä¿è¯ä¸¤ä¸ªæ—¥å¿—ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼Œéœ€è¦åŠ é”æ“ä½œä¿è¯ä¸¤é˜¶æ®µæäº¤çš„åŸå­æ€§ã€‚</p>
</blockquote>
<p><strong>binlog ç»„æäº¤æœºåˆ¶</strong>ï¼šå½“æœ‰å¤šä¸ªäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¼šå°†å¤šä¸ª
binlog åˆ·ç›˜æ“ä½œåˆå¹¶æˆä¸€ä¸ªï¼Œä»è€Œå‡å°‘ç£ç›˜ I/O çš„æ¬¡æ•°ã€‚prepare
é˜¶æ®µä¸å˜ï¼Œåªé’ˆå¯¹ commit é˜¶æ®µï¼Œå°† commit é˜¶æ®µæ‹†åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>flush é˜¶æ®µ</strong>ï¼šå¤šä¸ªäº‹åŠ¡æŒ‰è¿›å…¥çš„é¡ºåºå°† binlog ä» cache
å†™å…¥æ–‡ä»¶ï¼ˆä¸åˆ·ç›˜ï¼‰ï¼›5.7 ä¹‹ååœ¨è¯¥é˜¶æ®µå¢åŠ äº† redo log çš„ç»„æäº¤ï¼Œå³å¤šä¸ªäº‹åŠ¡
redo log ç»Ÿä¸€åˆ·ç›˜ï¼›
<ul>
<li>ç±»ä¼¼äº XA äº‹åŠ¡çš„ Prepare é˜¶æ®µï¼Œå¦‚æœåœ¨è¿™ä¸€æ­¥å®Œæˆåæ•°æ®åº“å´©æºƒï¼Œç”±äº
binlog ä¸­æ²¡æœ‰è¯¥ç»„äº‹åŠ¡çš„è®°å½•ï¼Œæ‰€ä»¥ MySQL ä¼šåœ¨é‡å¯åå›æ»šè¯¥ç»„äº‹åŠ¡ï¼›</li>
</ul></li>
<li><strong>sync é˜¶æ®µ</strong>ï¼šå¯¹ binlog æ–‡ä»¶åš fsync æ“ä½œï¼ˆå¤šä¸ªäº‹åŠ¡çš„
binlog åˆå¹¶ä¸€æ¬¡åˆ·ç›˜ï¼‰ï¼›
<ul>
<li>ç±»ä¼¼äº XA äº‹åŠ¡çš„ Commit é˜¶æ®µï¼Œå¦‚æœåœ¨è¿™ä¸€æ­¥å®Œæˆåæ•°æ®åº“å´©æºƒï¼Œç”±äº
binlog ä¸­å·²ç»æœ‰äº†äº‹åŠ¡è®°å½•ï¼ŒMySQLä¼šåœ¨é‡å¯åé€šè¿‡ redo log
åˆ·ç›˜çš„æ•°æ®ç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚</li>
</ul></li>
<li><strong>commit é˜¶æ®µ</strong>ï¼šå„ä¸ªäº‹åŠ¡æŒ‰é¡ºåºåš InnoDB commit
æ“ä½œï¼›</li>
</ul>
<p>æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé”å°±åªé’ˆå¯¹æ¯ä¸ªé˜Ÿåˆ—è¿›è¡Œä¿æŠ¤ï¼Œä¸å†é”ä½æäº¤äº‹åŠ¡çš„æ•´ä¸ªè¿‡ç¨‹ã€‚å‡å°äº†é”ç²’åº¦ï¼Œè¿™æ ·å°±ä½¿å¾—å¤šä¸ªé˜¶æ®µå¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡æ•ˆç‡ã€‚</p>
<h2 id="æ€»ç»“æ¨¡æ‹Ÿä¸€æ¬¡æ›´æ–°æµç¨‹">æ€»ç»“æ¨¡æ‹Ÿä¸€æ¬¡æ›´æ–°æµç¨‹</h2>
<ul>
<li>MySQL æ‰§è¡Œå™¨æ£€æŸ¥è®°å½•æ˜¯å¦åœ¨ buffer pool ä¸­
<ul>
<li>è‹¥ä¸åœ¨ï¼Œå°†æ•°æ®é¡µä»ç£ç›˜è¯»å…¥åˆ° buffer poolï¼›</li>
<li>è‹¥æ›´æ–°å‰ä¸æ›´æ–°åæ•°æ®ä¸åŒï¼Œè°ƒç”¨ å­˜å‚¨å¼•æ“ æ‰§è¡Œæ›´æ–°æ“ä½œï¼›</li>
</ul></li>
<li>å¼€å¯äº‹åŠ¡ï¼Œè®°å½• undo logï¼ŒåŒæ—¶å°† Undo é¡µçš„ä¿®æ”¹è®°å½•å­˜åœ¨ redo log
ä¸­ï¼›</li>
<li>å­˜å‚¨å¼•æ“æ›´æ–°æ•°æ®ï¼Œå¹¶æ ‡è®°æ•°æ®é¡µä¸ºè„é¡µï¼ŒåŒæ—¶å°†æ•°æ®é¡µçš„ä¿®æ”¹è®°å½•å­˜åœ¨
redo log ä¸­ï¼›
<ul>
<li>ä¸ºäº†å‡å°‘ç£ç›˜I/Oï¼Œè„é¡µé€‰æ‹©åˆé€‚æ—¶é—´æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼ŒæŒä¹…åŒ–ååˆ é™¤å¯¹åº”çš„
redo logï¼›</li>
</ul></li>
<li>è®°å½•æ›´æ–°å®Œæ¯•ï¼Œè®°å½• binlog è‡³ binlog cacheï¼›</li>
<li>äº‹åŠ¡æäº¤ï¼Œå°† redolog binlog æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼ˆä¸¤é˜¶æ®µæäº¤ï¼›ç»„æäº¤ï¼‰
<ul>
<li>prepare é˜¶æ®µ</li>
<li>commit é˜¶æ®µ</li>
</ul></li>
</ul>
<p>è„é¡µåˆ·ç›˜çš„æ—¶æœº</p>
<ul>
<li>Redo log æ»¡äº†ï¼›</li>
<li>BufferPoolæ»¡äº†ï¼›</li>
<li>MySQLç©ºé—²ï¼›</li>
<li>åå°çº¿ç¨‹å®šæ—¶ checkpointï¼›</li>
<li>äº‹åŠ¡æäº¤æ—¶ï¼ˆä¸€èˆ¬ä¸é€‰ï¼‰ï¼›</li>
</ul>
<h1 id="å†…å­˜">å†…å­˜</h1>
<p><strong>Buffer Pool ç¼“å­˜</strong>çš„å†…å®¹åŒ…æ‹¬ï¼šç´¢å¼•é¡µã€æ•°æ®é¡µã€Undo
é¡µã€æ’å…¥ç¼“å­˜é¡µã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€é”ä¿¡æ¯ç­‰ã€‚<code>innodb_buffer_pool_size</code>
é»˜è®¤ 128MBã€‚</p>
<p>ä¸ºäº†ç®¡ç†è¿™äº›åœ¨ Buffer Pool ä¸­çš„ç¼“å­˜é¡µï¼ŒInnoDB
ä¸ºæ¯ä¸€ä¸ªç¼“å­˜é¡µéƒ½åˆ›å»ºäº†ä¸€ä¸ª<strong>æ§åˆ¶å—</strong>ï¼Œæ§åˆ¶å—ä¿¡æ¯åŒ…æ‹¬ï¼šç¼“å­˜é¡µçš„è¡¨ç©ºé—´ã€é¡µå·ã€ç¼“å­˜é¡µåœ°å€ã€é“¾è¡¨èŠ‚ç‚¹ç­‰ç­‰ã€‚ç”¨ä¸‰ç§é“¾è¡¨ç®¡ç†ä¸åŒçŠ¶æ€çš„ç¼“å­˜å—ï¼š</p>
<ul>
<li>Free List ï¼ˆç©ºé—²é¡µé“¾è¡¨ï¼‰ï¼Œç®¡ç†ç©ºé—²é¡µï¼›</li>
<li>Flush List ï¼ˆè„é¡µé“¾è¡¨ï¼‰ï¼Œç®¡ç†è„é¡µï¼›</li>
<li>LRU
Listï¼Œç®¡ç†è„é¡µ+å¹²å‡€é¡µï¼Œå°†ç»å¸¸æŸ¥è¯¢æˆ–å¯èƒ½å°†è¦æŸ¥è¯¢çš„æ•°æ®ç¼“å­˜åœ¨å…¶ä¸­ï¼Œè€Œä¸å¸¸æŸ¥è¯¢çš„æ•°æ®å°±æ·˜æ±°å‡ºå»ï¼›</li>
</ul>
<p><strong>Free é“¾è¡¨</strong>ï¼šä½¿ç”¨é“¾è¡¨ç»“æ„ï¼Œå¿«é€Ÿæ‰¾åˆ°ç©ºé—²çš„ç¼“å­˜é¡µï¼›</p>
<p>æ¯å½“éœ€è¦ä»ç£ç›˜ä¸­åŠ è½½ä¸€ä¸ªé¡µåˆ° Buffer Pool ä¸­æ—¶ï¼Œå°±ä»
Freeé“¾è¡¨ä¸­å–ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µï¼Œå¹¶ä¸”æŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„æ§åˆ¶å—çš„ä¿¡æ¯å¡«ä¸Šï¼Œç„¶åæŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„æ§åˆ¶å—ä»
Free é“¾è¡¨ä¸­ç§»é™¤</p>
<style>.tjncwnrwspxi{zoom: 67%;}</style>
<img data-src="/" class="tjncwnrwspxi" alt="img">
<p><strong>Flush é“¾è¡¨</strong>ï¼šä½¿ç”¨é“¾è¡¨ç»“æ„ï¼Œå¿«é€Ÿæ‰¾åˆ°è„é¡µï¼›ï¼ˆç»“æ„ç±»ä¼¼äº
Free é“¾è¡¨ï¼‰</p>
<p>è„é¡µè½ç›˜æ—¶ï¼Œåå°çº¿ç¨‹éå† Flush é“¾è¡¨</p>
<h2 id="æé«˜ç¼“å­˜å‘½ä¸­ç‡">æé«˜ç¼“å­˜å‘½ä¸­ç‡</h2>
<p>Buffer Pool æœ‰ä¸‰ç§é¡µå’Œé“¾è¡¨ç”¨æ¥ç®¡ç†æ•°æ®</p>
<style>.qyjdunhlmswo{zoom:67%;}</style>
<img data-src="/" class="qyjdunhlmswo" alt="img">
<ul>
<li>Free Pageï¼ˆç©ºé—²é¡µï¼‰ï¼Œè¡¨ç¤ºæ­¤é¡µæœªè¢«ä½¿ç”¨ï¼Œä½äº Free é“¾è¡¨ï¼›</li>
<li>Clean Pageï¼ˆå¹²å‡€é¡µï¼‰ï¼Œè¡¨ç¤ºæ­¤é¡µå·²è¢«ä½¿ç”¨ï¼Œä½†æ˜¯é¡µé¢æœªå‘ç”Ÿä¿®æ”¹ï¼Œä½äºLRU
é“¾è¡¨ã€‚</li>
<li>Dirty
Pageï¼ˆè„é¡µï¼‰ï¼Œè¡¨ç¤ºæ­¤é¡µã€Œå·²è¢«ä½¿ç”¨ã€ä¸”ã€Œå·²ç»è¢«ä¿®æ”¹ã€ï¼Œå…¶æ•°æ®å’Œç£ç›˜ä¸Šçš„æ•°æ®å·²ç»ä¸ä¸€è‡´ã€‚å½“è„é¡µä¸Šçš„æ•°æ®å†™å…¥ç£ç›˜åï¼Œå†…å­˜æ•°æ®å’Œç£ç›˜æ•°æ®ä¸€è‡´ï¼Œé‚£ä¹ˆè¯¥é¡µå°±å˜æˆäº†å¹²å‡€é¡µã€‚è„é¡µåŒæ—¶å­˜åœ¨äº
LRU é“¾è¡¨å’Œ Flush é“¾è¡¨ã€‚</li>
</ul>
<p>æ™®é€šçš„LRU ç®—æ³•ä¼šå‡ºç°ä»¥ä¸‹<strong>ä¸¤ä¸ªé—®é¢˜</strong></p>
<ul>
<li>é¢„è¯»å¤±æ•ˆï¼šåŠ è½½è®¿é—®æ•°æ®é¡µæ—¶ï¼Œæå‰åŠ è½½è¿›æ¥çš„<strong>ç›¸é‚»æ•°æ®</strong>é¡µï¼Œå³é¢„è¯»é¡µï¼Œä½†åç»­å¹¶æ²¡æœ‰è®¿é—®é¢„è¯»é¡µï¼›</li>
<li>Buffer Pool æ±¡æŸ“ï¼šæŸä¸€ä¸ª SQL è¯­å¥æ‰«æäº†å¤§é‡çš„æ•°æ®æ—¶ï¼Œå°† Buffer Pool
é‡Œçš„æ‰€æœ‰é¡µéƒ½æ›¿æ¢å‡ºå»ï¼Œå¯¼è‡´<strong>å¤§é‡çƒ­æ•°æ®è¢«æ·˜æ±°</strong>äº†ï¼Œåç»­çƒ­æ•°æ®è¢«è®¿é—®æ—¶ä¼šäº§ç”Ÿå¤§é‡ç£ç›˜
I/Oï¼›
<ul>
<li>ç´¢å¼•å¤±æ•ˆæ‰¹é‡æ‰«æçš„æ—¶å€™ä¼šå‡ºç°æ±¡æŸ“</li>
</ul></li>
</ul>
<p><strong>è§£å†³åŠæ³•</strong></p>
<ul>
<li>å°† LRU åˆ’åˆ†äº† 2 ä¸ªåŒºåŸŸï¼šold åŒºåŸŸ å’Œ young
åŒºåŸŸã€‚åˆ’åˆ†è¿™ä¸¤ä¸ªåŒºåŸŸåï¼Œé¢„è¯»çš„é¡µå°±åªéœ€è¦åŠ å…¥åˆ° old
åŒºåŸŸçš„å¤´éƒ¨ï¼Œå½“é¡µè¢«çœŸæ­£è®¿é—®çš„æ—¶å€™ï¼Œæ‰å°†é¡µæ’å…¥ young åŒºåŸŸçš„å¤´éƒ¨ã€‚</li>
<li>åªæœ‰åŒæ—¶æ»¡è¶³<strong>è¢«è®¿é—®</strong>ä¸åœ¨ <strong>old åŒºåŸŸåœç•™æ—¶é—´è¶…è¿‡
<code>innodb_old_blocks_time</code> ç§’</strong>ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰ä¼šè¢«æ’å…¥åˆ°
young åŒºåŸŸå¤´éƒ¨</li>
<li>young åŒºåŸŸä¼˜åŒ–ï¼šä¸ºäº†é˜²æ­¢ young åŒºåŸŸèŠ‚ç‚¹é¢‘ç¹ç§»åŠ¨åˆ°å¤´éƒ¨ã€‚young
åŒºåŸŸå‰é¢ 1/4 è¢«è®¿é—®ä¸ä¼šç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œåªæœ‰åé¢çš„ 3/4è¢«è®¿é—®äº†æ‰ä¼š</li>
</ul>
<h1 id="ä¼˜åŒ–">ä¼˜åŒ–</h1>
<p>ç£ç›˜IOã€ç´¢å¼•ã€<a
href="https://www.cnblogs.com/yanggb/p/11058707.html">æ•°æ®åˆ†é¡µï¼ˆæŸ¥è¯¢å¤§é‡æ•°æ®ï¼‰</a>ã€é”ç«äº‰ã€å†…å­˜ä½¿ç”¨ä¸‹Â·</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Rpc ä¸­é—´ä»¶</title>
    <url>/#developer/Rpc/</url>
    <content><![CDATA[<img data-src="/" class="" title="å›¾ç‰‡è¯´æ˜">
<p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„ CAP ç†è®º</p>
<ul>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šæ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬</li>
<li>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šéæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”ï¼ˆä¸æ˜¯é”™è¯¯æˆ–è€…è¶…æ—¶çš„å“åº”ï¼‰</li>
<li>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition
Toleranceï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°ç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚</li>
</ul>
<p>åˆ†å¸ƒå¼ä¿è¯æœåŠ¡é«˜å¹¶å‘ç¨³å®šæ€§</p>
<ul>
<li>ç¼“å­˜ï¼šç¼“å­˜æ˜¯ä¸€ç§æé«˜æ•°æ®è¯»å–æ€§èƒ½çš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨å†…å­˜ä¸­å­˜å‚¨ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¯ä»¥å‡å°‘å¯¹æ•°æ®åº“æˆ–è€…å…¶ä»–å­˜å‚¨ç³»ç»Ÿçš„è®¿é—®ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚ç¼“å­˜å¯ä»¥åº”ç”¨åœ¨å¤šä¸ªå±‚æ¬¡ï¼Œä¾‹å¦‚æµè§ˆå™¨ç¼“å­˜ã€CDN
ç¼“å­˜ã€åå‘ä»£ç†ç¼“å­˜ã€åº”ç”¨ç¼“å­˜ç­‰ã€‚</li>
<li>é™çº§ï¼šé™çº§æ˜¯åœ¨ç³»ç»Ÿå‹åŠ›è¿‡å¤§æˆ–è€…éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œæš‚æ—¶å…³é—­ä¸€äº›éæ ¸å¿ƒçš„æœåŠ¡ï¼Œä»¥ä¿è¯æ ¸å¿ƒæœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚é™çº§å¯ä»¥åœ¨å¤šä¸ªå±‚æ¬¡è¿›è¡Œï¼Œä¾‹å¦‚é¡µé¢é™çº§ã€åŠŸèƒ½é™çº§ã€æœåŠ¡é™çº§ç­‰ã€‚</li>
<li>é™æµï¼šé™æµæ˜¯ä¸€ç§æ§åˆ¶ç³»ç»Ÿå¤„ç†è¯·æ±‚çš„é€Ÿç‡çš„æŠ€æœ¯ï¼Œä»¥é˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚é™æµå¯ä»¥é€šè¿‡å¤šç§ç®—æ³•å®ç°ï¼Œä¾‹å¦‚å›ºå®šçª—å£ã€æ»‘åŠ¨çª—å£ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ç­‰ã€‚</li>
</ul>
<p>Nacos é…ç½®ä¸­å¿ƒ æ³¨å†Œä¸­å¿ƒ</p>
<h1 id="rpc-æ¡†æ¶">RPC æ¡†æ¶</h1>
<blockquote>
<p>æ³›æŒ‡è°ƒç”¨è¿œç¨‹çš„å‡½æ•°çš„æ–¹æ³•ï¼Œå¯¹ç¼–è§£ç å’Œç½‘ç»œå±‚æœ‰ç‰¹æ®Šçš„ä¼˜åŒ–ï¼Œä»è€Œæœ‰æ›´é«˜çš„æ•ˆç‡ã€‚</p>
</blockquote>
<p>RPC æ¡†æ¶ä¸»è¦ç”± Serverã€Clientã€Server Stubã€Client Stub ç»„ä»¶ç»„æˆ</p>
<ul>
<li>Client Stub
ä¸»è¦æ˜¯å°†å®¢æˆ·ç«¯çš„è¯·æ±‚å‚æ•°ã€è¯·æ±‚æœåŠ¡åœ°å€ã€è¯·æ±‚æœåŠ¡åç§°åšä¸€ä¸ªå°è£…ï¼Œå¹¶å‘é€ç»™
Server Stub</li>
<li>Server Stub ä¸»è¦ç”¨äºæ¥æ”¶ Client Stub å‘é€çš„æ•°æ®å¹¶è§£æï¼Œå»è°ƒç”¨ Server
ç«¯çš„æœ¬åœ°æ–¹æ³•</li>
</ul>
<p>å±‚æ¬¡ç»“æ„ï¼šä»£ç†æ›¾ã€æ³¨å†Œä¸­å¿ƒå±‚ï¼ˆæœåŠ¡å‘ç°ã€æ³¨å†Œã€ç®¡ç†ï¼‰ã€</p>
<p>RPC åè®®å®šåˆ¶åŒ–ç¨‹åº¦é«˜ï¼Œå¯ä»¥é‡‡ç”¨ä½“ç§¯æ›´å°çš„ Protobuf
æˆ–å…¶ä»–åºåˆ—åŒ–åè®®å»ä¿å­˜ç»“æ„ä½“æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦åƒ HTTP
é‚£æ ·è€ƒè™‘å„ç§æµè§ˆå™¨è¡Œä¸ºï¼Œå¦‚ 302
é‡å®šå‘è·³è½¬ã€‚å› æ­¤æ€§èƒ½ä¹Ÿä¼šæ›´å¥½ä¸€äº›ã€‚å…¶åº•å±‚ä¸ä»…å¯ä»¥é€šè¿‡ tcp udp
å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ http å®ç°ã€‚</p>
<p>RPC
åè®®ä¼šå»ºä¸ªè¿æ¥æ± ï¼Œåœ¨è¯·æ±‚é‡å¤§çš„æ—¶å€™ï¼Œå»ºç«‹å¤šæ¡è¿æ¥æ”¾åœ¨æ± å†…ï¼Œè¦å‘æ•°æ®çš„æ—¶å€™å°±ä»æ± é‡Œå–ä¸€æ¡è¿æ¥å‡ºæ¥ï¼Œç”¨å®Œæ”¾å›å»ï¼Œä¸‹æ¬¡å†å¤ç”¨ï¼Œå¯ä»¥è¯´éå¸¸ç¯ä¿ã€‚</p>
<p>ç›®å‰ï¼Œå¯¹å¤–ä¸€èˆ¬ç”¨ HTTP åè®®ï¼Œè€Œå†…éƒ¨é›†ç¾¤çš„å¾®æœåŠ¡ä¹‹é—´åˆ™é‡‡ç”¨ RPC
åè®®è¿›è¡Œé€šè®¯ã€‚</p>
<h1 id="dubbo-ä¸Šçº¿é—®é¢˜">Dubbo ä¸Šçº¿é—®é¢˜</h1>
<p>è®°å½•ã€å­¦ä¹ ã€æ±‡æ€»å®ä¹ å’ŒæŠ€æœ¯åšå®¢ä¸­çœ‹åˆ°çš„ Dubbo å®æˆ˜é‡åˆ°çš„é—®é¢˜</p>
<h2 id="æœåŠ¡ç«¯æ¥å£ä¸æŒ‡å®šé€šè®¯åè®®å¯¼è‡´-oom">æœåŠ¡ç«¯æ¥å£ä¸æŒ‡å®šé€šè®¯åè®®å¯¼è‡´
OOM</h2>
<p>é—®é¢˜èƒŒæ™¯ï¼š</p>
<p>é—®é¢˜æè¿°ï¼š</p>
<ul>
<li><p>å¼€å‘äººå‘˜ä½¿ç”¨æ–¹æ²¡æœ‰é…ç½®æ¥å£çš„ protocol
å­—æ®µï¼Œè€Œæ˜¯å†™åœ¨æ¥å£å®ç°ç±»ä¸Š</p></li>
<li><p><code>dubbo-3.0.4</code> æ¡†æ¶ï¼š</p>
<ul>
<li>è‹¥æ²¡æœ‰æŒ‡å®š protocol å­—æ®µï¼Œä¼šåˆ›å»ºæœåŠ¡ç«¯æä¾›çš„æ‰€æœ‰åè®®çš„ invoker</li>
<li>EasyREST åŒ…<code>createClientInvoker</code>åˆ›å»º REST åè®®çš„ invoker
æ—¶éœ€è¦ HttpMethod å‚æ•°</li>
<li>ç”±äºæ³¨è§£å†™åœ¨å®ç°ç±»è€Œä¸æ˜¯æ¥å£ä¸Šé¢ï¼Œå¯¼è‡´æ¶ˆè´¹ç«¯æ— æ³•å…±äº«ç›¸åº”çš„ REST
é…ç½®ä¿¡æ¯ï¼Œå³ HttpMethod ä¸º nullï¼Œå› æ­¤ RESTClient åˆ›å»ºå¤±è´¥</li>
<li>åœ¨æœåŠ¡æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡éƒ½æ˜¯å…¨é‡æ›´æ–°æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ç«¯ä¿¡æ¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœ
invoker
ä¸€ç›´æ³¨å†Œå¤±è´¥ï¼Œä¼šä¸æ–­å°†å¤±è´¥çš„<code>Client</code>å­˜åˆ°<code>List&lt;ResteasyClient&gt;</code>ä¸­ï¼Œå¦‚æœæœ‰
n å°æœºå™¨éœ€è¦ä¾æ¬¡æ›´æ–°ï¼Œè¿™æ—¶å®¢æˆ·ç«¯çš„æ•°ç»„ä¸­ä¼šå­˜ n*n
ä¸ªå¤±è´¥çš„è¿æ¥å®ä¾‹ï¼Œä»è€Œå¯¼è‡´ OOM</li>
</ul></li>
</ul>
<p>è§£å†³æ–¹æ³•ï¼ˆé’ˆå¯¹æ¡†æ¶ï¼Œå¼€å‘äººå‘˜éœ€è¦ç‰¢è®° Dubbo é…ç½®å¿…é¡»åœ¨æ¥å£ä¸Šï¼‰ï¼š</p>
<ul>
<li>ResteasyClient å¯¹è±¡ç”± RestProtocol åè®®å¯¹è±¡æŒæœ‰ï¼Œé’ˆå¯¹æ²¡æœ‰åˆ›å»ºæˆåŠŸ
invoker çš„åœºæ™¯åº”æŠŠå…¶å¯¹åº”çš„ ResteasyClient <u>é”€æ¯</u>æ‰</li>
</ul>
<p>é”€æ¯æ–¹æ³•</p>
<ul>
<li>ç”¨<code>Map&lt;String, ResteasyClient&gt;</code>ä»£æ›¿
<code>List&lt;ResteasyClient&gt;</code>ï¼ŒåŒä¸€ä¸ªæœåŠ¡ç«¯åªå­˜ä¸€æ¬¡</li>
<li>ç”¨<code>WeakHashMap&lt;String, ResteasyClient&gt;</code>è‡ªåŠ¨å›æ”¶ä¸ç”¨çš„
ResteasyClientï¼ˆå‚è€ƒ<a
href="https://github.com/apache/dubbo/pull/4629">pr</a>ï¼‰</li>
</ul>
<p><a
href="https://tech.youzan.com/ji-ci-dubbofu-wu-fa-xian-dao-zhi-de-oom/">å‚è€ƒ</a></p>
<h2 id="çˆ¶å­çº¿ç¨‹å¹¶å‘-rpc-è°ƒç”¨æ­»é”">çˆ¶å­çº¿ç¨‹å¹¶å‘ RPC è°ƒç”¨æ­»é”</h2>
<p>é—®é¢˜æè¿°ï¼š</p>
<ul>
<li>ç›´æ¥é€šè¿‡ <code>Executors</code> æ„é€  å›ºå®šæ•°é‡+æ— é™é•¿ç­‰å¾…é˜Ÿåˆ—
çº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± åœ¨å…±äº«çš„æ— ç•Œé˜Ÿåˆ—ä¸Šæ“ä½œçš„å›ºå®šæ•°é‡çš„çº¿ç¨‹ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œæœ€å¤šnThreadsçº¿ç¨‹å°†å¤„äºæ´»åŠ¨å¤„ç†ä»»åŠ¡çŠ¶æ€ã€‚å¦‚æœåœ¨æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æäº¤é¢å¤–çš„ä»»åŠ¡ï¼Œå®ƒä»¬å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç›´åˆ°æœ‰çº¿ç¨‹å¯ç”¨ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¹¶å‘è°ƒç”¨ Rpc æ¥å£è·å–è¿”å›å€¼</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Future&lt;String&gt; future = executor.submit(()-&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> æ•°æ®æŸ¥è¯¢ä»»åŠ¡;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>æ•°æ®æŸ¥è¯¢ä»»åŠ¡ä¸­å­˜åœ¨çˆ¶å­è°ƒç”¨å…³ç³»ï¼Œæ•°æ®æŸ¥è¯¢ä»»åŠ¡åŒæ­¥è°ƒç”¨ Redis
æŸ¥è¯¢ç¼“å­˜å’Œ Rpc è°ƒç”¨å¾®æœåŠ¡è·å¾—æ•°æ®ã€‚å¦‚æœæœ¬åœ° Redis
ç¼“å­˜ä¸­èƒ½è·å¾—æ•°æ®ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜å€¼å¹¶å–æ¶ˆ Rpc è°ƒç”¨
<code>future.cancel(true)</code>ã€‚</li>
</ul>
<p>è§£å†³åŠæ³•</p>
<ul>
<li>çˆ¶å­ä»»åŠ¡åˆ†å¼€å¹¶å‘æ‰§è¡Œï¼Œè€—æ—¶çš„å¼‚æ­¥çº¿ç¨‹åº”åšå¥½çº¿ç¨‹æ± éš”ç¦»</li>
<li><code>CompletableFuture.anyOf(task1,tsak2)</code>
ä¼˜å…ˆå–å…ˆå®Œæˆçš„é‚£ä¸ªä»»åŠ¡çš„è¿”å›å€¼</li>
</ul>
<p><a href="https://heapdump.cn/article/646639">å‚è€ƒ</a></p>
<h1 id="å°è¯•å¼€å‘åŸºç¡€ç‰ˆ-rpc-ä¸­é—´ä»¶">å°è¯•å¼€å‘åŸºç¡€ç‰ˆ Rpc ä¸­é—´ä»¶</h1>
<p><strong>æœåŠ¡å‘ç°æµç¨‹</strong>ï¼šä½¿ç”¨è¿œç¨‹æœåŠ¡çš„æ—¶å€™é¦–å…ˆéœ€è¦é…ç½®ä¸€ä¸ª
dubbo.xml
æ–‡ä»¶æˆ–è€…åœ¨ä½¿ç”¨çš„ç±»åŠ ä¸Š<code>@Reference</code>ï¼ŒäºŒè€…éƒ½æ˜¯ç”¨æ¥å¯¹dubboæ¶ˆè´¹è€…å¼•ç”¨æœåŠ¡è¿›è¡Œä¸€äº›é…ç½®ï¼Œç„¶ååº”ç”¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šå°†é…ç½®ä¿¡æ¯è½¬åŒ–ä¸ºä¸€ä¸ª<code>ReferenceBean</code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨<code>createProxy</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªè¿œç¨‹æœåŠ¡æ¥å£çš„ä»£ç†å¯¹è±¡ã€‚</p>
<p>ä»£ç†å¯¹è±¡çš„ <strong>invoke
åˆ›å»º</strong>ï¼šå¯åŠ¨æ—¶ä¸»åŠ¨è®¢é˜…æ³¨å†Œä¸­å¿ƒï¼Œä¼šæ˜¾ç¤ºåœ°è°ƒç”¨ä¸€æ¬¡<code>notify</code>æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¼šå°è¯•å°†è¿œç¨‹æœåŠ¡æ³¨å†Œçš„<code>url</code>è½¬æ¢æˆä¸€ä¸ªæœ¬åœ°çš„<code>invoker</code>ã€‚</p>
<ul>
<li>è½¬æ¢è¿‡ç¨‹ä¸­ä¼šæ ¹æ®å…·ä½“çš„ <code>protocol</code> åˆ›å»ºå¯¹åº”çš„
<code>invoker</code>ï¼Œå¦‚ Rest å’Œ Dubbo éœ€è¦è§£æä¸åŒçš„å‚æ•°ã€‚</li>
</ul>
<p>æœåŠ¡æ³¨å†Œåœ°å€å‘ç”Ÿæ”¹å˜æ—¶ï¼šä¼šé€šçŸ¥ç»™æ¶ˆè´¹è€…ï¼Œdubbo
åè®®é‡Œé¢æ˜ç¡®è®²åˆ°æœåŠ¡å‘ç”Ÿæ”¹å˜ä¼šå…¨é‡æ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„ç¼“å­˜</p>
<h2 id="netty-æ•°æ®ä¼ è¾“">Netty æ•°æ®ä¼ è¾“</h2>
<blockquote>
<p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œåºåˆ—åŒ–å’Œç¼–ç é€šå¸¸æ˜¯ç»“åˆä½¿ç”¨çš„ã€‚<strong>åºåˆ—åŒ–å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œç¼–ç å°†å­—èŠ‚æµè½¬æ¢ä¸ºç½‘ç»œä¼ è¾“æ‰€éœ€çš„æ ¼å¼</strong>ï¼ˆå¦‚æŒ‰ç…§åè®®è§„å®šçš„æ ¼å¼è¿›è¡Œç¼–ç ï¼‰ã€‚åœ¨æ¥æ”¶ç«¯ï¼Œ<strong>è§£ç å°†ç½‘ç»œä¼ è¾“çš„æ•°æ®è§£æä¸ºåŸå§‹çš„æ ¼å¼ï¼ˆå¦‚è§£ç æˆå¯¹è±¡ï¼‰</strong>ï¼Œä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†å’Œä½¿ç”¨ã€‚</p>
</blockquote>
<p>Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½<strong>äº‹ä»¶é©±åŠ¨å‹éé˜»å¡ IO æ¡†æ¶</strong>ï¼š</p>
<ul>
<li>æä¾›äº† ByteBuf å®¹å™¨ï¼Œæ›´æ–¹ä¾¿åœ°å¤„ç†æ•°æ®ã€‚<code>ByteBuf</code>
åœ¨é‡å†™ç¼–è§£ç å™¨çš„ encoder/decoder æ–¹æ³•ä¸­ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li>
<li>channel</li>
</ul>
<p>ç¼–ç ï¼šå…ˆåºåˆ—åŒ–ï¼Œå†å‹ç¼©ï¼Œæœ€åå†™è¿› ByteBuf å¯¹è±¡ä¸­</p>
<p>è§£ç ï¼šä» ByteBuf å¯¹è±¡ä¸­è¯»ï¼Œç„¶åè½¬æˆæˆ‘ä»¬éœ€è¦çš„å¯¹è±¡</p>
<h2 id="ä»£ç†æ¨¡å¼">ä»£ç†æ¨¡å¼</h2>
<p><strong>é™æ€ä»£ç†</strong></p>
<blockquote>
<p>é™æ€ä»£ç†ä¸­ï¼Œæˆ‘ä»¬å¯¹ç›®æ ‡å¯¹è±¡çš„æ¯ä¸ªæ–¹æ³•çš„å¢å¼ºéƒ½æ˜¯æ‰‹åŠ¨å®Œæˆçš„ï¼ˆåé¢ä¼šå…·ä½“æ¼”ç¤ºä»£ç ï¼‰ï¼Œéå¸¸ä¸çµæ´»ï¼ˆæ¯”å¦‚æ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼‰ä¸”éº»çƒ¦(éœ€è¦å¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½å•ç‹¬å†™ä¸€ä¸ªä»£ç†ç±»)ã€‚
å®é™…åº”ç”¨åœºæ™¯éå¸¸éå¸¸å°‘ï¼Œæ—¥å¸¸å¼€å‘å‡ ä¹çœ‹ä¸åˆ°ä½¿ç”¨é™æ€ä»£ç†çš„åœºæ™¯ã€‚</p>
</blockquote>
<p>ä» JVM å±‚é¢æ¥è¯´ï¼Œ
é™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class
æ–‡ä»¶ã€‚</p>
<p>é™æ€ä»£ç†çš„æ­¥éª¤</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŒæ ·å®ç°è¿™ä¸ªæ¥å£</li>
<li>å°†ç›®æ ‡å¯¹è±¡æ³¨å…¥è¿›ä»£ç†ç±»ï¼Œç„¶ååœ¨ä»£ç†ç±»çš„å¯¹åº”æ–¹æ³•è°ƒç”¨ç›®æ ‡ç±»ä¸­çš„å¯¹åº”æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»£ç†ç±»å±è”½å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ååšä¸€äº›è‡ªå·±æƒ³åšçš„äº‹æƒ…ã€‚</li>
</ul>
<h2 id="jdk-åŠ¨æ€ä»£ç†">JDK åŠ¨æ€ä»£ç†</h2>
<ul>
<li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li>
<li>è‡ªå®šä¹‰ InvocationHandler å¹¶é‡å†™ invoke æ–¹æ³•ï¼Œåœ¨ invoke
æ–¹æ³•ä¸­æˆ‘ä»¬ä¼šè°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼ˆè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼‰å¹¶è‡ªå®šä¹‰ä¸€äº›å¤„ç†é€»è¾‘ï¼›</li>
<li>é€šè¿‡
<code>Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)</code>
æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼›</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcClientProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨ä»£ç†ç±»å†…ï¼Œæ ¹æ®ä¼ å…¥çš„ç±» clazzï¼Œè·å¾—ä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getProxy</span><span class="params">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(clazz.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[]&#123;clazz&#125;, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å½“é€šè¿‡ä»£ç†ç±»è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯è¿™ä¸ªinvokeï¼ˆä¼ å…¥çš„åªæ˜¯æœåŠ¡æ¥å£ï¼Œå…·ä½“çš„å®ç°åœ¨æœåŠ¡ç«¯å®ç°ç±»ä¸­ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ˜¯å¦‚ä½•è°ƒç”¨æœåŠ¡ç«¯å®ç°ç±»çš„ä»£ç çš„å‘¢ï¼Ÿ<strong>æ³¨å…¥</strong></p>
<ol type="1">
<li>åœ¨å®ä¾‹åŒ– bean ä¹‹åï¼ŒpostProcessAfterInitialization æ–¹æ³•è¢«è°ƒç”¨ã€‚</li>
<li>å¯¹äºæ¯ä¸ª bean ç±»çš„å­—æ®µï¼Œæ£€æŸ¥æ˜¯å¦æ ‡è®°äº† <span class="citation"
data-cites="RpcReference">@RpcReference</span> æ³¨è§£ã€‚</li>
<li>å¦‚æœå‘ç°æ ‡è®°äº† <span class="citation"
data-cites="RpcReference">@RpcReference</span>
æ³¨è§£çš„å­—æ®µï¼Œæ ¹æ®æ³¨è§£ä¸­çš„ä¿¡æ¯åˆ›å»ºç›¸åº”çš„ RpcServiceConfig å¯¹è±¡ã€‚</li>
<li>é€šè¿‡ RpcClientProxy åˆ›å»ºäº†ä¸€ä¸ªä»£ç†å¯¹è±¡
clientProxyï¼Œè¿™ä¸ªä»£ç†å¯¹è±¡å®ç°äº† declaredField.getType()
æ‰€è¡¨ç¤ºçš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£å¯èƒ½å°±æ˜¯ HelloService æ¥å£æˆ–å…¶å®ƒæ¥å£ï¼Œå–å†³äº
helloService å­—æ®µçš„ç±»å‹ã€‚</li>
<li>è¿™ä¸ªä»£ç†å¯¹è±¡ clientProxy ä¼šåœ¨æ–¹æ³•è°ƒç”¨æ—¶å§”æ‰˜ç»™ RpcClientProxy çš„
invoke æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è´Ÿè´£å¤„ç†è¿œç¨‹è°ƒç”¨çš„é€»è¾‘ã€‚</li>
<li>é€šè¿‡åå°„è®¾ç½® clientProxy åˆ° HelloController ç±»çš„ helloService
å­—æ®µä¸Šï¼Œæ›¿æ¢äº†åŸæ¥çš„å­—æ®µå€¼ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">clientProxy</span> <span class="operator">=</span> rpcClientProxy.getProxy(declaredField.getType());</span><br><span class="line">declaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    declaredField.set(bean, clientProxy);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¼ è¾“åè®®">ä¼ è¾“åè®®</h2>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">*   0     1     2     3     4        5     6     7     8         9        10     11     12   13   14 15 16</span><br><span class="line">*   +-----+-----+-----+-----+--------+----+----+----+------+-----------+-------+-------+-----+---+-----+----+</span><br><span class="line">*   |   magic   code        |version | full length         | messageType| codec|compress|    RequestId       |</span><br><span class="line">*   +-----------------------+--------+---------------------+-----------+-----------+-----------+------------+</span><br><span class="line">*   |                                         body                                                            |</span><br><span class="line">*   +-------------------------------------------------------------------------------------------------------+</span><br><span class="line">* 4B  magic codeï¼ˆé­”æ³•æ•°ï¼‰   1B versionï¼ˆç‰ˆæœ¬ï¼‰   4B full lengthï¼ˆæ¶ˆæ¯é•¿åº¦ï¼‰    1B messageTypeï¼ˆæ¶ˆæ¯ç±»å‹ï¼‰</span><br><span class="line">* 1B compressï¼ˆå‹ç¼©ç±»å‹ï¼‰ 1B codecï¼ˆåºåˆ—åŒ–ç±»å‹ï¼‰    4B  requestIdï¼ˆè¯·æ±‚çš„Idï¼‰</span><br></pre></td></tr></table></figure>
<h2 id="æ³¨å†Œä¸­å¿ƒ">æ³¨å†Œä¸­å¿ƒ</h2>
<p>æœåŠ¡æ³¨å†Œï¼šåœ¨ zk é‡Œé¢åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æŒä¹…èŠ‚ç‚¹</p>
<p>å½“æˆ‘ä»¬çš„æœåŠ¡è¢«<strong>æ³¨å†Œè¿› zookeeper</strong>
çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†å®Œæ•´çš„æœåŠ¡åç§° rpcServiceName ï¼ˆclass
name+group+versionï¼‰ä½œä¸ºæ ¹èŠ‚ç‚¹
ï¼Œå­èŠ‚ç‚¹æ˜¯å¯¹åº”çš„æœåŠ¡åœ°å€ï¼ˆip+ç«¯å£å·ï¼‰ã€‚ç›¸å…³ä»£ç åœ¨
<code>ZkServiceProviderImpl.publishService()</code> ä¸­ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦<strong>è·å¾—æŸä¸ªæœåŠ¡å¯¹åº”çš„åœ°å€</strong>çš„è¯ï¼Œå°±ç›´æ¥æ ¹æ®å®Œæ•´çš„æœåŠ¡åç§°æ¥è·å–åˆ°å…¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡å…·ä½“çš„è´Ÿè½½å‡è¡¡ç­–ç•¥å–å‡ºä¸€ä¸ªå°±å¯ä»¥äº†ã€‚ç›¸å…³ä»£ç åœ¨
<code>ZkServiceDiscoveryImpl.lookupService()</code> ä¸­ã€‚</p>
<h3 id="zookeeper-å®¢æˆ·ç«¯">Zookeeper å®¢æˆ·ç«¯</h3>
<blockquote>
<p>Curator æ˜¯ Netflix
å…¬å¸å¼€æºçš„ä¸€å¥—zookeeperå®¢æˆ·ç«¯æ¡†æ¶ï¼Œè§£å†³äº†å¾ˆå¤šZookeeperå®¢æˆ·ç«¯éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘å·¥ä½œï¼ŒåŒ…æ‹¬è¿æ¥é‡è¿ã€åå¤æ³¨å†ŒWatcherå’ŒNodeExistsExceptionå¼‚å¸¸ç­‰ç­‰ã€‚é¡¹ç›®å†…é‡‡ç”¨
CuratorUtils ç±»è°ƒç”¨ Curatorã€‚</p>
</blockquote>
<p>é‡è¯•ç­–ç•¥ï¼šExponentialBackoffRetryæ˜¯æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// zkçš„å¯¹å¤–æ¥å£ï¼Œåé¢æˆ‘ä»¬è¦å¹²ä»€ä¹ˆåªéœ€è¦é€šè¿‡å•ä¾‹æ¨¡å¼è·å¾—è¿™ä¸ªç±»ï¼Œç„¶åç”¨è¿™ä¸ªç±»çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ServiceProvider</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ åˆ°æœ¬åœ° serviceMap ä¸­ï¼ˆè¿œç¨‹Rpcè°ƒç”¨ï¼Œè·å–æœ¬åœ°çš„è°ƒç”¨ç±»ï¼‰</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addService</span><span class="params">(RpcServiceConfig rpcServiceConfig)</span>;</span><br><span class="line">    Object <span class="title function_">getService</span><span class="params">(String rpcServiceName)</span>;</span><br><span class="line">    <span class="comment">// æ³¨å†ŒæœåŠ¡åˆ° zookeeper ä¸­ï¼ˆæœåŠ¡å‘ç°ä¸æ³¨å†Œï¼‰</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">publishService</span><span class="params">(RpcServiceConfig rpcServiceConfig)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h2>
<p>éšæœºé€‰å–ç­–ç•¥ è½®è¯¢ç­–ç•¥ åŠ æƒè½®è¯¢ç­–ç•¥ æœ€å°‘æ´»è·ƒè¿æ¥ç­–ç•¥ ä¸€è‡´æ€§ Hash
ç­–ç•¥</p>
<h2 id="åºåˆ—åŒ–">åºåˆ—åŒ–</h2>
<ul>
<li>åºåˆ—åŒ–ï¼šå°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµ</li>
<li>ååºåˆ—åŒ–ï¼šå°†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµè½¬åŒ–ä¸ºæ•°æ®ç»“æ„æˆ–å¯¹è±¡</li>
</ul>
<p><strong>æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ç²˜åŒ…å’ŒåŠåŒ…é—®é¢˜ï¼Œä½ æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ</strong></p>
<p>è‡ªå®šä¹‰æ¶ˆæ¯ç»“æ„ï¼ˆå…¶ä»–çš„è¿˜æœ‰å›ºå®šé•¿åº¦ä¼ è¾“ã€ç‰¹æ®Šå­—ç¬¦åˆ†å‰²ï¼‰ï¼šMagicNumber
é­”æ•°ã€ContentLength è¯·æ±‚é•¿åº¦</p>
]]></content>
      <categories>
        <category>Javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring</title>
    <url>/#developer/Spring/</url>
    <content><![CDATA[<p>SpringCore ä¸»è¦æä¾› IoC ä¾èµ–æ³¨å…¥åŠŸèƒ½çš„æ”¯æŒ SpringMVC å¿«é€Ÿæ„å»º MVC
æ¶æ„çš„ Web ç¨‹åº SpringBoot ç®€åŒ– Spring å¼€å‘ï¼Œå‡å°‘é…ç½®æ–‡ä»¶ï¼Œå¼€ç®±å³ç”¨</p>
<h1 id="ioc-æ§åˆ¶åè½¬">IOC æ§åˆ¶åè½¬</h1>
<blockquote>
<p>å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶ï¼Œå®ƒæ‰€ä¾èµ–çš„å¯¹è±¡ç”±å¤–éƒ¨ä¼ é€’ç»™å®ƒï¼Œè€Œéè‡ªå·±å»åˆ›å»ºæ‰€ä¾èµ–çš„å¯¹è±¡ï¼ˆæ¯”å¦‚é€šè¿‡newæ“ä½œï¼‰ã€‚å› æ­¤ï¼Œä¹Ÿå¯ä»¥è¯´åœ¨å¯¹è±¡å¦‚ä½•è·å–å®ƒçš„ä¾èµ–å¯¹è±¡è¿™ä»¶äº‹æƒ…ä¸Šï¼Œæ§åˆ¶æƒåè½¬äº†ã€‚è¿™ä¾¿ä¸éš¾ç†è§£æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥è¿™ä¸¤ä¸ªåå­—çš„ç”±æ¥äº†ã€‚</p>
</blockquote>
<p>å°†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»äº¤ç»™ IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ç”± IoC
å®¹å™¨å®Œæˆå¯¹è±¡çš„æ³¨å…¥ Bean å·¥å‚æ¨¡å¼</p>
<ul>
<li>å•ä¾‹ Singletonã€å¤šä¾‹/åŸå‹ Prototype Bean</li>
</ul>
<h1 id="aop-é¢å‘åˆ‡é¢ç¼–ç¨‹">AOP é¢å‘åˆ‡é¢ç¼–ç¨‹</h1>
<p>å°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
å®ç°æ–¹å¼ï¼šåŸºäºåŠ¨æ€ä»£ç†ï¼Œæœ‰æ¥å£ç”¨ jdk åŸç”Ÿçš„ä»£ç†æ–¹æ³•ï¼Œæ²¡å€Ÿå£ç”¨ CGLib
<img data-src="/" class="" title="image-20240521182846989"></p>
<h1 id="bean-ç”Ÿå‘½å‘¨æœŸ">Bean ç”Ÿå‘½å‘¨æœŸ</h1>
<blockquote>
<p>è‡ªåŠ¨è£…é…ï¼š<span class="citation"
data-cites="Component">@Component</span>ï¼›<span class="citation"
data-cites="Service">@Service</span>ï¼›<span class="citation"
data-cites="Controller">@Controller</span>ï¼›<span class="citation"
data-cites="Configure">@Configure</span> + <span class="citation"
data-cites="Bean">@Bean</span></p>
</blockquote>
<img data-src="/" class="" title="image-20240521182854337">
<p>xxx.class --&gt; é»˜è®¤æ— å‚æ„é€ æ–¹æ³• --&gt; æ™®é€šå¯¹è±¡ --&gt;
ä¾èµ–æ³¨å…¥ï¼ˆå±æ€§èµ‹å€¼ï¼‰ --&gt; åˆå§‹åŒ–å‰ --&gt; åˆå§‹åŒ– --&gt; åˆå§‹åŒ–å
--&gt; ä»£ç†å¯¹è±¡ --&gt; å¾—åˆ°Beanï¼ˆ<a
href="https://www.cnblogs.com/chengxuxiaoyuan/p/16321716.html">æºç </a>ï¼‰
å®ä¾‹åŒ– Bean
å¯¹è±¡ï¼šé»˜è®¤è°ƒç”¨æ— å‚æ„é€ å™¨ï¼›è‹¥ä½¿ç”¨æœ‰å‚æ„é€ å™¨ï¼Œå‚æ•°å¿…é¡»æ˜¯å®¹å™¨ä¸­æœ‰çš„Beanã€æŒ‰å‚æ•°æŸ¥æ‰¾
Bean æ—¶ï¼Œå…ˆæŒ‰ç…§ classname åæŒ‰ç…§å‚æ•°åã€‘ åˆå§‹åŒ–å‰ä¸­åï¼šBeanPostProcessor
çš„ postProcessAfterInitialization() --&gt; <span class="citation"
data-cites="PostConstruct">@PostConstruct</span> æ³¨è§£ --&gt;
InitializingBean çš„ afterPropertiesSet() æ–¹æ³• --&gt; BeanPostProcessor
çš„ postProcessAfterInitialization()ï¼ˆå®ç°äº† AOP ä»£ç†)</p>
<ul>
<li>Aware å…¶å®å°±æ˜¯ä¸€ä¸ªæ ‡è¯†ï¼›åªæœ‰æ»¡è¶³ Aware
è§„èŒƒæˆ–è€…å…¶å­ç±»è§„èŒƒçš„æ‰èƒ½è¿›è¡Œç›¸å…³çš„èµ‹å€¼æ“ä½œï¼Œè¿™æ ·åšçš„è¯å¯ä»¥å°‘å†™å¾ˆå¤šåˆ¤æ–­ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œç»Ÿä¸€çš„åˆ¤æ–­èµ‹å€¼ï¼›</li>
<li>BeanPostProcessor
å‰ç½®å¤„ç†å™¨çš„å…³é”®å®ç°ç±»ï¼šApplicationContextAwareProcessor</li>
<li>BeanPostProcessor
åç½®å¤„ç†å™¨çš„å…³é”®å®ç°ç±»ï¼šAbstractAutoProxyCreatorã€‚è¿™ä¸ªæ–¹æ³•è´Ÿè´£å¸®æˆ‘ä»¬åˆ›å»ºä»£ç†ï¼Œåº•å±‚é‡‡ç”¨å¯¹è±¡cglib
æˆ–åŠ¨æ€ä»£ç†ã€AOPå…¶å®å°±æ˜¯ IOC
æ•´ä½“æµç¨‹ï¼ˆBeanç”Ÿå‘½å‘¨æœŸï¼‰é‡Œçš„ä¸€ä¸ªæ‰©å±•ç‚¹ã€‘</li>
<li>InitializingBean æ¥å£ä¸­çš„ afterPropertiesSet
æ–¹æ³•ï¼šåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å»ç¼–å†™æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»¥åŠè¿›è¡Œç›¸å…³çš„å±æ€§èµ‹å€¼ç­‰ç­‰</li>
</ul>
<p>åº•å±‚å®ç°</p>
<ul>
<li>AbstractAutowireCapableBeanFactory å†…çš„ initializeBean è°ƒç”¨äº†æ‰€æœ‰
BeanPostProcessor çš„å®ç°ç±»</li>
<li>ApplicationContext ç±»å‹å®¹å™¨çš„å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª BeanFactory
ç±»å‹çš„å®¹å™¨ï¼ˆAnnotationConfigApplicationContext çš„çˆ¶ç±»
GenericApplicationContext ç»´æŠ¤äº†ä¸€ä¸ª Bean
å·¥å‚å®ç°ç±»ï¼šDefaultListableBeanFactoryï¼‰</li>
<li>DefaultListableBeanFactoryï¼šSpring é»˜è®¤çš„ BeanFactory å®ç°</li>
<li>DefaultSingletonBeanRegistryï¼šDefaultListableBeanFactory
å•ä¾‹æ¨¡å¼å­˜å‚¨å…³ç³»çš„åœ°æ–¹ Map&lt;String(BeanName),Object(instance)&gt;</li>
<li>AbstractApplicationContext.refresh() æ–¹æ³•
<ul>
<li>é…ç½®äº†å¯¹ BeanFactoryPostProcessor çš„å®ç°
postProcessBeanFactory(beanFactory) å’Œå¤„ç†
invokeBeanFactoryPostProcessors(beanFactory)ã€‚BeanFactoryPostProcessor
å¯ä»¥è‡ªå®šä¹‰ ApplicationContext å®¹å™¨ä¸­çš„ BeanFactory
è¿›è¡Œå¤„ç†ï¼Œåœ¨è¿˜æ²¡æœ‰å¯¹ä»»ä½•Beanè¿›è¡Œå®ä¾‹åŒ–ä¹‹å‰ï¼ˆConfigurationClassPostProcessor
é€šè¿‡æ³¨è§£è§£æé…ç½®ç±»ï¼›PropertySourcesPlaceholderConfigurerï¼šxmlé…ç½®æ–‡ä»¶ä¸­å¯¼å…¥çš„
properties æ–‡ä»¶è¿›è¡Œè§£æ,å¹¶æ›¿æ¢beanå®šä¹‰ä¸­çš„å ä½ç¬¦ï¼‰</li>
<li>é…ç½®äº†å¯¹ BeanPostProcessor çš„å®ç°</li>
</ul></li>
</ul>
<hr />
<ol type="1">
<li>(1-1)ä¾èµ–æ³¨å…¥ï¼š<span class="citation"
data-cites="Autowired">@Autowired</span>ï¼›<span class="citation"
data-cites="Resource">@Resource</span></li>
<li>äº‹åŠ¡ <span class="citation"
data-cites="Transactional">@Transactional</span>ã€<span class="citation"
data-cites="Configuration">@Configuration</span></li>
<li>(1-2)å•ä¾‹ Singletonã€å¤šä¾‹/åŸå‹ Prototype Bean</li>
<li>jvmç±»åŠ è½½å™¨classloaderï¼šbootstrap ext app <a
href="https://blog.csdn.net/javazejian/article/details/73413292#:~:text=%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E4%B8%BB%E8%A6%81%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%98%AFJVM%E8%87%AA%E8%BA%AB%E9%9C%80%E8%A6%81%E7%9A%84%E7%B1%BB%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%8A%A0%E8%BD%BD%E4%BD%BF%E7%94%A8C%2B%2B%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%8C%E6%98%AF%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%87%AA%E8%BA%AB%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%8C%E5%AE%83%E8%B4%9F%E8%B4%A3%E5%B0%86%20%3CJAVA_HOME%3E%2Flib%20%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%BA%93%E6%88%96,-Xbootclasspath%20%E5%8F%82%E6%95%B0%E6%8C%87%E5%AE%9A%E7%9A%84%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84jar%E5%8C%85%E5%8A%A0%E8%BD%BD%E5%88%B0%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%8C%E6%B3%A8%E6%84%8F%E5%BF%85%E7%94%B1%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%98%AF%E6%8C%89%E7%85%A7%E6%96%87%E4%BB%B6%E5%90%8D%E8%AF%86%E5%88%AB%E5%8A%A0%E8%BD%BDjar%E5%8C%85%E7%9A%84%EF%BC%8C%E5%A6%82rt.jar%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%96%87%E4%BB%B6%E5%90%8D%E4%B8%8D%E8%A2%AB%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%86%E5%88%AB%EF%BC%8C%E5%8D%B3%E4%BD%BF%E6%8A%8Ajar%E5%8C%85%E4%B8%A2%E5%88%B0lib%E7%9B%AE%E5%BD%95%E4%B8%8B%E4%B9%9F%E6%98%AF%E6%B2%A1%E6%9C%89%E4%BD%9C%E7%94%A8%E7%9A%84%20%28%E5%87%BA%E4%BA%8E%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91%EF%BC%8CBootstrap%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%8F%AA%E5%8A%A0%E8%BD%BD%E5%8C%85%E5%90%8D%E4%B8%BAjava%E3%80%81javax%E3%80%81sun%E7%AD%89%E5%BC%80%E5%A4%B4%E7%9A%84%E7%B1%BB%29%E3%80%82">åšå®¢</a></li>
</ol>
<p>TODO Spring å¯åŠ¨æµç¨‹ Springboot å’Œ Spring æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ä¸éœ€è¦ xml
é…ç½® Springboot è‡ªåŠ¨é…ç½®</p>
<ul>
<li>â€œçº¦å®šä¼˜äºé…ç½®â€ç†å¿µ</li>
<li><span class="citation"
data-cites="EnableAutoConfiguration">@EnableAutoConfiguration</span></li>
<li>è‡ªåŠ¨å°†ä¸€äº›é…ç½®ç±»çš„beanæ³¨å†Œè¿›iocå®¹å™¨</li>
</ul>
<p>logbackæ˜¯ slf4j çš„å®˜æ–¹å®ç°ï¼Œlog4j æ˜¯å¦ä¸€ä¸ªå®ç°ï¼Œlogback å’Œ log4j
æ‰æ˜¯äºŒé€‰ä¸€ï¼Œslf4j æ˜¯é—¨é¢æ—¥å¿—çš„ apiã€‚</p>
<p>TODO <a
href="https://www.cnblogs.com/tuyang1129/p/12861617.html">https://www.cnblogs.com/tuyang1129/p/12861617.html</a>
<a
href="https://www.cnblogs.com/tuyang1129/p/12866484.html">https://www.cnblogs.com/tuyang1129/p/12866484.html</a></p>
<h1 id="spring-äº‹åŠ¡">Spring äº‹åŠ¡</h1>
<p>Spring çš„å£°æ˜å¼äº‹åŠ¡ä¿¡æ¯æ˜¯å­˜åœ¨ ThreadLocal
ä¸­çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹æ°¸è¿œåªèƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰€ä»¥ Spring
çš„äº‹åŠ¡æ˜¯æ— æ³•å®ç°äº‹åŠ¡ä¸€è‡´æ€§ï¼ˆåŒæ—¶æäº¤ã€åŒæ—¶å›æ»šï¼‰çš„</p>
<p>è§£å†³æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œæˆ–è€…é€šè¿‡åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯ï¼šäºŒé˜¶æ®µæäº¤æ–¹å¼</p>
<h1 id="å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–">å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–</h1>
<p><a
href="https://juejin.cn/post/6860785780307492871#heading-1">ä¸‰å±‚ç¼“å­˜è®¾è®¡</a></p>
<ul>
<li>ä¸€çº§ç¼“å­˜ï¼Œç¼“å­˜æ­£å¸¸çš„ bean å®ä¾‹</li>
<li>äºŒçº§ç¼“å­˜ï¼Œç¼“å­˜è¿˜æœªè¿›è¡Œä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–æ–¹æ³•è°ƒç”¨çš„ bean å®ä¾‹</li>
<li>ä¸‰çº§ç¼“å­˜ï¼Œç¼“å­˜ bean å®ä¾‹çš„ ObjectFactoryï¼Œç”¨äºè§£å†³ BeanPostProcessor
ä»£ç†ç±»æ—¶æ­£ç¡®åœ°ä¾èµ–æ³¨å…¥</li>
</ul>
<blockquote>
<p>å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œä¸ç®¡ä½¿ç”¨ä¸‰çº§ç¼“å­˜è¿˜æ˜¯ä¸¤çº§ç¼“å­˜ï¼Œä»£ç†ç±»é€»è¾‘éƒ½å¿…é¡»æå‰æ›å…‰</p>
</blockquote>
]]></content>
      <categories>
        <category>Javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringMVC</title>
    <url>/#developer/SpringMVC/</url>
    <content><![CDATA[<h1 id="tomcat">Tomcat</h1>
<p>Tomcat æ˜¯åŸºäº HTTP åè®®çš„ Web æœåŠ¡å™¨ï¼Œå·¥ä½œæµç¨‹å›¾ <a
href="https://blog.csdn.net/qq_19782019/article/details/80292110">Link</a></p>
<img data-src="/" class="" title="img">
<h2 id="servlet">Servlet</h2>
<p>Servlet æ¥å£å®šä¹‰äº† Servlet ä¸ servletå®¹å™¨
ä¹‹é—´çš„å¥‘çº¦ã€‚è¿™ä¸ªå¥‘çº¦æ˜¯ï¼šServletå®¹å™¨å°†Servletç±»è½½å…¥å†…å­˜ï¼Œå¹¶äº§ç”Ÿ Servlet
å®ä¾‹å’Œè°ƒç”¨å®ƒå…·ä½“çš„æ–¹æ³•ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæ¯ç§
Servlet ç±»å‹åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹</strong>ã€‚ç±»æ¯” SpringMVC ä¸­æ¯ä¸€ä¸ª Mapping
å¯¹åº”ä¸€ä¸ªæ§åˆ¶å±‚æ–¹æ³•ã€ä¸ç¡®å®šã€‘</p>
<p>å¯¹äºæ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ŒServletå®¹å™¨è¿˜ä¼šåˆ›å»ºä¸€ä¸ªServletContextå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä¸­å°è£…äº†ä¸Šä¸‹æ–‡ï¼ˆåº”ç”¨ç¨‹åºï¼‰çš„ç¯å¢ƒè¯¦æƒ…ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ªServletContextã€‚æ¯ä¸ªServletå¯¹è±¡ä¹Ÿéƒ½æœ‰ä¸€ä¸ªå°è£…Servleté…ç½®çš„ServletConfigå¯¹è±¡ã€‚</p>
<h1 id="springmvc">SpringMVC</h1>
<p>æµç¨‹å›¾</p>
<img data-src="/" class="" title="SpringMVCæµç¨‹å›¾">
<ul>
<li>ç”±<code>DispatcherServlet</code>
ä»<code>HandlerMappings</code>ä¸­åŒ¹é…å¯¹åº”çš„<code>Handler</code>ã€‚æ­¤æ—¶åªæ˜¯è·å–åˆ°äº†å¯¹åº”çš„<code>Handler</code>ï¼Œç„¶åæ‹¿ç€è¿™ä¸ª<code>Handler</code>å»å¯»æ‰¾å¯¹åº”çš„é€‚é…å™¨ï¼Œå³ï¼š<code>HandlerAdapter</code>ï¼šè®©å›ºå®šå‚æ•°çš„
Servlet å¤„ç†æ–¹æ³•è°ƒç”¨çµæ´»çš„ Handler æ¥å¤„ç†ï¼›</li>
<li>æ‰§è¡Œ <code>Controller</code> å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œ æ‰§è¡Œå®Œæˆä¹‹åè¿”å›ä¸€ä¸ª
<code>ModeAndView</code> æˆ– Json æ ¼å¼æ•°æ®ï¼›</li>
</ul>
<p>HandlerMapping/HandlerAdapter çš„<strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼š</p>
<p>SpringMVC çš„ Handler æœ‰å¤šç§å®ç°æ–¹å¼ï¼ˆå¦‚ç»§æ‰¿ Controller æ¥å£ã€ç»§æ‰¿
HttpRequestHandler æ¥å£ã€åŸºäºæ³¨è§£ <span class="citation"
data-cites="Controller">@Controller</span>
çš„æ§åˆ¶å™¨ï¼‰ã€‚ç”±äºå®ç°æ–¹å¼ä¸ä¸€æ ·ï¼Œè°ƒç”¨æ–¹å¼å°±ä¸ç¡®å®šï¼Œå°±éœ€è¦é€‚é…å™¨æ¨¡å¼å°†æ‰€æœ‰å®ç°æ–¹å¼éƒ½ç»Ÿä¸€æˆåŒä¸€ä¸ªæ¥å£ã€‚æŠŠä»»ä½•ä¸€ä¸ª
Handler
éƒ½é€‚é…æˆä¸€ä¸ªHandlerAdapterï¼Œä»è€Œå¯ä»¥åšç»Ÿä¸€çš„æµç¨‹å¤„ç†ï¼Œä¸ç”¨è€¦åˆå…·ä½“çš„å¤„ç†å™¨ï¼Œæ¨¡ç³Šæ‰å…·ä½“çš„å®ç°ã€‚</p>
<p>Spring MVCä¼šä¸ºæ¯ä¸€ä¸ªæ ‡è®°äº† <span class="citation"
data-cites="Controller">@Controller</span>
çš„ç±»åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨å®ä¾‹ï¼ˆbeanï¼‰ï¼Œå¹¶ä¸”æ ¹æ®è¿™äº›ç±»ä¸­çš„ <span
class="citation" data-cites="RequestMapping">@RequestMapping</span>
æ³¨è§£æ¥é…ç½® URL åˆ°æ–¹æ³•çš„æ˜ å°„ã€‚è¿™äº›æ˜ å°„ä¿¡æ¯é€šå¸¸ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªå«åš
<code>HandlerMapping</code> çš„ç»„ä»¶ä¸­</p>
<h1 id="ç³»ç»Ÿæƒé™">ç³»ç»Ÿæƒé™</h1>
<p>JWT æ˜¯æ— çŠ¶æ€çš„ï¼Œé€‚åˆåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨</p>
]]></content>
      <categories>
        <category>Javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>SpringMVC</tag>
      </tags>
  </entry>
</search>
